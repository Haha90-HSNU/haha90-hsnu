'use strict';var bspL,bspR,bspMain,con1,con2,con5,labels05,fps=60,log=console.log,titleTime=120,lesson=1,gameMD=0,bsp5=[],isPressing=!1,ff1=0,valueFixed=0,ff2=0,ff5=0;const mm=10,kk=20,gg=5,L0=20,dt=.01;var isPlay=!0;function init(){con1=new THREE.Object3D,con2=new THREE.Object3D,con5=new THREE.Object3D,scene.add(con1).add(con2).add(con5),bspMain=new BlockSpringPair(!0),con1.add(bspMain),bspR=new BlockSpringPair,bspL=new BlockSpringPair,bspL.position.x=-15,bspR.position.x=15,con2.add(bspL).add(bspR),con2.labelR=new TexturePlane(100,100,"textureFext2",1),con2.labelL=new TexturePlane(100,100,"textureFext2",1),con2.labelR.textureGotoAndStop(1),con2.labelL.textureGotoAndStop(0),con2.labelR.position.x=20,con2.labelL.position.x=-20,con2.labelR.position.z=con2.labelL.position.z=5,con2.labelR.position.y=con2.labelL.position.y=10+L0+10,con2.labelR.scale.x=con2.labelR.scale.y=con2.labelL.scale.x=con2.labelL.scale.y=.08,con2.add(con2.labelR).add(con2.labelL);for(var a=0;5>a;a++){let b=new BlockSpringPair;b.position.x=-40+20*a,bsp5.push(b),con5.add(b)}bsp5[0].blockU.visible=bsp5[0].arFext.visible=!1,labels05=new Labels05,labels05.position.z=5.2,con5.add(labels05),con5.king2=new TheKing,con5.king3=new TheKing,con5.king4=new TheKing,con5.king2.position.z=con5.king3.position.z=con5.king4.position.z=5.5,con5.king2.position.y=con5.king3.position.y=con5.king4.position.y=10+L0-mm*gg/kk,con5.king2.position.x=-5,con5.king3.position.x=15,con5.king4.position.x=35,con5.add(con5.king2).add(con5.king3).add(con5.king4),con5.label0=new TexturePlane(200,100,"textureText",1),con5.label1=new TexturePlane(200,100,"textureText",1),con5.label2=new TexturePlane(400,100,"textureFext5",1),con5.label3=new TexturePlane(400,100,"textureFext5",1),con5.label4=new TexturePlane(400,100,"textureFext5",1),con5.label0.textureGotoAndStop(0),con5.label1.textureGotoAndStop(1),con5.label2.textureGotoAndStop(2),con5.label3.textureGotoAndStop(0),con5.label4.textureGotoAndStop(1),con5.label0.position.x=-30,con5.label1.position.x=-30,con5.label2.position.x=0,con5.label3.position.x=20,con5.label4.position.x=40,con5.label0.position.z=con5.label1.position.z=6,con5.label2.position.z=con5.label3.position.z=con5.label4.position.z=6,con5.label0.position.y=10+L0+2.5,con5.label1.position.y=10+L0-5,con5.label2.position.y=con5.label3.position.y=con5.label4.position.y=10+L0+15,con5.label2.scale.x=con5.label2.scale.y=con5.label3.scale.x=con5.label3.scale.y=con5.label4.scale.x=con5.label4.scale.y=.05,con5.label0.scale.x=con5.label0.scale.y=con5.label1.scale.x=con5.label1.scale.y=.05,con5.add(con5.label2).add(con5.label3).add(con5.label4),con5.add(con5.label0).add(con5.label1),world2D.btnM01.on("click",clickMatinBtn),world2D.btnM02.on("click",clickMatinBtn),world2D.btnM05.on("click",clickMatinBtn),world2D.control01.slFext.minimum=-100,world2D.control01.slFext.maximum=500,world2D.control01.slFext.value=0,world2D.control01.btnRelease.on("click",function(){1===lesson&&0===gameMD&&(gameMD=1)}),world2D.control01.btnPlayStop.on("click",function(){1===lesson&&1===gameMD&&(isPlay=!isPlay)}),world2D.control02.btnPressAndRelease.on("mousedown",function(){isPressing=!0}),world2D.control02.btnPressAndRelease.on("pressup",function(){isPressing=!1,0===gameMD&&(gameMD=1)}),world2D.control05.btnPressAndRelease.on("mousedown",function(){isPressing=!0}),world2D.control05.btnPressAndRelease.on("pressup",function(){isPressing=!1,0===gameMD&&(gameMD=1)}),world2D.btnReset.on("click",function(){gameMD=0,ff2=0,ff5=0}),setInterval(tick,1e3/fps)}function tick(){if(titleTime--,60<titleTime?(world2D.title.x=800,world2D.title.y=450,world2D.title.scaleX=world2D.title.scaleY=2):0<titleTime&&(world2D.title.x=(800*titleTime+350*(60-titleTime))/60,world2D.title.y=(450*titleTime+80*(60-titleTime))/60,world2D.title.scaleX=world2D.title.scaleY=(2*titleTime+1*(60-titleTime))/60),world2D.control01.visible=con1.visible=1===lesson,world2D.control02.visible=con2.visible=2===lesson,world2D.control05.visible=con5.visible=5===lesson,1===lesson)world2D.control01.slFext.value=25*Math.round(world2D.control01.slFext.value/25),0===gameMD?(valueFixed=world2D.control01.slFext.value=25*Math.round(world2D.control01.slFext.value/25),ff1=.9*ff1+.1*world2D.control01.slFext.value/100*mm*gg,bspMain.pressF(ff1),isPlay=!0):1===gameMD&&(world2D.control01.slFext.value=valueFixed,bspMain.move()),world2D.control01.btnPlayStop.visible=1===gameMD;else if(2===lesson)0===gameMD?(isPressing?ff2+=1*gg:ff2-=1*gg,ff2>15*gg?ff2=15*gg:0>ff2&&(ff2=0),bspL.pressF(ff2),bspR.pressF(3*ff2)):1===gameMD&&(bspL.move(),bspR.move()),con2.labelR.visible=con2.labelL.visible=0<ff2&&0===gameMD;else if(5===lesson){if(0===gameMD)isPressing?ff5+=1*gg:ff5-=1*gg,ff5>20*gg?ff5=20*gg:0>ff5&&(ff5=0),bsp5[0].pressF(-10*gg),bsp5[1].pressF(0),bsp5[2].pressF(.75*ff5),bsp5[3].pressF(ff5),bsp5[4].pressF(2.25*ff5),con5.king2.setKing(.75*ff5/kk),con5.king3.setKing(ff5/kk),con5.king4.setKing(2.25*ff5/kk),con5.king2.visible=con5.king3.visible=con5.king4.visible=0<ff5;else if(1===gameMD){bsp5[2].move(),bsp5[3].move(),bsp5[4].move(),con5.king2.setKing(.75*ff5/kk),con5.king3.setKing(ff5/kk),con5.king4.visible=con5.king2.visible=con5.king3.visible=!0;let a=5*bsp5[4].blockU.vy**2,b=.5*kk*(bsp5[4].blockU.position.y-bsp5[4].blockD.position.y-10-L0+mm*gg/kk)**2;con5.king4.setKing(Math.sqrt(2*(a+b)/kk))}bsp5[0].blockU.visible=bsp5[0].arFext.visible=!1,con5.label2.visible=con5.label3.visible=con5.label4.visible=0<ff5&&0===gameMD}world2D.control01.btnRelease.visible=0===gameMD,world2D.control02.btnPressAndRelease.visible=0===gameMD,world2D.control05.btnPressAndRelease.visible=0===gameMD,world2D.btnReset.visible=1===gameMD,world3D.cameraTarget.y=10+L0,world3D.render(),world2D.stage.update()}MyJS.myResize();function clickMatinBtn(a){let b=parseInt(a.target.name.charAt(5));b!=lesson&&(lesson=b,gameMD=0,ff2=0,ff5=0)}var TexturePlane=class extends THREE.Object3D{constructor(a,b,c,d){super();let e=this;e.ss=d||1,e.w=a,e.h=b,e.canvas=document.createElement("canvas"),e.canvas.width=e.w*e.ss,e.canvas.height=e.h*e.ss,e.stage=new createjs.Stage(e.canvas),e.eTexture=new lib[c],e.eTexture.scaleX=e.eTexture.scaleY=e.ss,e.stage.addChild(e.eTexture),e.stage.update(),e.mapTexture=new THREE.Texture(e.canvas),e.mapTexture.needsUpdate=!0,e.mapMaterial=new THREE.MeshStandardMaterial({map:e.mapTexture,side:0,roughness:.4,transparent:!0}),e.mesh=new THREE.Mesh(new THREE.PlaneGeometry(e.w,e.h,1,1),e.mapMaterial),e.add(e.mesh)}textureGotoAndStop(a){let b=this;b.eTexture.gotoAndStop(a),b.stage.update(),b.mapTexture.needsUpdate=!0}};class BlockSpringPair extends THREE.Object3D{constructor(a){super();let b=this;b.isMain=a,b.blockU=new THREE.Object3D,b.blockD=new THREE.Object3D,b.spring=new TEACHER.ObjSpring(L0,3,.3,8,16776960),b.arFext=new TEACHER.ObjArrow(1.6,16737894),b.add(b.blockU).add(b.blockD).add(b.spring).add(b.arFext);let c=new TexturePlane(10,10,"textureMassU",10),d=new TexturePlane(10,10,"textureMassD",10);c.position.z=d.position.z=5,b.blockU.add(c),b.blockD.add(d);let e=new THREE.PlaneGeometry(10,10,1,1),f=new TEACHER.MSMat(65535),g=new TEACHER.MSMat(52224);for(var h=0;2>h;h++)for(var k=0;5>k;k++){let a=new THREE.Mesh(e,1>h?f:g);0==k?(a.position.y=5,a.rotation.x=-Math.PI/2):1===k?(a.position.y=-5,a.rotation.x=Math.PI/2):2===k?(a.position.x=5,a.rotation.y=Math.PI/2):3===k?(a.position.x=-5,a.rotation.y=-Math.PI/2):4==k&&(a.position.z=-5,a.rotation.y=Math.PI),1>h?b.blockU.add(a):b.blockD.add(a)}if(b.isMain){b.arMgU=new TEACHER.ObjArrow(1.6,16777215),b.arMgD=new TEACHER.ObjArrow(1.6,16777215),b.arFkU=new TEACHER.ObjArrow(1.6,16776960),b.arFkD=new TEACHER.ObjArrow(1.6,16776960),b.arNmD=new TEACHER.ObjArrow(1.6,16737894),b.ar2in1=new TEACHER.ObjArrow(1.6,16737894),b.wireU=new THREE.Object3D,b.wireD=new THREE.Object3D,b.add(b.wireU).add(b.wireD);for(var h=0;2>h;h++){let a=0==h?b.wireU:b.wireD,e=0==h?65535:52224,c=.5,d=new THREE.BoxGeometry(10,10,10),f=new TEACHER.MSMat(e);for(var k=0;4>k;k++){let b=new THREE.Mesh(d,f);b.scale.y=b.scale.z=c/10,b.position.y=.5*(10-c)*(2>k?1:-1),b.position.z=.5*(10-c)*(0==k%2?1:-1);let e=new THREE.Mesh(d,f);e.scale.x=e.scale.z=c/10,e.position.x=.5*(10-c)*(2>k?1:-1),e.position.z=.5*(10-c)*(0==k%2?1:-1);let g=new THREE.Mesh(d,f);g.scale.x=g.scale.y=c/10,g.position.x=.5*(10-c)*(2>k?1:-1),g.position.y=.5*(10-c)*(0==k%2?1:-1),a.add(b).add(e).add(g)}}b.add(b.arMgU).add(b.arMgD).add(b.arFkU).add(b.arFkD).add(b.arNmD).add(b.ar2in1).add(b.wireU).add(b.wireD),b.fLabelMg=new TexturePlane(200,100,"textureForce",1),b.fLabelFk=new TexturePlane(200,100,"textureForce",1),b.fLabel2in1=new TexturePlane(200,100,"textureForce",1),b.fLabelNm=new TexturePlane(200,100,"textureForce",1),b.fLabelMg.scale.x=b.fLabelMg.scale.y=b.fLabelFk.scale.x=b.fLabelFk.scale.y=b.fLabelNm.scale.x=b.fLabelNm.scale.y=.05,b.fLabel2in1.scale.x=b.fLabel2in1.scale.y=.05,b.fLabelMg.textureGotoAndStop(0),b.fLabelFk.textureGotoAndStop(1),b.fLabel2in1.textureGotoAndStop(2),b.fLabelNm.textureGotoAndStop(3),b.fLabelMg.position.z=b.fLabelFk.position.z=b.fLabel2in1.position.z=b.fLabelNm.position.z=2,b.fLabelMg.position.x=9,b.fLabelFk.position.x=-9,b.fLabel2in1.position.x=15,b.fLabelNm.position.x=3,b.add(b.fLabelMg).add(b.fLabelFk).add(b.fLabel2in1).add(b.fLabelNm)}}pressF(a){let b=this,c=.15;b.Fext=a,b.blockU.position.y=10+L0+5-mm*gg/kk-a/kk,b.blockD.position.y=5,b.spring.position.y=b.blockD.position.y+5,b.blockU.vy=b.blockD.vy=0,b.spring.setSpring(0,L0-mm*gg/kk-a/kk,0),b.arFext.position.y=b.blockU.position.y+5+a*c*(0<a?1:0),b.arFext.setArrow(0,-a*c,0),b.arFext.visible=0<Math.abs(a),b.isMain&&b.setMain()}move(){let a=this,b=world2D.chSlow.checked?1:10,c=1!==lesson||1!==gameMD||isPlay?dt:0;for(var d,e=0;e<b;e++)d=kk*(a.blockU.position.y-a.blockD.position.y-10-L0),a.blockU.vy-=(d/mm+gg)*c,a.blockU.position.y+=a.blockU.vy*c,a.blockD.vy+=(d/mm-gg)*c,a.blockD.position.y+=a.blockD.vy*c,5>a.blockD.position.y&&0>a.blockD.vy&&(a.blockD.vy*=-.8,a.blockD.position.y=5);a.spring.position.y=a.blockD.position.y+5,a.spring.setSpring(0,a.blockU.position.y-a.blockD.position.y-10,0),a.arFext.visible=!1,a.isMain&&a.setMain()}setMain(){let a=this,b=world2D.control01.chArrow.checked,c=.15;if(a.wireU.position.y=a.blockU.position.y,a.wireD.position.y=a.blockD.position.y,b){a.arMgU.position.y=a.blockU.position.y,a.arMgU.position.x=1,a.arMgU.setArrow(0,-10*gg*c,0),a.arMgD.position.y=a.blockD.position.y,a.arMgD.position.x=0,a.arMgD.setArrow(0,-10*gg*c,0);let b=kk*(a.blockU.position.y-a.blockD.position.y-10-L0);a.arFkU.position.y=a.blockU.position.y-5,a.arFkU.position.x=-2.5,a.arFkU.setArrow(0,-b*c,0),a.arFkD.position.y=a.blockD.position.y+5,a.arFkD.position.x=-2.5,a.arFkD.setArrow(0,b*c,0),a.arNmD.position.x=-1,a.arNmD.setArrow(0,Math.max(mm*gg-b,0)*c,0),a.ar2in1.position.x=8,a.ar2in1.position.y=this.blockU.position.y,a.ar2in1.setArrow(0,(-b-mm*gg)*c,0),a.fLabelMg.position.y=this.blockU.position.y-5*gg*c,a.fLabelFk.position.y=this.blockU.position.y-5-.5*b*c,a.fLabel2in1.position.y=this.blockU.position.y+.5*(-b-mm*gg)*c,a.fLabelNm.position.y=.5*Math.max(mm*gg-b,0)*c}a.arFkD.visible=a.arMgD.visible=b,a.fLabelFk.visible=a.fLabelMg.visible=a.arFkU.visible=a.arMgU.visible=b&&!world2D.control01.ch2in1.checked,a.fLabelNm.visible=a.arNmD.visible=b&&5.1>a.blockD.position.y,a.fLabel2in1.visible=a.ar2in1.visible=b&&world2D.control01.ch2in1.checked,a.wireU.visible=a.wireD.visible=b,a.blockD.visible=a.blockU.visible=!b}}class Labels05 extends THREE.Object3D{constructor(){super();let a=this;a.lineO=new TEACHER.Line(255,5,2),a.add(a.lineO),a.lineO.position.y=10+L0,a.lineO.addPoint(-45,0,0),a.lineO.addPoint(45,0,0),a.lineO.update(),a.lineP=new TEACHER.Line(255,5,2),a.add(a.lineP),a.lineP.position.y=10+L0-mm*gg/kk,a.lineP.addPoint(-45,0,0),a.lineP.addPoint(45,0,0),a.lineP.update()}}class TheKing extends THREE.Object3D{constructor(){super();let a=this,b=5;a.barU=new TEACHER.Line(16711680,5,2),a.barM=new TEACHER.Line(16711680,5,2),a.barD=new TEACHER.Line(16711680,5,2),a.barV=new TEACHER.Line(16711680,5,2),a.barU.addPoint(-b/2,0,0),a.barU.addPoint(b/2,0,0),a.barD.addPoint(-b/2,0,0),a.barD.addPoint(b/2,0,0),a.barM.addPoint(-b/2,0,0),a.barM.addPoint(b/2,0,0),a.barV.addPoint(0,10,0),a.barV.addPoint(0,-10,0),a.barU.update(),a.barD.update(),a.barM.update(),a.barV.update(),a.add(a.barU).add(a.barD).add(a.barM).add(a.barV)}setKing(a){let b=this;b.barU.position.y=a,b.barD.position.y=-a,b.barV.setPoint(0,0,a,0),b.barV.setPoint(1,0,-a,0),b.barV.update()}}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);.01<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");world3D.scene.add(ground);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();