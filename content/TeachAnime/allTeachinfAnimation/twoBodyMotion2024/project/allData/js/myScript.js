'use strict';var course01,course02,course03,course04,courseNow,theWall,fps=60,log=console.log,titleTime=120,courseMD=1,gameMD=0,isPlay=!0,isWall=!1,tt=0,dt=.1;const gg=2;var theVTChart,mBall=1,mCar=1,followCenterRatio=0,followCarRatio=0;function init(){grounds.position.y=-1,course01=new TheCourse(1),course02=new TheCourse(2),course03=new TheCourse(3),course04=new TheCourse(4),scene.add(course01).add(course02).add(course03).add(course04),theWall=new TEACHER.ObjBox(10,30,30,10053222),theWall.position.x=-5,scene.add(theWall),theVTChart=new VTChartPlane,theVTChart.position.y=42,theVTChart.position.z=-50,scene.add(theVTChart),world2D.btnPlayStop.on("click",clickBtn),world2D.btnReset.on("click",clickBtn),world2D.btnCourse1.on("click",clickBtnCourse),world2D.btnCourse2.on("click",clickBtnCourse),world2D.btnCourse3.on("click",clickBtnCourse),world2D.btnCourse4.on("click",clickBtnCourse),world2D.rbFollowGround.on("click",clickRB),world2D.rbFollowCenter.on("click",clickRB),world2D.rbFollowCar.on("click",clickRB),world2D.rbFollowGround.checked=!0,world2D.slMMRatio.maximum=7,world2D.slMMRatio.minimum=-7,world2D.slMMRatio.value=0,world2D.slCameraRR.value=150,world2D.chGround.checked=!0,setInterval(tick,1e3/fps)}function tick(){titleTime--,60<titleTime?(world2D.title.x=800,world2D.title.y=450,world2D.title.scaleX=world2D.title.scaleY=2.8):0<titleTime&&(world2D.title.x=(800*titleTime+240*(60-titleTime))/60,world2D.title.y=(450*titleTime+70*(60-titleTime))/60,world2D.title.scaleX=world2D.title.scaleY=(2.8*titleTime+1*(60-titleTime))/60),world2D.slMMRatio.value=Math.round(world2D.slMMRatio.value),0===world2D.slMMRatio.value?(mCar=mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(0)):1===world2D.slMMRatio.value?(mCar=1,mBall=2,world2D.mmText.nnNum1.gotoAndStop(1),world2D.mmText.nnNum2.gotoAndStop(0)):2===world2D.slMMRatio.value?(mCar=1,mBall=5,world2D.mmText.nnNum1.gotoAndStop(2),world2D.mmText.nnNum2.gotoAndStop(0)):3===world2D.slMMRatio.value?(mCar=1,mBall=10,world2D.mmText.nnNum1.gotoAndStop(3),world2D.mmText.nnNum2.gotoAndStop(0)):4===world2D.slMMRatio.value?(mCar=1,mBall=100,world2D.mmText.nnNum1.gotoAndStop(4),world2D.mmText.nnNum2.gotoAndStop(0)):5===world2D.slMMRatio.value?(mCar=1,mBall=1e3,world2D.mmText.nnNum1.gotoAndStop(5),world2D.mmText.nnNum2.gotoAndStop(0)):6===world2D.slMMRatio.value?(mCar=1,mBall=1e4,world2D.mmText.nnNum1.gotoAndStop(6),world2D.mmText.nnNum2.gotoAndStop(0)):7===world2D.slMMRatio.value?(mCar=1,mBall=1e5,world2D.mmText.nnNum1.gotoAndStop(7),world2D.mmText.nnNum2.gotoAndStop(0)):-1===world2D.slMMRatio.value?(mCar=2,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(1)):-2===world2D.slMMRatio.value?(mCar=5,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(2)):-3===world2D.slMMRatio.value?(mCar=10,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(3)):-4===world2D.slMMRatio.value?(mCar=100,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(4)):-5===world2D.slMMRatio.value?(mCar=1e3,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(5)):-6===world2D.slMMRatio.value?(mCar=1e4,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(6)):-7===world2D.slMMRatio.value&&(mCar=1e5,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(7)),1===courseMD?courseNow=course01:2===courseMD?courseNow=course02:3===courseMD?courseNow=course03:4===courseMD&&(courseNow=course04),course01.visible=1===courseMD,course02.visible=2===courseMD,course03.visible=3===courseMD,course04.visible=4===courseMD,0===gameMD?isWall=world2D.chWall.checked:world2D.chWall.checked=isWall,isWall&&15<theWall.position.y&&2>gameMD?(theWall.visible=!0,theWall.position.y-=5,15>theWall.position.y&&(theWall.position.y=15)):!isWall&&150>theWall.position.y?(theWall.visible=!0,theWall.position.y+=5,150<theWall.position.y&&(theWall.position.y=150,theWall.visible=!1)):2===gameMD&&50<courseNow.car.position.x&&150>theWall.position.y&&(theWall.visible=!0,theWall.position.y+=2,150<theWall.position.y&&(theWall.position.y=150,theWall.visible=!1)),0===gameMD?courseNow.resetCourse():1===gameMD?isPlay&&courseNow.goWithWall():2===gameMD&&isPlay&&courseNow.goWithoutWall(),courseNow.mc.position.x=(mCar*(courseNow.car.xc+courseNow.car.position.x)+mBall*courseNow.ball.position.x)/(mCar+mBall),courseNow.mc.position.y=(mCar*(courseNow.car.yc+courseNow.car.position.y)+mBall*courseNow.ball.position.y)/(mCar+mBall),courseNow.mc.visible=world2D.chMC.checked,world2D.chVT.visible=3>courseMD,3>courseMD&&world2D.chVT.checked&&(tt+=5*dt,theVTChart.updateVT()),theVTChart.visible=world2D.chVT.checked,world2D.slMMRatio.visible=0===gameMD,world2D.btnPlayStop.visible=3>gameMD,world2D.btnReset.visible=1<gameMD,300<courseNow.mc.position.x&&(courseNow.ball.xx-=600,courseNow.car.xx-=600,world3D.cameraTarget.x-=600),world2D.rbFollowGround.checked?(followCenterRatio-=.05,followCarRatio-=.05,followCenterRatio=Math.max(followCenterRatio,0),followCarRatio=Math.max(followCarRatio,0)):world2D.rbFollowCenter.checked?(followCenterRatio+=.05,followCarRatio-=.05,followCenterRatio=Math.min(followCenterRatio,1),followCarRatio=Math.max(followCarRatio,0)):world2D.rbFollowCar.checked&&(followCenterRatio-=.05,followCarRatio+=.05,followCenterRatio=Math.max(followCenterRatio,0),followCarRatio=Math.min(followCarRatio,1)),world2D.slCameraRR.value=10*Math.round(world2D.slCameraRR.value/10);let a=1===courseMD?55:2===courseMD?30:35;let b=followCenterRatio*courseNow.mc.position.x+followCarRatio*(courseNow.car.position.x+a)+(1-followCenterRatio)*(1-followCarRatio)*a,c=3>courseMD?10:15;0===gameMD?(world3D.cameraTarget.x=.92*world3D.cameraTarget.x+.08*b,world3D.cameraTarget.y=.92*world3D.cameraTarget.y+.08*c):(world3D.cameraTarget.x=b,world3D.cameraTarget.y=c),theVTChart.position.x=world3D.cameraTarget.x,world2D.chTrace.visible=2<courseMD,courseNow.traceBall.visible=2<courseMD&&world2D.chTrace.checked,courseNow.traceBall.position.x=world3D.cameraTarget.x,grounds.visible=world2D.chGround.checked,world3D.render(),world2D.stage.update()}MyJS.myResize();function clickRB(a){let b=a.target.parent.name;world2D.rbFollowGround.checked="rbFollowGround"===b,world2D.rbFollowCenter.checked="rbFollowCenter"===b,world2D.rbFollowCar.checked="rbFollowCar"===b}function clickBtn(a){let b=a.target.name;"btnPlayStop"===b?0===gameMD?(gameMD=isWall?1:2,isPlay=!0):3>gameMD&&(isPlay=!isPlay):"btnReset"===b&&(isPlay=!0,gameMD=0,theVTChart.clearVT())}function clickBtnCourse(a){let b=a.target.name;courseMD!=parseInt(b.charAt(9))&&(courseMD=parseInt(b.charAt(9)),isPlay=!0,gameMD=0),world2D.slCameraRR.value=1===courseMD?150:120}class TheCourse extends THREE.Object3D{constructor(a){super();let b=this;b.cMD=a,b.ball=new TheBall(a,b),b.car=new TheCar(a,b),b.traceBall=new FireSmoke(1e3),b.add(b.ball).add(b.car).add(b.traceBall),b.mc=new THREE.Object3D,b.mc.add(new TEACHER.ObjBox(6,.6,.6,16776960)),b.mc.add(new TEACHER.ObjBox(.6,6,.6,16776960)),b.mc.add(new TEACHER.ObjBox(.6,.6,6,16776960)),b.add(b.mc)}resetCourse(){let a=this;if(a.car.position.x=0,1===a.cMD)a.ball.xx=5+a.car.spL0-5+a.ball.size/2,a.car.xx=0,a.ball.vx=0,a.car.vx=0,a.ball.position.x=a.ball.xx,a.car.position.x=0,a.car.springL.setSpring(5,0,0),a.car.springR.setSpring(-10,0,0),a.vc=0,a.xc=0,a.moveMD="shmL";else if(2===a.cMD)a.ball.xx=a.car.size+a.car.spL0-20,a.car.xx=0,a.ball.vx=0,a.car.vx=0,a.ball.position.x=a.ball.xx+a.ball.size/2,a.car.position.x=0,a.car.spring.setSpring(a.ball.xx-a.car.xx-a.car.size,0,0),a.vc=0,a.xc=(mCar*(a.car.xx+a.car.size/2)+mBall*(a.ball.xx+a.ball.size/2))/(mCar+mBall),a.shmTime=0,a.vc=0,isWall?(a.ball.shmRR=20,a.car.shmRR=0,a.shmOmega=Math.sqrt(a.car.spKK/mBall),a.phi0=0,a.ball.x0=a.ball.xx=a.car.size+a.car.spL0,a.car.x0=a.car.xx=a.car.size):(a.ball.shmRR=20*mCar/(mBall+mCar),a.car.shmRR=20*mBall/(mBall+mCar),a.shmOmega=Math.sqrt(a.car.spKK/(mBall*mCar)*(mBall+mCar)),a.phi0=0,a.ball.x0=a.ball.xx=a.car.size+a.car.spL0-20+a.ball.shmRR,a.car.x0=a.car.xx=a.car.size-a.car.shmRR);else if(3===a.cMD||4===a.cMD){if(a.vc=0,a.car.xx=0,a.ball.xx=5,a.ball.yy=5+a.car.innerRR,a.ball.vx=0,a.ball.vy=0,a.ball.omega=0,a.ball.theta=-Math.PI/2,a.ball.position.x=a.ball.xx+a.ball.RR,a.ball.position.y=a.ball.yy,a.car.position.x=a.car.xx,4===a.cMD){let b=a.car.innerRR;a.car.bar.position.x=.5*(a.ball.position.x+a.car.position.x+5+b)-a.car.position.x,a.car.bar.position.y=.5*(a.ball.yy+5+b),a.car.bar.rotation.z=Math.atan2(a.ball.position.x-(a.car.position.x+5+b),5+b-a.ball.yy)}a.theta0=Math.PI/2,a.yTime=Math.sqrt(2*a.car.innerRR/gg),a.ballDir=a.ballDirOld=1,a.xc=(mBall*a.ball.xx+mCar*(a.car.xx+5+a.car.innerRR))/(mBall+mCar)}a.traceBall.zero()}goWithWall(){let a=this;if(1===a.cMD){let b=a.car.spKK*(a.ball.xx-a.car.xx-5-a.ball.size/2-a.car.spL0);a.car.xx=0,a.ball.xx+=a.ball.vx*dt-.5*b/mBall*dt*dt,a.ball.vx+=-b/mBall*dt,a.vc=mBall*a.ball.vx/(mBall+mCar),a.ball.position.x=a.ball.xx,a.car.springL.setSpring(a.ball.xx-5,0,0),a.car.springR.setSpring(-10,0,0),(0<a.ball.xx-a.car.xx-5-a.car.spL0-a.ball.size/2||a.ball.vx>5*Math.sqrt(a.car.spKK/mBall))&&(gameMD=2,a.moveMD="+1",a.ball.vx=5*Math.sqrt(a.car.spKK/mBall),a.car.xx=0,a.vc=5*mBall*Math.sqrt(a.car.spKK/mBall)/(mBall+mCar))}else if(2===a.cMD)a.car.xx=0,a.ball.xx=a.car.size+a.car.spL0-a.ball.shmRR*Math.cos(a.shmOmega*a.shmTime),a.shmTime+=dt,a.ball.vx=a.shmOmega*a.ball.shmRR*Math.sin(a.shmOmega*a.shmTime),a.car.vx=0,a.vc=mBall*a.ball.vx/(mBall+mCar),a.ball.position.x=a.ball.xx+a.ball.size/2,a.car.position.x=a.car.xx,a.car.spring.position.x=a.car.xx+a.car.size,a.car.spring.setSpring(a.ball.xx-a.car.xx-a.car.size,0,0),a.ball.xx>a.car.xx+a.car.size+a.car.spL0&&(gameMD=2,a.ball.x0=a.ball.xx=a.car.size+a.car.spL0,a.car.x0=a.car.xx=a.car.size,a.vc=20*mBall*Math.sqrt(a.car.spKK/mBall)/(mBall+mCar),a.shmOmega=Math.sqrt(a.car.spKK/(mBall*mCar)*(mBall+mCar)),a.ball.shmRR=(20*Math.sqrt(a.car.spKK/mBall)-a.vc)/a.shmOmega,a.car.shmRR=a.ball.shmRR*mBall/mCar,a.shmTime=0,a.phi0=.25*2*Math.PI);else if(3===a.cMD||4===a.cMD){a.ball.theta>Math.PI/2?(a.ball.theta=Math.PI/2,a.ball.omega=0):a.ball.theta<-Math.PI/2&&(a.ball.theta=-Math.PI/2,a.ball.omega=0);let b=Math.cos(a.ball.theta),c=Math.sin(a.ball.theta),d=a.car.innerRR;if(a.ball.theta+=a.ball.omega*dt-1*c/d*dt*dt,a.ball.omega-=gg*c/d*dt,b=Math.cos(a.ball.theta),c=Math.sin(a.ball.theta),a.ball.xx=5+d*(1+c),a.ball.yy=5+d*(1-b),a.car.position.x=0,a.car.position.y=0,a.ball.position.x=a.ball.xx-a.ball.RR*c,a.ball.position.y=a.ball.yy+a.ball.RR*b,4===a.cMD){let b=a.car.innerRR;a.car.bar.position.x=.5*(a.ball.position.x+a.car.position.x+5+b)-a.car.position.x,a.car.bar.position.y=.5*(a.ball.yy+5+b),a.car.bar.rotation.z=Math.atan2(a.ball.position.x-(a.car.position.x+5+b),5+b-a.ball.yy)}a.ball.xx>5+d&&(gameMD=2,a.ball.vx=Math.sqrt(4*d),a.ball.vy=0,a.car.vx=0,a.vc=(mBall*a.ball.vx+mCar*a.car.vx)/(mBall+mCar),a.ball.vxc=a.ball.vx-a.vc,a.car.vxc=a.car.vx-a.vc,a.theta0=Math.acos(mBall/(mCar+mBall)),a.ball.theta=0,a.ball.omega=Math.sqrt(4/d),a.xc=(mBall*a.ball.xx+mCar*(a.car.xx+5+a.car.innerRR))/(mBall+mCar),a.ballDir=a.ballDirOld=1)}world2D.chTrace.checked&&(a.traceBall.addOne(a.ball.position.x-world3D.cameraTarget.x,a.ball.position.y,a.ball.position.z,1,0,0,7),a.traceBall.update())}goWithoutWall(){let a=this;if(1===a.cMD){if(a.pMax=isWall?5*Math.sqrt(mCar/(mBall+mCar)):5,"shmL"===a.moveMD){let b=a.car.spKK*(a.ball.xx-a.car.xx-5-a.ball.size/2-a.car.spL0);a.ball.xx+=a.ball.vx*dt-.5*b/mBall*dt*dt,a.ball.vx+=-b/mBall*dt,a.car.xx+=a.car.vx*dt+.5*b/mCar*dt*dt,a.car.vx+=b/mCar*dt,a.car.springL.setSpring(a.ball.xx-a.car.xx-5-a.ball.size/2,0,0),a.car.springR.setSpring(-10,0,0),(0<a.ball.xx-a.car.xx-5-a.car.spL0-a.ball.size/2||a.ball.vx>a.pMax*Math.sqrt(a.car.spKK/mBall*mCar/(mCar+mBall))+a.vc)&&(a.moveMD="+1",a.ball.vx=a.pMax*Math.sqrt(a.car.spKK/mBall*mCar/(mCar+mBall))+a.vc,a.car.vx=-a.pMax*Math.sqrt(a.car.spKK/mBall*mCar/(mCar+mBall))*mBall/mCar+a.vc)}else if("+1"===a.moveMD)a.ball.xx+=a.ball.vx*dt,a.car.xx+=a.car.vx*dt,a.car.springL.setSpring(10,0,0),a.car.springR.setSpring(-10,0,0),0<a.ball.xx+a.ball.size/2-(a.car.xx+5+100-a.car.spL0)&&(a.moveMD="shmR");else if("shmR"===a.moveMD){let b=a.car.spKK*(a.ball.xx+a.ball.size/2-(a.car.xx+5+100-a.car.spL0));a.ball.xx+=a.ball.vx*dt-.5*b/mBall*dt*dt,a.ball.vx+=-b/mBall*dt,a.car.xx+=a.car.vx*dt+.5*b/mCar*dt*dt,a.car.vx+=b/mCar*dt,a.car.springL.setSpring(10,0,0),a.car.springR.setSpring(-10+(a.ball.xx+a.ball.size/2)-(a.car.xx+5+100-a.car.spL0),0,0),(0>a.ball.xx+a.ball.size/2-(a.car.xx+5+100-a.car.spL0)||a.ball.vx<-a.pMax*Math.sqrt(a.car.spKK/mBall*mCar/(mCar+mBall))+a.vc)&&(a.moveMD="-1",a.ball.vx=-a.pMax*Math.sqrt(a.car.spKK/mBall*mCar/(mCar+mBall))+a.vc,a.car.vx=a.pMax*Math.sqrt(a.car.spKK/mBall*mCar/(mCar+mBall))*mBall/mCar+a.vc)}else"-1"===a.moveMD&&(a.ball.xx+=a.ball.vx*dt,a.car.xx+=a.car.vx*dt,a.car.springL.setSpring(10,0,0),a.car.springR.setSpring(-10,0,0),0>a.ball.xx-a.ball.size/2-(a.car.xx+5+a.car.spL0)&&(a.moveMD="shmL"));a.ball.position.x=a.ball.xx,a.car.position.x=a.car.xx}else if(2===a.cMD)a.ball.xx=a.ball.x0+a.vc*a.shmTime-a.ball.shmRR*Math.cos(a.shmOmega*a.shmTime+a.phi0),a.car.xx=a.car.x0+a.vc*a.shmTime+a.car.shmRR*Math.cos(a.shmOmega*a.shmTime+a.phi0),a.shmTime+=dt,a.ball.vx=a.vc+a.shmOmega*a.ball.shmRR*Math.sin(a.shmOmega*a.shmTime+a.phi0),a.car.vx=a.vc-a.shmOmega*a.car.shmRR*Math.sin(a.shmOmega*a.shmTime+a.phi0),a.ball.position.x=a.ball.xx+a.ball.size/2,a.car.position.x=a.car.xx-a.car.size,a.car.spring.position.x=a.car.size,a.car.spring.setSpring(a.ball.xx-a.car.xx,0,0);else if(3===a.cMD||4===a.cMD){if(0<a.vc||3>mBall/mCar){a.ball.theta>a.theta0?(a.ball.theta=a.theta0,a.ball.omega=0):a.ball.theta<-a.theta0&&(a.ball.theta=-a.theta0,a.ball.omega=0);let b=Math.cos(a.ball.theta),c=Math.sin(a.ball.theta),d=a.car.innerRR,e=(-2/d*c-mBall/(mBall+mCar)*c*b*a.ball.omega*a.ball.omega)/(1-mBall/(mBall+mCar)*b*b);if(a.ball.theta+=a.ball.omega*dt+.5*e*dt*dt,a.ball.omega+=e*dt,b=Math.cos(a.ball.theta),c=Math.sin(a.ball.theta),.995>Math.abs(a.ball.theta/a.theta0)){let e=Math.sqrt(4*(b-Math.cos(a.theta0))*(mBall+mCar)/d/(mCar+mBall*c*c));a.ball.omega=e*(0>a.ball.omega?-1:1)}a.car.vxc=-mBall/(mBall+mCar)*d*a.ball.omega*b,a.car.xx+=(a.car.vxc+a.vc)*dt,a.ball.xx=a.car.xx+5+d*(1+c),a.ball.yy=5+d*(1-b),a.car.position.x=a.car.xx,a.car.position.y=0,a.ball.position.x=a.ball.xx-a.ball.RR*c,a.ball.position.y=a.ball.yy+a.ball.RR*b}else{let b=a.car.innerRR,c=b*mCar/(mCar+mBall),d=Math.sqrt(4*b*(1-Math.cos(a.theta0))),e=b*(1-Math.cos(a.theta0));a.ball.yy=d*a.yTime-1*a.yTime**2+5,a.ball.vy=d-gg*a.yTime,a.yTime+=dt,a.xc+=a.vc*dt,a.ballDir=a.yTime<Math.sqrt(2*b*(1-Math.cos(a.theta0))/gg)?-a.ballDirOld:a.ballDirOld,5>a.ball.yy&&0>a.ball.vy&&(a.yTime=0,a.ball.yy=5,a.ball.vy=d,a.ballDirOld*=-1),a.ball.xx=-c*Math.sqrt(1-((a.ball.yy-5-e)/e)**2)*a.ballDirOld+a.xc,a.car.xx=a.xc-(a.ball.xx-a.xc)*mBall/mCar-5-b,a.car.position.x=a.car.xx-a.ball.RR*(a.ballDirOld-1),a.car.position.y=0,a.ball.position.x=a.ball.xx+a.ball.RR,a.ball.position.y=a.ball.yy+a.ball.RR*Math.abs(a.ball.vy/d)}if(4===a.cMD){let b=a.car.innerRR;a.car.bar.position.x=.5*(a.ball.position.x+a.car.position.x+5+b)-a.car.position.x,a.car.bar.position.y=.5*(a.ball.yy+5+b),a.car.bar.rotation.z=Math.atan2(a.ball.position.x-(a.car.position.x+5+b),5+b-a.ball.yy)}}world2D.chTrace.checked&&(a.traceBall.addOne(a.ball.position.x-world3D.cameraTarget.x,a.ball.position.y,a.ball.position.z,1,0,0,7),a.traceBall.update())}}class TheBall extends THREE.Object3D{constructor(a){super();let b=this;1===a?(b.size=10,b.ball=new TEACHER.ObjBox(b.size,b.size,b.size,65535),b.position.y=5+b.size/2,b.add(b.ball)):2===a?(b.size=20,b.ball=new TEACHER.ObjBox(b.size,b.size,b.size,65535),b.position.y=b.size/2,b.add(b.ball)):(3==a||4==a)&&(b.RR=2,b.ball=new TEACHER.ObjSphere(b.RR,16711680),b.add(b.ball))}}class TheCar extends THREE.Object3D{constructor(a,b){super();let c=this;1===a?(c.buildBody1(b),c.xc=55,c.yc=10):2===a?(c.buildBody2(b),c.xc=10,c.yc=10):3===a?(c.buildBody3(b),c.xc=35,c.yc=10):4==a&&(c.buildBody4(b),c.xc=35,c.yc=10)}buildBody1(){let a=this;a.widthBig=100,a.widthSmall=80;let b=new TEACHER.MSMat(39423);a.solid=new THREE.Object3D,a.add(a.solid);let c=new THREE.PlaneGeometry(5,20,1,1),d=new THREE.Mesh(c,b);d.position.y=15,d.position.x=+2.5,d.rotation.x=-Math.PI/2,a.solid.add(d),c=new THREE.PlaneGeometry(a.widthBig,20,1,1),d=new THREE.Mesh(c,b),d.position.x=5+a.widthBig/2,d.position.y=5,d.rotation.x=-Math.PI/2,a.solid.add(d),c=new THREE.PlaneGeometry(5,20,1,1),d=new THREE.Mesh(c,b),d.position.y=15,d.position.x=7.5+a.widthBig,d.rotation.x=-Math.PI/2,a.solid.add(d),c=new THREE.PlaneGeometry(a.widthBig+10,20,1,1),d=new THREE.Mesh(c,b),d.position.x=5+a.widthBig/2,d.rotation.x=Math.PI/2,a.solid.add(d),c=new THREE.PlaneGeometry(20,15,1,1),d=new THREE.Mesh(c,b),d.position.x=a.widthBig+10,d.position.y=15/2,d.rotation.y=Math.PI/2,a.solid.add(d),c=new THREE.PlaneGeometry(20,15,1,1),d=new THREE.Mesh(c,b),d.position.x=0,d.position.y=15/2,d.rotation.y=-Math.PI/2,a.solid.add(d),c=new THREE.PlaneGeometry(20,10,1,1),d=new THREE.Mesh(c,b),d.position.x=5,d.position.y=10,d.rotation.y=+Math.PI/2,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=a.widthBig+5,d.position.y=10,d.rotation.y=-Math.PI/2,a.solid.add(d),c=new THREE.PlaneGeometry(5,15,1,1),d=new THREE.Mesh(c,b),d.position.x=2.5,d.position.y=15/2,d.position.z=10,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=7.5+a.widthBig,d.position.y=15/2,d.position.z=10,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=7.5+a.widthBig,d.position.y=15/2,d.position.z=-10,d.rotation.y=Math.PI,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=2.5,d.position.y=15/2,d.position.z=-10,d.rotation.y=Math.PI,a.solid.add(d),c=new THREE.PlaneGeometry(a.widthBig,5,1,1),d=new THREE.Mesh(c,b),d.position.x=5+a.widthBig/2,d.position.y=5/2,d.position.z=10,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=5+a.widthBig/2,d.position.y=5/2,d.position.z=-10,d.rotation.y=Math.PI,a.solid.add(d),a.spL0=10,a.spKK=1,a.springL=new TEACHER.ObjSpring(a.spL0,2,.4,6,11184640),a.springR=new TEACHER.ObjSpring(a.spL0,2,.4,6,11184640),a.springL.position.x=5,a.springR.position.x=5+a.widthBig,a.springL.position.y=a.springR.position.y=10,a.springL.setSpring(a.spL0,0,0),a.springR.setSpring(-a.spL0,0,0),a.solid.add(a.springL).add(a.springR),c=new THREE.CylinderGeometry(3,3,2,16),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5,d.position.z=11,a.solid.add(d),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5+a.widthBig,d.position.z=11,a.solid.add(d),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5,d.position.z=-11,a.solid.add(d),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5+a.widthBig,d.position.z=-11,a.solid.add(d)}buildBody2(){let a=this;a.size=20;let b=new TEACHER.MSMat(39423);a.solid=new THREE.Object3D,a.add(a.solid);let c=new THREE.BoxGeometry(a.size,a.size,a.size,1,1,1),d=new THREE.Mesh(c,b);d.position.x=.5*a.size,d.position.y=.5*a.size,a.solid.add(d),a.spL0=50,a.spKK=.5,a.spring=new TEACHER.ObjSpring(a.spL0,3,1,8,16776960),a.spring.position.x=5,a.spring.position.x=a.size,a.spring.position.y=a.size/2,a.spring.setSpring(a.spL0,0,0),a.solid.add(a.spring)}buildBody3(){let a=this;a.innerRR=30;let b=30,c=new TEACHER.MSMat(39423);a.solid=new THREE.Object3D,a.add(a.solid);let d=new THREE.PlaneGeometry(100,100,30,1);for(var e=0;e<=b;e++){let c=e/b*Math.PI,f=5+a.innerRR-a.innerRR*Math.cos(c),g=5+a.innerRR-a.innerRR*Math.sin(c);d.attributes.position.array[3*e+0]=f,d.attributes.position.array[3*e+1]=g,d.attributes.position.array[3*e+2]=-10,d.attributes.position.array[3*(e+b+1)+0]=f,d.attributes.position.array[3*(e+b+1)+1]=g,d.attributes.position.array[3*(e+b+1)+2]=10}d.computeVertexNormals();let f=new THREE.Mesh(d,c);a.solid.add(f),d=new THREE.PlaneGeometry(5,20,1,1),f=new THREE.Mesh(d,c),f.rotation.x=-Math.PI/2,f.position.y=5+a.innerRR,f.position.x=2.5,a.solid.add(f),f=new THREE.Mesh(d,c),f.rotation.x=-Math.PI/2,f.position.y=5+a.innerRR,f.position.x=7.5+2*a.innerRR,a.solid.add(f),d=new THREE.PlaneGeometry(100,100,30,1);for(var e=0;e<=b;e++){let c=e/b*Math.PI,f=5+a.innerRR-a.innerRR*Math.cos(c),g=5+a.innerRR-a.innerRR*Math.sin(c);d.attributes.position.array[3*e+0]=f,d.attributes.position.array[3*e+1]=g,d.attributes.position.array[3*e+2]=10,d.attributes.position.array[3*(e+b+1)+0]=f,d.attributes.position.array[3*(e+b+1)+1]=0,d.attributes.position.array[3*(e+b+1)+2]=10}d.computeVertexNormals(),f=new THREE.Mesh(d,c),a.solid.add(f),d=new THREE.PlaneGeometry(100,100,30,1);for(var e=0;e<=b;e++){let c=(b-e)/b*Math.PI,f=5+a.innerRR-a.innerRR*Math.cos(c),g=5+a.innerRR-a.innerRR*Math.sin(c);d.attributes.position.array[3*e+0]=f,d.attributes.position.array[3*e+1]=g,d.attributes.position.array[3*e+2]=-10,d.attributes.position.array[3*(e+b+1)+0]=f,d.attributes.position.array[3*(e+b+1)+1]=0,d.attributes.position.array[3*(e+b+1)+2]=-10}d.computeVertexNormals(),f=new THREE.Mesh(d,c),a.solid.add(f),d=new THREE.PlaneGeometry(5,5+a.innerRR,1,1),f=new THREE.Mesh(d,c),f.position.y=(5+a.innerRR)/2,f.position.x=2.5,f.position.z=10,a.solid.add(f),f=new THREE.Mesh(d,c),f.position.y=(5+a.innerRR)/2,f.position.x=7.5+2*a.innerRR,f.position.z=10,a.solid.add(f),f=new THREE.Mesh(d,c),f.position.y=(5+a.innerRR)/2,f.position.x=2.5,f.position.z=-10,f.rotation.y=Math.PI,a.solid.add(f),f=new THREE.Mesh(d,c),f.position.y=(5+a.innerRR)/2,f.position.x=7.5+2*a.innerRR,f.position.z=-10,f.rotation.y=Math.PI,a.solid.add(f),d=new THREE.PlaneGeometry(10+2*a.innerRR,20,1,1),f=new THREE.Mesh(d,c),f.rotation.x=Math.PI/2,f.position.x=5+a.innerRR,a.add(f),d=new THREE.PlaneGeometry(20,5+a.innerRR,1,1),f=new THREE.Mesh(d,c),f.rotation.y=-Math.PI/2,f.position.y=(5+a.innerRR)/2,f.position.x=0,a.solid.add(f),f=new THREE.Mesh(d,c),f.rotation.y=Math.PI/2,f.position.y=(5+a.innerRR)/2,f.position.x=10+2*a.innerRR,a.solid.add(f),d=new THREE.CylinderGeometry(3,3,2,16),f=new THREE.Mesh(d,c),f.rotation.x=Math.PI/2,f.position.y=2,f.position.x=5,f.position.z=11,a.solid.add(f),f=new THREE.Mesh(d,c),f.rotation.x=Math.PI/2,f.position.y=2,f.position.x=5+2*a.innerRR,f.position.z=11,a.solid.add(f),f=new THREE.Mesh(d,c),f.rotation.x=Math.PI/2,f.position.y=2,f.position.x=5,f.position.z=-11,a.solid.add(f),f=new THREE.Mesh(d,c),f.rotation.x=Math.PI/2,f.position.y=2,f.position.x=5+2*a.innerRR,f.position.z=-11,a.solid.add(f)}buildBody4(){let a=this;a.innerRR=30;let b=new TEACHER.MSMat(39423);a.solid=new THREE.Object3D,a.add(a.solid);let c=new THREE.BoxGeometry(2,5+a.innerRR,2,1,1,1),d=new THREE.Mesh(c,b);d.position.x=1,d.position.y=.5*(5+a.innerRR),d.position.z=9,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=10+2*a.innerRR-1,d.position.y=.5*(5+a.innerRR),d.position.z=9,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=10+2*a.innerRR-1,d.position.y=.5*(5+a.innerRR),d.position.z=-9,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=1,d.position.y=.5*(5+a.innerRR),d.position.z=-9,a.solid.add(d),c=new THREE.BoxGeometry(10+2*a.innerRR,2,2,1,1,1),d=new THREE.Mesh(c,b),d.position.x=.5*(10+2*a.innerRR),d.position.y=5+a.innerRR-1,d.position.z=9,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=.5*(10+2*a.innerRR),d.position.y=5+a.innerRR-1,d.position.z=-9,a.solid.add(d),c=new THREE.BoxGeometry(2,2,20,1,1,1),d=new THREE.Mesh(c,b),d.position.x=10+2*a.innerRR-1,d.position.y=5+a.innerRR-1,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=1,d.position.y=5+a.innerRR-1,a.solid.add(d),d=new THREE.Mesh(c,b),d.position.x=5+a.innerRR,d.position.y=5+a.innerRR-1,a.solid.add(d),c=new THREE.BoxGeometry(10+2*a.innerRR,4,20,1,1,1),d=new THREE.Mesh(c,b),d.position.x=5+a.innerRR,d.position.y=2,a.solid.add(d),a.bar=new TEACHER.ObjCylinder(.5,a.innerRR-2,65535),a.add(a.bar),c=new THREE.CylinderGeometry(3,3,2,16),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5,d.position.z=11,a.solid.add(d),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5+2*a.innerRR,d.position.z=11,a.solid.add(d),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5,d.position.z=-11,a.solid.add(d),d=new THREE.Mesh(c,b),d.rotation.x=Math.PI/2,d.position.y=2,d.position.x=5+2*a.innerRR,d.position.z=-11,a.solid.add(d)}}class FireSmoke extends THREE.Object3D{constructor(a){super();let b=this;b.nn=a,b.iNow=0,b.xxiNow=0,b.velocities,b.velocities=new Float32Array(3*b.nn),b.positions=new Float32Array(3*b.nn),b.colors=new Float32Array(3*b.nn),b.sizes=new Float32Array(b.nn),b.ages=new Float32Array(b.nn);const c=new THREE.Vector3,d=new THREE.Color(16777215);for(let e=0;e<b.nn;e++)c.x=0,c.y=0,c.z=0,c.toArray(b.positions,3*e),d.setHSL(.5+.1*(e/b.nn),.7,.5),d.toArray(b.colors,3*e),b.sizes[e]=2,b.ages[e]=-1;const e=new THREE.BufferGeometry;e.setAttribute("position",new THREE.BufferAttribute(b.positions,3)),e.setAttribute("customColor",new THREE.BufferAttribute(b.colors,3)),e.setAttribute("size",new THREE.BufferAttribute(b.sizes,1));const f=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(16777215)},pointTexture:{value:new THREE.TextureLoader().load("allData/pics/ball.png")}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0});b.points=new THREE.Points(e,f),b.add(b.points)}zero(){let a=this;a.iNow=0,a.xxiNow=0;const b=a.points.geometry,c=b.attributes;for(var d=0;d<a.nn;d++)c.position.array[3*d+0]=0,c.position.array[3*d+1]=0,c.position.array[3*d+2]=0,c.size.array[d]=1e-5,c.customColor.array[3*d+0]=1,c.customColor.array[3*d+1]=1,c.customColor.array[3*d+2]=1,a.ages[d]=-1;c.size.needsUpdate=!0,c.position.needsUpdate=!0,c.customColor.needsUpdate=!0}addOne(a,b,c,d,e,f,g){let h=this;const i=h.points.geometry,j=i.attributes;h.ages[h.iNow]=0,h.finalR=d,h.finalG=e,h.finalB=f,h.finalSize=g,j.position.array[3*h.iNow+0]=a,j.position.array[3*h.iNow+1]=b,j.position.array[3*h.iNow+2]=c,j.customColor.array[3*h.iNow+0]=1,j.customColor.array[3*h.iNow+1]=1,j.customColor.array[3*h.iNow+2]=1,h.iNow+=1,h.xxiNow+=1,h.iNow>=h.nn&&(h.iNow=0)}update(){let a=this;const b=a.points.geometry,c=b.attributes;for(let b=0;b<a.nn;b++){let d=c.position.array[3*b+0],e=c.position.array[3*b+1],f=c.position.array[3*b+2];a.ages[b]+=0<=a.ages[b]?1:0,c.size.array[b]=0<=a.ages[b]?a.finalSize+(20-a.finalSize)*Math.exp(-a.ages[b]/10):1e-5,c.position.array[3*b+0]=d,c.position.array[3*b+1]=e,c.position.array[3*b+2]=f,c.customColor.array[3*b+0]=a.finalR+(1-a.finalR)*Math.exp(-a.ages[b]/10),c.customColor.array[3*b+1]=a.finalG+(1-a.finalG)*Math.exp(-a.ages[b]/10),c.customColor.array[3*b+2]=a.finalB+(1-a.finalB)*Math.exp(-a.ages[b]/10)}c.size.needsUpdate=!0,c.position.needsUpdate=!0,c.customColor.needsUpdate=!0}}var VTChartPlane=class extends THREE.Object3D{constructor(){super();let a=this;a.ss=8,a.w=100,a.h=60,a.canvas=document.createElement("canvas"),a.canvas.width=a.w*a.ss,a.canvas.height=a.h*a.ss,a.stage=new createjs.Stage(a.canvas),a.planeTexture=new lib.textureVT,a.planeTexture.scaleX=a.planeTexture.scaleY=a.ss,a.stage.addChild(a.planeTexture),a.stage.update(),a.mapTexture=new THREE.Texture(a.canvas),a.mapTexture.needsUpdate=!0,a.mapMaterial=new THREE.MeshStandardMaterial({map:a.mapTexture,side:2,roughness:.4,transparent:!1}),a.mesh=new THREE.Mesh(new THREE.PlaneGeometry(a.w,a.h,1,1),a.mapMaterial),a.add(a.mesh),a.timeMax=100,a.v1Now=0,a.v2Now=0,a.vCNow=0,a.vtPoints=[],a.line1=new createjs.Shape,a.line2=new createjs.Shape,a.lineC=new createjs.Shape,a.line1.x=a.line2.x=a.lineC.x=10,a.line1.y=a.line2.y=a.lineC.y=30,a.line1.scaleY=a.line2.scaleY=a.lineC.scaleY=-1,a.planeTexture.addChild(a.line1),a.planeTexture.addChild(a.line2),a.planeTexture.addChild(a.lineC)}updateVT(){let a=this,b=a.line1.graphics,c=a.line2.graphics,d=a.lineC.graphics;a.vTimeNow=tt,a.v1Now=courseNow.ball.vx,a.v2Now=courseNow.car.vx,a.vCNow=courseNow.vc,b.c().ss(1.2).s("#0FF"),c.c().ss(1.2).s("#09F"),d.c().ss(1.2).s("#FF0");let e=1===courseMD?3:1.2,f=a.vtPoints.length;for(var g=0;g<f;g++){let f=a.vtPoints[g],h=a.vTimeNow<a.timeMax?80*(f.time/a.timeMax):80*((f.time+a.timeMax-a.vTimeNow)/a.timeMax);0==g?(b.mt(h,f.v1*e),c.mt(h,f.v2*e),d.mt(h,f.vC*e)):(b.lt(h,f.v1*e),c.lt(h,f.v2*e),d.lt(h,f.vC*e))}let h=a.vTimeNow<a.timeMax?80*(a.vTimeNow/a.timeMax):80*((a.vTimeNow+a.timeMax-a.vTimeNow)/a.timeMax);b.lt(h,a.v1Now*e),c.lt(h,a.v2Now*e),d.lt(h,a.vCNow*e),0===a.vtPoints.length?a.vtPoints.push(new OneVTPoint(a.vTimeNow,a.v1Now,a.v2Now,a.vCNow)):.1<=a.vTimeNow-a.vtPoints[a.vtPoints.length-1].time&&a.vtPoints.push(new OneVTPoint(a.vTimeNow,a.v1Now,a.v2Now,a.vCNow)),0<a.vtPoints.length&&a.vTimeNow-a.vtPoints[0].time>a.timeMax&&a.vtPoints.shift(),a.stage.update(),a.mapTexture.needsUpdate=!0}clearVT(){let a=this;a.line1.graphics.c(),a.line2.graphics.c(),a.lineC.graphics.c(),a.vtPoints=[],a.stage.update(),a.mapTexture.needsUpdate=!0}};class OneVTPoint{constructor(a,b,c,d){this.time=a,this.v1=b,this.v2=c,this.vC=d}}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,10,10),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var grounds=new THREE.Object3D;scene.add(grounds);for(var i=0;10>i;i++){let a=new TEACHER.ObjPicPlane(100,100,"allData/pics/ground.png","y");a.position.x=-350+100*i,grounds.add(a);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.x=-350+100*i,logo.position.z=-50,logo.position.y=100/8/2,grounds.add(logo)}function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();