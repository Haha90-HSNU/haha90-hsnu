"use strict";var ballA,ballB,bar,title,theLine,fps=60,log=console.log,LL=30,gameMD=0,v0=5,dt=.1,yA=0,yC=0,xC=0,vC=0,isElastic=!0,isFixed=!0;function init(){ground.rotation.x=.5*Math.PI,ground.position.z=-5,skyBox.visible=!1,logo.position.z=0,logo.position.y=45,(ballA=new TEACHER.ObjSphere(2,3407667)).y0=-10,ballA.arr=new TEACHER.ObjArrow(.8,16776960),ballA.add(ballA.arr),ballA.arr.setArrow(5,0,0),ballA.arr.position.x=2,ballB=new TEACHER.ObjBox(2,LL+2,2,65535),scene.add(ballA).add(ballB),(bar=new TEACHER.ObjCylinder(.4,16,16737792,!1,"z")).position.y=.5*LL;const t=new TEACHER.ObjCylinder(6,10,16737792,!1,"z");t.position.z=-7,bar.add(t),scene.add(bar),(title=new TEACHER.ObjTextPlane(150,10,"質點-支點棒-彈性碰撞")).position.y=25,scene.add(title),theLine=generateTheLine(),scene.add(theLine),log(theLine),world2D.ch01.setLabel("撞完合體"),world2D.ch02.setLabel("上方支點"),world2D.btn01.setLabel("發射!"),world2D.btn01.on("mousedown",btnDown),world2D.btn02.setLabel("重來"),world2D.btn02.on("mousedown",btnDown),world2D.btn03.setLabel("俯視"),world2D.btn03.on("mousedown",btnDown),world2D.btn03.visible=!1,world2D.sl01.visible=!1,world2D.sl02.visible=!1,world2D.sl03.visible=!1,world2D.btnUp.visible=!1,world2D.btnDown.visible=!1,world2D.btnLeft.visible=!1,world2D.btnRight.visible=!1,world2D.btn01.x=1450,world2D.btn01.y=660,world2D.btn01.scaleX=world2D.btn01.scaleY=2,world2D.btn02.x=1450,world2D.btn02.y=620,world2D.btn02.scaleX=world2D.btn02.scaleY=2,world2D.ch01.scaleX=world2D.ch01.scaleY=1.6,world2D.ch02.scaleX=world2D.ch02.scaleY=1.6,world2D.ch02.y+=20,world2D.ch01.x+=50,world2D.ch02.x+=50,world3D.cameraTheta=.5*Math.PI,world3D.cameraPhi=0,setInterval(tick,1e3/fps)}function tick(){if(0===gameMD){ballA.position.x=-30,ballA.position.y=ballA.y0,ballA.vx=v0,ballA.vy=0,ballB.vx=0,ballB.vy=0,ballB.omega=0,ballB.position.x=0,ballB.position.y=0,ballB.rotation.z=0,isElastic=!world2D.ch01.checked,isFixed=world2D.ch02.checked,bar.visible=isFixed;let t="質點-";t+=isFixed?"支點棒":"自由棒",t+=isElastic?"-彈性碰撞":"-撞完合體",title.setText(t),theLine.setLine()}else{var t,e,o,i,a,n;1===gameMD?(ballA.position.x+=ballA.vx*dt,t=-ballA.position.y/LL,yA=ballA.position.y,isElastic&&-3<ballA.position.x?gameMD=(isFixed?(a=6*v0*(i=.5+t)/(1+3*i*i)/LL,e=(3*i*i-1)/(3*i*i+1)*v0,ballA.vx=e,ballA.vy=0,ballB.omega=a,ballB.vx=0):(o=v0-(e=6*v0*t*t/(1+6*t*t)),a=12*t*(v0-e)/LL,ballA.vx=e,ballA.vy=0,ballB.omega=a,ballB.vx=o),ballB.vy=0,2):!isElastic&&0<ballA.position.x&&(gameMD=(a=isFixed?3*v0*(i=.5+t)/(1+3*i*i)/LL:(yC=.5*ballA.position.y,xC=.5*ballA.position.x,vC=.5*v0,12*v0*t/(1+6*t*t)/LL),ballA.vx=0,ballB.omega=a,ballB.vx=0,2))):2===gameMD&&(isElastic&&!isFixed?(ballA.position.x+=ballA.vx*dt,ballA.position.y+=ballA.vy*dt,ballB.position.x+=ballB.vx*dt,ballB.position.y+=ballB.vy*dt,ballB.rotation.z+=ballB.omega*dt,(n=collisionElasticFree(ballA.position.x,ballA.position.y,ballA.vx,ballA.vy,ballB.position.x,ballB.position.y,ballB.vx,ballB.vy,ballB.rotation.z,ballB.omega))&&(ballA.vx=n[0],ballA.vy=n[1],ballB.vx=n[2],ballB.vy=n[3],ballB.omega=n[4])):isElastic&&isFixed?(ballA.position.x+=ballA.vx*dt,ballA.position.y+=ballA.vy*dt,ballB.rotation.z+=ballB.omega*dt,ballB.position.x=.5*Math.sin(ballB.rotation.z)*LL,ballB.position.y=.5*(1-Math.cos(ballB.rotation.z))*LL,(n=collisionElasticFixed(ballA.position.x,ballA.position.y,ballA.vx,ballA.vy,ballB.rotation.z,ballB.omega))&&(ballA.vx=n[0],ballA.vy=n[1],ballB.omega=n[2])):!isElastic&&isFixed?(ballB.rotation.z+=ballB.omega*dt,ballB.position.x=.5*Math.sin(ballB.rotation.z)*LL,ballB.position.y=.5*(1-Math.cos(ballB.rotation.z))*LL,ballA.position.x=Math.sin(ballB.rotation.z)*(.5*LL-yA),ballA.position.y=.5*LL-(.5*LL-yA)*Math.cos(ballB.rotation.z)):isElastic||isFixed||(xC+=vC*dt,ballB.rotation.z+=ballB.omega*dt,ballB.position.x=xC-Math.sin(-ballB.rotation.z)*yC,ballB.position.y=yC-Math.cos(-ballB.rotation.z)*yC,ballA.position.x=xC+Math.sin(-ballB.rotation.z)*yC,ballA.position.y=yC+Math.cos(-ballB.rotation.z)*yC))}world2D.btn01.visible=0===gameMD,world2D.btn02.visible=2===gameMD,world2D.ch01.visible=world2D.ch02.visible=0===gameMD,theLine.visible=ballA.arr.visible=0===gameMD,world3D.render(),world2D.stage.update()}function btnDown(t){t=t.target.parent.name;log(t),"btn01"===t&&0===gameMD?gameMD=1:"btn02"===t&&2===gameMD?gameMD=0:"btn03"===t&&(world3D.cameraTheta=.5*Math.PI,world3D.cameraPhi=0,world2D.btn03.visible=!1)}function myMouseDown(t){var e=getMouse3D("z"),o=e.x-ballA.position.x,e=e.y-ballA.position.y;0===gameMD&&o*o+e*e<4?ballA.isDraging=!0:world3D.camera.isDraging=!0,world3D.camera.oldMouseX=stage2D.mouseX,world3D.camera.oldMouseY=stage2D.mouseY}function myMouseMove(t){if(world3D.camera.isDraging&&world3D.cameraDragAndRotate){var e=stage2D.mouseX,o=stage2D.mouseY;for(world3D.cameraPhi-=.005*(e-world3D.camera.oldMouseX);world3D.cameraPhi>Math.PI;)world3D.cameraPhi-=2*Math.PI;for(;world3D.cameraPhi<-Math.PI;)world3D.cameraPhi+=2*Math.PI;world3D.cameraTheta-=.005*(o-world3D.camera.oldMouseY),world3D.cameraTheta>.9999*Math.PI&&(world3D.cameraTheta=.9999*Math.PI),world3D.cameraTheta<1e-4*Math.PI&&(world3D.cameraTheta=1e-4*Math.PI),world3D.camera.oldMouseX=e,world3D.camera.oldMouseY=o,world2D.btn03.visible=!0}else ballA.isDraging&&0===gameMD&&(o=getMouse3D("z"),ballA.position.y=ballA.y0=o.y,ballA.position.y<-.5*LL?ballA.position.y=ballA.y0=-.5*LL:ballA.position.y>.5*LL?ballA.position.y=ballA.y0=.5*LL:Math.abs(ballA.position.y)<1&&(ballA.position.y=ballA.y0=0))}function myMouseUp(t){world3D.camera.isDraging=!1,ballA.isDraging=!1}function generateTheLine(){var t=new THREE.Object3D,e=16776960;t.lineU=new TEACHER.Line(e,2),t.lineD=new TEACHER.Line(e,2),t.lineM=new TEACHER.Line(e,2);for(var o=0;o<2;o++)t.lineU.addPoint(o,0,0),t.lineD.addPoint(o,0,0),t.lineM.addPoint(o,0,0);return t.label=new TEACHER.ObjTextPlane(40,5,"0.85LL","z",e),t.add(t.lineU).add(t.lineD).add(t.lineM).add(t.label),t.setLine=function(){t.lineU.setPoint(0,.5*ballA.position.x-5,ballA.position.y,0),t.lineU.setPoint(1,.5*ballA.position.x+5,ballA.position.y,0),t.lineU.update(),t.lineD.setPoint(0,.5*ballA.position.x-5,0,0),t.lineD.setPoint(1,.5*ballA.position.x+5,0,0),t.lineD.update(),t.lineM.setPoint(0,.5*ballA.position.x,0,0),t.lineM.setPoint(1,.5*ballA.position.x,ballA.position.y,0),t.lineM.update(),t.label.setText("0."+Math.round(Math.abs(ballA.position.y/LL*100))+" L"),t.label.position.y=.5*ballA.position.y,t.label.position.x=.5*ballA.position.x-6},t}function collisionElasticFree(t,e,o,i,a,n,l,s,r,E){t=[t-a,e-n],a=[Math.sin(r),-Math.cos(r)],e=t[0]*a[0]+t[1]*a[1],n=[t[0]-e*a[0],t[1]-e*a[1]],r=[n[0]/Math.sqrt(n[0]*n[0]+n[1]*n[1]),n[1]/Math.sqrt(n[0]*n[0]+n[1]*n[1])],n=t[0]*r[0]+t[1]*r[1],t=o*r[0]+i*r[1],o=o*a[0]+i*a[1],i=l*r[0]+s*r[1],s=l*a[0]+s*a[1];if(Math.abs(e)<.5*LL&&n<3&&t-i-e*E*(a[0]*r[1]-a[1]*r[0])<0){n=(i-t+e*E*(a[0]*r[1]-a[1]*r[0]))/(1+6*Math.pow(e/LL,2)),t=n+t,i=i-n,t=[o*a[0]+t*r[0],o*a[1]+t*r[1]],r=[s*a[0]+i*r[0],s*a[1]+i*r[1]];return[t[0],t[1],r[0],r[1],E+n*e*12/LL/LL]}}function collisionElasticFixed(t,e,o,i,a,n){var l=[t,e-.5*LL],s=[Math.sin(a),-Math.cos(a)],t=l[0]*s[0]+l[1]*s[1],e=[l[0]-t*s[0],l[1]-t*s[1]],a=[e[0]/Math.sqrt(e[0]*e[0]+e[1]*e[1]),e[1]/Math.sqrt(e[0]*e[0]+e[1]*e[1])],e=o*a[0]+i*a[1],i=o*s[0]+i*s[1];if(t<LL&&0<t&&l[0]*a[0]+l[1]*a[1]<3&&e-t*n*(s[0]*a[1]-s[1]*a[0])<0){l=2*(t*n*(s[0]*a[1]-s[1]*a[0])-e)/(1+3*Math.pow(t/LL,2)),e=l+e,a=[i*s[0]+e*a[0],i*s[1]+e*a[1]];return[a[0],a[1],n-l*t*3/LL/LL]}}MyJS.myResize(),world2D.btn3D.on("mousedown",myMouseDown),world2D.btn3D.on("pressmove",myMouseMove),world2D.btn3D.on("pressup",myMouseUp);var TEACHER={ObjPlane:function(t,e,o,i,a){var n=this;n.mat=new TEACHER.MSMat(o,a),n.geo=new THREE.PlaneGeometry(t||10,e||10,1,1),n.mesh=new THREE.Mesh(n.geo,n.mat),"x"===i?n.mesh.rotation.y=.5*Math.PI:"y"===i&&(n.mesh.rotation.x=-.5*Math.PI),THREE.Object3D.call(this,n.geo,n.mat),n.add(n.mesh)}};TEACHER.ObjPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPlane.prototype.constructor=TEACHER.ObjPlane,TEACHER.ObjCylinder=function(t,e,o,i,a,n){var l=this;l.mat=new TEACHER.MSMat(o,n),l.geo=new THREE.CylinderGeometry(t||10,t||10,e||10,32,2,i),l.mesh=new THREE.Mesh(l.geo,l.mat),"x"===a?l.mesh.rotation.z=-.5*Math.PI:"z"===a&&(l.mesh.rotation.x=.5*Math.PI),THREE.Object3D.call(this,l.geo,l.mat),l.add(l.mesh)},TEACHER.ObjCylinder.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjCylinder.prototype.constructor=TEACHER.ObjCylinder,TEACHER.ObjSphere=function(t,e,o){var i=this;i.mat=new TEACHER.MSMat(e,o),i.geo=new THREE.SphereGeometry(t||10,32,16),i.mesh=new THREE.Mesh(i.geo,i.mat),THREE.Object3D.call(this,i.geo,i.mat),i.add(i.mesh)},TEACHER.ObjSphere.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjSphere.prototype.constructor=TEACHER.ObjSphere,TEACHER.ObjBox=function(t,e,o,i,a){var n=this;n.mat=new TEACHER.MSMat(i,a),n.geo=new THREE.BoxGeometry(t||10,e||10,o||10),n.mesh=new THREE.Mesh(n.geo,n.mat),THREE.Object3D.call(this,n.geo,n.mat),n.add(n.mesh)},TEACHER.ObjBox.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjBox.prototype.constructor=TEACHER.ObjBox,TEACHER.MSMat=function(t,e){THREE.MeshStandardMaterial.call(this,{color:t||16711935,roughness:.4,side:e||0})},TEACHER.MSMat.prototype=Object.create(THREE.MeshStandardMaterial.prototype),TEACHER.MSMat.prototype.constructor=TEACHER.MSMat,TEACHER.ObjPicPlane=function(t,e,o,i,a){var n=this,o=(new THREE.TextureLoader).load(o);n.mat=new THREE.MeshBasicMaterial({map:o,transparent:!0,side:a||0}),n.geo=new THREE.PlaneGeometry(t,e,1,1),n.mesh=new THREE.Mesh(n.geo,n.mat),"x"===i?n.mesh.rotation.y=.5*Math.PI:"y"===i&&(n.mesh.rotation.x=-.5*Math.PI),THREE.Object3D.call(this),n.add(n.mesh)},TEACHER.ObjPicPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicPlane.prototype.constructor=TEACHER.ObjPicPlane,TEACHER.ObjPicCylinder=function(t,e,o,i,a,n){var l=this,o=(new THREE.TextureLoader).load(o);l.mat=new THREE.MeshBasicMaterial({map:o,side:n||0}),l.geo=new THREE.CylinderGeometry(t||10,t||10,e||10,32,4,i),l.mesh=new THREE.Mesh(l.geo,l.mat),"x"===a?l.mesh.rotation.z=-.5*Math.PI:"z"===a?(l.mesh.rotation.y=.5*Math.PI,l.mesh.rotation.x=.5*Math.PI):"y"===a&&(l.mesh.rotation.y=.5*Math.PI),THREE.Object3D.call(this,l.geo,l.mat),l.add(l.mesh)},TEACHER.ObjPicCylinder.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicCylinder.prototype.constructor=TEACHER.ObjPicCylinder,TEACHER.ObjPicSphere=function(t,e,o){var i=this,e=(new THREE.TextureLoader).load(e);i.mat=new THREE.MeshBasicMaterial({map:e,side:o||0}),i.geo=new THREE.SphereGeometry(t||10,32,16),i.mesh=new THREE.Mesh(i.geo,i.mat),THREE.Object3D.call(this,i.geo,i.mat),i.add(i.mesh)},TEACHER.ObjPicSphere.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicSphere.prototype.constructor=TEACHER.ObjPicSphere,TEACHER.ObjArrow=function(t,e){var o=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),e=new THREE.ConeGeometry(t||10,40,32);this.ArrowHead=new THREE.Mesh(e,o),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry(.5*(t||10),.5*(t||10),60,32,2),this.ArrowBody=new THREE.Mesh(e,o),this.ArrowBody.position.y=30,THREE.Object3D.call(this),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)},TEACHER.ObjArrow.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjArrow.prototype.constructor=TEACHER.ObjArrow,TEACHER.ObjArrow.prototype.setArrow=function(t,e,o){var i=t*t+e*e+o*o,a=Math.sqrt(i);0<i?(this.rotX.visible=!0,this.rotX.scale.y=a/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(e/a),this.rotY.rotation.y=Math.atan2(t,o)},TEACHER.ObjSpring=function(t,e,o,i,a){var n=t||20;this.L0=n;let l=[];var s=i||5,r=e||5,e=o||.5;l.push(new THREE.Vector3(0,0,0)),l.push(new THREE.Vector3(0,.05*n,0));for(var E=0;E<=16*s;E++)l.push(new THREE.Vector3(r*Math.cos(2*E*Math.PI/16),n*(.05+.9*E/s/16),r*Math.sin(2*E*Math.PI/16)));l.push(new THREE.Vector3(0,.95*n,0)),l.push(new THREE.Vector3(0,n,0));o=new THREE.CatmullRomCurve3(l),a=new THREE.MeshStandardMaterial({color:a||16711935,roughness:.4}),e=new THREE.TubeGeometry(o,500,e,12);this.mesh=new THREE.Mesh(e,a),THREE.Object3D.call(this),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)},TEACHER.ObjSpring.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjSpring.prototype.constructor=TEACHER.ObjSpring,TEACHER.ObjSpring.prototype.setSpring=function(t,e,o){var i=t*t+e*e+o*o,a=Math.sqrt(i);0<i?(this.rotX.visible=!0,this.rotX.scale.y=a/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(e/a),this.rotY.rotation.y=Math.atan2(t,o)},TEACHER.Points=function(t,e,o){var i=this,e=e||1,t=t||16711935;let a=new THREE.Color(t);i.nnMax=o||1e4,i.nnNow=0,i.geometry=new THREE.BufferGeometry,i.positions=[],i.geometry.setAttribute("position",new THREE.Float32BufferAttribute(i.positions,3)),i.geometry.computeBoundingSphere();e=new THREE.PointsMaterial({size:e,map:i.createCanvasMaterial("#"+a.getHexString(),64),transparent:!0,depthWrite:!1});THREE.Points.call(this,i.geometry,e)},TEACHER.Points.prototype=Object.create(THREE.Points.prototype),TEACHER.Points.prototype.constructor=TEACHER.Points,TEACHER.Points.prototype.createCanvasMaterial=function(t,e){var o=document.createElement("canvas");o.width=o.height=e;var i=o.getContext("2d");i.imageSmoothingEnabled=!1;var a=new THREE.Texture(o),o=e/2;return i.beginPath(),i.arc(o,o,e/2-3,0,2*Math.PI,!1),i.closePath(),i.fillStyle=t,i.fill(),a.needsUpdate=!0,a},TEACHER.Points.prototype.addPoint=function(t,e,o){var i=this;i.nnNow<i.nnMax?i.nnNow++:(log("TEACHER.Points 到達最大點數"),i.positions.shift(),i.positions.shift(),i.positions.shift()),i.positions.push(t,e,o)},TEACHER.Points.prototype.clear=function(){this.positions=[],this.nnNow=0,this.update()},TEACHER.Points.prototype.setPoint=function(t,e,o,i){var a=this;t>a.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):t>a.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(a.positions[3*t]=e,a.positions[3*t+1]=o,a.positions[3*t+2]=i)},TEACHER.Points.prototype.getPoint=function(t){var e=this;let o=new THREE.Vector3;return t>e.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):t>e.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(o.x=e.positions[3*t],o.y=e.positions[3*t+1],o.z=e.positions[3*t+2]),o},TEACHER.Points.prototype.update=function(){this.geometry.setAttribute("position",new THREE.Float32BufferAttribute(this.positions,3)),this.geometry.computeBoundingSphere(),this.geometry.attributes.position.needsUpdate=!0},TEACHER.Line=function(t,e,o){var i=this;i.nnMax=o||1e4,i.lineWidth=e||1,i.nnNow=0;e=new THREE.LineMaterial({color:t||16711935,linewidth:e||1});e.resolution.set(window.innerWidth,window.innerHeight),i.geometry=new THREE.LineGeometry,i.positions=new Float32Array(3*i.nnMax),i.geometry.setPositions(i.positions),THREE.Line2.call(this,i.geometry,e)},TEACHER.Line.prototype=Object.create(THREE.Line2.prototype),TEACHER.Line.prototype.constructor=TEACHER.Line,TEACHER.Line.prototype.addPoint=function(t,e,o){var i=this;if(i.nnNow<i.nnMax)i.nnNow++;else{log("TEACHER.Line 到達最大點數");for(var a=0;a<i.nnMax-1;a++)i.positions[3*a]=i.positions[3*a+3],i.positions[3*a+1]=i.positions[3*a+4],i.positions[3*a+2]=i.positions[3*a+5]}for(a=i.nnNow;a<=i.nnMax;a++)i.positions[3*(a-1)]=t,i.positions[3*(a-1)+1]=e,i.positions[3*(a-1)+2]=o},TEACHER.Line.prototype.clear=function(){this.positions=new Float32Array(3*this.nnMax),this.nnNow=0,this.update()},TEACHER.Line.prototype.setPoint=function(t,e,o,i){var a=this;t>a.nnMax?log("輸入的n值大於TEACHER.Line 最大點數 nnMax"):t>a.nnNow?log("輸入的n值大於TEACHER.Line 現在點數 nnNow"):(a.positions[3*t]=e,a.positions[3*t+1]=o,a.positions[3*t+2]=i)},TEACHER.Line.prototype.getPoint=function(t){var e=this;let o=new THREE.Vector3;return t>e.nnMax?log("輸入的n值大於TEACHER.Line 最大點數 nnMax"):t>e.nnNow?log("輸入的n值大於TEACHER.Line 現在點數 nnNow"):(o.x=e.positions[3*t],o.y=e.positions[3*t+1],o.z=e.positions[3*t+2]),o},TEACHER.Line.prototype.update=function(){for(var t=this,e=t.getPoint(t.nnNow-1),o=t.nnNow;o<=t.nnMax;o++)t.positions[3*o]=e.x,t.positions[3*o+1]=e.y,t.positions[3*o+2]=e.z;t.geometry.setPositions(t.positions)},TEACHER.ObjTextPlane=function(t,e,o,i,a,n){var l=this,s=Math.round(Math.log2(t/e)),r=$("<canvas>").attr("width",String(128*Math.pow(2,s))).attr("height","128");l.stage=new createjs.Stage(r[0]);let E=new createjs.Container;if(n){let t=new createjs.Shape,e=new THREE.Color(n);t.graphics.c().f("#"+e.getHexString()).dr(0,0,128*Math.pow(2,s),128),E.addChild(t)}l.ctext=new createjs.Text;let b=new THREE.Color(a||16777215);l.ctext.color="#"+b.getHexString(),l.ctext.font="96px Arial",l.ctext.text=o||"",l.ctext.textAlign="center",l.ctext.textBaseline="middle",l.ctext.x=128*Math.pow(2,s)/2,l.ctext.y=64,E.addChild(l.ctext),l.stage.addChild(E),l.stage.update(),l.texture=new THREE.Texture(r[0]);r=new THREE.MeshBasicMaterial({map:l.texture,transparent:!0}),e=new THREE.PlaneGeometry(t||10,e||10,1,1);l.texture.needsUpdate=!0,l.plane1=new THREE.Mesh(e,r),l.plane2=new THREE.Mesh(e,r),l.plane2.rotation.y=Math.PI;let p=new THREE.Object3D;p.add(l.plane1).add(l.plane2),"x"===i?p.rotation.y=.5*Math.PI:"y"===i&&(p.rotation.x=-.5*Math.PI),THREE.Object3D.call(this),l.add(p)},TEACHER.ObjTextPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjTextPlane.prototype.constructor=TEACHER.ObjTextPlane,TEACHER.ObjTextPlane.prototype.setText=function(t){this.ctext.text=t,this.stage.update(),this.texture.needsUpdate=!0},TEACHER.ObjGraph=function(t,e,o,i,a,n,l){var s=this;s.objCon=new THREE.Object3D,s._xMin=t||0,s._xMax=e||10,s._yMin=o||0,s._yMax=i||10,s.divXN=5,s.divYN=4,s.frameMat=new THREE.LineBasicMaterial({color:a||16777215});for(var r=[],E=0;E<=s.divXN;E++)r.push(new THREE.Vector3(20*E-50,0,0)),r.push(new THREE.Vector3(20*E-50,50,0));for(var b=0;b<=s.divYN;b++)r.push(new THREE.Vector3(-50,12.5*b,0)),r.push(new THREE.Vector3(50,12.5*b,0));i=(new THREE.BufferGeometry).setFromPoints(r);s.frame=new THREE.LineSegments(i,s.frameMat),s.objCon.add(s.frame),s.labelXMin=new TEACHER.ObjTextPlane(20,5,String(s._xMin),"z",a||16777215),s.labelXMin.position.x=-50,s.labelXMin.position.y=-3,s.objCon.add(s.labelXMin),s.labelXMax=new TEACHER.ObjTextPlane(20,5,String(s._xMax),"z",a||16777215),s.labelXMax.position.x=50,s.labelXMax.position.y=-3,s.objCon.add(s.labelXMax),s.labelYMin=new TEACHER.ObjTextPlane(20,5,String(s._yMin),"z",a||16777215),s.labelYMin.position.x=-53,s.labelYMin.position.y=0,s.objCon.add(s.labelYMin),s.labelYMax=new TEACHER.ObjTextPlane(20,5,String(s._yMax),"z",a||16777215),s.labelYMax.position.x=-53,s.labelYMax.position.y=50,s.objCon.add(s.labelYMax),s.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",a||16777215),s.labelX.position.x=60,s.labelX.position.y=4,s.labelX.position.z=1,s.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",a||16777215),s.labelY.position.x=-60,s.labelY.position.y=25,s.labelY.position.z=1,s.labelY.rotation.z=Math.PI/2,s.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",a||16777215),s.labelTitle.position.y=53,s.labelTitle.position.z=1,s.objCon.add(s.labelX).add(s.labelY).add(s.labelTitle),s._lineColor=n,s._nnMax=l,s.line=new TEACHER.Line(s._lineColor||16776960,2,s._nnMax),s.objCon.add(s.line),s.changeScale(),THREE.Object3D.call(this),s.add(s.objCon)},TEACHER.ObjGraph.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjGraph.prototype.constructor=TEACHER.ObjGraph,Object.defineProperty(TEACHER.ObjGraph.prototype,"xMin",{get:function(){return this._xMin},set:function(t){this._xMin=t,this.changeScale()}}),Object.defineProperty(TEACHER.ObjGraph.prototype,"xMax",{get:function(){return this._xMax},set:function(t){this._xMax=t,this.changeScale()}}),Object.defineProperty(TEACHER.ObjGraph.prototype,"yMin",{get:function(){return this._yMin},set:function(t){this._yMin=t,this.changeScale()}}),Object.defineProperty(TEACHER.ObjGraph.prototype,"yMax",{get:function(){return this._yMax},set:function(t){this._yMax=t,this.changeScale()}}),TEACHER.ObjGraph.prototype.addPoint=function(t,e){this.line.addPoint(t,e,0),this.line.update()},TEACHER.ObjGraph.prototype.clear=function(){this.line.clear()},TEACHER.ObjGraph.prototype.changeScale=function(){var t=this;t.line.scale.x=100/(t._xMax-t._xMin),t.line.scale.y=50/(t._yMax-t._yMin),t.line.position.x=-50-t._xMin*t.line.scale.x,t.line.position.y=-t._yMin*t.line.scale.y,t.labelXMin.setText(t._xMin),t.labelXMax.setText(t._xMax),t.labelYMin.setText(t._yMin),t.labelYMax.setText(t._yMax)},TEACHER.ObjGraph.prototype.setLabel=function(t,e,o){this.labelTitle.setText(t||"y-x"),this.labelY.setText(e||"y"),this.labelX.setText(o||"x")};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");world3D.scene.add(ground);var logo=new TEACHER.ObjPicPlane(100,12.5,pics.logo,"z",2);function getMouse3D(t,e){var o=t||"y";let i;t=new THREE.Vector3;"x"===o?i=new THREE.Vector3(1,0,0):"y"===o?i=new THREE.Vector3(0,1,0):"z"===o?i=new THREE.Vector3(0,0,1):log("錯誤!!");let a=new THREE.Vector2;return a.x=world2D.stage.mouseX/1600*2-1,a.y=-world2D.stage.mouseY/900*2+1,world3D.raycaster.setFromCamera(a,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(i),t),t}logo.position.z=-50,logo.position.y=6.25,world3D.scene.add(logo),init();