'use strict';var ground1,ground2,ground10,ground20,thetaOut,traceLine,theWheels,pointer,fps=60,log=console.log,sin=Math.sin,cos=Math.cos,tan=Math.tan,L0=45,v1=4,v2=2,dd=10,wheelR=5,thetaIn=30*Math.PI/180,thetaInTarget=30*Math.PI/180,tt=0,dt=.1,isPlay=!1,followRatio=0,cameraLock=0;function init(){ground.visible=!1,ground1=new TEACHER.ObjPicPlane(100,50,"allData/pics/g1.png","y"),ground2=new TEACHER.ObjPicPlane(100,50,"allData/pics/g2.png","y"),ground10=new TEACHER.ObjPicPlane(100,50,"allData/pics/g1_0.png","y"),ground20=new TEACHER.ObjPicPlane(100,50,"allData/pics/g2_0.png","y"),ground1.position.z=ground10.position.z=-25,ground2.position.z=ground20.position.z=25,ground2.position.y=ground20.position.y=-.5,ground1.position.y=ground10.position.y=-.5,scene.add(ground1).add(ground10).add(ground2).add(ground20),pointer=new THREE.Object3D,pointer.position.x=-L0*Math.sin(30*Math.PI/180),pointer.position.z=-L0*Math.cos(30*Math.PI/180),pointer.rotation.y=30*Math.PI/180+Math.PI,thetaIn=thetaInTarget=Math.atan2(pointer.position.x,-pointer.position.z),scene.add(pointer);var a=new TEACHER.ObjCylinder(1.5,1,16737894,!1,"y"),b=new TEACHER.ObjArrow(.5,16737894);b.setArrow(0,0,-10),pointer.label=new TEACHER.ObjPicPlane(9.12,2.94,"allData/pics/drag.png","y"),pointer.label.position.x=8,pointer.label.rotation.y=Math.PI,pointer.line=new TEACHER.Line(16776960,5,3),pointer.line.addPoint(0,0,-12),pointer.line.addPoint(0,0,-50),pointer.line.addPoint(0,0,-95),pointer.line.update(),pointer.add(a).add(b).add(pointer.label).add(pointer.line),traceLine=new TraceLine,scene.add(traceLine),initWheels(),world2D.slCameraRR.value=120,world2D.sl01.minimum=0,world2D.sl01.maximum=360,world2D.sl01.value=30,world2D.slDD.minimum=.1,world2D.slDD.maximum=10,world2D.slDD.value=5,world2D.btnPlayStop.on("click",clickBtn),world2D.btnReset.on("click",clickBtn),world2D.btn3D.on("mousedown",myMouseDown),world2D.btn3D.on("pressmove",myMouseMove),world2D.btn3D.on("pressup",myMouseUp),world2D.chFollow.on("click",clickChFollow),world3D.cameraTheta=0,setInterval(tick,1e3/fps)}function tick(){ground1.visible=ground2.visible=world2D.chLine.checked,ground10.visible=ground20.visible=!world2D.chLine.checked,pointer.line.visible=world2D.chLine.checked,pointer.label.visible=0===tt,thetaIn-thetaInTarget>Math.PI?thetaIn-=2*Math.PI:thetaIn-thetaInTarget<-Math.PI&&(thetaIn+=2*Math.PI),thetaIn=.8*thetaIn+.2*thetaInTarget,dd=world2D.slDD.value,traceLine.updateData(),traceLine.updateLines(),tt+=dt*(isPlay?1:0),updateWheels(tt),world2D.btnReset.visible=0<tt,world2D.btnPlayStop.visible=tt<traceLine.data[traceLine.data.length-1][0],followRatio+=.02*(world2D.chFollow.checked?1:-1),1<followRatio?followRatio=1:0>followRatio&&(followRatio=0),world3D.cameraTarget.x=followRatio*theWheels.position.x,world3D.cameraTarget.z=followRatio*theWheels.position.z,0<cameraLock&&(cameraLock--,world2D.slCameraRR.value=.92*world2D.slCameraRR.value+.08*(world2D.chFollow.checked?60:120),world3D.cameraTheta=.92*world3D.cameraTheta+.08*(world2D.chFollow.checked?45*Math.PI/180:0),world3D.cameraPhi=.92*world3D.cameraPhi+.08*(world2D.chFollow.checked?(0<Math.sin(thetaIn)?1:-1)*Math.PI-thetaIn+.3:0)),world3D.render(),world2D.stage.update()}MyJS.myResize();function clickChFollow(){cameraLock=120}function wrinkleGround(){let a=ground1.geo.attributes.position.array,b=a.length;for(var c=0;c<b;c+=3)a[c+0]+=0*Math.random(),a[c+1]+=0*Math.random(),a[c+2]+=1.5*(Math.random()-.5);log(a),ground1.geo.setAttribute("position",new THREE.BufferAttribute(a,3)),ground1.geo.attributes.position.needsUpdate=!0}function initWheels(){theWheels=new THREE.Object3D,scene.add(theWheels),theWheels.position.y=wheelR,theWheels.wheelR=new THREE.Object3D,theWheels.wheelL=new THREE.Object3D,theWheels.add(theWheels.wheelL).add(theWheels.wheelR);for(var a=0;2>a;a++){const c=new THREE.TorusGeometry(wheelR-.5,.5,32,128),d=new TEACHER.MSMat(3355443,0),e=new THREE.Mesh(c,d);e.rotation.y=Math.PI/2;const f=new TEACHER.ObjCylinder(1,1,3355443,!1,"x");for(var b=0;4>b;b++){const c=new TEACHER.ObjCylinder(.2,2*wheelR-1,10066329,!0,"y");c.rotation.x=b*Math.PI/4,0===a?theWheels.wheelL.add(c):theWheels.wheelR.add(c)}0==a?theWheels.wheelL.add(e).add(f):theWheels.wheelR.add(e).add(f)}theWheels.hBar=new TEACHER.ObjCylinder(.4,10,6723993,!1,"x"),theWheels.add(theWheels.hBar),theWheels.arrow=new TEACHER.ObjArrow(.4,16776960),theWheels.arrow.setArrow(0,0,10),theWheels.arrow.position.y=-.8*wheelR,theWheels.arrow.scale.x=1.5,theWheels.arrow.scale.y=.5,theWheels.add(theWheels.arrow)}function updateWheels(a){let b=0,c=traceLine.data.length;for(var d=0;d<c-1;d++)b=d,a>=traceLine.data[d][0]&&a<traceLine.data[d+1][0]&&(d=c);let e=(a-traceLine.data[b][0])/(traceLine.data[b+1][0]-traceLine.data[b][0]);e=1<e?1:e;let f=(1-e)*traceLine.data[b][1]+e*traceLine.data[b+1][1],g=(1-e)*traceLine.data[b][2]+e*traceLine.data[b+1][2],h=(1-e)*traceLine.data[b][3]+e*traceLine.data[b+1][3],j=(1-e)*traceLine.data[b][4]+e*traceLine.data[b+1][4],k=(1-e)*traceLine.data[b][5]+e*traceLine.data[b+1][5],l=(1-e)*traceLine.data[b][6]+e*traceLine.data[b+1][6];theWheels.position.x=(f+h)/2,theWheels.position.z=-(g+j)/2,theWheels.rotation.y=Math.atan2(g-j,f-h),theWheels.wheelR.position.x=-dd/2,theWheels.wheelL.position.x=dd/2,theWheels.wheelL.rotation.x=k/wheelR,theWheels.wheelR.rotation.x=l/wheelR,theWheels.hBar.scale.x=dd/10;var m;m=0<g&&0<j?v1:0>g&&0>j?v2:0>g&&0<j?(j*v1-g*v2)/(j-g):(g*v1-j*v2)/(g-j),theWheels.arrow.setArrow(0,0,10*(m/v1))}class TraceLine extends THREE.Object3D{constructor(){super();var a=this;a.lineL=new TEACHER.Line(6750207,5),a.lineR=new TEACHER.Line(6750207,5),a.add(a.lineL).add(a.lineR)}updateData(){let a=this,b=L0;a.data=[];let c,d=b*sin(thetaIn),e=b*cos(thetaIn),f=(thetaIn+3*Math.PI)%(2*Math.PI),g=d-dd/2*cos(f),h=e+dd/2*sin(f),j=d+dd/2*cos(f),l=e-dd/2*sin(f),m=0;ttext1.visible=ttext2.visible=ttext3.visible=!1;let n=0;0<h&&0<l?(thetaOut=Math.asin(sin(thetaIn)*v2/v1)+Math.PI,n=1,ttext1.visible=!0):0>h&&0>l?(thetaOut=-Math.asin(sin(thetaIn)*v1/v2),n=1,thetaOut?ttext2.visible=!0:(thetaOut=-thetaIn,ttext3.visible=!0)):(thetaOut=-Math.asin(sin(f)*(l*v2-h*v1)/(l-h)/v1)+Math.PI,n=2),thetaOut=(thetaOut+2*Math.PI)%(2*Math.PI);let o=thetaOut-f;a.data.push([m,g,h,j,l,0,0]);let p,q,r,s,t=0,u=0;if(1==n){g=d-dd/2*cos(f),h=e+dd/2*sin(f),j=d+dd/2*cos(f),l=e-dd/2*sin(f),0<h?(p=r=v1*sin(f),q=s=v1*cos(f)):(p=r=v2*sin(f),q=s=v2*cos(f)),c=Math.min(Math.abs(h/q),Math.abs(l/s));let b=10;for(var v=0;v<b;v++)g+=p*c/b,j+=r*c/b,h+=q*c/b,l+=s*c/b,t+=Math.sqrt(p*p+q*q)*c/b,u+=Math.sqrt(r*r+s*s)*c/b,m+=c/b,a.data.push([m,g,h,j,l,t,u]);n=2}if(2==n){let b,i;f>Math.PI?(i=v1,b=v2):(i=v2,b=v1);let w=(b-i)/dd;c=o/w;let x=16;for(var v=0;v<x;v++)f+=w*c/x,p=b*sin(f),r=i*sin(f),q=b*cos(f),s=i*cos(f),g+=p*c/x,j+=r*c/x,h+=q*c/x,l+=s*c/x,t+=Math.sqrt(p*p+q*q)*c,u+=Math.sqrt(r*r+s*s)*c,d=(g+j)/2,e=(h+l)/2,m+=c/x,a.data.push([m,g,h,j,l,t,u]);n=3}if(3==n){0<h?(p=r=v1*sin(f),q=s=v1*cos(f),c=b/v1):(p=r=v2*sin(f),q=s=v2*cos(f),c=b/v2);let d=10;for(var v=0;v<d;v++)g+=p*c/d,j+=r*c/d,h+=q*c/d,l+=s*c/d,t+=Math.sqrt(p*p+q*q)*c/d,u+=Math.sqrt(r*r+s*s)*c/d,m+=c/d,a.data.push([m,g,h,j,l,t,u]);n=4}}updatePoints(){let a=this,b=a.data.length;a.pps.clear();for(let c=0;c<b;c++)a.pps.addPoint(a.data[c][1],.2,-a.data[c][2]),a.pps.addPoint(a.data[c][3],.2,-a.data[c][4]);a.pps.update()}updateLines(){let a=this;if(a.lineR.clear(),a.lineL.clear(),world2D.chPredict.checked){let b=a.data.length;for(let c=0;c<b;c++)a.lineL.addPoint(a.data[c][1],.2,-a.data[c][2]),a.lineR.addPoint(a.data[c][3],.2,-a.data[c][4])}else if(0<tt){let b=a.data.length;for(let c=0;c<b-1;c++)if(tt>traceLine.data[c][0])a.lineL.addPoint(a.data[c][1],.2,-a.data[c][2]),a.lineR.addPoint(a.data[c][3],.2,-a.data[c][4]);else{let d=(tt-traceLine.data[c][0])/(traceLine.data[c+1][0]-traceLine.data[c][0]);d=1<d?1:d;let e=(1-d)*traceLine.data[c][1]+d*traceLine.data[c+1][1],f=(1-d)*traceLine.data[c][2]+d*traceLine.data[c+1][2],g=(1-d)*traceLine.data[c][3]+d*traceLine.data[c+1][3],h=(1-d)*traceLine.data[c][4]+d*traceLine.data[c+1][4];a.lineL.addPoint(e,.2,-f),a.lineR.addPoint(g,.2,-h),c=b+1}}a.lineR.update(),a.lineL.update()}}function myMouseDown(){let a=getMouse3D("y",0),b=Math.sqrt(Math.pow(a.x-pointer.position.x,2)+Math.pow(a.z-pointer.position.z,2));world3D.camera.isPointerDraging=8>b,world3D.camera.isDraging=!world3D.camera.isPointerDraging,world3D.camera.oldMouseX=stage2D.mouseX,world3D.camera.oldMouseY=stage2D.mouseY}function myMouseMove(){if(world3D.camera.isPointerDraging){let a=getMouse3D("y",0);thetaInTarget=Math.atan2(a.x,-a.z),pointer.position.x=L0*Math.sin(thetaInTarget),pointer.position.z=-L0*Math.cos(thetaInTarget),pointer.rotation.y=-thetaInTarget+Math.PI}else if(world3D.camera.isDraging&&world3D.cameraDragAndRotate&&0===cameraLock){var a=stage2D.mouseX,b=stage2D.mouseY;for(world3D.cameraPhi-=.005*(a-world3D.camera.oldMouseX);world3D.cameraPhi>Math.PI;)world3D.cameraPhi-=2*Math.PI;for(;world3D.cameraPhi<-Math.PI;)world3D.cameraPhi+=2*Math.PI;world3D.cameraTheta-=.005*(b-world3D.camera.oldMouseY),world3D.cameraTheta>.9999*Math.PI&&(world3D.cameraTheta=.9999*Math.PI),world3D.cameraTheta<1e-4*Math.PI&&(world3D.cameraTheta=1e-4*Math.PI),world3D.camera.oldMouseX=a,world3D.camera.oldMouseY=b}}function myMouseUp(){world3D.camera.isPointerDraging=world3D.camera.isDraging=!1}function clickBtn(a){var b=a.target.name;"btnPlayStop"===b?isPlay=!isPlay:"btnReset"===b&&(isPlay=!1,tt=0,world2D.btnReset.visible=!1,world2D.btnPlayStop.visible=!0)}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");world3D.scene.add(ground);var ttext1=new TEACHER.ObjPicPlane(100,25,"allData/pics/text1.png","z",2),ttext2=new TEACHER.ObjPicPlane(100,25,"allData/pics/text2.png","z",2),ttext3=new TEACHER.ObjPicPlane(100,25,"allData/pics/text3.png","z",2);ttext1.position.z=ttext2.position.z=ttext3.position.z=-50,ttext1.position.y=ttext2.position.y=ttext3.position.y=13,world3D.scene.add(ttext1).add(ttext2).add(ttext3);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}TEACHER.CCC=class{constructor(a){this.name=a}},init();