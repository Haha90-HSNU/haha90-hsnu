'use strict';var course01,course02,fps=60,log=console.log,titleTime=120,courseMD=1,gameMD=0,isPlay=!0,tt=0,dt=.1;const gg=2;var mBall=1,mCar=1,followRatio=0;function init(){ground1.position.y=ground2.position.y=ground3.position.y=-1,course01=new TheCourse(1),course02=new TheCourse(2),scene.add(course01).add(course02),world2D.btnPlayStop.on("click",clickBtn),world2D.btnReset.on("click",clickBtn),world2D.btnCourse1.on("click",clickBtnCourse),world2D.btnCourse2.on("click",clickBtnCourse),world2D.slMMRatio.maximum=7,world2D.slMMRatio.minimum=-7,world2D.slMMRatio.value=0,world2D.chMC.checked=!0,world2D.slCameraRR.value=120,world2D.chGround.checked=!0,setInterval(tick,1e3/fps)}function tick(){titleTime--,60<titleTime?(world2D.title.x=800,world2D.title.y=450,world2D.title.scaleX=world2D.title.scaleY=2):0<titleTime&&(world2D.title.x=(800*titleTime+370*(60-titleTime))/60,world2D.title.y=(450*titleTime+90*(60-titleTime))/60,world2D.title.scaleX=world2D.title.scaleY=(2*titleTime+1*(60-titleTime))/60),world2D.slMMRatio.value=Math.round(world2D.slMMRatio.value),0===world2D.slMMRatio.value?(mCar=mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(0)):1===world2D.slMMRatio.value?(mCar=1,mBall=2,world2D.mmText.nnNum1.gotoAndStop(1),world2D.mmText.nnNum2.gotoAndStop(0)):2===world2D.slMMRatio.value?(mCar=1,mBall=5,world2D.mmText.nnNum1.gotoAndStop(2),world2D.mmText.nnNum2.gotoAndStop(0)):3===world2D.slMMRatio.value?(mCar=1,mBall=10,world2D.mmText.nnNum1.gotoAndStop(3),world2D.mmText.nnNum2.gotoAndStop(0)):4===world2D.slMMRatio.value?(mCar=1,mBall=100,world2D.mmText.nnNum1.gotoAndStop(4),world2D.mmText.nnNum2.gotoAndStop(0)):5===world2D.slMMRatio.value?(mCar=1,mBall=1e3,world2D.mmText.nnNum1.gotoAndStop(5),world2D.mmText.nnNum2.gotoAndStop(0)):6===world2D.slMMRatio.value?(mCar=1,mBall=1e4,world2D.mmText.nnNum1.gotoAndStop(6),world2D.mmText.nnNum2.gotoAndStop(0)):7===world2D.slMMRatio.value?(mCar=1,mBall=1e5,world2D.mmText.nnNum1.gotoAndStop(7),world2D.mmText.nnNum2.gotoAndStop(0)):-1===world2D.slMMRatio.value?(mCar=2,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(1)):-2===world2D.slMMRatio.value?(mCar=5,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(2)):-3===world2D.slMMRatio.value?(mCar=10,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(3)):-4===world2D.slMMRatio.value?(mCar=100,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(4)):-5===world2D.slMMRatio.value?(mCar=1e3,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(5)):-6===world2D.slMMRatio.value?(mCar=1e4,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(6)):-7===world2D.slMMRatio.value&&(mCar=1e5,mBall=1,world2D.mmText.nnNum1.gotoAndStop(0),world2D.mmText.nnNum2.gotoAndStop(7));let a=1===courseMD?course01:course02;course01.visible=1===courseMD,course02.visible=2===courseMD,0===gameMD?a.resetCourse():1===gameMD?isPlay&&a.fall():2===gameMD&&isPlay&&a.move(),a.mc.position.x=(mCar*(a.car.xc+a.car.position.x)+mBall*a.ball.position.x)/(mCar+mBall),a.mc.position.y=(mCar*(a.car.yc+a.car.position.y)+mBall*a.ball.position.y)/(mCar+mBall),a.mc.visible=world2D.chMC.checked,a.car.wireA.position.x=0,a.car.wireB.position.x=50*mBall/(mBall+mCar),a.car.wireC.position.x=a.car.position.x,a.car.wireA.visible=world2D.chWireframe.checked&&0<gameMD,a.car.wireB.visible=world2D.chWireframe.checked&&1<gameMD,a.car.wireC.visible=world2D.chWireframe.checked,a.trace.visible=world2D.chWireframe.checked,a.car.solid.visible=!world2D.chWireframe.checked,a.ball.arrowN1.visible=a.ball.arrowN2.visible=world2D.chNN.checked,world2D.slMMRatio.visible=0===gameMD,world2D.btnPlayStop.visible=3>gameMD,world2D.btnReset.visible=2<gameMD,a.ball.arrowN1.visible=a.ball.arrowN2.visible=world2D.chNN.checked,world2D.chFollow.checked?followRatio+=.02:followRatio-=.02,followRatio=Math.min(followRatio,1),followRatio=Math.max(followRatio,0),world3D.cameraTarget.y=20,world3D.cameraTarget.x=followRatio*a.car.position.x+40,a.trace.position.x=world3D.cameraTarget.x,ground1.visible=ground2.visible=ground3.visible=logo.visible=world2D.chGround.checked,world3D.render(),world2D.stage.update()}MyJS.myResize();function clickBtn(a){let b=a.target.name;"btnPlayStop"===b?0===gameMD?(gameMD=1,isPlay=!0):3>gameMD&&(isPlay=!isPlay):"btnReset"===b&&(isPlay=!0,gameMD=0)}function clickBtnCourse(a){let b=a.target.name;courseMD!=parseInt(b.charAt(9))&&(courseMD=parseInt(b.charAt(9)),isPlay=!0,gameMD=0)}class TheCourse extends THREE.Object3D{constructor(a){super();let b=this;b.cMD=a,b.ball=new TheBall,b.car=new TheCar(a,b),b.trace=new FireSmoke(2500),b.add(b.ball).add(b.car).add(b.trace),b.mc=new THREE.Object3D,b.mc.add(new TEACHER.ObjBox(6,.6,.6,16776960)),b.mc.add(new TEACHER.ObjBox(.6,6,.6,16776960)),b.mc.add(new TEACHER.ObjBox(.6,.6,6,16776960)),b.add(b.mc)}resetCourse(){let a=this;if(a.car.position.x=0,1===a.cMD){a.ball.position.x=50-a.ball.RR*Math.sin(Math.PI/6),a.ball.position.y=50*Math.tan(Math.PI/6)+a.ball.RR*Math.cos(Math.PI/6),a.ball.vx=a.ball.vy=0,a.car.v2=0;let b=mBall*gg*Math.sqrt(3)/4/(mCar+mBall/4);a.ball.arrowN1.setArrow(-5*mCar*b/mBall,5*mCar*b/mBall/Math.tan(Math.PI/6),0),a.ball.arrowN2.setArrow(5*mCar*b/mBall,-5*mCar*b/mBall/Math.tan(Math.PI/6),0)}else if(2===a.cMD){a.ball.xx=50*Math.cos(Math.PI/6),a.ball.yy=25,a.ball.position.x=a.ball.xx-a.ball.RR*Math.sin(Math.PI/3),a.ball.position.y=a.ball.yy+a.ball.RR*Math.cos(Math.PI/3);let b=Math.PI/3,c=Math.cos(b),d=Math.sin(b),e=mBall*gg*c*d/(mCar+mBall*d*d);a.ball.arrowN1.setArrow(-5*mCar*e/mBall,5*mCar*e/mBall/Math.tan(b),0),a.ball.arrowN2.setArrow(5*mCar*e/mBall,-5*mCar*e/mBall/Math.tan(b),0)}a.trace.zero()}fall(){let a=this;if(1===a.cMD){let b=mBall*gg*Math.sqrt(3)/4/(mCar+mBall/4),c=mCar*b/mBall,d=Math.tan(Math.PI/6)*(c+b);a.car.position.x+=a.car.v2*dt+.5*b*dt*dt,a.car.v2+=b*dt,a.ball.position.x-=a.ball.vx*dt+.5*c*dt*dt,a.ball.vx+=c*dt,a.ball.position.y-=a.ball.vy*dt+.5*d*dt*dt,a.ball.vy+=d*dt,a.ball.arrowN1.setArrow(-5*mCar*b/mBall,5*mCar*b/mBall/Math.tan(Math.PI/6),0),a.ball.arrowN2.setArrow(5*mCar*b/mBall,-5*mCar*b/mBall/Math.tan(Math.PI/6),0),a.ball.position.y<a.ball.RR&&(gameMD=2,a.ball.position.y=a.ball.RR,a.car.v2=Math.sqrt(50*(2*mBall*gg)/Math.sqrt(3)/(mCar*mCar/mBall+Math.pow(mCar+mBall,2)/3/mBall+mCar)),a.ball.vx=mCar*a.car.v2/mBall)}else if(2===a.cMD){let b=Math.acos((50-a.ball.yy)/50),c=Math.cos(b),d=Math.sin(b),e=50,f=Math.sqrt(2*mBall*gg*e*Math.max(c-.5,0)/(mCar*mCar/mBall+Math.pow(d/c*(mCar+mBall),2)/mBall+mCar)),g=f*mCar/mBall,h=(mBall*gg*c*d+mBall*d/e*(Math.pow(c*(g+f),2)+Math.pow(d*((g+f)*d/c),2)))/(mCar+mBall*d*d),i=mCar*h/mBall;a.car.position.x+=f*dt+.5*h*dt*dt,a.ball.xx-=g*dt+.5*i*dt*dt,a.ball.vx+=i*dt;let j=a.ball.xx-a.car.position.x;0<j?(a.ball.yy=e-Math.sqrt(e*e-j*j),a.ball.position.x=a.ball.xx-a.ball.RR*Math.sin(b),a.ball.position.y=a.ball.yy+a.ball.RR*Math.cos(b)):(a.ball.position.y=a.ball.RR,a.car.v2=Math.sqrt(25*(2*mBall*gg)/(mCar*mCar/mBall+mCar)),a.ball.vx=a.car.v2*mCar/mBall,gameMD=2),a.ball.arrowN1.setArrow(-5*mCar*h/mBall,5*mCar*h/mBall/Math.tan(b),0),a.ball.arrowN2.setArrow(5*mCar*h/mBall,-5*mCar*h/mBall/Math.tan(b),0)}a.trace.addOne(a.ball.position.x-world3D.cameraTarget.x,a.ball.position.y,a.ball.position.z,1,.5,0,10),a.trace.update()}move(){let a=this;a.car.position.x+=a.car.v2*dt,a.ball.position.x-=a.ball.vx*dt,160<a.car.position.x-a.ball.position.x&&(gameMD=3),a.ball.arrowN1.setArrow(0,0,0),a.ball.arrowN2.setArrow(0,0,0),a.trace.addOne(a.ball.position.x-world3D.cameraTarget.x,a.ball.position.y,a.ball.position.z,1,.5,0,10),a.trace.update()}}class TheBall extends THREE.Object3D{constructor(){super();let a=this;a.RR=2,a.ball=new TEACHER.ObjSphere(a.RR,16711680),a.add(a.ball),a.arrowN1=new TEACHER.ObjArrow(.8,16776960),a.arrowN2=new TEACHER.ObjArrow(.8,16776960),a.add(a.arrowN1).add(a.arrowN2)}}class TheCar extends THREE.Object3D{constructor(a,b){super();let c=this;1===a?(c.buildBody1(b),c.xc=100/3,c.yc=50/3/Math.sqrt(3)):2==a&&(c.buildBody2(b),c.xc=40,c.yc=.9*(50/3/Math.sqrt(3))),c.carMC=new TEACHER.ObjSphere(.8,39423),c.carMC.position.x=c.xc,c.carMC.position.y=c.yc,c.add(c.carMC)}buildBody1(a){let b=this,c=5,d=new TEACHER.MSMat(39423);b.solid=new THREE.Object3D,b.add(b.solid);let e=new THREE.PlaneGeometry(100,100,c,1);for(var f=0;f<=c;f++)e.attributes.position.array[3*f+0]=10*f,e.attributes.position.array[3*f+1]=10*f*Math.tan(Math.PI/6),e.attributes.position.array[3*f+2]=-10,e.attributes.position.array[3*(f+c+1)+0]=10*f,e.attributes.position.array[3*(f+c+1)+1]=10*f*Math.tan(Math.PI/6),e.attributes.position.array[3*(f+c+1)+2]=10;e.computeVertexNormals();let g=new THREE.Mesh(e,d);b.solid.add(g),e=new THREE.PlaneGeometry(100,100,c,1);for(var f=0;f<=c;f++)e.attributes.position.array[3*f+0]=10*f,e.attributes.position.array[3*f+1]=10*f*Math.tan(Math.PI/6),e.attributes.position.array[3*f+2]=10,e.attributes.position.array[3*(f+c+1)+0]=10*f,e.attributes.position.array[3*(f+c+1)+1]=0,e.attributes.position.array[3*(f+c+1)+2]=10;e.computeVertexNormals(),g=new THREE.Mesh(e,d),b.solid.add(g),e=new THREE.PlaneGeometry(100,100,c,1);for(var f=0;f<=c;f++)e.attributes.position.array[3*f+0]=10*(c-f),e.attributes.position.array[3*f+1]=10*(c-f)*Math.tan(Math.PI/6),e.attributes.position.array[3*f+2]=-10,e.attributes.position.array[3*(f+c+1)+0]=10*(c-f),e.attributes.position.array[3*(f+c+1)+1]=0,e.attributes.position.array[3*(f+c+1)+2]=-10;e.computeVertexNormals(),g=new THREE.Mesh(e,d),b.solid.add(g),e=new THREE.PlaneGeometry(50,20,1,1),g=new THREE.Mesh(e,d),g.rotation.x=Math.PI/2,g.position.x=25,b.solid.add(g),e=new THREE.PlaneGeometry(20,50*Math.tan(Math.PI/6),1,1),g=new THREE.Mesh(e,d),g.rotation.y=Math.PI/2,g.position.y=25*Math.tan(Math.PI/6),g.position.x=50,b.solid.add(g),b.wireA=new THREE.Object3D,a.add(b.wireA),b.wireB=new THREE.Object3D,a.add(b.wireB),b.wireC=new THREE.Object3D,a.add(b.wireC);for(var f=0;3>f;f++){let a=0==f?b.wireA:1===f?b.wireB:b.wireC,c=0==f?13209:1===f?26367:65535,d=new TEACHER.Line(c,5,4);d.addPoint(0,0,10),d.addPoint(50,0,10),d.addPoint(50,50*Math.tan(Math.PI/6),10),d.addPoint(0,0,10),d.update(),a.add(d),d=new TEACHER.Line(c,5,4),d.addPoint(0,0,-10),d.addPoint(50,0,-10),d.addPoint(50,50*Math.tan(Math.PI/6),-10),d.addPoint(0,0,-10),d.update(),a.add(d),d=new TEACHER.Line(c,5,2),d.addPoint(0,0,-10),d.addPoint(0,0,10),d.update(),a.add(d),d=new TEACHER.Line(c,5,2),d.addPoint(50,0,-10),d.addPoint(50,0,10),d.update(),a.add(d),d=new TEACHER.Line(c,5,2),d.addPoint(50,50*Math.tan(Math.PI/6),-10),d.addPoint(50,50*Math.tan(Math.PI/6),10),d.update(),a.add(d),d=new TEACHER.Line(c,5,2)}}buildBody2(a){let b=this,c=30,d=new TEACHER.MSMat(39423);b.solid=new THREE.Object3D,b.add(b.solid);let e=new THREE.PlaneGeometry(100,100,c,1);for(var f=0;f<=c;f++){let a=50*(f/c)*Math.sqrt(3)/2,b=50-Math.sqrt(2500-a**2);e.attributes.position.array[3*f+0]=a,e.attributes.position.array[3*f+1]=b,e.attributes.position.array[3*f+2]=-10,e.attributes.position.array[3*(f+c+1)+0]=a,e.attributes.position.array[3*(f+c+1)+1]=b,e.attributes.position.array[3*(f+c+1)+2]=10}e.computeVertexNormals();let g=new THREE.Mesh(e,d);b.solid.add(g),e=new THREE.PlaneGeometry(50*(1-Math.sqrt(3)/2),20,1,1),g=new THREE.Mesh(e,d),g.rotation.x=-Math.PI/2,g.position.y=25,g.position.x=50-25*(1-Math.sqrt(3)/2),b.solid.add(g),e=new THREE.PlaneGeometry(100,100,c,1);for(var f=0;f<=c;f++){let a=50*(f/c),b=Math.min(50-Math.sqrt(2500-a**2),25);e.attributes.position.array[3*f+0]=a,e.attributes.position.array[3*f+1]=b,e.attributes.position.array[3*f+2]=10,e.attributes.position.array[3*(f+c+1)+0]=a,e.attributes.position.array[3*(f+c+1)+1]=0,e.attributes.position.array[3*(f+c+1)+2]=10}e.computeVertexNormals(),g=new THREE.Mesh(e,d),b.solid.add(g),e=new THREE.PlaneGeometry(100,100,c,1);for(var f=0;f<=c;f++){let a=50*((c-f)/c),b=Math.min(50-Math.sqrt(2500-a**2),25);e.attributes.position.array[3*f+0]=a,e.attributes.position.array[3*f+1]=b,e.attributes.position.array[3*f+2]=-10,e.attributes.position.array[3*(f+c+1)+0]=a,e.attributes.position.array[3*(f+c+1)+1]=0,e.attributes.position.array[3*(f+c+1)+2]=-10}e.computeVertexNormals(),g=new THREE.Mesh(e,d),b.solid.add(g),e=new THREE.PlaneGeometry(50,20,1,1),g=new THREE.Mesh(e,d),g.rotation.x=Math.PI/2,g.position.x=25,b.add(g),e=new THREE.PlaneGeometry(20,25,1,1),g=new THREE.Mesh(e,d),g.rotation.y=Math.PI/2,g.position.y=25/2,g.position.x=50,b.solid.add(g),b.wireA=new THREE.Object3D,a.add(b.wireA),b.wireB=new THREE.Object3D,a.add(b.wireB),b.wireC=new THREE.Object3D,a.add(b.wireC);for(var f=0;3>f;f++){let a=0==f?b.wireA:1===f?b.wireB:b.wireC,c=0==f?13209:1===f?26367:65535;for(var h=0;2>h;h++){let b=new TEACHER.Line(c,5,4);b.addPoint(0,0,0==h?10:-10),b.addPoint(50,0,0==h?10:-10),b.addPoint(50,25,0==h?10:-10),b.addPoint(25*Math.sqrt(3),25,0==h?10:-10),b.update(),a.add(b),b=new TEACHER.Line(c,5,33);for(var l=0;32>=l;l++){let a=25*(l/32)*Math.sqrt(3),c=Math.min(50-Math.sqrt(2500-a**2),25);b.addPoint(a,c,0===h?10:-10)}b.update(),a.add(b)}let d=new TEACHER.Line(c,5,2);d.addPoint(0,0,-10),d.addPoint(0,0,10),d.update(),a.add(d),d=new TEACHER.Line(c,5,2),d.addPoint(50,0,-10),d.addPoint(50,0,10),d.update(),a.add(d),d=new TEACHER.Line(c,5,2),d.addPoint(50,25,-10),d.addPoint(50,25,10),d.update(),a.add(d),d=new TEACHER.Line(c,5,2),d.addPoint(25*Math.sqrt(3),25,-10),d.addPoint(25*Math.sqrt(3),25,10),d.update(),a.add(d)}}}class FireSmoke extends THREE.Object3D{constructor(a){super();let b=this;b.nn=a,b.iNow=0,b.xxiNow=0,b.velocities,b.velocities=new Float32Array(3*b.nn),b.positions=new Float32Array(3*b.nn),b.colors=new Float32Array(3*b.nn),b.sizes=new Float32Array(b.nn),b.ages=new Float32Array(b.nn);const c=new THREE.Vector3,d=new THREE.Color(16777215);for(let e=0;e<b.nn;e++)c.x=0,c.y=0,c.z=0,c.toArray(b.positions,3*e),d.setHSL(.5+.1*(e/b.nn),.7,.5),d.toArray(b.colors,3*e),b.sizes[e]=2,b.ages[e]=-1;const e=new THREE.BufferGeometry;e.setAttribute("position",new THREE.BufferAttribute(b.positions,3)),e.setAttribute("customColor",new THREE.BufferAttribute(b.colors,3)),e.setAttribute("size",new THREE.BufferAttribute(b.sizes,1));const f=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(16777215)},pointTexture:{value:new THREE.TextureLoader().load("allData/pics/ball.png")}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0});b.points=new THREE.Points(e,f),b.add(b.points)}zero(){let a=this;a.iNow=0,a.xxiNow=0;const b=a.points.geometry,c=b.attributes;for(var d=0;d<a.nn;d++)c.position.array[3*d+0]=0,c.position.array[3*d+1]=0,c.position.array[3*d+2]=0,c.size.array[d]=1e-5,c.customColor.array[3*d+0]=1,c.customColor.array[3*d+1]=1,c.customColor.array[3*d+2]=1,a.ages[d]=-1;c.size.needsUpdate=!0,c.position.needsUpdate=!0,c.customColor.needsUpdate=!0}addOne(a,b,c,d,e,f,g){let h=this;const i=h.points.geometry,j=i.attributes;h.ages[h.iNow]=0,h.finalR=d,h.finalG=e,h.finalB=f,h.finalSize=g,j.position.array[3*h.iNow+0]=a,j.position.array[3*h.iNow+1]=b,j.position.array[3*h.iNow+2]=c,j.customColor.array[3*h.iNow+0]=1,j.customColor.array[3*h.iNow+1]=1,j.customColor.array[3*h.iNow+2]=1,h.iNow+=1,h.xxiNow+=1,h.iNow>=h.nn&&(h.iNow=0)}update(){let a=this;const b=a.points.geometry,c=b.attributes;for(let b=0;b<a.nn;b++){let d=c.position.array[3*b+0],e=c.position.array[3*b+1],f=c.position.array[3*b+2];a.ages[b]+=0<=a.ages[b]?1:0,c.size.array[b]=0<=a.ages[b]?a.finalSize+(20-a.finalSize)*Math.exp(-a.ages[b]/10):1e-5,c.position.array[3*b+0]=d,c.position.array[3*b+1]=e,c.position.array[3*b+2]=f,c.customColor.array[3*b+0]=a.finalR+(1-a.finalR)*Math.exp(-a.ages[b]/10),c.customColor.array[3*b+1]=a.finalG+(1-a.finalG)*Math.exp(-a.ages[b]/10),c.customColor.array[3*b+2]=a.finalB+(1-a.finalB)*Math.exp(-a.ages[b]/10)}c.size.needsUpdate=!0,c.position.needsUpdate=!0,c.customColor.needsUpdate=!0}}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,10,10),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground1=new TEACHER.ObjPicPlane(100,100,pics.ground,"y"),ground2=new TEACHER.ObjPicPlane(100,100,pics.ground,"y"),ground3=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");ground1.position.x=-100,ground3.position.x=100,world3D.scene.add(ground1).add(ground2).add(ground3);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();