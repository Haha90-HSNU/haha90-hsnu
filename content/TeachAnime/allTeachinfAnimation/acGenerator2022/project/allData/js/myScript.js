"use strict";var model,fps=60,log=console.log,allRotZ=new THREE.Object3D;const teachingMD=2;var brushMD=1,dt=.1,isPlay=!0,isStep=!1,battDir=1,battDx=0,magDir=1,magDx=0,gRotDir=1,cameraFollowTarget=0,cameraFollowRatio=0,titleCount=0;function init(){world2D.slCameraRR.value=180,scene.add(allRotZ),loadModel(),world2D.title.gotoAndStop(teachingMD-1),world2D.title.x=800,world2D.title.y=450}function tick(){if(titleCount<120&&(titleCount++,world2D.title.x=(120-titleCount)/120*800+titleCount/120*150,world2D.title.y=(120-titleCount)/120*450+titleCount/120*80,world2D.title.scaleX=world2D.title.scaleY=(120-titleCount)/120*3+titleCount/120*.8),1===teachingMD){brushMD=world2D.controlMotor.chCircle.checked?1:0;var e=-1;battDir>1&&battDir<2?(e=0,(battDir+=battDx)<=1?battDir=1:battDir>=2&&(battDir=2)):1===battDir?0===brushMD&&(model.rotator.theta<Math.PI/2||model.rotator.theta>3*Math.PI/2)?e=1:0===brushMD&&model.rotator.theta>Math.PI/2&&model.rotator.theta<3*Math.PI/2?e=-1:1===brushMD&&(e=1):2===battDir&&(0===brushMD&&(model.rotator.theta<Math.PI/2||model.rotator.theta>3*Math.PI/2)?e=-1:0===brushMD&&model.rotator.theta>Math.PI/2&&model.rotator.theta<3*Math.PI/2?e=1:1===brushMD&&(e=-1)),model.battery.rotation.y=(battDir-1)*Math.PI,magDir>1&&magDir<2&&((magDir+=magDx)<=1?magDir=1:magDir>=2&&(magDir=2)),model.allMag.rotation.x=(magDir-1)*Math.PI,model.magS.visible=model.magN.visible=!world2D.controlMotor.chMagnet.checked,model.magSWire.visible=model.magNWire.visible=world2D.controlMotor.chMagnet.checked,dt>.005&&world2D.controlMotor.chSlowM.checked?(dt-=.0015)<.005&&(dt=.005):dt<.1&&!world2D.controlMotor.chSlowM.checked&&(dt+=.0015)>.1&&(dt=.1);var o=.8*e*Math.sin(model.rotator.theta-Math.PI*(magDir-.5))-.2*model.rotator.omega;for(model.rotator.omega+=o*dt*(isPlay?1:0),model.rotator.theta+=model.rotator.omega*dt*(isPlay?1:0);model.rotator.theta>2*Math.PI;)model.rotator.theta-=2*Math.PI;for(;model.rotator.theta<0;)model.rotator.theta+=2*Math.PI;model.rotator.rotation.x=model.rotator.theta,model.mainCore.visible=!world2D.controlMotor.chCoil2.checked,model.mainCore2.visible=world2D.controlMotor.chCoil2.checked,model.arrowBB.visible=world2D.controlMotor.chArrowB.checked;for(var t=model.currentCores.length,a=0;a<t;a++){(s=model.currentCores[a]).visible=0!=e&&world2D.controlMotor.chArrowI.checked,s.scale.x=s.scale.y=s.scale.z=e}model.arrowAA.scale.y=e,model.arrowAA.visible=model.planeAA.visible=world2D.controlMotor.chArrowA.checked,model.thumb.visible=world2D.controlMotor.chThumb.checked,model.thumb.rotation.x=(-1===e?Math.PI:0)-Math.PI/2;for(a=0;a<2;a++)for(var r=0;r<3;r++){0===r?s=model.currentFixeds[a]:1===r?s=model.currentBrushAs[a]:2===r&&(s=model.currentBrushBs[a]),s.scale.x=s.scale.y=s.scale.z=1===battDir?1:-1,s.visible=world2D.controlMotor.chArrowI.checked&&(1===battDir||2===battDir)}model.arrowFFL.rotation.x=-Math.PI/2*e-model.rotator.theta+Math.PI*(magDir-.5),model.arrowFFR.rotation.x=-Math.PI/2*e-model.rotator.theta+Math.PI*(magDir-.5),model.arrowFFL.visible=model.arrowFFR.visible=world2D.controlMotor.chArrowF.checked&&0!=e,model.handILBRcOUT.position.z=-2.2*Math.cos(model.rotator.theta),model.handILBRcOUT.position.y=2.2*Math.sin(model.rotator.theta)+.3,model.handILBLcOUT.position.z=2.2*Math.cos(model.rotator.theta),model.handILBLcOUT.position.y=-2.2*Math.sin(model.rotator.theta)+.3,model.handILBRcOUT.rotation.x=model.allMag.rotation.x+Math.PI,model.handILBLcOUT.rotation.x=model.allMag.rotation.x+Math.PI,model.handILBRcIN.rotation.z=-e<0?0:Math.PI,model.handILBLcIN.rotation.z=e<0?0:Math.PI,model.handILBRcOUT.visible=model.handILBLcOUT.visible=world2D.controlMotor.chHandILB.checked&&0!=e}else if(2===teachingMD){for(brushMD=world2D.controlGenerator.chCircle.checked?1:0,magDir>1&&magDir<2&&((magDir+=magDx)<=1?magDir=1:magDir>=2&&(magDir=2)),model.allMag.rotation.x=(magDir-1)*Math.PI,model.magS.visible=model.magN.visible=!world2D.controlGenerator.chMagnet.checked,model.magSWire.visible=model.magNWire.visible=world2D.controlGenerator.chMagnet.checked,model.rotator.theta+=.02*gRotDir*(isPlay?1:0);model.rotator.theta>2*Math.PI;)model.rotator.theta-=2*Math.PI;for(;model.rotator.theta<0;)model.rotator.theta+=2*Math.PI;if(model.rotator.rotation.x=model.rotator.theta-Math.PI/2,(cameraFollowRatio+=.01*(world2D.controlGenerator.chFollow.checked?1:-1))>1?cameraFollowRatio=1:cameraFollowRatio<0?cameraFollowRatio=0:cameraFollowRatio>0&&cameraFollowRatio<1&&(world2D.slCameraRR.value=80+100*(1-cameraFollowRatio)),cameraFollowTarget=-(world2D.controlGenerator.chFollow.checked?model.rotator.theta:0),world2D.controlGenerator.chFollow.checked)if(gRotDir<0){for(;cameraFollowTarget>allRotZ.rotation.z+2*Math.PI;)cameraFollowTarget-=2*Math.PI;for(;cameraFollowTarget<allRotZ.rotation.z;)cameraFollowTarget+=2*Math.PI}else{for(;cameraFollowTarget<allRotZ.rotation.z-2*Math.PI;)cameraFollowTarget+=2*Math.PI;for(;cameraFollowTarget>allRotZ.rotation.z;)cameraFollowTarget-=2*Math.PI}for(world2D.controlGenerator.chFollow.checked?allRotZ.rotation.z-=.02*gRotDir*(isPlay?1:0)*cameraFollowRatio:allRotZ.rotation.z*=.95;allRotZ.rotation.z>Math.PI;)allRotZ.rotation.z-=2*Math.PI;for(;allRotZ.rotation.z<-Math.PI;)allRotZ.rotation.z+=2*Math.PI;for(a=0;a<16;a++){var l=model.xxooPlane.xxoos1[a],n=model.xxooPlane.xxoos2[a];l.x=n.x=256*(a%4-1.5)/4.8+128,l.y=n.y=256*(Math.floor(a/4)-1.5)/3.8/Math.cos(model.rotator.theta)+128,l.scaleX=n.scaleX=.6,l.scaleY=n.scaleY=2.88/3.8,Math.cos(model.rotator.theta)*(magDir-1.5)<0?(l.gotoAndStop(0),n.gotoAndStop(1)):(l.gotoAndStop(1),n.gotoAndStop(0))}model.xxooPlane.stage1.update(),model.xxooPlane.stage2.update(),model.xxooPlane.texture1.needsUpdate=!0,model.xxooPlane.texture2.needsUpdate=!0,model.xxooPlane.visible=world2D.controlGenerator.chArrowPhi.checked&&(1===magDir||2===magDir);Math.cos(model.rotator.theta);var i=Math.sin(model.rotator.theta)*(magDir-1.5<0?1:-1)*gRotDir;for(a=0;a<9;a++){(s=model.arrowBInduceds[a]).scale.z=s.scale.x=s.scale.y=i,s.visible=world2D.controlGenerator.chBBInduced.checked&&(1===magDir||2===magDir)}for(t=model.arrowBBGs.length,a=0;a<t;a++){(s=model.arrowBBGs[a]).visible=world2D.controlGenerator.chArrowB.checked}for(t=model.currentCores.length,a=0;a<t;a++){(s=model.currentCores[a]).visible=0!=e&&world2D.controlGenerator.chArrowIInduced.checked,s.scale.x=s.scale.y=s.scale.z=i}for(a=0;a<2;a++)for(r=0;r<3;r++){var s;0===r?s=model.currentFixeds[a]:1===r?s=model.currentBrushAs[a]:2===r&&(s=model.currentBrushBs[a]),s.scale.x=s.scale.y=s.scale.z=i*(0===brushMD&&Math.sin(model.rotator.theta)<0?-1:1),s.visible=world2D.controlGenerator.chArrowIInduced.checked&&(1===battDir||2===battDir)}model.arrowRot.scale.x=model.arrowRot.scale.y=model.arrowRot.scale.z=gRotDir,isStep&&(isPlay=!1)}model.brushA.visible=model.collectionA.visible=0==brushMD,model.brushB.visible=model.collectionB.visible=1==brushMD,world3D.render(),world2D.stage.update()}function loadModel(){(new THREE.GLTFLoader).load("allData/js/model3D/DCACMotor.gltf",function(e){model=e.scene,allRotZ.add(e.scene),initModel(),setInterval(tick,1e3/fps)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){console.log("An error happened")})}function initModel(){for(model.rotation.y=-.5*Math.PI,model.scale.x=model.scale.y=model.scale.z=10,ground.position.y=-22,ground.position.z=0,model.allMag=new THREE.Object3D,model.handAndFan=new THREE.Object3D,model.collectionA=new THREE.Object3D,model.collectionB=new THREE.Object3D,model.brushA=new THREE.Object3D,model.brushB=new THREE.Object3D,model.battery=new THREE.Object3D,model.resistor=new THREE.Object3D,model.battery.position.x=model.resistor.position.x=7.5,model.battery.position.y=model.resistor.position.y=-.6,model.rotator=new THREE.Object3D,model.fixed=new THREE.Object3D,model.rotator.omega=0,model.rotator.theta=0;model.children.length>0;){var e=model.children.pop();"fan00"===e.name?(model.handAndFan.add(e),e.visible=1===teachingMD):"hand00"===e.name||"hand01"===e.name||"hand02"===e.name||"hand03"===e.name?(model.handAndFan.add(e),e.visible=2===teachingMD):"MainCore"===e.name||"MainCore2"===e.name||"thumb"===e.name?("thumb"===e.name&&(model.thumb=e),"MainCore2"===e.name&&(model.mainCore2=e),"MainCore"===e.name&&(model.mainCore=e),model.rotator.add(e)):"handILBR"===e.name||"handILBL"===e.name?(e.position.x=0,e.position.y=0,e.position.z=0,model[e.name+"cIN"]=new THREE.Object3D,model[e.name+"cOUT"]=new THREE.Object3D,model[e.name+"cOUT"].add(model[e.name+"cIN"]),model[e.name+"cIN"].add(e),model.fixed.add(model[e.name+"cOUT"]),e.visible=1===teachingMD):"magN"===e.name||"magS"===e.name||"magLetterN"===e.name||"magLetterS"===e.name?("magN"===e.name?model.magN=e:"magS"===e.name?model.magS=e:"magLetterN"===e.name?model.magLatterN=e:"magLetterS"===e.name&&(model.magLatterS=e),model.allMag.add(e)):"collectionA0"===e.name||"collectionA1"===e.name||"collectionAL"===e.name||"collectionAR"===e.name?model.collectionA.add(e):"collectionB01"===e.name||"collectionB02"===e.name||"collectionBL"===e.name||"collectionBR"===e.name?model.collectionB.add(e):"brushAL"===e.name||"brushAR"===e.name||"brushALwire"===e.name||"brushARwire"===e.name?model.brushA.add(e):"brushBL"===e.name||"brushBR"===e.name||"brushBLwire"===e.name||"brushBRwire"===e.name?model.brushB.add(e):"batt0"===e.name||"batt1"===e.name||"batt2"===e.name?(e.position.x=0,e.position.y=0,model.battery.add(e),e.visible=1===teachingMD):"resist"===e.name&&(e.position.x=0,e.position.y=0,model.resistor.add(e),e.visible=2===teachingMD)}model.add(model.rotator),model.add(model.fixed),model.rotator.add(model.collectionA),model.rotator.add(model.collectionB),model.rotator.add(model.handAndFan),model.fixed.add(model.brushA),model.fixed.add(model.brushB),model.fixed.add(model.battery),model.fixed.add(model.resistor),model.fixed.add(model.allMag);var o=new THREE.EdgesGeometry(model.magN.geometry),t=new THREE.LineBasicMaterial({color:255});model.magNWire=new THREE.LineSegments(o,t),model.magNWire.position.z=model.magN.position.z,model.magNWire.scale.z=model.magN.scale.z,model.magNWire.scale.y=model.magN.scale.y,model.allMag.add(model.magNWire);var a=new THREE.EdgesGeometry(model.magS.geometry),r=new THREE.LineBasicMaterial({color:16711680});if(model.magSWire=new THREE.LineSegments(a,r),model.magSWire.position.z=model.magS.position.z,model.magSWire.scale.z=model.magS.scale.z,model.magSWire.scale.y=model.magS.scale.y,model.allMag.add(model.magSWire),model.magN.visible=model.magS.visible=!1,1===teachingMD)model.arrowAA=new TEACHER.ObjArrow(.15,6750054),model.arrowAA.setArrow(0,3,0),model.rotator.add(model.arrowAA),model.planeAA=new THREE.Mesh(new THREE.PlaneGeometry(4.8,3.8),new THREE.MeshBasicMaterial({color:6750054,transparent:!0,opacity:.5,side:2})),model.planeAA.rotation.x=Math.PI/2,model.rotator.add(model.planeAA),model.arrowBB=new TEACHER.ObjArrow(.15,16776960,!0),model.arrowBB.setArrow(0,0,-5),model.allMag.add(model.arrowBB),model.arrowFFR=new TEACHER.ObjArrow(.1,3407871),model.arrowFFL=new TEACHER.ObjArrow(.1,3407871),model.arrowFFR.setArrow(0,2,0),model.arrowFFL.setArrow(0,-2,0),model.arrowFFR.position.z=2,model.arrowFFL.position.z=-2,model.rotator.add(model.arrowFFR).add(model.arrowFFL),world2D.controlMotor.visible=!0,world2D.controlGenerator.visible=!1,world2D.controlMotor.chArrowB.checked=!0,world2D.controlMotor.chArrowA.checked=!0,world2D.controlMotor.chArrowI.checked=!0,world2D.controlMotor.chMagnet.checked=!0,world2D.controlMotor.btnPlayStop.on("click",function(){isPlay=!isPlay}),world2D.controlMotor.btnChangeI.on("click",function(){1===battDir?battDir+=battDx=.01:2===battDir&&(battDir+=battDx=-.01)}),world2D.controlMotor.btnChangeB.on("click",function(){1===magDir?magDir+=magDx=.01:2===magDir&&(magDir+=magDx=-.01)});else if(2===teachingMD){model.mainCore2.visible=model.thumb.visible=!1,model.arrowRot=new TEACHER.ObjArrow(.3,10066329,!0),model.arrowRot.setArrow(0,0,2),model.arrowRot.position.x=-3.5,model.arrowRot.position.y=3,model.handAndFan.add(model.arrowRot),model.arrowBInduceds=[];for(var l=0;l<9;l++){(n=new TEACHER.ObjArrow(.2,3407667,!0)).setArrow(0,2.5,0),n.position.x=1.5*(l%3-1),n.position.z=1.5*(Math.floor(l/3)-1),model.rotator.add(n),model.arrowBInduceds.push(n)}model.arrowBBGs=[];for(l=0;l<16;l++){var n;(n=new TEACHER.ObjArrow(.1,16776960,!0)).position.x=1*(l%4-1.5),n.position.y=1*(Math.floor(l/4)-1.5),n.setArrow(0,0,-4),model.allMag.add(n),model.arrowBBGs.push(n)}let e=$("<canvas>").attr("width",String(256)).attr("height",String(256)),o=new createjs.Stage(e[0]),t=$("<canvas>").attr("width",String(256)).attr("height",String(256)),a=new createjs.Stage(t[0]),r=new createjs.Container,w=new createjs.Container,E=new createjs.Shape;E.graphics.c().f("#000066").dr(0,0,256,256),E.alpha=.6;let M=new createjs.Shape;M.graphics.c().f("#660000").dr(0,0,256,256),M.alpha=.6,r.addChild(E),w.addChild(M);var i=[],s=[];for(l=0;l<16;l++){var d=new lib.xxoo;i.push(d),r.addChild(d);d=new lib.xxoo;s.push(d),w.addChild(d)}o.addChild(r),o.update(),a.addChild(w),a.update();let x=new THREE.Texture(e[0]);var c=new THREE.MeshBasicMaterial({map:x,transparent:!0});let g=new THREE.Texture(t[0]);var m=new THREE.MeshBasicMaterial({map:g,transparent:!0}),h=new THREE.PlaneGeometry(4.8,3.8,1,1);x.needsUpdate=!0,g.needsUpdate=!0;let b=new THREE.Mesh(h,c),p=new THREE.Mesh(h,m);b.rotation.x=.5*Math.PI,p.rotation.x=-.5*Math.PI,model.xxooPlane=new THREE.Object3D,model.xxooPlane.add(b).add(p),model.rotator.add(model.xxooPlane),model.xxooPlane.stage1=o,model.xxooPlane.stage2=a,model.xxooPlane.xxoos1=i,model.xxooPlane.xxoos2=s,model.xxooPlane.texture1=x,model.xxooPlane.texture2=g,model.xxooPlane.size=256,world2D.controlMotor.visible=!1,world2D.controlGenerator.visible=!0,world2D.controlGenerator.btnPlayStop.on("click",function(){isPlay=!isPlay,isStep=!1}),world2D.controlGenerator.btnStep.on("click",function(){isPlay=!0,isStep=!0}),world2D.controlGenerator.btnChangeB.on("click",function(){1===magDir?magDir+=magDx=.01:2===magDir&&(magDir+=magDx=-.01)}),world2D.controlGenerator.btnChangeRot.on("click",function(){gRotDir*=-1}),world2D.controlGenerator.chCircle.checked=!0,world2D.controlGenerator.chArrowB.checked=!0,world2D.controlGenerator.chArrowIInduced.checked=!0,world2D.controlGenerator.chArrowPhi.checked=!0}model.currentCores=[];var w,E=16711935,M=.12,x=.12;model.cDY=x,(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(0,0,2),w.position.x=-2.62,model.rotator.add(w),model.currentCores.push(w),(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(2,0,0),w.position.z=2.12,model.rotator.add(w),model.currentCores.push(w),(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(-2,0,0),w.position.z=-2.12,model.rotator.add(w),model.currentCores.push(w),(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(1.2,0,0),w.position.x=3.5,w.position.z=.32,model.rotator.add(w),model.currentCores.push(w),(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(-1.2,0,0),w.position.x=3.5,w.position.z=-.32,model.rotator.add(w),model.currentCores.push(w),model.currentFixeds=[],(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(0,0,-1),w.position.x=7.5,w.position.z=-1.8,w.position.y=-.48,model.fixed.add(w),model.currentFixeds.push(w),(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(0,0,-1),w.position.x=7.5,w.position.z=1.8,w.position.y=-.48,model.fixed.add(w),model.currentFixeds.push(w),model.currentBrushAs=[],(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(0,0,1),w.position.x=5,w.position.z=1.8,w.position.y=-.48,model.brushA.add(w),model.currentBrushAs.push(w),(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(0,0,1),w.position.x=5,w.position.z=-1.8,w.position.y=-.48,model.brushA.add(w),model.currentBrushAs.push(w),model.currentBrushBs=[],(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(0,0,1),w.position.x=5.5,w.position.z=1.8,w.position.y=-.48,model.brushB.add(w),model.currentBrushBs.push(w),(w=new TEACHER.ObjArrow(M,E,!0)).setArrow(0,0,1),w.position.x=4.5,w.position.z=-1.8,w.position.y=-.48,model.brushB.add(w),model.currentBrushBs.push(w)}MyJS.myResize();var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(e,o,t,a,r){super();let l=this;l.mat=new TEACHER.MSMat(t,r),l.geo=new THREE.PlaneGeometry(e||10,o||10,1,1),l.mesh=new THREE.Mesh(l.geo,l.mat),"x"===a?l.mesh.rotation.y=.5*Math.PI:"y"===a&&(l.mesh.rotation.x=-.5*Math.PI),l.add(l.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(e,o,t,a,r,l){super();let n=this;n.mat=new TEACHER.MSMat(t,l),n.geo=new THREE.CylinderGeometry(e||10,e||10,o||10,32,2,a),n.mesh=new THREE.Mesh(n.geo,n.mat),"x"===r?n.mesh.rotation.z=-.5*Math.PI:"z"===r&&(n.mesh.rotation.x=.5*Math.PI),n.add(n.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(e,o,t){super();let a=this;a.mat=new TEACHER.MSMat(o,t),a.geo=new THREE.SphereGeometry(e||10,32,16),a.mesh=new THREE.Mesh(a.geo,a.mat),a.add(a.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(e,o,t,a,r){super();let l=this;l.mat=new TEACHER.MSMat(a,r),l.geo=new THREE.BoxGeometry(e||10,o||10,t||10),l.mesh=new THREE.Mesh(l.geo,l.mat),l.add(l.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(e,o){super({color:e||16711935,roughness:.4,side:o||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(e,o,t,a,r){super();let l=this,n=(new THREE.TextureLoader).load(t);l.mat=new THREE.MeshBasicMaterial({map:n,transparent:!0,side:r||0}),l.geo=new THREE.PlaneGeometry(e,o,1,1),l.mesh=new THREE.Mesh(l.geo,l.mat),"x"===a?l.mesh.rotation.y=.5*Math.PI:"y"===a&&(l.mesh.rotation.x=-.5*Math.PI),l.add(l.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(e,o,t,a,r,l){super();let n=this,i=(new THREE.TextureLoader).load(t);n.mat=new THREE.MeshBasicMaterial({map:i,side:l||0}),n.geo=new THREE.CylinderGeometry(e||10,e||10,o||10,32,4,a),n.mesh=new THREE.Mesh(n.geo,n.mat),"x"===r?n.mesh.rotation.z=-.5*Math.PI:"z"===r?(n.mesh.rotation.y=.5*Math.PI,n.mesh.rotation.x=.5*Math.PI):"y"===r&&(n.mesh.rotation.y=.5*Math.PI),n.add(n.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(e,o,t){super();let a=this,r=(new THREE.TextureLoader).load(o);a.mat=new THREE.MeshBasicMaterial({map:r,side:t||0}),a.geo=new THREE.SphereGeometry(e||10,32,16),a.mesh=new THREE.Mesh(a.geo,a.mat),a.add(a.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(e,o,t){super();let a=new THREE.MeshStandardMaterial({color:o||16711935,roughness:.4}),r=new THREE.ConeGeometry(e||10,40,32);this.ArrowHead=new THREE.Mesh(r,a),this.ArrowHead.position.y=80,r=new THREE.CylinderGeometry(.5*(e||10),.5*(e||10),60,32,2),this.ArrowBody=new THREE.Mesh(r,a),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead),this.isCenter=t}setArrow(e,o,t){let a=e*e+o*o+t*t,r=Math.sqrt(a);a>0?(this.rotX.visible=!0,this.rotX.scale.y=r/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(o/r),this.rotY.rotation.y=Math.atan2(e,t),this.isCenter&&(this.rotY.position.x=-.5*e,this.rotY.position.y=-.5*o,this.rotY.position.z=-.5*t)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(e,o,t,a,r){super();let l=e||20;this.L0=l;let n=[],i=a||5,s=o||5,d=t||.5;n.push(new THREE.Vector3(0,0,0)),n.push(new THREE.Vector3(0,.05*l,0));for(var c=0;c<=16*i;c++)n.push(new THREE.Vector3(s*Math.cos(2*c*Math.PI/16),l*(.05+.9*c/i/16),s*Math.sin(2*c*Math.PI/16)));n.push(new THREE.Vector3(0,.95*l,0)),n.push(new THREE.Vector3(0,l,0));let m=new THREE.CatmullRomCurve3(n),h=new THREE.MeshStandardMaterial({color:r||16711935,roughness:.4}),w=new THREE.TubeGeometry(m,500,d,12);this.mesh=new THREE.Mesh(w,h),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(e,o,t){let a=e*e+o*o+t*t,r=Math.sqrt(a);a>0?(this.rotX.visible=!0,this.rotX.scale.y=r/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(o/r),this.rotY.rotation.y=Math.atan2(e,t)}},TEACHER.Points=class extends THREE.Points{constructor(e,o,t){let a=o||1,r=e||16711935,l=new THREE.Color(r),n=t||1e4,i=new THREE.BufferGeometry,s=[];i.setAttribute("position",new THREE.Float32BufferAttribute(s,3)),i.computeBoundingSphere(),super(i,new THREE.PointsMaterial({size:a,map:TEACHER.Points.createCanvasMaterial("#"+l.getHexString(),64),transparent:!0,depthWrite:!1}));this.nnMax=n,this.nnNow=0,this.geometry=i,this.positions=s}static createCanvasMaterial(e,o){var t=document.createElement("canvas");t.width=t.height=o;var a=t.getContext("2d");a.imageSmoothingEnabled=!1;var r=new THREE.Texture(t),l=o/2;return a.beginPath(),a.arc(l,l,o/2-3,0,2*Math.PI,!1),a.closePath(),a.fillStyle=e,a.fill(),r.needsUpdate=!0,r}addPoint(e,o,t){let a=this;a.nnNow<a.nnMax?a.nnNow++:(log("TEACHER.Points 到達最大點數"),a.positions.shift(),a.positions.shift(),a.positions.shift()),a.positions.push(e,o,t)}clear(){this.positions=[],this.nnNow=0,this.update()}setPoint(e,o,t,a){let r=this;e>r.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):e>r.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(r.positions[3*e]=o,r.positions[3*e+1]=t,r.positions[3*e+2]=a)}getPoint(e){let o=this,t=new THREE.Vector3;return e>o.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):e>o.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(t.x=o.positions[3*e],t.y=o.positions[3*e+1],t.z=o.positions[3*e+2]),t}update(){this.geometry.setAttribute("position",new THREE.Float32BufferAttribute(this.positions,3)),this.geometry.computeBoundingSphere(),this.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(e,o,t){let a=t||1e4,r=o||1;var l=new THREE.LineMaterial({color:e||16711935,linewidth:o||1});l.resolution.set(window.innerWidth,window.innerHeight);let n=new THREE.LineGeometry,i=new Float32Array(3*a);n.setPositions(i),super(n,l);let s=this;s.nnMax=a,s.lineWidth=r,s.nnNow=0,s.geometry=n,s.positions=i}addPoint(e,o,t){let a=this;if(a.nnNow<a.nnMax)a.nnNow++;else{log("TEACHER.Line 到達最大點數");for(var r=0;r<a.nnMax-1;r++)a.positions[3*r]=a.positions[3*r+3],a.positions[3*r+1]=a.positions[3*r+4],a.positions[3*r+2]=a.positions[3*r+5]}for(r=a.nnNow;r<=a.nnMax;r++)a.positions[3*(r-1)]=e,a.positions[3*(r-1)+1]=o,a.positions[3*(r-1)+2]=t}clear(){this.positions=new Float32Array(3*this.nnMax),this.nnNow=0,this.update()}setPoint(e,o,t,a){let r=this;e>r.nnMax?log("輸入的n值大於TEACHER.Line 最大點數 nnMax"):e>r.nnNow?log("輸入的n值大於TEACHER.Line 現在點數 nnNow"):(r.positions[3*e]=o,r.positions[3*e+1]=t,r.positions[3*e+2]=a)}getPoint(e){let o=this,t=new THREE.Vector3;return e>o.nnMax?log("輸入的n值大於TEACHER.Line 最大點數 nnMax"):e>o.nnNow?log("輸入的n值大於TEACHER.Line 現在點數 nnNow"):(t.x=o.positions[3*e],t.y=o.positions[3*e+1],t.z=o.positions[3*e+2]),t}update(){let e=this,o=e.getPoint(e.nnNow-1);for(var t=e.nnNow;t<=e.nnMax;t++)e.positions[3*t]=o.x,e.positions[3*t+1]=o.y,e.positions[3*t+2]=o.z;e.geometry.setPositions(e.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(e,o,t,a,r,l){super();let n=this,i=Math.round(Math.log2(e/o)),s=$("<canvas>").attr("width",String(128*Math.pow(2,i))).attr("height","128");n.stage=new createjs.Stage(s[0]);let d=new createjs.Container;if(l){let e=new createjs.Shape,o=new THREE.Color(l);e.graphics.c().f("#"+o.getHexString()).dr(0,0,128*Math.pow(2,i),128),d.addChild(e)}n.ctext=new createjs.Text;let c=new THREE.Color(r||16777215);n.ctext.color="#"+c.getHexString(),n.ctext.font="96px Arial",n.ctext.text=t||"",n.ctext.textAlign="center",n.ctext.textBaseline="middle",n.ctext.x=128*Math.pow(2,i)/2,n.ctext.y=64,d.addChild(n.ctext),n.stage.addChild(d),n.stage.update(),n.texture=new THREE.Texture(s[0]);var m=new THREE.MeshBasicMaterial({map:n.texture,transparent:!0}),h=new THREE.PlaneGeometry(e||10,o||10,1,1);n.texture.needsUpdate=!0,n.plane1=new THREE.Mesh(h,m),n.plane2=new THREE.Mesh(h,m),n.plane2.rotation.y=Math.PI;let w=new THREE.Object3D;w.add(n.plane1).add(n.plane2),"x"===a?w.rotation.y=.5*Math.PI:"y"===a&&(w.rotation.x=-.5*Math.PI),n.add(w)}setText(e){let o=this;o.ctext.text=e,o.stage.update(),o.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(e,o,t,a,r,l,n){super();let i=this;i.objCon=new THREE.Object3D,i._xMin=e||0,i._xMax=o||10,i._yMin=t||0,i._yMax=a||10,i.divXN=5,i.divYN=4,i.frameMat=new THREE.LineBasicMaterial({color:r||16777215});for(var s=[],d=0;d<=i.divXN;d++)s.push(new THREE.Vector3(20*d-50,0,0)),s.push(new THREE.Vector3(20*d-50,50,0));for(var c=0;c<=i.divYN;c++)s.push(new THREE.Vector3(-50,12.5*c,0)),s.push(new THREE.Vector3(50,12.5*c,0));let m=(new THREE.BufferGeometry).setFromPoints(s);i.frame=new THREE.LineSegments(m,i.frameMat),i.objCon.add(i.frame),i.labelXMin=new TEACHER.ObjTextPlane(20,5,String(i._xMin),"z",r||16777215),i.labelXMin.position.x=-50,i.labelXMin.position.y=-3,i.objCon.add(i.labelXMin),i.labelXMax=new TEACHER.ObjTextPlane(20,5,String(i._xMax),"z",r||16777215),i.labelXMax.position.x=50,i.labelXMax.position.y=-3,i.objCon.add(i.labelXMax),i.labelYMin=new TEACHER.ObjTextPlane(20,5,String(i._yMin),"z",r||16777215),i.labelYMin.position.x=-53,i.labelYMin.position.y=0,i.objCon.add(i.labelYMin),i.labelYMax=new TEACHER.ObjTextPlane(20,5,String(i._yMax),"z",r||16777215),i.labelYMax.position.x=-53,i.labelYMax.position.y=50,i.objCon.add(i.labelYMax),i.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",r||16777215),i.labelX.position.x=60,i.labelX.position.y=4,i.labelX.position.z=1,i.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",r||16777215),i.labelY.position.x=-60,i.labelY.position.y=25,i.labelY.position.z=1,i.labelY.rotation.z=Math.PI/2,i.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",r||16777215),i.labelTitle.position.y=53,i.labelTitle.position.z=1,i.objCon.add(i.labelX).add(i.labelY).add(i.labelTitle),i._lineColor=l,i._nnMax=n,i.line=new TEACHER.Line(i._lineColor||16776960,2,i._nnMax),i.objCon.add(i.line),i.changeScale(),i.add(i.objCon)}addPoint(e,o){this.line.addPoint(e,o,0),this.line.update()}clear(){this.line.clear()}changeScale(){let e=this;e.line.scale.x=100/(e._xMax-e._xMin),e.line.scale.y=50/(e._yMax-e._yMin),e.line.position.x=-50-e._xMin*e.line.scale.x,e.line.position.y=-e._yMin*e.line.scale.y,e.labelXMin.setText(e._xMin),e.labelXMax.setText(e._xMax),e.labelYMin.setText(e._yMin),e.labelYMax.setText(e._yMax)}setLabel(e,o,t){this.labelTitle.setText(e||"y-x"),this.labelY.setText(o||"y"),this.labelX.setText(t||"x")}get xMin(){return this._xMin}set xMin(e){this._xMin=e,this.changeScale()}get xMax(){return this._xMax}set xMax(e){this._xMax=e,this.changeScale()}get yMin(){return this._yMin}set yMin(e){this._yMin=e,this.changeScale()}get yMax(){return this._yMax}set yMax(e){this._yMax=e,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),allRotZ.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,60,"allData/pics/ground2.png","y");allRotZ.add(ground);var directionalLight,logo=new TEACHER.ObjPicPlane(100,12.5,pics.logo,"z",2);function getMouse3D(e,o){let t,a=e||"y",r=new THREE.Vector3;"x"===a?t=new THREE.Vector3(1,0,0):"y"===a?t=new THREE.Vector3(0,1,0):"z"===a?t=new THREE.Vector3(0,0,1):log("錯誤!!");let l=new THREE.Vector2;return l.x=world2D.stage.mouseX/1600*2-1,l.y=-world2D.stage.mouseY/900*2+1,world3D.raycaster.setFromCamera(l,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(t),r),r}logo.position.z=-50,logo.position.y=15,allRotZ.add(logo),(directionalLight=new THREE.DirectionalLight(16777215,1)).position.set(5,10,7.5),allRotZ.add(directionalLight),(directionalLight=new THREE.DirectionalLight(16777215,1)).position.set(-5,10,-7.5),allRotZ.add(directionalLight);var ambientLight=new THREE.AmbientLight(6710886);allRotZ.add(ambientLight),init();