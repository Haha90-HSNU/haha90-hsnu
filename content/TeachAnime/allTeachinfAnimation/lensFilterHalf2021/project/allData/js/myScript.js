var MyJS=MyJS||{};(function(){function a(a){THREE.Object3D.call(this),b=a}var b;a.prototype=new THREE.Object3D,MyJS.AllPlayers=a,a.prototype.setMeshs=function(a){var d=this,e=.8*b.gvs.lenFF;if("top"===a||"bottom"===a){if(d.obj=d.generateOneCrossMesh(),d.obj.position.z=e,d.add(d.obj),"top"===a){d.lenOutline=d.generateLenOutline(),d.add(d.lenOutline),d.lenMask=d.generateLenMask(),d.add(d.lenMask),d.lenMask.position.y=2*b.gvs.lenRR+10;let a=new THREE.CylinderGeometry(0,b.gvs.lenRR+10,.01,32,1,!0),c=new THREE.MeshBasicMaterial({color:16776960});d.lenBack=new THREE.Mesh(a,c),d.lenBack.rotation.x=-Math.PI/2,d.lenBack.position.z=-.5*b.gvs.lenDD,d.add(d.lenBack)}d.imgWireframe=d.generateOneCrossWireframe(),d.imgWireframe.position.z=-e,d.add(d.imgWireframe),d.pointer=d.generatePointer(),d.pointer.position.x=0,d.pointer.position.y=0,d.pointer.position.z=2*e,d.add(d.pointer),d.groundZP=d.generateWireframePlane(400,1e3,4,10,39321,2,1),d.groundZN=d.generateWireframePlane(400,1e3,4,10,39321,2,-1),d.add(d.groundZP),d.add(d.groundZN),d.rays=this.generateRays(),d.rays2=this.generateRays(),d.add(d.rays).add(d.rays2),"bottom"===a&&(d.eye=new c.ObjPicPlane(100,100,"allData/pics/eye.png"),d.eye.position.z=-800,d.add(d.eye))}else"image"===a?(d.img=d.generateOneCrossMesh(),d.img.position.z=-e,d.add(d.img),d.pointer=d.generatePointer(),d.pointer.position.x=0,d.pointer.position.y=0,d.pointer.position.z=2*e,d.add(d.pointer),d.groundZP=d.generateWireframePlane(400,1e3,4,10,39321,2,1),d.groundZN=d.generateWireframePlane(400,1e3,4,10,39321,2,-1),d.add(d.groundZP),d.add(d.groundZN)):"len"===a&&(d.len=d.generateLen(),d.add(d.len))},a.prototype.generateOneCrossMesh=function(){var a=new THREE.Object3D;a.info01=[],a.info02=[],a.info03=[],a.obj01=new THREE.Object3D,a.add(a.obj01);var b=new THREE.SphereGeometry(5),c=new THREE.Color;c.setHSL(1,1,1);var d=new THREE.MeshBasicMaterial({color:c}),e=new THREE.Mesh(b,d);a.obj01.add(e),a.info01.push([e.position.x,e.position.y,Math.floor(256*c.r),Math.floor(256*c.g),Math.floor(256*c.b)]),a.obj02=new THREE.Object3D,a.add(a.obj02);for(var f=100,g=5,b=new THREE.SphereGeometry(5),h=1;h<=g;h++)for(var c,k=0;4>k;k++){c=new THREE.Color,c.setHSL(0==k?0:1===k?1/3:3===k?2/3:1/6,h/g,1-.5*h/g);var d=new THREE.MeshBasicMaterial({color:c}),e=new THREE.Mesh(b,d);e.position.x=f*h/g*(1==k?1:3===k?-1:0),e.position.y=f*h/g*(0==k?1:2===k?-1:0),a.obj02.add(e),a.info02.push([e.position.x,e.position.y,Math.floor(256*c.r),Math.floor(256*c.g),Math.floor(256*c.b)])}var c=new THREE.Color;c.setHSL(0,0,1);var d=new THREE.MeshBasicMaterial({color:c}),e=new THREE.Mesh(b,d);a.obj02.add(e),a.info02.push([e.position.x,e.position.y,Math.floor(256*c.r),Math.floor(256*c.g),Math.floor(256*c.b)]),a.obj03=new THREE.Object3D,a.add(a.obj03);for(var b=new THREE.SphereGeometry(5),c=new THREE.Color,h=0;3>h;h++){c.setRGB(0==h?1:0,1==h?1:0,2==h?1:0);var d=new THREE.MeshBasicMaterial({color:c}),e=new THREE.Mesh(b,d);e.position.x=50*Math.sin(2*(h/3)*Math.PI+Math.PI),e.position.y=50*Math.cos(2*(h/3)*Math.PI+Math.PI),a.obj03.add(e),a.info03.push([e.position.x,e.position.y,Math.floor(256*c.r),Math.floor(256*c.g),Math.floor(256*c.b)])}return a},a.prototype.generateOneCrossWireframe=function(){var a=new THREE.Object3D,b=6,c=50,d=300,e=1,f=16711935,g=new THREE.CylinderGeometry(c,c+b,.01,16,1,!0),h=new THREE.MeshBasicMaterial({color:f}),i=new THREE.Mesh(g,h);i.rotation.x=90*Math.PI/180,i.position.z=.5*e,a.add(i);var i=new THREE.Mesh(g,h);i.rotation.x=-90*Math.PI/180,i.position.z=-.5*e,a.add(i);var j=new THREE.BoxGeometry(d,b,e),k=new THREE.MeshBasicMaterial({color:f}),l=new THREE.Mesh(j,k);return a.add(l),j=new THREE.BoxGeometry(b,d,e),l=new THREE.Mesh(j,k),a.add(l),a},a.prototype.generateLen=function(){var a=new THREE.Object3D,c=b.gvs.lenRR,d=b.gvs.lenDD,e=new THREE.CylinderGeometry(c,c,d,64,1),f=new THREE.MeshBasicMaterial({color:16711935}),g=new THREE.Mesh(e,f);return g.rotation.x=90*Math.PI/180,a.add(g),a},a.prototype.generateLenOutline=function(){var a=new THREE.Object3D,c=b.gvs.lenRR,d=10,e=new THREE.CylinderGeometry(c,c+d,.01,64,1,!0),f=new THREE.MeshBasicMaterial({color:16776960}),g=new THREE.Mesh(e,f);g.rotation.x=90*Math.PI/180,g.position.z=.5*d,a.add(g);var g=new THREE.Mesh(e,f);g.rotation.x=-90*Math.PI/180,g.position.z=-.5*d,a.add(g);var e=new THREE.CylinderGeometry(c+d,c+d,d,64,1,!0),g=new THREE.Mesh(e,f);return g.rotation.x=90*Math.PI/180,a.add(g),a},a.prototype.generateLenMask=function(){var a=new THREE.Object3D,c=b.gvs.lenRR,d=new THREE.BoxGeometry(2*c,2*c,20),e=new THREE.MeshBasicMaterial({color:16737894}),f=new THREE.Mesh(d,e);return a.add(f),a},a.prototype.generatePointer=function(){var a=new THREE.Object3D;return a},a.prototype.generateRays=function(){var a=new THREE.Object3D;a.arrows1=[],a.arrows2=[],a.dx=30;var d=b.gvs.lenRR;let e=0;for(var f=0;f<=d;f+=1){let b=f*Math.cos(e),d=f*Math.sin(e);e+=137.5*Math.PI/180;var g=new c.ObjArrow(2,10066329);a.arrows1.push(g),a.add(g),g.setArrow(20,20,20),g.xx=b,g.yy=d;var g=new c.ObjArrow(2,10066329);a.arrows2.push(g),a.add(g),g.xx=b,g.yy=d}return a},a.prototype.generateWireframePlane=function(a,d,e,f,g,h,k){var l=new THREE.Object3D,c=new THREE.BoxGeometry(100,100,100),m=new THREE.MeshBasicMaterial({color:g||10066329}),n=h||5,o=-b.gvs.lenRR-10;l.boxArray=[];for(var p=0;p<e;p++)for(var q,r=0;r<=f;r++){q=new THREE.Mesh(c,m),q.RX=new THREE.Object3D,q.p1=new THREE.Vector3((0+p)*a/e-.5*a,o,k*r*d/f),q.p2=new THREE.Vector3((1+p)*a/e-.5*a,o,k*r*d/f);var s=q.p1.distanceTo(q.p2),t=Math.atan2(q.p1.z-q.p2.z,q.p1.x-q.p2.x);q.scale.x=s/100,q.scale.y=n/100,q.scale.z=n/100,q.RX.position.x=.5*(q.p1.x+q.p2.x),q.RX.position.y=.5*(q.p1.y+q.p2.y),q.RX.position.z=.5*(q.p1.z+q.p2.z),q.rotation.y=t,q.RX.add(q),l.add(q.RX),l.boxArray.push(q)}for(var p=0;p<=e;p++)for(var q,r=0;r<f;r++){q=new THREE.Mesh(c,m),q.RX=new THREE.Object3D,q.p1=new THREE.Vector3(p*a/e-.5*a,o,k*(0+r)*d/f),q.p2=new THREE.Vector3(p*a/e-.5*a,o,k*(1+r)*d/f);var s=q.p1.distanceTo(q.p2),t=Math.atan2(q.p1.z-q.p2.z,q.p1.x-q.p2.x);q.scale.x=s/100,q.scale.y=n/100,q.scale.z=n/100,q.RX.position.x=.5*(q.p1.x+q.p2.x),q.RX.position.y=.5*(q.p1.y+q.p2.y),q.RX.position.z=.5*(q.p1.z+q.p2.z),q.rotation.y=t,q.RX.add(q),l.add(q.RX),l.boxArray.push(q)}return l},a.prototype.updateGround=function(a){for(var d,e=this["groundZ"+a],c=e.boxArray.length,f=0;f<c;f++){d=e.boxArray[f];for(var g=1;2>=g;g++){var h=d["p"+g],k=Math.abs(h.z);if(0===k&&(k="N"===a?.01:-.01,k*="mirror"===b.lenMD?-1:1),Math.abs(k)===b.ff){var l=d["p"+(1===g?2:1)],n=Math.abs(l.z);k=.999*k+.001*n}if("i"===b.fMD)var o=-k;else var o=1/(1/b.ff-1/k);var p=o/k,m=-p*h.x,q=-p*h.y,r=o;"len"===b.lenMD&&0<h.z?r*=-1:"mirror"===b.lenMD&&0>h.z&&(r*=-1);var s=new THREE.Vector3(m,q,r);d["q"+g]=s}if(0<=d.q1.z*d.q2.z){d.visible=!0;var t=d.q1.distanceTo(d.q2),u=Math.acos((d.q1.x-d.q2.x)/t),v=Math.atan2(d.q1.y-d.q2.y,d.q1.z-d.q2.z);d.scale.x=t/100,d.RX.position.x=.5*(d.q1.x+d.q2.x),d.RX.position.y=.5*(d.q1.y+d.q2.y),d.RX.position.z=.5*(d.q1.z+d.q2.z),d.rotation.y=-u,d.RX.rotation.x=-v}else d.visible=!1}};var c={};c.Line=function(a,b,c){let d=this;d.nnMax=c||1e4,d.lineWidth=b||1,d.nnNow=0;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight),d.geometry=new THREE.LineGeometry,d.positions=new Float32Array(3*d.nnMax),d.geometry.setPositions(d.positions),THREE.Line2.call(this,d.geometry,e)},c.Line.prototype=Object.create(THREE.Line2.prototype),c.Line.prototype.constructor=c.Line,c.Line.prototype.addPoint=function(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c},c.Line.prototype.clear=function(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()},c.Line.prototype.setPoint=function(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)},c.Line.prototype.getPoint=function(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c},c.Line.prototype.update=function(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)},c.ObjArrow=function(a,b){let c=new THREE.MeshBasicMaterial({color:b||16711935}),d=new THREE.BoxGeometry(a||10,100,a||10);this.ArrowBody=new THREE.Mesh(d,c),this.ArrowBody.position.y=50,THREE.Object3D.call(this),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody)},c.ObjArrow.prototype=Object.create(THREE.Object3D.prototype),c.ObjArrow.prototype.constructor=c.ObjArrow,c.ObjArrow.prototype.setArrow=function(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)},c.ObjPicPlane=function(a,b,c,d,e){let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),THREE.Object3D.call(this),f.add(f.mesh)},c.ObjPicPlane.prototype=Object.create(THREE.Object3D.prototype),c.ObjPicPlane.prototype.constructor=c.ObjPicPlane})();var MyJS=MyJS||{};(function(){function a(){o=this,o.gvs={lenRR:150,lenDD:10,lenFF:200},o.isDirty=!0,o.preventCameraDrag=!0,o.lenMD="len",o.fMD="p",o.pp=2.5*o.gvs.lenFF;o.stageWidth=1600,o.stageHeight=900,o.bgColor=0,o.camera=new THREE.PerspectiveCamera(75,o.stageWidth/o.stageHeight,.1,1e4),o.renderer=new THREE.WebGLRenderer({antialias:!0}),o.renderer.setSize(o.stageWidth,o.stageHeight),$("#mainAnimation").append(o.renderer.domElement),$(o.renderer.domElement).attr("id","canvas3D"),$("#mainAnimation").mousedown(h),$("#mainAnimation").mousemove(i),$("#mainAnimation").mouseup(j),$("#mainAnimation").on("touchstart",h),$("#mainAnimation").on("touchmove",i),$("#mainAnimation").on("touchend",j),o.renderTargetImage=new THREE.WebGLRenderTarget(o.stageWidth,o.stageHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter}),o.renderTargetLen=new THREE.WebGLRenderTarget(o.stageWidth,o.stageHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter}),o.renderTargetTop=new THREE.WebGLRenderTarget(o.stageWidth,o.stageHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter}),o.renderTargetBottom=new THREE.WebGLRenderTarget(o.stageWidth,o.stageHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter}),o.sceneTop=new THREE.Scene,o.sceneBottom=new THREE.Scene,o.sceneBottom.background=new THREE.Color(o.bgColor),o.sceneImage=new THREE.Scene,o.sceneImage.background=new THREE.Color(o.bgColor),o.sceneLen=new THREE.Scene,o.cameraRR=500,o.cameraTheta=80*Math.PI/180,o.cameraPhi=20*Math.PI/180,o.cameraThetaT=80*Math.PI/180,o.cameraPhiT=20*Math.PI/180,o.cameraX0=0,o.cameraY0=0,o.cameraZ0=0,o.camera.isDraging=!1,o.composer=new THREE.EffectComposer(o.renderer),o.maskPass=new THREE.ShaderPass(MyTextureMaskShader),o.copyPass=new THREE.ShaderPass(THREE.CopyShader),o.effectFXAA=new THREE.ShaderPass(THREE.FXAAShader),o.maskPass.uniforms.textureBottom.value=o.renderTargetBottom,o.maskPass.uniforms.textureTop.value=o.renderTargetTop,o.maskPass.uniforms.textureMask.value=o.renderTargetLen,o.maskPass.uniforms.textureMasked.value=o.renderTargetImage,o.effectFXAA.uniforms.resolution.value.set(1/o.stageWidth,1/o.stageHeight),o.composer.addPass(o.maskPass),o.composer.addPass(o.copyPass),o.composer.addPass(o.effectFXAA),o.effectFXAA.renderToScreen=!0,o.raycaster=new THREE.Raycaster,o.stats=new Stats,o.allPlayersTop=new MyJS.AllPlayers(o),o.allPlayersTop.setMeshs("top"),o.sceneTop.add(o.allPlayersTop),o.allPlayersImage=new MyJS.AllPlayers(o),o.allPlayersImage.setMeshs("image"),o.sceneImage.add(o.allPlayersImage),o.allPlayersBottom=new MyJS.AllPlayers(o),o.allPlayersBottom.setMeshs("bottom"),o.sceneBottom.add(o.allPlayersBottom),o.allPlayersLen=new MyJS.AllPlayers(o),o.allPlayersLen.setMeshs("len"),o.sceneLen.add(o.allPlayersLen),o.canvasPixi=$("<canvas>").attr("width","512px").attr("height","512px").attr("id","canvasPixi"),o.ctx=o.canvasPixi[0].getContext("2d"),o.screenImgTexture=new THREE.CanvasTexture(o.canvasPixi[0]),o.screenImgMaterial=new THREE.MeshBasicMaterial({map:o.screenImgTexture,side:THREE.DoubleSide});var a=new THREE.PlaneGeometry(300,300),b=new THREE.Mesh(a,o.screenImgMaterial);o.allPlayersTop.pointer.add(b);var b=new THREE.Mesh(a,o.screenImgMaterial);o.allPlayersBottom.pointer.add(b);var b=new THREE.Mesh(a,o.screenImgMaterial);o.allPlayersImage.pointer.add(b),o.screenImgTexture.needsUpdate=!0,o.tt=0}function b(){o.objMD=p.rbObj01.selected?1:p.rbObj02.selected?2:3,o.pp=Math.abs(p.theControlPQ.theObj.x)/100*o.gvs.lenFF,o.ppPointer=Math.abs(p.theControlPQ.thePointer.x)/100*o.gvs.lenFF,"i"===o.fMD?(o.qq=-o.pp,o.qqPointer=-o.ppPointer):(o.ff=("n"===o.fMD?-1:1)*o.gvs.lenFF,o.qq=1/(1/o.ff-1/o.pp),o.qqPointer=1/(1/o.ff-1/o.ppPointer)),o.allPlayersTop.obj.position.z=o.pp,o.allPlayersBottom.obj.position.z=o.pp,o.allPlayersTop.obj.obj01.visible=p.rbObj01.selected,o.allPlayersTop.obj.obj02.visible=p.rbObj02.selected,o.allPlayersTop.obj.obj03.visible=p.rbObj03.selected,o.allPlayersBottom.obj.obj01.visible=p.rbObj01.selected,o.allPlayersBottom.obj.obj02.visible=p.rbObj02.selected,o.allPlayersBottom.obj.obj03.visible=p.rbObj03.selected,o.allPlayersImage.img.obj01.visible=p.rbObj01.selected,o.allPlayersImage.img.obj02.visible=p.rbObj02.selected,o.allPlayersImage.img.obj03.visible=p.rbObj03.selected,o.allPlayersImage.img.scale.x=o.allPlayersImage.img.scale.y=-o.qq/o.pp,o.allPlayersImage.img.position.z=o.qq,"len"===o.lenMD&&(o.allPlayersImage.img.position.z*=-1),p.theControlPQ.theImg.x=100*(-o.allPlayersImage.img.position.z/o.gvs.lenFF),o.allPlayersTop.imgWireframe.position.z=o.allPlayersImage.img.position.z,o.allPlayersTop.imgWireframe.scale.x=o.allPlayersTop.imgWireframe.scale.y=-o.qq/o.pp,o.allPlayersBottom.imgWireframe.position.z=o.allPlayersImage.img.position.z,o.allPlayersBottom.imgWireframe.scale.x=o.allPlayersBottom.imgWireframe.scale.y=-o.qq/o.pp,o.allPlayersTop.pointer.position.z=o.ppPointer*(0>p.theControlPQ.thePointer.x?1:-1),o.allPlayersBottom.pointer.position.z=o.ppPointer*(0>p.theControlPQ.thePointer.x?1:-1),o.allPlayersImage.pointer.scale.x=o.allPlayersImage.pointer.scale.y=-o.qqPointer/o.ppPointer,o.allPlayersImage.pointer.position.z=o.qqPointer*(0>p.theControlPQ.thePointer.x?1:-1),"len"===o.lenMD&&(o.allPlayersImage.pointer.position.z*=-1),o.allPlayersImage.updateGround("P"),o.allPlayersImage.updateGround("N"),o.tt++,o.lenMaskY=o.gvs.lenRR-p.slMaskY.value,o.allPlayersTop.lenMask.position.y=o.lenMaskY+o.gvs.lenRR,o.allPlayersTop.lenMask.visible=o.lenMaskY<o.gvs.lenRR,o.isScreen=p.chScreen.selected,p.slIntensity.visible=o.isScreen,o.allPlayersTop.pointer.position.y=o.allPlayersBottom.pointer.position.y=o.allPlayersImage.pointer.position.y=o.isScreen?0:200*o.gvs.lenRR,o.drawCanvas(),o.screenImgTexture.needsUpdate=!0,p.controlView.rbLight.visible=p.controlView.rbView.visible=p.controlView.rbGod.selected,p.controlView.mcObj.visible=p.controlView.rbDiagram.visible=p.controlView.rbEdge.visible=p.controlView.chDash.visible=p.controlView.rbLight.visible&&p.controlView.rbLight.selected,p.controlView.chBend.visible=p.controlView.rbView.visible&&p.controlView.rbView.selected,o.cameraRR=1600,o.cameraX0=0,o.cameraZ0=0,o.cameraY0=0,o.cameraPhi=.9*o.cameraPhi+.1*o.cameraPhiT,o.cameraTheta=.9*o.cameraTheta+.1*o.cameraThetaT,o.camera.position.x=o.cameraRR*Math.sin(o.cameraTheta)*Math.sin(o.cameraPhi)+o.cameraX0,o.camera.position.z=o.cameraRR*Math.sin(o.cameraTheta)*Math.cos(o.cameraPhi)+o.cameraZ0,o.camera.position.y=o.cameraRR*Math.cos(o.cameraTheta)+o.cameraY0,o.camera.lookAt(new THREE.Vector3(o.cameraX0,o.cameraY0,o.cameraZ0));let a=p.chZoomIn.selected?15:38;o.camera.fov=.95*o.camera.fov+.05*a,o.camera.updateProjectionMatrix(),o.isObjCameraSameSide=0<o.camera.position.z*o.pp,o.isImgCameraSameSide=0<o.camera.position.z*o.allPlayersImage.img.position.z,o.isPointerCameraSameSide=0<o.camera.position.z*o.allPlayersTop.pointer.position.z,o.isPointerImgCameraSameSide=0<o.camera.position.z*o.allPlayersImage.pointer.position.z,o.allPlayersTop.lenBack.visible="mirror"===o.lenMD,o.allPlayersTop.obj.visible=o.isObjCameraSameSide,o.allPlayersBottom.obj.visible=!o.isObjCameraSameSide,"len"===o.lenMD?o.allPlayersImage.img.visible=!o.isObjCameraSameSide:"mirror"===o.lenMD&&(o.allPlayersImage.img.visible=o.isObjCameraSameSide);"len"===o.lenMD?(o.allPlayersTop.imgWireframe.visible=0>o.qq&&o.isObjCameraSameSide&&!1,o.allPlayersBottom.imgWireframe.visible=!(0>o.qq&&o.isObjCameraSameSide)&&!1):"mirror"===o.lenMD&&(o.allPlayersTop.imgWireframe.visible=0>o.qq&&!o.isObjCameraSameSide&&!1,o.allPlayersBottom.imgWireframe.visible=(!(0>o.qq)||o.isObjCameraSameSide)&&!1),p.theControlPQ.theImg.visible=!1,o.allPlayersTop.pointer.visible=o.isPointerCameraSameSide,o.allPlayersBottom.pointer.visible=!o.isPointerCameraSameSide,"len"===o.lenMD?o.allPlayersImage.pointer.visible=!o.isPointerCameraSameSide:"mirror"===o.lenMD&&(o.allPlayersImage.pointer.visible=o.isPointerCameraSameSide),o.allPlayersTop.groundZP.visible=0<o.camera.position.z,o.allPlayersTop.groundZN.visible=0>o.camera.position.z,o.allPlayersBottom.groundZP.visible=0>o.camera.position.z,o.allPlayersBottom.groundZN.visible=0<o.camera.position.z,"len"===o.lenMD?(o.allPlayersImage.groundZP.visible=0>o.camera.position.z,o.allPlayersImage.groundZN.visible=0<o.camera.position.z):"mirror"===o.lenMD&&(o.allPlayersImage.groundZP.visible=0<o.camera.position.z,o.allPlayersImage.groundZN.visible=!1);for(var b=p.rbObj01.selected?0:p.rbObj02.selected?-100:-50,c=p.rbObj01.selected?16777215:p.rbObj02.selected?16777062:16724787,d=16711680,e=0;2>e;e++){for(var f,g=0==e?o.allPlayersTop:o.allPlayersBottom,h=o.gvs.lenRR,j=0,k=g.rays.arrows1.length,j=0;j<k;j++){f=g.rays.arrows1[j],f.position.z=o.pp,f.position.y=b,f.position.x=0,f.setArrow(f.xx,f.yy-b,-o.pp),f.visible=p.chRay.selected,f.ArrowBody.material.color.setHex(c);var l=g.rays.arrows2[j];l.position.z=0,l.position.y=l.yy,l.position.x=l.xx;let a=o.isScreen?-o.ppPointer:-1e3,d=Math.atan2(l.yy+b*o.qq/o.pp,o.qq),e=Math.atan2(l.xx,o.qq);l.setArrow(a*Math.tan(e),a*Math.tan(d),a),l.ArrowBody.material.color.setHex(c),l.visible=l.yy<=o.lenMaskY&&p.chRay.selected}let a=p.rbObj02.selected;for(var f,k=g.rays.arrows1.length,j=0;j<k;j++){f=g.rays2.arrows1[j],f.position.z=o.pp,f.position.y=-b,f.position.x=0,f.setArrow(f.xx,f.yy+b,-o.pp),f.visible=p.chRay.selected&&a,f.ArrowBody.material.color.setHex(d);var l=g.rays2.arrows2[j];l.position.z=0,l.position.y=l.yy,l.position.x=l.xx;let c=o.isScreen?-o.ppPointer:-1e3,e=Math.atan2(l.yy-b*o.qq/o.pp,o.qq),h=Math.atan2(l.xx,o.qq);l.setArrow(c*Math.tan(h),c*Math.tan(e),c),l.ArrowBody.material.color.setHex(d),l.visible=l.yy<=o.lenMaskY&&p.chRay.selected&&a}}o.isDirty=o.isDirty||o.camera.isDraging||.01<Math.abs(o.camera.fov-a),o.isDirty=!0,o.isDirty&&(o.renderer.render(o.sceneBottom,o.camera,o.renderTargetBottom),o.renderer.render(o.sceneTop,o.camera,o.renderTargetTop),o.renderer.render(o.sceneImage,o.camera,o.renderTargetImage),o.renderer.render(o.sceneLen,o.camera,o.renderTargetLen),o.composer.render(),o.isDirty=!1,log("render")),stage2D.update(),o.stats.update()}function c(a,b,c=!1){a.selected=a.checker.visible=c,a.gp=b,b.push(a),a.on("click",d)}function d(a){var b=a.target.parent;if(!b.selected){for(var c=b.gp.length,d=0;d<c;d++)b.gp[d].selected=b.gp[d].checker.visible=!1;b.selected=b.checker.visible=!0}o.isDirty=!0}function e(a){var b=a.target.name;"btnToEye"===b?(o.cameraThetaT=.5*Math.PI,o.cameraPhiT=Math.PI):"btnToSide"===b&&(o.cameraThetaT=.5*Math.PI,o.cameraPhiT=.5*Math.PI)}function f(a,b){a.selected=a.checker.visible=b,a.on("click",g)}function g(a){var b=a.target.parent;b.selected=!b.selected,b.checker.visible=b.selected,o.isDirty=!0}function h(a){log("down!!");var b=0,c=0;if("mousedown"===a.type?(b=a.pageX,c=a.pageY):"touchstart"===a.type&&(b=a.originalEvent.touches[0].pageX,c=a.originalEvent.touches[0].pageY,lastTouch=a),!k){var d=$("#mainAnimation").offset();b-=d.left,c-=d.top,l(b,c)}else k=!1}function i(a){var b=0,c=0;"mousemove"===a.type?(b=a.pageX,c=a.pageY):"touchmove"===a.type&&(b=a.originalEvent.touches[0].pageX,c=a.originalEvent.touches[0].pageY,lastTouch=a);var d=$("#mainAnimation").offset();b-=d.left,c-=d.top,n(b,c),"obj"===o.drag2D?(p.theControlPQ.theObj.x=stage2D.mouseX-p.theControlPQ.x,-450>p.theControlPQ.theObj.x?p.theControlPQ.theObj.x=-450:-10<p.theControlPQ.theObj.x&&(p.theControlPQ.theObj.x=-10),o.isDirty=!0):"point"===o.drag2D&&(p.theControlPQ.thePointer.x=stage2D.mouseX-p.theControlPQ.x,20>p.theControlPQ.thePointer.x?p.theControlPQ.thePointer.x=20:450<p.theControlPQ.thePointer.x&&(p.theControlPQ.thePointer.x=450),o.isDirty=!0)}function j(a){var b=0,c=0;"mouseup"===a.type?(b=a.pageX,c=a.pageY):"touchend"===a.type&&(b=lastTouch.originalEvent.touches[0].pageX,c=lastTouch.originalEvent.touches[0].pageY);var d=$("#mainAnimation").offset();b-=d.left,c-=d.top,m(b,c),o.drag2D=""}function k(){o.preventCameraDrag=!0,log("preventCameraDra!!!!!")}function l(a,b){o.camera.isDraging=!0,o.camera.oldMouseX=a,o.camera.oldMouseY=b}function m(){o.camera.isDraging=!1}function n(a,b){if(o.camera.isDraging){var c=a,d=b;for(o.cameraPhiT-=.01*(c-o.camera.oldMouseX);o.cameraPhiT>Math.PI;)o.cameraPhiT-=2*Math.PI;for(;o.cameraPhiT<-Math.PI;)o.cameraPhiT+=2*Math.PI;o.cameraThetaT-=.01*(d-o.camera.oldMouseY),o.cameraThetaT>.99*Math.PI&&(o.cameraThetaT=.99*Math.PI),o.cameraThetaT<.01*Math.PI&&(o.cameraThetaT=.01*Math.PI),o.cameraTheta=o.cameraThetaT,o.cameraPhi=o.cameraPhiT,o.camera.oldMouseX=c,o.camera.oldMouseY=d}}var o,p;MyJS.TheWorld=a,a.prototype.drawCanvas=function(){var a=o.ctx;let c=o.lenMaskY,d=o.gvs.lenRR;if(c>d?c=d:c<-d&&(c=-d),a.globalCompositeOperation="lighter",a.clearRect(0,0,512,512),a.fillStyle="#333333",a.fillRect(0,0,512,512),o.isScreen){var e=o.allPlayersTop.obj.info;p.rbObj01.selected?e=o.allPlayersTop.obj.info01:p.rbObj02.selected?e=o.allPlayersTop.obj.info02:p.rbObj03.selected&&(e=o.allPlayersTop.obj.info03);for(var f=Math.acos(c/o.gvs.lenRR),h=0;h<e.length;h++){var j=e[h][0],k=e[h][1],l=e[h][2],m=e[h][3],g=e[h][4],b=512*(-o.ppPointer/o.pp/300),n=512*(o.gvs.lenRR*(o.qq-o.ppPointer)/o.qq/300),q=10*Math.exp(-Math.pow(o.ppPointer-o.qq,6)/1e4);a.beginPath();var r=0;q>Math.abs(n)?(log("rr2"),r=(c*Math.sqrt(d*d-c*c)+d*d*(Math.asin(c/d)+Math.PI/2))/(Math.PI*d*d)):(log("rr1"),r=5/Math.max(Math.abs(n),5)),r=Math.pow(r,1/2),log("alpha="+r),r*=p.slIntensity.value;var s=o.ppPointer<o.qq?1:-1;a.moveTo(256+j*b+s*Math.abs(n)*Math.sin(f),256-k*b-s*Math.abs(n)*Math.cos(f));for(var t=f;t<=2*Math.PI-f;t+=(2*Math.PI-f)/64)a.lineTo(256+j*b+s*Math.abs(n)*Math.sin(t),256-k*b-s*Math.abs(n)*Math.cos(t));a.lineTo(256+j*b+s*Math.abs(n)*Math.sin(2*Math.PI-f),256-k*b-s*Math.abs(n)*Math.cos(2*Math.PI-f)),a.moveTo(256+j*b+q,256-k*b),a.arc(256+j*b,256-k*b,q,0,2*Math.PI),a.fillStyle="rgba("+l+","+m+","+g+","+r+")",a.fill()}}},a.prototype.initMyAnimate=function(){p=myAnimate,p.rbObjMD=[],c(p.rbObj01,p.rbObjMD,!0),c(p.rbObj02,p.rbObjMD),c(p.rbObj03,p.rbObjMD),f(p.chRay,!1),f(p.chScreen,!1),f(p.chZoomIn,!1),p.theControlPQ.theObj.on("mousedown",function(){o.drag2D="obj",k=!0}),p.theControlPQ.thePointer.on("mousedown",function(){o.drag2D="point",k=!0}),p.slMaskY.on("mousedown",function(){k=!0}),p.slIntensity.on("mousedown",function(){k=!0}),p.slMaskY.minimum=-2,p.slMaskY.maximum=302,p.slMaskY.value=0,p.slIntensity.minimum=.1,p.slIntensity.maximum=2.5,p.slIntensity.value=1,p.btnToEye.on("click",e),p.btnToSide.on("click",e),setInterval(b,1e3/fps)},a.prototype.changeResolution=function(a){resolutionScale=a||1;var b=this;b.stageWidth=1600*resolutionScale,b.stageHeight=900*resolutionScale,b.renderTargetImage.setSize(b.stageWidth,b.stageHeight),b.renderTargetLen.setSize(b.stageWidth,b.stageHeight),b.renderTargetTop.setSize(b.stageWidth,b.stageHeight),b.renderTargetBottom.setSize(b.stageWidth,b.stageHeight),b.renderer.setSize(b.stageWidth,b.stageHeight),b.camera.updateProjectionMatrix(),b.composer=new THREE.EffectComposer(b.renderer),b.maskPass=new THREE.ShaderPass(MyTextureMaskShader),b.copyPass=new THREE.ShaderPass(THREE.CopyShader),b.effectFXAA=new THREE.ShaderPass(THREE.FXAAShader),b.maskPass.uniforms.textureBottom.value=b.renderTargetBottom,b.maskPass.uniforms.textureTop.value=b.renderTargetTop,b.maskPass.uniforms.textureMask.value=b.renderTargetLen,b.maskPass.uniforms.textureMasked.value=b.renderTargetImage,b.effectFXAA.uniforms.resolution.value.set(1/b.stageWidth,1/b.stageHeight),b.composer.addPass(b.maskPass),b.composer.addPass(b.copyPass),b.composer.addPass(b.effectFXAA),b.effectFXAA.renderToScreen=!0,MyJS.myResize()}})();var myAnimate,stage2D,fps=30,theWorld=new MyJS.TheWorld;(function(){var a=AdobeAn.getComposition("98EA1A955B63F6489D0F00F6BFD1C4DE"),b=a.getLibrary();myAnimate=new b.myAnimate;var c=$("<canvas>").attr("width","1600px").attr("height","900px");$("#mainAnimation").append(c),stage2D=new createjs.Stage(c[0]),stage2D.enableMouseOver(1e3/fps),stage2D.addChild(myAnimate),createjs.Touch.enable(stage2D),stage2D.update(),theWorld.initMyAnimate()})(),MyJS.myResize();