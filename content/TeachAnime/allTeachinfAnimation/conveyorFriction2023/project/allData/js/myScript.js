'use strict';var theConveyor,fps=60,log=console.log,gameMD=0,titleTime=100;const conveyorL=150,conveyorR=10,conveyorW=20;var beltAccDir=0,beltA=0,beltV=0;const beltVMax=10;var theClaw,theBox,beltDX=0,conveyorMD=3,clawMD=1,clawMovingTarget=0,clawMovingNow=0;const boxL=10,boxX0=-60;var theVTChart,theMatter,boxX=-60,boxA=0,boxV=0,fSK="X",muS=.6,muK=.4,gg=1,tt=0,dt=.1,lookingMD=0;function init(){ground1.position.y=ground2.position.y=-1.6*conveyorR-1,theConveyor=new Conveyor,scene.add(theConveyor),theClaw=new Claw,theClaw.position.x=boxX0,scene.add(theClaw),theBox=new Box,scene.add(theBox),theBox.position.x=boxX,theBox.position.y=conveyorR,theVTChart=new VTChartPlane,theVTChart.position.y=30,theVTChart.position.z=-20,scene.add(theVTChart),theMatter=new MatterWorld,world2D.slCameraRR.value=130,world2D.rbConveyor01.on("click",clickConveyorRB),world2D.rbConveyor02.on("click",clickConveyorRB),setConveyorMD(2),world2D.slSinVMax.value=60,world2D.btnAccSlowR.on("mousedown",downAcc),world2D.btnAccSlowL.on("mousedown",downAcc),world2D.btnAccFastR.on("mousedown",downAcc),world2D.btnAccFastL.on("mousedown",downAcc),world2D.slMuS.value=100*muS,world2D.slMuK.value=100*(muK/muS),world2D.btnUp.on("mousedown",downBtnClaw),world2D.btnDown.on("mousedown",downBtnClaw),world2D.btnClawRelease.on("click",clickClawRelease),world2D.on("pressup",myUp),world2D.btnClawReset.on("click",resetGame),world2D.btnClawReset.visible=!1,world2D.chBoxMark.checked=!0,world2D.rbLookAll.on("click",clickRBLook),world2D.rbLookBox.on("click",clickRBLook),world2D.rbLookAll.checked=!0,setInterval(tick,1e3/fps)}function tick(){if(titleTime--,60<titleTime?(world2D.title.x=800,world2D.title.y=450,world2D.title.scaleX=world2D.title.scaleY=2):0<titleTime?(world2D.title.x=800*(titleTime/60)+200*((60-titleTime)/60),world2D.title.y=450*(titleTime/60)+50*((60-titleTime)/60),world2D.title.scaleX=world2D.title.scaleY=2*(titleTime/60)+.5*((60-titleTime)/60)):(world2D.title.x=200,world2D.title.y=50,world2D.title.scaleX=world2D.title.scaleY=.5),0===gameMD&&2===conveyorMD&&0===beltV&&0===tt||(tt+=dt),muS=.9*muS+.1*Math.round(10*(world2D.slMuS.value/100))/10,muK=.9*muK+.1*Math.round(10*(world2D.slMuK.value/100*muS))/10,world2D.slMuS.valueText.text=digit1(muS),world2D.slMuK.valueText.text=digit1(muK),theConveyor.updateConveyor(),theClaw.updateClaw(),0===gameMD)boxX=boxX0,boxV=0,boxA=0,1===clawMD?(theBox.position.x=theClaw.position.x,theBox.position.y=theClaw.baseDown.position.y-10-5,theBox.rotation.z=0,theBox.normalFoce=(20-(theClaw.baseUp.position.y-theClaw.baseDown.position.y))/10,fSK=0<theBox.normalFoce&&0!=beltV?"K":"X"):2===clawMD&&(theBox.position.x=theClaw.position.x,theBox.vy-=gg*dt,theBox.rotation.z=0,theBox.position.y+=theBox.vy*dt-.5*gg*dt*dt,theBox.position.y<conveyorR&&(theBox.position.y=conveyorR,theBox.normalFoce=1,gameMD=1));else if(1===gameMD){if("S"===fSK||"Z"===fSK)Math.abs(beltA)>gg*muS?(fSK="K",boxA=gg*muK*(beltV>boxV?1:-1),boxV+=boxA*dt):(fSK="S",boxA=beltA,boxV=beltV,0===boxA&&(fSK="Z"));else{let a=gg*muK*(beltV>boxV?1:-1),b=boxV+a*dt;0>=(b-beltV)*(boxV-beltV)?(fSK="S",boxA=beltA,boxV=beltV):(fSK="K",boxA=a,boxV=b)}boxX+=boxV*dt,75>Math.abs(boxX)?(theMatter.setMatterFrom3D(),theBox.position.x=boxX):(gameMD=2,fSK="X")}else if(2===gameMD)theMatter.runMatter(),theBox.rotation.z=-theMatter.mBox.angle,theBox.position.x=(theMatter.mBox.position.x-800)/theMatter.ss-5*Math.sin(theBox.rotation.z),theBox.position.y=-(theMatter.mBox.position.y-450)/theMatter.ss-5*Math.cos(theBox.rotation.z),-40>theBox.position.y&&(gameMD=3);else if(3===gameMD);theBox.boxPlane.updateBoxPlane(),2>gameMD&&theVTChart.updateVT(),theVTChart.visible=world2D.chVTChart.checked,world2D.btnAccFastL.visible=world2D.btnAccFastR.visible=world2D.btnAccSlowL.visible=world2D.btnAccSlowR.visible=world2D.rbConveyor02.checked,world2D.slSinVMax.visible=world2D.rbConveyor01.checked,world2D.accBar.gotoAndStop(1===conveyorMD?0:1),world2D.accBar.tickSinR.visible=world2D.accBar.tickSinL.visible=1===conveyorMD,world2D.accBar.tickSinR.x=100*(.2*theConveyor.sinVMaxNow),world2D.accBar.tickSinL.x=100*(.2*-theConveyor.sinVMaxNow),world2D.accBar.tickMuSGR.x=100*muS,world2D.accBar.tickMuSGL.x=100*-muS,world2D.accBar.tickMuKGR.x=100*muK,world2D.accBar.tickMuKGL.x=100*-muK,lookingMD=.9*lookingMD+.1*(world2D.rbLookBox.checked?1:0),world3D.cameraTarget.y=conveyorR,world3D.cameraTarget.x=.9*world3D.cameraTarget.x+.1*lookingMD*boxX,world2D.slCameraRR.value=40*lookingMD+140*(1-lookingMD),world3D.render(),world2D.stage.update()}function myUp(){clawMovingTarget=0,beltAccDir=0}function downBtnClaw(a){let b=a.target.parent.name;0===gameMD&&1===clawMD&&("btnDown"===b?clawMovingTarget=-1:"btnUp"===b&&(clawMovingTarget=1))}function clickClawRelease(){clawMD=2,theBox.vy=0,world2D.btnClawRelease.visible=world2D.btnUp.visible=world2D.btnDown.visible=!1,world2D.btnClawReset.visible=!0}function resetGame(){tt=0,gameMD=0,clawMD=1,fSK="X",theClaw.yNow=55,world2D.btnClawRelease.visible=world2D.btnUp.visible=world2D.btnDown.visible=!0,world2D.btnClawReset.visible=!1;let a=theConveyor.beltPlane;a.traceHiddenCTX.clearRect(0,0,363*a.ss,boxL*a.ss),a.traceCTX.clearRect(0,0,363*a.ss,boxL*a.ss),a.resetting=!0,theVTChart.clearVT()}function clickConveyorRB(a){let b=a.target.parent.name;"rbConveyor01"===b?conveyorMD=1:"rbConveyor02"===b&&(conveyorMD=2),setConveyorMD(conveyorMD)}function setConveyorMD(a){conveyorMD=a,world2D.rbConveyor01.checked=1===conveyorMD,world2D.rbConveyor02.checked=2===conveyorMD}function downAcc(a){let b=a.target.name;"btnAccFastL"===b?beltAccDir=-2:"btnAccSlowL"===b?beltAccDir=-1:"btnAccFastR"===b?beltAccDir=2:"btnAccSlowR"===b&&(beltAccDir=1)}function digit1(a){let b=Math.round(10*a)+"";return b=1===b.length?"0."+b:b.substring(0,b.length-1)+"."+b.substring(b.length-1,b.length),b}function clickRBLook(a){let b=a.target.parent.name;world2D.rbLookAll.checked="rbLookAll"===b,world2D.rbLookBox.checked="rbLookBox"===b}MyJS.myResize();class Conveyor extends THREE.Object3D{constructor(){super();let a=this,b=1.2;a.wheels=[];for(var c=0;2>c;c++){let e=new TEACHER.ObjCylinder(conveyorR-b,conveyorW+4,65535,!1,"z");for(var d=0;6>d;d++){let a=new TEACHER.ObjCylinder(.6,conveyorW+4.5,153,!1,"z"),b=.65*conveyorR;a.position.x=b*Math.cos(2*(d/6*Math.PI)),a.position.y=b*Math.sin(2*(d/6*Math.PI)),e.add(a)}e.position.x=-75*(1>c?1:-1),a.wheels.push(e),a.add(e);let f=11184640;for(var d=0;2>d;d++){let e=new THREE.CylinderGeometry(conveyorR-b,conveyorR,.001,16,1,!0,0,Math.PI),g=new TEACHER.MSMat(f,1>d?0:1),h=new THREE.Mesh(e,g);h.position.z=.5*conveyorW*(1>d?1:-1),h.position.x=-75*(1>c?1:-1),h.rotation.x=Math.PI/2,h.rotation.y=Math.PI*(1>c?1:0),a.add(h);let i=new THREE.PlaneGeometry(conveyorL,b,1,1);g=new TEACHER.MSMat(f,0),h=new THREE.Mesh(i,g),h.position.z=.5*conveyorW*(1>c?1:-1),h.position.y=(conveyorR-.5*b)*(1>d?1:-1),h.rotation.y=Math.PI*(1>c?0:1),a.add(h)}let g=new THREE.PlaneGeometry(conveyorL,conveyorW,1,1),h=new TEACHER.MSMat(13421568,0),i=new THREE.Mesh(g,h);i.position.y=(conveyorR-b)*(1>c?-1:1),i.rotation.x=.5*Math.PI*(1>c?-1:1),a.add(i)}a.beltPlane=new BeltPlane,a.add(a.beltPlane);let e=new TEACHER.ObjCylinder(1,conveyorW+10,6710886,!1,"z"),f=new TEACHER.ObjCylinder(1,conveyorW+10,6710886,!1,"z");e.position.x=-75,f.position.x=75,a.add(e).add(f);for(var c=0;4>c;c++){let b=new TEACHER.ObjBox(1.2,1.6*conveyorR,1.2,6710886);b.position.y=-.8*conveyorR,b.position.x=75*(2>c?-1:1),b.position.z=.5*(conveyorW+7)*(0==c%2?-1:1),a.add(b)}let g=new TEACHER.ObjBox(180,2,40,6710886);g.position.y=-1.6*conveyorR,a.add(g),a.sinVMaxNow=world2D.slSinVMax.value/100*beltVMax/1.8}updateConveyor(){let a=this;1===conveyorMD?(a.sinVMaxNow=.9*a.sinVMaxNow+.1*world2D.slSinVMax.value/100*beltVMax/1.8,beltV=a.sinVMaxNow*Math.sin(.2*tt),beltA=.2*a.sinVMaxNow*Math.cos(.2*tt)):2===conveyorMD?(beltA=.5*beltAccDir,0>=beltV*(beltV+beltA*dt)&&0>beltA*beltV&&(beltA=0,beltV=0,beltAccDir=0),beltV+=beltA*dt,Math.abs(beltV)>beltVMax&&(beltV=beltVMax*(0<beltV?1:-1))):3===conveyorMD&&(beltV=10,beltA=0),beltDX=beltV*dt;for(var b=0;2>b;b++){let c=a.wheels[b];c.rotation.z-=beltDX/conveyorR}a.beltPlane.updateBelt()}}var BeltPlane=class extends THREE.Object3D{constructor(){super();let a=this;a.ss=4,a.w=363,a.h=conveyorW,a.canvas=document.createElement("canvas"),a.canvas.width=a.w*a.ss,a.canvas.height=a.h*a.ss,a.stage=new createjs.Stage(a.canvas),a.groundTexture=new lib.textureBelt,a.groundTexture.scaleX=a.groundTexture.scaleY=a.ss,a.stage.addChild(a.groundTexture),a.stage.update(),a.mapTexture=new THREE.Texture(a.canvas),a.mapTexture.needsUpdate=!0,a.mapMaterial=new THREE.MeshStandardMaterial({map:a.mapTexture,side:0,roughness:.4,transparent:!1}),a.mesh=new THREE.Mesh(new THREE.PlaneGeometry(a.w,a.h,363,1),a.mapMaterial),a.add(a.mesh);for(var b=0;363>=b;b++)for(var c=0;1>=c;c++){let d,e;if(b<Math.PI*conveyorR)d=-75-conveyorR*Math.sin(b/Math.PI/conveyorR*Math.PI),e=-conveyorR*Math.cos(b/Math.PI/conveyorR*Math.PI);else if(b<Math.PI*conveyorR+conveyorL){let a=b-Math.PI*conveyorR;d=-75+a,e=conveyorR}else if(b<2*(Math.PI*conveyorR)+conveyorL){let a=b-Math.PI*conveyorR-conveyorL;d=75+conveyorR*Math.sin(a/Math.PI/conveyorR*Math.PI),e=conveyorR*Math.cos(a/Math.PI/conveyorR*Math.PI)}else{let a=b-2*Math.PI*conveyorR-conveyorL;d=75-a,e=-conveyorR}a.mesh.geometry.attributes.position.array[3*(364*c+b)+0]=d,a.mesh.geometry.attributes.position.array[3*(364*c+b)+1]=e,a.mesh.geometry.attributes.position.array[3*(364*c+b)+2]=.5*conveyorW*(.5>c?-1:1)}a.mesh.geometry.computeVertexNormals();let d=363*a.ss,e=boxL*a.ss;a.traceCanvas=document.createElement("canvas"),a.traceCanvas.width=d,a.traceCanvas.height=e,a.traceHiddenCanvas=document.createElement("canvas"),a.traceHiddenCanvas.width=d,a.traceHiddenCanvas.height=e,a.traceCTX=a.traceCanvas.getContext("2d"),a.traceHiddenCTX=a.traceHiddenCanvas.getContext("2d"),a.traceBitmap=new createjs.Bitmap(a.traceCanvas),a.traceBitmap.y=(.5*conveyorW-5)*a.ss,a.stage.addChild(a.traceBitmap),a.traceRemainder=0}updateBelt(){let a=this;a.groundTexture.grid.x+=beltDX,a.groundTexture.grid.x%=10;let b=beltDX*a.ss;if(a.traceRemainder+=b-Math.floor(b),1<a.traceRemainder?(a.traceRemainder-=1,b=Math.floor(b)+1):-1>a.traceRemainder?(a.traceRemainder+=1,b=Math.floor(b)-1):b=Math.floor(b),a.traceHiddenCTX.clearRect(0,0,363*a.ss,boxL*a.ss),a.traceHiddenCTX.drawImage(a.traceCanvas,0,0),a.traceCTX.clearRect(0,0,363*a.ss,boxL*a.ss),a.traceCTX.drawImage(a.traceHiddenCanvas,b,0),2>gameMD&&!a.resetting&&"K"===fSK){a.traceCTX.fillStyle="rgba(255, 0, 0 , "+theBox.normalFoce+")";let b=Math.round((Math.PI*conveyorR+75+boxX-5)*a.ss);a.traceCTX.clearRect(b,0,boxL*a.ss,boxL*a.ss),a.traceCTX.fillRect(b,0,boxL*a.ss,boxL*a.ss)}else a.resetting&&(a.resetting=!1);a.stage.update(),a.mapTexture.needsUpdate=!0}},VTChartPlane=class extends THREE.Object3D{constructor(){super();let a=this;a.ss=8,a.w=100,a.h=60,a.canvas=document.createElement("canvas"),a.canvas.width=a.w*a.ss,a.canvas.height=a.h*a.ss,a.stage=new createjs.Stage(a.canvas),a.planeTexture=new lib.textureVT,a.planeTexture.scaleX=a.planeTexture.scaleY=a.ss,a.stage.addChild(a.planeTexture),a.stage.update(),a.mapTexture=new THREE.Texture(a.canvas),a.mapTexture.needsUpdate=!0,a.mapMaterial=new THREE.MeshStandardMaterial({map:a.mapTexture,side:2,roughness:.4,transparent:!1}),a.mesh=new THREE.Mesh(new THREE.PlaneGeometry(a.w,a.h,1,1),a.mapMaterial),a.add(a.mesh),a.timeMax=100,a.vBletNow=0,a.vBoxNow=0,a.vTimeNow=0,a.vtPoints=[],a.lineBelt=new createjs.Shape,a.lineBoxS=new createjs.Shape,a.lineBoxK=new createjs.Shape,a.lineBoxZ=new createjs.Shape,a.lineBelt.x=a.lineBoxS.x=a.lineBoxK.x=a.lineBoxZ.x=10,a.lineBelt.y=a.lineBoxS.y=a.lineBoxK.y=a.lineBoxZ.y=30,a.lineBelt.scaleY=a.lineBoxS.scaleY=a.lineBoxK.scaleY=a.lineBoxZ.scaleY=-1,a.planeTexture.addChild(a.lineBelt),a.planeTexture.addChild(a.lineBoxS),a.planeTexture.addChild(a.lineBoxK),a.planeTexture.addChild(a.lineBoxZ)}updateVT(){let a=this,b=a.lineBelt.graphics,c=a.lineBoxS.graphics,d=a.lineBoxK.graphics,e=a.lineBoxZ.graphics;a.vTimeNow=tt,a.vBletNow=beltV,a.vBoxNow=boxV,a.fSKNow=fSK,b.c().ss(1.2).s("#FFF"),c.c().ss(.9).s("#00F"),d.c().ss(.9).s("#F00"),e.c().ss(.9).s("#000");let f=a.vtPoints.length;for(var g=0;g<f;g++){let f=a.vtPoints[g],h=a.vTimeNow<a.timeMax?80*(f.time/a.timeMax):80*((f.time+a.timeMax-a.vTimeNow)/a.timeMax);0==g?(b.mt(h,20*(f.vxBelt/beltVMax)),c.mt(h,20*(f.vxBox/beltVMax)),d.mt(h,20*(f.vxBox/beltVMax)),e.mt(h,20*(f.vxBox/beltVMax))):(b.lt(h,20*(f.vxBelt/beltVMax)),"S"===f.fSK?(c.lt(h,20*(f.vxBox/beltVMax)),d.mt(h,20*(f.vxBox/beltVMax)),e.mt(h,20*(f.vxBox/beltVMax))):"K"===f.fSK?(c.mt(h,20*(f.vxBox/beltVMax)),d.lt(h,20*(f.vxBox/beltVMax)),e.mt(h,20*(f.vxBox/beltVMax))):"Z"===f.fSK?(c.mt(h,20*(f.vxBox/beltVMax)),d.mt(h,20*(f.vxBox/beltVMax)),e.lt(h,20*(f.vxBox/beltVMax))):(c.mt(h,20*(f.vxBox/beltVMax)),d.mt(h,20*(f.vxBox/beltVMax)),e.mt(h,20*(f.vxBox/beltVMax))))}let h=a.vTimeNow<a.timeMax?80*(a.vTimeNow/a.timeMax):80*((a.vTimeNow+a.timeMax-a.vTimeNow)/a.timeMax);b.lt(h,20*(a.vBletNow/beltVMax)),"S"===a.fSKNow?(c.lt(h,20*(a.vBoxNow/beltVMax)),d.mt(h,20*(a.vBoxNow/beltVMax)),e.mt(h,20*(a.vBoxNow/beltVMax))):"K"===a.fSKNow?(c.mt(h,20*(a.vBoxNow/beltVMax)),d.lt(h,20*(a.vBoxNow/beltVMax)),e.mt(h,20*(a.vBoxNow/beltVMax))):"Z"===a.fSKNow?(c.mt(h,20*(a.vBoxNow/beltVMax)),d.mt(h,20*(a.vBoxNow/beltVMax)),e.lt(h,20*(a.vBoxNow/beltVMax))):(c.mt(h,20*(a.vBoxNow/beltVMax)),d.mt(h,20*(a.vBoxNow/beltVMax)),e.mt(h,20*(a.vBoxNow/beltVMax))),0===a.vtPoints.length?a.vtPoints.push(new OneVTPoint(a.vTimeNow,a.vBletNow,a.vBoxNow,a.fSKNow)):.1<=a.vTimeNow-a.vtPoints[a.vtPoints.length-1].time&&a.vtPoints.push(new OneVTPoint(a.vTimeNow,a.vBletNow,a.vBoxNow,a.fSKNow)),0<a.vtPoints.length&&a.vTimeNow-a.vtPoints[0].time>a.timeMax&&a.vtPoints.shift(),a.stage.update(),a.mapTexture.needsUpdate=!0}clearVT(){let a=this;a.lineBelt.graphics.c(),a.lineBoxS.graphics.c(),a.lineBoxK.graphics.c(),a.lineBoxZ.graphics.c(),a.vtPoints=[],a.stage.update(),a.mapTexture.needsUpdate=!0}};class OneVTPoint{constructor(a,b,c,d){this.time=a,this.vxBelt=b,this.vxBox=c,this.fSK=d}}class Box extends THREE.Object3D{constructor(){super();let a=this;const b=16776960;let c=new TEACHER.ObjPlane(boxL,boxL,b,"y");c.position.y=boxL,a.add(c),c=new TEACHER.ObjPlane(boxL,boxL,b,"y"),c.rotation.x=Math.PI,a.add(c),c=new TEACHER.ObjPlane(boxL,boxL,b,"x"),c.position.x=5,c.position.y=5,a.add(c),c=new TEACHER.ObjPlane(boxL,boxL,b,"x"),c.position.x=-5,c.position.y=5,c.rotation.y=Math.PI,a.add(c),c=new TEACHER.ObjPlane(boxL,boxL,b,"z"),c.position.z=-5,c.position.y=5,c.rotation.y=Math.PI,a.add(c),a.boxPlane=new BoxPlane,a.boxPlane.position.y=5,a.boxPlane.position.z=5,a.add(a.boxPlane)}}class BoxPlane extends THREE.Object3D{constructor(){super();let a=this;a.ss=15,a.w=10,a.h=10,a.canvas=document.createElement("canvas"),a.canvas.width=a.w*a.ss,a.canvas.height=a.h*a.ss,a.stage=new createjs.Stage(a.canvas),a.planeTexture=new lib.textureBox,a.planeTexture.scaleX=a.planeTexture.scaleY=a.ss,a.stage.addChild(a.planeTexture),a.stage.update(),a.mapTexture=new THREE.Texture(a.canvas),a.mapTexture.needsUpdate=!0,a.mapMaterial=new THREE.MeshStandardMaterial({map:a.mapTexture,side:0,roughness:.4,transparent:!1}),a.mesh=new THREE.Mesh(new THREE.PlaneGeometry(a.w,a.h,1,1),a.mapMaterial),a.add(a.mesh)}updateBoxPlane(){let a=this,b=world2D.chBoxMark.checked;a.planeTexture.arrFS.x=5,a.planeTexture.arrFS.y=10,a.planeTexture.arrFS.scaleX=boxA/10,a.planeTexture.arrFS.scaleY=.2,a.planeTexture.arrFS.visible="S"===fSK&&b,a.planeTexture.arrFK.x=5,a.planeTexture.arrFK.y=10,a.planeTexture.arrFK.scaleX=2==gameMD?gg*muK/10*(0>boxA?-1:1):gg*muK/10*(0>beltV?-1:1),a.planeTexture.arrFK.scaleY=.2,a.planeTexture.arrFK.visible="K"===fSK&&b,a.planeTexture.labelFF.gotoAndStop("S"===fSK?0:"K"===fSK?1:2),a.planeTexture.labelFF.visible="X"!=fSK&&b,a.stage.update(),a.mapTexture.needsUpdate=!0}}class Claw extends THREE.Object3D{constructor(){super();let a=this;a.baseUp=new TEACHER.ObjBox(14,2,22,6710886),a.baseUp.position.y=55,a.baseUp.position.z=-5,a.add(a.baseUp),a.baseDown=new TEACHER.ObjCylinder(2,5,39321,!1,"x"),a.baseDown.position.y=35,a.add(a.baseDown),a.springs=[];for(var b=0;5>b;b++){let c=new TEACHER.ObjCylinder(5-.8*b,4,39321,!1,"y");c.position.y=55-4*(.5+b),a.add(c),a.springs.push(c)}let c=new TEACHER.ObjBox(2,76,1.2,6710886),d=new TEACHER.ObjBox(2,76,1.2,6710886);c.position.x=-5,d.position.x=5,c.position.y=d.position.y=22,c.position.z=d.position.z=-.5*(conveyorW+7),a.add(c).add(d),a.clawF=new THREE.Object3D,a.clawB=new THREE.Object3D,a.baseDown.add(a.clawB).add(a.clawF);for(var b=0;2>b;b++){let c=0==b?a.clawF:a.clawB,d=new TEACHER.ObjBox(1.6,1.6,5*Math.sqrt(5)+.65,65535);d.position.y=-2.5,d.position.z=5*(0==b?1:-1),d.rotation.x=Math.atan2(1,2)*(0==b?1:-1),c.add(d),d=new TEACHER.ObjBox(1,5.7,1,65535),d.position.y=-7.5,d.position.z=10*(0==b?1:-1),c.add(d),d=new TEACHER.ObjBox(1,1,5.4,65535),d.position.y=-10,d.position.z=7.8*(0==b?1:-1),c.add(d),d=new TEACHER.ObjBox(5,5,.5,65535),d.position.y=-10,d.position.z=5.25*(0==b?1:-1),c.add(d)}a.yNow=55}updateClaw(){let a=this;if(1===clawMD){let b=a.yNow;clawMovingNow=.9*clawMovingNow+.1*clawMovingTarget,b+=clawMovingNow,a.setBaseUp(b),a.visible=!0,a.position.y=0,a.clawB.rotation.x=a.clawF.rotation.x=0}else 2===clawMD&&(a.clawF.rotation.x>-30*Math.PI/180?(a.clawF.rotation.x=.9*a.clawF.rotation.x+.1*(-30.1*Math.PI/180),a.clawB.rotation.x=-a.clawF.rotation.x):100>a.position.y?a.position.y=.92*a.position.y+101*.08:a.visible=!1)}setBaseUp(a){let b=this;b.yNow=a,b.springLen=20,55<b.yNow?(b.yNow=55,b.springLen=20):45<b.yNow?b.springLen=20:35<b.yNow?b.springLen=20-(45-b.yNow):(b.yNow=35,b.springLen=10),b.baseUp.position.y=b.yNow,b.baseDown.position.y=b.yNow-b.springLen;for(var c=0;5>c;c++){let a=b.springs[c];a.position.y=b.yNow-.5-(b.springLen-2.5)/5*(.5+c)}}}class MatterWorld{constructor(){let a=this;a.ss=5,a.Engine=Matter.Engine,a.Render=Matter.Render,a.Runner=Matter.Runner,a.Bodies=Matter.Bodies,a.Body=Matter.Body,a.Constraint=Matter.Constraint,a.Composite=Matter.Composite,a.Composites=Matter.Composites,a.MouseConstraint=Matter.MouseConstraint,a.Mouse=Matter.Mouse,a.engine=a.Engine.create(),a.engine.gravity.y=90,a.render=a.Render.create({canvas:canvasMatter[0],engine:a.engine,options:{width:1600,height:900,pixelRatio:1,background:"transparent",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!1,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!0,showCollisions:!0,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}}),a.runner=a.Runner.create(),a.mGround=a.Bodies.rectangle(800,450,conveyorL*a.ss,2*conveyorR*a.ss,{isStatic:!0}),a.wheelR=a.Bodies.circle(800+75*a.ss,450,conveyorR*a.ss,{isStatic:!0}),a.wheelL=a.Bodies.circle(800-75*a.ss,450,conveyorR*a.ss,{isStatic:!0}),a.mBox=a.Bodies.rectangle(800,350,boxL*a.ss,boxL*a.ss),a.mBox.friction=0,a.mBox.frictionAir=0,a.mGround.friction=0,a.wheelL.friction=a.wheelR.friction=0,a.Composite.add(a.engine.world,[a.mGround,a.wheelL,a.wheelR,a.mBox]),a.Render.run(a.render)}setMatterFrom3D(){let a=this;a.Body.setVelocity(a.mBox,{x:boxV*a.ss,y:0}),a.Body.setPosition(a.mBox,{x:boxX*a.ss+800,y:450-(conveyorR+5)*a.ss}),a.mBox.angle=0,a.engine.timing.timeScale=dt,a.Runner.tick(a.runner,a.engine)}runMatter(){let a=this;a.engine.timing.timeScale=dt,a.Runner.tick(a.runner,a.engine)}}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground1=new TEACHER.ObjPicPlane(100,100,pics.ground,"y"),ground2=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");ground1.position.x=50,ground2.position.x=-50,world3D.scene.add(ground1).add(ground2);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();