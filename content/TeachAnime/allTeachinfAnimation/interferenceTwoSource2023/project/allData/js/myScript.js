'use strict';var thePlane,the2DPlane,ball01,ball02,ballP,wave01,wave02,waveSD,fps=60,log=console.log,isDragingP=!1,sourceMD="12",segW=500,segH=500;const waveNN=500;var text3D01,text3D02,color01=65535,color02=16738047,time=0,x0=-40,y0=0,slitDD=20,lambda=5,intRatio=0,circleRatio=1,colorRatio=1,phi0=300*Math.PI/180,deltaPhi=0,amp=3,time=0,E01=1,E02=1,E01Target=1,E02Target=1,titleTime=120;function init(){thePlane=new ThePlane,thePlane.rotation.x=-Math.PI/2,scene.add(thePlane),ball01=new TEACHER.ObjSphere(1,color01),ball02=new TEACHER.ObjSphere(1,color02),ballP=new TEACHER.ObjSphere(1.2,16776960),ballP.targetX=30,ballP.targetY=0,wave01=new TEACHER.Line(color01,5,waveNN),wave02=new TEACHER.Line(color02,5,waveNN),waveSD=new TEACHER.Line(16776960,8,waveNN);for(var a=0;a<waveNN;a++)wave01.addPoint(-50+a,20,0),wave02.addPoint(-50+a,-20,0),waveSD.addPoint(-50+a,-20,0);thePlane.add(ball01).add(ball02).add(ballP).add(wave01).add(wave02).add(waveSD),wave01.update(),wave02.update(),waveSD.update(),text3D01=new OneWaveXText(1,color01,65793),text3D02=new OneWaveXText(2,color02,65793),scene.add(text3D01).add(text3D02),the2DPlane=new ObjCanvasPlane(100,100,"z","texture2DPlane",6),thePlane.add(the2DPlane),world2D.slSlitDD.maximum=90,world2D.slSlitDD.value=slitDD,world2D.slLambda.minimum=2,world2D.slLambda.maximum=20,world2D.slLambda.value=lambda,world2D.slColor.value=100,world2D.slTime.value=80,world2D.slAmp.value=100,world2D.rb01.on("click",clickRB0102),world2D.rb02.on("click",clickRB0102),world2D.rb12.on("click",clickRB0102),world2D.rb12.checked=!0,setInterval(tick,1e3/fps)}function tick(){titleTime--,60>titleTime&&0<titleTime&&(world2D.title.x=800*titleTime/60+250*(60-titleTime)/60,world2D.title.y=450*titleTime/60+70*(60-titleTime)/60,world2D.title.scaleX=world2D.title.scaleY=2.5*titleTime/60+.8*(60-titleTime)/60),time+=world2D.slTime.value/800,slitDD=.92*slitDD+.08*Math.round(world2D.slSlitDD.value),lambda=.92*lambda+.08*Math.round(world2D.slLambda.value),deltaPhi=.85*deltaPhi+.15*world2D.slDeltaPhi.value/100*Math.PI,amp=.85*amp+.15*world2D.slAmp.value/100;let a=361-330*(world2D.slPhi0.value/100);if(phi0=.92*phi0+.08*a*Math.PI/180,intRatio=.85*intRatio+.15*world2D.slIntRatio.value/100,colorRatio=.85*colorRatio+.15*world2D.slColor.value/100,E01=.9*E01+.1*E01Target,E02=.9*E02+.1*E02Target,thePlane.mesh.position.z=-3.1,thePlane.updateFragment(),ball01.position.x=x0,ball01.position.y=y0+.5*slitDD,ball01.position.z=3*Math.cos(time)+5*(1-amp),ball02.position.x=x0,ball02.position.y=y0-.5*slitDD,ball02.position.z=3*Math.cos(-time+deltaPhi)+5*(1-amp),isDragingP){let a=getMouse3D();50<a.x?a.x=50:-20>a.x&&(a.x=-20),50<a.z?a.z=50:-50>a.z&&(a.z=-50),ballP.targetX=a.x,ballP.targetY=-a.z}ballP.position.x=.9*ballP.position.x+.1*ballP.targetX,ballP.position.y=.9*ballP.position.y+.1*ballP.targetY;let b=ballP.position.x-ball01.position.x,c=ballP.position.x-ball02.position.x,d=ballP.position.y-ball01.position.y,e=ballP.position.y-ball02.position.y,f=Math.sqrt(b*b+d*d),g=Math.sqrt(c*c+e*e);for(var h=0;h<waveNN;h++){let a=3*Math.cos(2*Math.PI*f/lambda*h/waveNN-time),b=3*Math.cos(2*Math.PI*g/lambda*h/waveNN-time+deltaPhi),c=1.5*(Math.cos(2*Math.PI*h/499*slitDD/lambda-time)+Math.cos(2*Math.PI*(499-h)/499*slitDD/lambda-time+deltaPhi));wave01.setPoint(h,ball01.position.x*(499-h)/499+ballP.position.x*h/499,ball01.position.y*(499-h)/499+ballP.position.y*h/499,a),wave02.setPoint(h,ball02.position.x*(499-h)/499+ballP.position.x*h/499,ball02.position.y*(499-h)/499+ballP.position.y*h/499,b),waveSD.setPoint(h,x0,ball01.position.y*(499-h)/499+ball02.position.y*h/499,c)}wave01.update(),wave02.update(),waveSD.update(),wave01.position.z=wave02.position.z=waveSD.position.z=5*(1-amp);for(var h=0;2>h;h++){let a=0==h?ball01:ball02,b=0==h?text3D01:text3D02,c=ballP.position.x-a.position.x,d=ballP.position.y-a.position.y,e=c*c+d*d;e=Math.sqrt(e);let f=Math.atan2(ballP.position.y-a.position.y,ballP.position.x-a.position.x);b.position.x=e/2*Math.cos(f)+x0,b.position.z=-e/2*Math.sin(f)-slitDD/2*(0==h?1:-1),b.position.y=5,b.rotation.y=f,b.setWaveX(e/lambda)}wave01.visible=text3D01.visible=world2D.chDeltaX.checked&&!world2D.rb02.checked,wave02.visible=text3D02.visible=world2D.chDeltaX.checked&&!world2D.rb01.checked,ballP.visible=world2D.chDeltaX.checked,waveSD.visible=world2D.chWaveSD.checked,the2DPlane.update2DPlane(),world3D.render(),world2D.stage.update()}MyJS.myResize();function clickRB0102(a){let b=a.target.parent.name;world2D.rb01.checked="rb01"===b,world2D.rb02.checked="rb02"===b,world2D.rb12.checked="rb12"===b,world2D.rb01.checked?(E01Target=2,E02Target=0):world2D.rb02.checked?(E01Target=0,E02Target=2):world2D.rb12.checked&&(E01Target=1,E02Target=1)}world2D.btn3D.on("mousedown",myMouseDown),world2D.btn3D.on("pressmove",myMouseMove),world2D.btn3D.on("pressup",myMouseUp);function myMouseDown(){let a=getMouse3D(),b=Math.sqrt(Math.pow(ballP.position.x-a.x,2)+Math.pow(ballP.position.y+a.z,2));2>b?isDragingP=!0:(world3D.camera.isDraging=!0,world3D.camera.oldMouseX=stage2D.mouseX,world3D.camera.oldMouseY=stage2D.mouseY)}function myMouseMove(){if(world3D.camera.isDraging&&world3D.cameraDragAndRotate){var a=stage2D.mouseX,b=stage2D.mouseY;for(world3D.cameraPhi-=.005*(a-world3D.camera.oldMouseX);world3D.cameraPhi>Math.PI;)world3D.cameraPhi-=2*Math.PI;for(;world3D.cameraPhi<-Math.PI;)world3D.cameraPhi+=2*Math.PI;world3D.cameraTheta-=.005*(b-world3D.camera.oldMouseY),world3D.cameraTheta>.9999*Math.PI&&(world3D.cameraTheta=.9999*Math.PI),world3D.cameraTheta<1e-4*Math.PI&&(world3D.cameraTheta=1e-4*Math.PI),world3D.camera.oldMouseX=a,world3D.camera.oldMouseY=b}}function myMouseUp(){world3D.camera.isDraging=!1,isDragingP=!1}class ThePlane extends THREE.Object3D{constructor(){super();let a=this;a.geo=new THREE.PlaneGeometry(100,100,segW,segH),a.uniforms={x0:{value:x0},y0:{value:y0},slitDD:{value:slitDD},lambda:{value:lambda},intRatio:{value:intRatio},colorRatio:{value:colorRatio},phi0:{value:phi0},deltaPhi:{value:deltaPhi},amp:{value:amp},time:{value:time},E01:{value:E01},E02:{value:E02}},a.mat=new THREE.ShaderMaterial({uniforms:a.uniforms,vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,side:THREE.DoubleSide,transparent:!0}),a.mesh=new THREE.Mesh(a.geo,a.mat),a.add(a.mesh)}updateFragment(){let a=this;a.uniforms.slitDD.value=slitDD,a.uniforms.lambda.value=lambda,a.uniforms.intRatio.value=intRatio,a.uniforms.colorRatio.value=colorRatio,a.uniforms.deltaPhi.value=deltaPhi,a.uniforms.amp.value=amp,a.uniforms.phi0.value=phi0,a.uniforms.time.value=time,a.uniforms.E01.value=E01,a.uniforms.E02.value=E02}}var ObjCanvasPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=e;f.w=a||100,f.h=b||100,f.canvas=document.createElement("canvas"),f.canvas.width=f.w*g,f.canvas.height=f.h*g,f.stage=new createjs.Stage(f.canvas),f.groundTexture=new lib[d],f.groundTexture.scaleX=f.groundTexture.scaleY=g,f.stage.addChild(f.groundTexture),f.stage.update(),f.mapTexture=new THREE.Texture(f.canvas),f.mapTexture.needsUpdate=!0,f.mapMaterial=new THREE.MeshStandardMaterial({map:f.mapTexture,side:0,roughness:.6,transparent:!0}),f.mesh=new THREE.Mesh(new THREE.PlaneGeometry(f.w,f.h,1,1),f.mapMaterial),"y"===c?f.mesh.rotation.x=-Math.PI/2:"x"==c&&(f.mesh.rotation.y=Math.PI/2),f.add(f.mesh)}update2DPlane(){let a=this;if(!a.graphics)a.graphics=new createjs.Graphics,a.shape=new createjs.Shape(a.graphics),a.shape.x=50,a.shape.y=50,a.groundTexture.addChild(a.shape);else{let e=a.graphics;if(e.clear(),e.setStrokeStyle(.6),world2D.chWaveFront.checked&&!world2D.rb02.checked){e.beginStroke("#00ffff");for(var b=0;70>b;b++){let a=(time%(2*Math.PI)/(2*Math.PI)+b)*lambda;e.mt(x0+a*Math.cos(phi0/2),y0-slitDD/2-a*Math.sin(phi0/2)),e.arc(x0,y0-slitDD/2,a,-phi0/2,phi0/2)}}if(world2D.chWaveFront.checked&&!world2D.rb01.checked){e.beginStroke("#ff66ff");for(var b=0;70>b;b++){let a=((time-deltaPhi)%(2*Math.PI)/(2*Math.PI)+b)*lambda;e.mt(x0+a*Math.cos(phi0/2),y0+slitDD/2-a*Math.sin(phi0/2)),e.arc(x0,y0+slitDD/2,a,-phi0/2,phi0/2)}}if(world2D.chLineAmp.checked&&0===world2D.slPhi0.value){let a=Math.floor(slitDD/lambda-deltaPhi/(2*Math.PI)),f=Math.floor(-slitDD/lambda-deltaPhi/(2*Math.PI))+1;.01>-slitDD/lambda-deltaPhi/(2*Math.PI)-Math.floor(-slitDD/lambda-deltaPhi/(2*Math.PI))&&f--,e.beginStroke("#ffffff");for(var b=f;b<=a;b++){let a=(b+deltaPhi/(2*Math.PI))*lambda/2;if(0==a)for(var c=-50;50>=c;c+=10){let a=y0;-49>c?e.mt(c,a):e.lt(c,a)}else if(0>=1-Math.pow(2*a/slitDD,2)){e.mt(x0,(y0+slitDD/2)*(0<a?-1:1));for(var d=y0+slitDD/2;50>=d;d+=5){let b=d*(0<a?-1:1);e.lt(x0,b)}}else{let b=a*Math.sqrt(1-Math.pow(2*a/slitDD,2))/(2*a/slitDD);for(var c=-50;50>=c;c++){let d=y0+a*Math.sqrt(1+Math.pow((c-x0)/b,2));-49>c?e.mt(c,d):e.lt(c,d)}}}}if(world2D.chLineNode.checked&&0===world2D.slPhi0.value){let a=Math.floor(slitDD/lambda-deltaPhi/(2*Math.PI)-.5),f=Math.floor(-slitDD/lambda-deltaPhi/(2*Math.PI)-.5)+1;.01>-slitDD/lambda-deltaPhi/(2*Math.PI)-.5-Math.floor(-slitDD/lambda-deltaPhi/(2*Math.PI)-.5)&&f--,e.beginStroke("#ffffff");for(var b=f;b<=a;b++){let a=(b+deltaPhi/(2*Math.PI)+.5)*lambda/2,f=!0;if(0==a)for(var c=-50;50>=c;c+=1){let a=y0;-49>c?e.mt(c,a):f?(e.lt(c,a),f=!f):(e.mt(c,a),f=!f)}else if(0>=1-Math.pow(2*a/slitDD,2)){e.mt(x0,(y0+slitDD/2)*(0<a?-1:1));for(var d=y0+slitDD/2;50>=d;d+=1){let b=d*(0<a?-1:1);f?(e.lt(x0,b),f=!f):(e.mt(x0,b),f=!f)}}else{let b=a*Math.sqrt(1-Math.pow(2*a/slitDD,2))/(2*a/slitDD);for(var c=-50;50>=c;c++){let d=y0+a*Math.sqrt(1+Math.pow((c-x0)/b,2));-49>c?e.mt(c,d):f?(e.lt(c,d),f=!f):(e.mt(c,d),f=!f)}}}}}a.stage.update(),a.mapTexture.needsUpdate=!0}};function digit1(a){let b=Math.round(10*a)+"";return b=1===b.length?"0."+b:b.substring(0,b.length-1)+"."+b.substring(b.length-1,b.length),b}class OneWaveXText extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.LetterX=new Text3DStroke("x",b,c,"gentilis_bold.typeface"),d.n12=a,d.Letter12=new Text3DStroke(1===d.n12?"1":"2",b,c,"gentilis_bold.typeface"),d.LetterEq=new Text3DStroke("=",b,c,"gentilis_bold.typeface"),d.LetterA=new DigitGroup(b,c),d.LetterB=new DigitGroup(b,c),d.LetterC=new DigitGroup(b,c),d.LetterDot=new Text3DStroke(".",b,c,"gentilis_bold.typeface"),d.LetterLambda=new Text3DStroke("l",b,c,"Standard Greek_Bold"),d.add(d.LetterX).add(d.Letter12).add(d.LetterEq).add(d.LetterA).add(d.LetterB).add(d.LetterC).add(d.LetterDot).add(d.LetterLambda)}setWaveX(a){let b=this,c=digit1(a);b.LetterA.visible=4===c.length,b.LetterA.setDigit(4===c.length?c.charAt(0):0),b.LetterB.setDigit(4===c.length?c.charAt(1):c.charAt(0)),b.LetterC.setDigit(4===c.length?c.charAt(3):c.charAt(2));let d=4*(c.length-1)+1;b.LetterX.position.x=-.5*d-8,b.Letter12.position.x=-.5*d-5,b.Letter12.scale.x=b.Letter12.scale.y=.7,b.Letter12.position.y=-2,b.LetterEq.position.x=-.5*d-2,b.LetterA.position.x=-.5*d+1,b.LetterB.position.x=-.5*d+2+(4===c.length?4:0),b.LetterC.position.x=.5*d,b.LetterDot.position.x=.5*d-3,b.LetterLambda.position.x=.5*d+5}}class DigitGroup extends THREE.Object3D{constructor(a,b){super();let c=this;c.digits=[];for(let d,e=0;9>=e;e++)d=new Text3DStroke(e+"",a,b,"Standard Greek_Bold"),d.visible=!1,c.digits.push(d),c.add(d)}setDigit(a){let b=this;for(let c=0;9>=c;c++)b.digits[c].visible=c==a}}class Text3DStroke extends THREE.Object3D{constructor(a,b,c,d){super();let e=this;const f=new FontLoader;f.load("allData/js/jsm/fonts/"+d+".json",function(d){e.matOut=new THREE.MeshBasicMaterial({color:c||255,side:THREE.DoubleSide}),e.matIn=new THREE.MeshBasicMaterial({color:b||65535,transparent:!1,side:THREE.DoubleSide}),e.message=a,e.shapes=d.generateShapes(e.message,6),e.geometry=new THREE.ShapeGeometry(e.shapes),e.geometry.computeBoundingBox();const f=-.5*(e.geometry.boundingBox.max.x-e.geometry.boundingBox.min.x);e.geometry.translate(f,0,0),e.textMesh=new THREE.Mesh(e.geometry,e.matIn),e.add(e.textMesh);const g=[];for(let a=0;a<e.shapes.length;a++){const b=e.shapes[a];if(b.holes&&0<b.holes.length)for(let a=0;a<b.holes.length;a++){const c=b.holes[a];g.push(c)}}e.shapes.push.apply(e.shapes,g);const h=SVGLoader.getStrokeStyle(.3,c);e.strokeText=new THREE.Group;for(let a=0;a<e.shapes.length;a++){const b=e.shapes[a],c=b.getPoints(),d=SVGLoader.pointsToStroke(c,h);d.translate(f,0,0);const g=new THREE.Mesh(d,e.matOut);e.strokeText.add(g)}e.strokeText.position.z=.1,e.add(e.strokeText)})}}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=5,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();