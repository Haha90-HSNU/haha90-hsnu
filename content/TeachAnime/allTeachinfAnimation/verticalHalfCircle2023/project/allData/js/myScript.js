'use strict';var graphics,fps=60,log=console.log,sin=Math.sin,cos=Math.cos,v0n=3.5,vx=0,vy=0,xx=-800,yy=0,gg=5,tt=0,ddt=.1,rr=300,phi=0,omega=0,motionMD=0,isPlay=!0,isStep=!1,isTraced=!1;function init(){initTracer(),world2D.slV0.minimum=1,world2D.slV0.maximum=6,world2D.slV0.value=5,world2D.slV0.digitN=1,world2D.btnGo.on("click",clickBtn),world2D.btnPlayStop.on("click",clickBtn),world2D.btnReset.on("click",clickBtn),world2D.btnStep.on("click",clickBtn),world2D.btnClear.on("click",function(){graphics.clear(),isTraced=!1}),world2D.chTrace.checked=!0,setInterval(tick,1e3/fps)}function tick(){let a=isPlay?ddt:0;if(0===motionMD)v0n=world2D.slV0.value,v0n=Math.round(10*v0n)/10,xx=-800,yy=0,vx=Math.sqrt(v0n*gg*rr),vy=0,world2D.ball.arrowN.rotation=-90,world2D.ball.arrowN.scaleX=.15*gg,world2D.ball.arrowN.x=world2D.ball.arrowN.y=0,world2D.ball.arrowN.life=10;else if(1===motionMD)xx+=vx*a,0<=xx&&(motionMD=2,phi=xx/rr,omega=Math.sqrt(v0n*gg*rr-2*gg*rr*(1-cos(phi)))/rr),world2D.ball.arrowN.rotation=-90,world2D.ball.arrowN.scaleX=.15*gg,world2D.ball.arrowN.x=world2D.ball.arrowN.y=0,world2D.ball.arrowN.life=10;else if(2===motionMD){phi+=omega*a-.5*gg/rr*sin(phi)*a*a,omega-=gg/rr*sin(phi)*a,xx=rr*sin(phi),yy=rr*(1-cos(phi));let b=rr*omega;vx=b*cos(phi),vy=b*sin(phi);let c=Math.PI;5>v0n&&2<v0n&&(c=Math.acos((2-v0n)/3)),world2D.ball.arrowN.rotation=-90-180*phi/Math.PI,world2D.ball.arrowN.scaleX=.15*(rr*omega*omega+gg*cos(phi)),world2D.ball.arrowN.x=world2D.ball.arrowN.y=0,world2D.ball.arrowN.life=10,phi>=c&&2<v0n&&phi>Math.PI/2?(motionMD=3,vx=rr*omega*cos(phi),vy=rr*omega*sin(phi),world2D.ball.arrowN.life=-1):0>phi&&2>=v0n&&(motionMD=4,vx=-Math.sqrt(v0n*gg*rr),vy=0,yy=0,xx=rr*sin(phi))}else if(3===motionMD){xx+=vx*a,yy+=vy*a-.5*gg*a*a,vy-=gg*a;let b=Math.sqrt(xx*xx+(rr-yy)*(rr-yy)),c=xx/b,d=(yy-rr)/b,e=vx*c+vy*d;if(0<xx&&b>=rr&&0<e){let a=vx-2*e*c,b=vy-2*e*d,f=Math.sqrt(a*a+b*b);xx=rr*c,yy=rr*(1+d);let g=Math.sqrt(v0n*gg*rr-2*gg*yy);vx=g*a/f,vy=g*b/f,world2D.ball.arrowN.rotation=-90-180*Math.atan2(xx,rr-yy)/Math.PI,world2D.ball.arrowN.scaleX=4,world2D.ball.arrowN.x=world2D.ball.arrowN.y=0,world2D.ball.arrowN.life=5}else 0>=yy&&0>vy&&(yy=0,vy=Math.sqrt(v0n*gg*rr-vx*vx),world2D.ball.arrowN.rotation=-90,world2D.ball.arrowN.scaleX=4,world2D.ball.arrowN.x=world2D.ball.arrowN.y=0,world2D.ball.arrowN.life=5);-800>xx&&(motionMD=5)}else if(4===motionMD)xx+=vx*a,world2D.ball.arrowN.rotation=-90,world2D.ball.arrowN.scaleX=.15*gg,world2D.ball.arrowN.x=world2D.ball.arrowN.y=0,world2D.ball.arrowN.life=10,-800>xx&&(motionMD=5);else if(5===motionMD);world2D.slV0.value=v0n,0<motionMD&&isPlay&&drawTracer(),world2D.ball.x=1100+xx,world2D.ball.y=700-yy,world2D.btnGo.visible=0===motionMD,world2D.btnStep.visible=world2D.btnPlayStop.visible=0!=motionMD&&5!=motionMD,world2D.btnReset.visible=0!=motionMD,world2D.btnClear.visible=world2D.chTrace.checked&&isTraced,world2D.heightMap.visible=world2D.chHeight.checked,world2D.tracer.visible=world2D.chTrace.checked,world2D.ball.arrowMg.rotation=90,world2D.ball.arrowMg.scaleX=.15*gg,world2D.ball.arrowMg.x=world2D.ball.arrowMg.y=0,world2D.ball.arrowMg.visible=world2D.chArrowMg.checked,world2D.ball.arrowV.rotation=180*-Math.atan2(vy,vx)/Math.PI,world2D.ball.arrowV.scaleX=.01*Math.sqrt(vx*vx+vy*vy),world2D.ball.arrowV.x=world2D.ball.arrowV.y=0,world2D.ball.arrowV.visible=world2D.chArrowV.checked,7>world2D.ball.arrowN.life&&world2D.ball.arrowN.life--,world2D.ball.arrowN.visible=world2D.chArrowN.checked&&0<world2D.ball.arrowN.life,isStep&&(isPlay=!1),world2D.stage.update()}MyJS.myResize();function initTracer(){var a=new createjs.Graphics;a.setStrokeStyle(1),a.beginStroke("#000000"),a.beginFill("red"),a.drawCircle(0,0,30),graphics=a;var b=new createjs.Shape(a);world2D.tracer.addChild(b),graphics.ii=0,graphics.clear(),graphics.lineMD=0,graphics.gx=xx,graphics.gy=yy}function drawTracer(){graphics.ii++;let a;1===motionMD?a="#FFFF00":2===motionMD?a="#FFFFFF":3===motionMD?a="#FF6666":4===motionMD&&(a="#66FF66"),graphics.es().ss(5,"round").s(a).mt(graphics.gx+800,-graphics.gy).lt(xx+800,-yy),isTraced=!0,graphics.gx=xx,graphics.gy=yy}function clickBtn(a){var b=a.target.name;"btnGo"===b?motionMD=1:"btnStep"===b?(isPlay=!0,isStep=!0):"btnPlayStop"===b?isStep?(isPlay=!0,isStep=!1):isPlay=!isPlay:"btnReset"===b&&(isStep=!1,isPlay=!0,motionMD=0,graphics.gx=-800,graphics.gy=0)}init();