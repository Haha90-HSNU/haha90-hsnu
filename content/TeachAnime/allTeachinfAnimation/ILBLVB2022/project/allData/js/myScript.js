'use strict';var allTheLines,wireBar,theWires1,theWires2,theMagnet,fps=60,log=console.log,cMD=1,cMDT=1,wireX=0,B0=5,I0=30,I0pn=1,wireColor=16751001,currentArrows=[],bArrows=[],tt=60;function init(){ground.visible=!1,world2D.slCameraRR.value=100,world3D.cameraTarget.x=-15,initTheWires1(),initTheWires2(),initTheMagnet(),initAllTheLines(),wireBar=new TEACHER.ObjCylinder(.8,30,wireColor,!1,"z"),wireBar.vx=0,scene.add(wireBar);for(var a,b=0;4>b;b++)a=new TEACHER.ObjArrow(1,wireColor),currentArrows.push(a),3>b?scene.add(a):wireBar.add(a);world2D.controlILB.btn01.on("click",clickILBbtn),world2D.controlILB.btn02.on("click",clickILBbtn),world2D.controlLvB.btnRight.on("mousedown",downLvBbtn),world2D.controlLvB.btnLeft.on("mousedown",downLvBbtn),world2D.on("pressup",w2Dup),world2D.mBtnILB.on("click",clickMBtn),world2D.mBtnLvB.on("click",clickMBtn),setInterval(tick,1e3/fps)}function tick(){if(tt-=.5,0<tt?(world2D.title.x=140+225*tt/60,world2D.title.y=100+340*tt/60,world2D.title.scaleX=world2D.title.scaleY=1+3*tt/60):world2D.title.visible=!1,theWires1.visible=world2D.controlILB.visible=1===cMD,theWires2.hand2Model&&(theWires2.hand2Model.visible=2===cMD),theWires2.visible=world2D.controlLvB.visible=2===cMD,1===cMD&&1===cMDT){theWires1.battery.position.y=.95*theWires1.battery.position.y+.05*theWires1.battery.TY,theWires1.battery.rotation.x=.95*theWires1.battery.rotation.x+.05*theWires1.battery.TR;var a=30*(Math.abs(world2D.controlILB.sl01.value)*(.5>theWires1.battery.position.y?1:0)*(.01>Math.sin(theWires1.battery.rotation.x)?1:0))/100+.05;I0=.8*I0+.2*a,I0pn=theWires1.battery.rotation.x<Math.PI/2?1:-1,theWires1.battery.scale.x=theWires1.battery.scale.y=.5+.7*Math.abs(world2D.controlILB.sl01.value)/100;var b=.08,c=I0*I0pn-1.35*wireX;wireBar.vx+=c*b,wireBar.vx*=.95,wireX+=wireBar.vx*b,theWires1.springB.setSpringNew222(40+wireX,0,0),theWires1.springF.setSpringNew222(40+wireX,0,0)}else if(2===cMD&&2===cMDT){theWires2.barL0.visible=!world2D.controlLvB.chOpen.checked,theWires2.barL1.visible=theWires2.barL2.visible=world2D.controlLvB.chOpen.checked;var b=.08,c=10*theWires2.handF-1*wireBar.vx*(world2D.controlLvB.chOpen.checked?0:1);wireBar.vx+=c*b,wireBar.vx*=.95,wireX+=wireBar.vx*b,23.5<wireX&&0<wireBar.vx?(wireBar.vx*=0,wireX=23.5):-23.5>wireX&&0>wireBar.vx&&(wireBar.vx*=0,wireX=-23.5),I0=4*Math.abs(wireBar.vx)*(world2D.controlLvB.chOpen.checked?0:1)+.05,I0pn=0<wireBar.vx?-1:1}else cMD+=1.5>cMDT?-.02:.02,wireX*=.95,I0=.05,wireBar.vx=0,1>cMD?cMD=1:2<cMD&&(cMD=2),world2D.mPointer.x=140+220*(cMD-1);wireBar.position.x=wireX,allTheLines.position.x=wireX,allTheLines.rotation.y=Math.PI*(0>I0pn?1:0),updateAllTheLines();for(var d,e=.8*(I0*I0pn),f=0;4>f;f++)d=currentArrows[f],d.visible=.05<Math.abs(e),0==f?(d.position.x=-61,d.position.z=0,d.position.y=2===cMD?1.5:7,d.setArrow(0,0,e)):1===f?(d.position.x=-45,d.position.z=20,d.position.y=2===cMD?-1.2:0,d.setArrow(e,0,0)):2===f?(d.position.x=-45,d.position.z=-20,d.position.y=2===cMD?-1.2:0,d.setArrow(-e,0,0)):3==f&&(d.position.x=5,d.position.z=0,d.position.y=0,d.setArrow(0,0,-e));world3D.render(),world2D.stage.update()}MyJS.myResize();function initTheMagnet(){theMagnet=new THREE.Object3D,scene.add(theMagnet);var a=theMagnet,b=11184810,c=new TEACHER.ObjBox(100,2,60,b);c.position.y=31;var d=new TEACHER.ObjBox(100,2,60,b);d.position.y=-31,c.position.z=d.position.z=-25;var e=new TEACHER.ObjBox(100,60,2,b);e.position.z=-54,a.add(c).add(d).add(e),a.magnetSolidN=new TEACHER.ObjBox(100,10,10,255),a.magnetSolidN.position.y=-25,a.magnetSolidS=new TEACHER.ObjBox(100,10,10,16711680),a.magnetSolidS.position.y=25,a.add(a.magnetSolidN).add(a.magnetSolidS);var f=new TEACHER.ObjPicPlane(10,10,"allData/pics/nnn.png");f.position.y=-25,f.position.z=8;var g=new TEACHER.ObjPicPlane(10,10,"allData/pics/sss.png");g.position.y=25,g.position.z=8,a.add(f).add(g)}function initTheWires1(){theWires1=new THREE.Object3D,scene.add(theWires1);var a=new TEACHER.ObjCylinder(.8,20,wireColor,!1,"x"),b=new TEACHER.ObjCylinder(.8,20,wireColor,!1,"x");a.position.z=14,b.position.z=-14,a.position.x=b.position.x=-50,theWires1.add(a).add(b);var c=new TEACHER.ObjCylinder(.8,6,wireColor,!1,"z"),d=new TEACHER.ObjCylinder(.8,6,wireColor,!1,"z");c.position.x=d.position.x=-61,c.position.z=-10,d.position.z=10;var e=new TEACHER.ObjBox(2,2,2,wireColor),f=new TEACHER.ObjBox(2,2,2,wireColor);e.position.x=f.position.x=-61,e.position.z=14,f.position.z=-14,theWires1.add(c).add(d).add(e).add(f),theWires1.battery=new THREE.Object3D,theWires1.battery.position.x=-61,theWires1.battery.position.y=10,theWires1.battery.scale.z=16/10,theWires1.battery.TY=10,theWires1.battery.TR=0,theWires1.add(theWires1.battery);var g=new TEACHER.ObjCylinder(1.5,1,13421772,!1,"z");g.position.z=4.5;var h=new TEACHER.ObjCylinder(4,3,16776960,!1,"z");h.position.z=2.5;var i=new TEACHER.ObjCylinder(4,7,6710886,!1,"z");i.position.z=-2.5,theWires1.battery.add(g).add(h).add(i),theWires1.springF=new TEACHER.ObjSpring(40,3,.5,8,wireColor),theWires1.springB=new TEACHER.ObjSpring(40,3,.5,8,wireColor),theWires1.add(theWires1.springF).add(theWires1.springB),theWires1.springF.position.z=14,theWires1.springB.position.z=-14,theWires1.springF.position.x=theWires1.springB.position.x=-40,theWires1.springF.setSpringNew222(40,0,0),theWires1.springB.setSpringNew222(40,0,0)}function initTheWires2(){theWires2=new THREE.Object3D,theWires2.position.y=-1.5,scene.add(theWires2),theWires2.handF=0;var a=new TEACHER.ObjCylinder(.8,100,wireColor,!1,"x"),b=new TEACHER.ObjCylinder(.8,100,wireColor,!1,"x");a.position.z=14,b.position.z=-14,a.position.x=b.position.x=-10,theWires2.add(a).add(b),theWires2.barL0=new TEACHER.ObjCylinder(.8,26,wireColor,!1,"z"),theWires2.barL1=new TEACHER.ObjCylinder(.8,6,wireColor,!1,"z"),theWires2.barL2=new TEACHER.ObjCylinder(.8,6,wireColor,!1,"z"),theWires2.barL0.position.x=theWires2.barL1.position.x=theWires2.barL2.position.x=-61,theWires2.barL1.position.z=-10,theWires2.barL2.position.z=10;var c=new TEACHER.ObjBox(2,2,2,wireColor),d=new TEACHER.ObjBox(2,2,2,wireColor);c.position.x=d.position.x=-61,c.position.z=14,d.position.z=-14,theWires2.add(theWires2.barL0).add(theWires2.barL1).add(theWires2.barL2).add(c).add(d);var e=new TEACHER.ObjCylinder(1.8,1.2,6710886,!1,"x"),f=new TEACHER.ObjCylinder(1.8,1.2,6710886,!1,"x"),g=new TEACHER.ObjCylinder(1.8,1.2,6710886,!1,"x"),h=new TEACHER.ObjCylinder(1.8,1.2,6710886,!1,"x");e.position.x=g.position.x=25,f.position.x=h.position.x=-25,e.position.z=f.position.z=14,g.position.z=h.position.z=-14,theWires2.add(e).add(f).add(g).add(h),loadModel()}function clickILBbtn(a){var b=a.target.name;"btn01"===b?5>theWires1.battery.position.y?theWires1.battery.TY=10:theWires1.battery.TY=0:"btn02"===b&&(theWires1.battery.rotation.x<Math.PI/2?theWires1.battery.TR=Math.PI:theWires1.battery.TR=0)}function downLvBbtn(a){var b=a.target.parent.name;"btnRight"===b?theWires2.handF=1:"btnLeft"===b&&(theWires2.handF=-1)}function w2Dup(){theWires2.handF=0}function clickMBtn(a){var b=a.target.name;"mBtnILB"===b?cMDT=1:"mBtnLvB"===b&&(cMDT=2)}function initAllTheLines(){allTheLines=new THREE.Object3D,scene.add(allTheLines);let a=allTheLines;a.innerLineMax=6,a.lxNN=16,a.lyNN=30,a.lineNNMax=120,a.outLinesU=[],a.outLinesD=[],a.inLinesU=[],a.inLinesD=[];for(var b,c=0;c<a.lxNN+a.innerLineMax;c++){b=new TEACHER.Line(16776960,3,a.lineNNMax),a.outLinesU.push(b),a.add(b);var b=new TEACHER.Line(16776960,3,a.lineNNMax);a.outLinesD.push(b),a.add(b);var b=new TEACHER.Line(16776960,3,a.lineNNMax);a.inLinesU.push(b),a.add(b);var b=new TEACHER.Line(16776960,3,a.lineNNMax);a.inLinesD.push(b),a.add(b);var d=new TEACHER.ObjArrow(.5,16776960);d.setArrow(0,3,0),a.add(d),bArrows.push(d);var d=new TEACHER.ObjArrow(.5,16776960);d.setArrow(0,3,0),a.add(d),bArrows.push(d);var d=new TEACHER.ObjArrow(.5,16776960);a.add(d),d.setArrow(0,-3,0),bArrows.push(d)}}function updateAllTheLines(){let a=allTheLines;a.innerLineCount=0;for(var b=0;b<a.lxNN+a.innerLineMax;b++){let i=allTheLines.outLinesU[b],j=allTheLines.outLinesD[b],C=allTheLines.inLinesU[b],D=allTheLines.inLinesD[b];j.pps0=[],j.ppsA=[],j.ppsB=[],j.ppsC=[],j.pps1=[],j.hasCross=!1;for(var c,d=0;d<a.lyNN;d++)c=-20+20/a.lyNN*d,c=20*-Math.pow(c/20,4),.01>Math.abs(c)&&(c=-.01),setLinePX(j,b,c);let E=j.pps0.length,F=j.ppsA.length,G=j.ppsB.length,H=j.ppsC.length,I=j.pps1.length,J=[],K=[],L=!1;if(0<G){if(-.015<j.ppsB[G-1].y){if(j.ix<allTheLines.lxNN){for(var e=0;e<E;e++)J.push(j.pps0[e]);for(var e=0;e<H;e++)J.push(j.ppsC[e]);for(var f,e=0;e<I;e++)f=new THREE.Vector3(j.pps1[I-e-1].x,-j.pps1[I-e-1].y,j.pps1[I-e-1].z),J.push(f);for(var f,e=0;e<H;e++)f=new THREE.Vector3(j.ppsC[H-e-1].x,-j.ppsC[H-e-1].y,j.ppsC[H-e-1].z),J.push(f);for(var f,e=0;e<E;e++)f=new THREE.Vector3(j.pps0[E-e-1].x,-j.pps0[E-e-1].y,j.pps0[E-e-1].z),J.push(f)}if(allTheLines.innerLineCount<allTheLines.innerLineMax){allTheLines.innerLineCount++,L=!0;for(var g=0;g<2*Math.PI;g+=2*Math.PI/64){var h=1e-6,k=2*I0/B0/Math.cos(g);(k<h||1e4<k)&&(k=1e4);for(var l=-I0/B0*Math.log(h*h)+h*Math.cos(g)-j.targetX,m=-I0/B0*Math.log(k*k)+k*Math.cos(g)-j.targetX,n=0;1e3>n||.02<k-h;){var o=.5*(h+k),p=-I0/B0*Math.log(o*o)+o*Math.cos(g)-j.targetX;0>=l*p?(k=o,m=p):(h=o,l=p),n++}var f=new THREE.Vector3(o*Math.cos(g),o*Math.sin(g),0);K.push(f)}}}else{for(var e=0;e<E;e++)J.push(j.pps0[e]);0>j.ppsC[0].x&&log("\u932F\u8AA4CCC"),J.push(j.ppsC[0]);for(var q=16,r=0;r<=q;r++){var s=(q-r)/q*j.ppsC[0].x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=-Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}for(var g=Math.PI/2;g<1.5*Math.PI;g+=2*Math.PI/30){var h=1e-6,k=2*I0/B0/Math.cos(g);(k<h||1e4<k)&&(k=1e4);for(var l=-I0/B0*Math.log(h*h)+h*Math.cos(g)-j.targetX,m=-I0/B0*Math.log(k*k)+k*Math.cos(g)-j.targetX,n=0;1e3>n||.02<k-h;){var o=.5*(h+k),p=-I0/B0*Math.log(o*o)+o*Math.cos(g)-j.targetX;0>=l*p?(k=o,m=p):(h=o,l=p),n++}var f=new THREE.Vector3(o*Math.cos(g),-o*Math.sin(g),0);J.push(f)}for(var q=16,r=0;r<=q;r++){var s=r/q*j.ppsC[0].x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}var f=new THREE.Vector3(j.ppsC[0].x,-j.ppsC[0].y,j.ppsC[0].z);J.push(f);for(var f,e=0;e<E;e++)f=new THREE.Vector3(j.pps0[E-e-1].x,-j.pps0[E-e-1].y,j.pps0[E-e-1].z),J.push(f)}}else if(b<a.lxNN){for(var v,w=5,q=6,x=j.pps0[0].x,e=0;e<E;e++){if(v=j.pps0[e].x,v-x<-w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=-Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v,J.push(j.pps0[e])}for(var v,e=0;e<H;e++){if(v=j.ppsC[e].x,v-x<-w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=-Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v,J.push(j.ppsC[e])}for(var v,e=0;e<F;e++){if(v=j.ppsA[e].x,v-x<-w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=-Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v,J.push(j.ppsA[e])}for(var v,e=0;e<I;e++){if(v=j.pps1[e].x,v-x<-w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=-Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v,J.push(j.pps1[e])}for(var v,e=0;e<I;e++){if(v=j.pps1[I-e-1].x,v-x>w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v;var f=new THREE.Vector3(j.pps1[I-e-1].x,-j.pps1[I-e-1].y,j.pps1[I-e-1].z);J.push(f)}for(var v,e=0;e<F;e++){if(v=j.ppsA[F-e-1].x,v-x>w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v;var f=new THREE.Vector3(j.ppsA[F-e-1].x,-j.ppsA[F-e-1].y,j.ppsA[F-e-1].z);J.push(f)}for(var v,e=0;e<H;e++){if(v=j.ppsC[H-e-1].x,v-x>w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v;var f=new THREE.Vector3(j.ppsC[H-e-1].x,-j.ppsC[H-e-1].y,j.ppsC[H-e-1].z);J.push(f)}for(var v,e=0;e<E;e++){if(v=j.pps0[E-e-1].x,v-x>w)for(var r=0;r<=q;r++){var s=r/q*v+(q-r)/q*x,t=-B0/I0*(j.targetX-s);t=Math.exp(t)-s*s;var u=Math.sqrt(t);J.push(new THREE.Vector3(s,u,0))}x=v;var f=new THREE.Vector3(j.pps0[E-e-1].x,-j.pps0[E-e-1].y,j.pps0[E-e-1].z);J.push(f)}}if(bArrows[3*b].visible=!1,bArrows[3*b+1].visible=!1,bArrows[3*b+2].visible=!1,b<a.lxNN){var y=J.length;j.clear(),j.visible=b<a.lxNN;for(var e=0;e<y;e++)j.addPoint(J[e].x,J[e].y,J[e].z);if(j.update(),0<y){var z=bArrows[3*b];z.visible=world2D.chBB.checked,z.position.x=J[Math.round(y/2)].x,z.position.y=J[Math.round(y/2)].y,z.position.z=0}}if(D.visible=L,L){var y=K.length;D.clear();for(var e=0;e<y;e++)D.addPoint(K[e].x,K[e].y,K[e].z);if(D.update(),0<y){var A=bArrows[3*b+1],B=bArrows[3*b+2];A.visible=B.visible=world2D.chBB.checked,B.position.x=K[0].x,B.position.y=K[0].y,A.position.x=K[Math.round(y/2)].x,A.position.y=K[Math.round(y/2)].y,B.position.z=A.position.z=0}}}}function setLinePX(a,b,c){let d=-50+100*((b+.5)/allTheLines.lxNN)-I0/B0*Math.log(400+Math.pow(-50+100*((b+.5)/allTheLines.lxNN)-wireX*I0pn,2))-wireX*I0pn;a.targetX=d,a.ix=b;let e=100,f=.01,g=150,h=-150,i=Math.pow(I0/B0,2)-c*c;if(0>i&&b<allTheLines.lxNN){for(var j=g,k=h,l=phiBB(j,c)-d,m=phiBB(k,c)-d,n=0;n<e&&j-k>f;){var o=.5*(j+k),p=phiBB(o,c)-d;0>=l*p?(k=o,m=p):0>=m*p?(j=o,l=p):log("\u52D8\u6839\u51FA\u932F!!"),n++}var q=new THREE.Vector3(o,c,0);a.hasCross?a.pps1.push(q):a.pps0.push(q)}else{var k=h,r=I0/B0-Math.sqrt(i),m=phiBB(k,c)-d,s=phiBB(r,c)-d,n=0;if(0<=m*s);else{for(var t=.5*(k+r);n<e&&r-k>f;){t=.5*(k+r);var p=phiBB(t,c)-d;0>=s*p?(k=t,m=p):0>=m*p?(r=t,s=p):log("A\u52D8\u6839\u51FA\u932F!!"),n++}var q=new THREE.Vector3(t,c,0);a.ppsA.push(q)}var u=I0/B0+Math.sqrt(i),r=I0/B0-Math.sqrt(i),v=phiBB(u,c)-d,s=phiBB(r,c)-d,n=0;if(0<=v*s);else{for(var w=.5*(u+r);n<e&&u-r>f;){w=.5*(u+r);var p=phiBB(w,c)-d;0>=s*p?(u=w,v=p):0>=v*p?(r=w,s=p):log("B\u52D8\u6839\u51FA\u932F!!"+b),n++}var q=new THREE.Vector3(w,c,0);a.ppsB.push(q)}var j=g,u=I0/B0+Math.sqrt(i),l=phiBB(j,c)-d,v=phiBB(u,c)-d,n=0;if(0<=l*v);else{for(var x=.5*(j+u);n<e&&j-u>f;){x=.5*(j+u);var p=phiBB(x,c)-d;0>=l*p?(u=x,v=p):0>=v*p?(j=x,l=p):log("C\u52D8\u6839\u51FA\u932F!!"+b),n++}var q=new THREE.Vector3(x,c,0);a.ppsC.push(q)}}}function phiBB(a,b){let c=-I0/B0*Math.log(a*a+b*b)+a;return c}function loadModel(){const a=new THREE.GLTFLoader;a.load("allData/js/model3D/punch.gltf",function(a){theWires2.hand2Model=a.scene,wireBar.add(a.scene),theWires2.hand2Model.scale.x=theWires2.hand2Model.scale.y=theWires2.hand2Model.scale.z=2.8,theWires2.hand2Model.rotation.x=Math.PI/2,theWires2.hand2Model.position.x=2.5,theWires2.hand2Model.position.z=-8,theWires2.hand2Model.position.y=0},function(a){console.log(100*(a.loaded/a.total)+"% loaded")},function(){console.log("An error happened")})}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=30,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=-20,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5,k=c||.5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var l=0;l<=16*h;l++)g.push(new THREE.Vector3(j*Math.cos(2*l*Math.PI/16),f*(.05+.9*l/h/16),j*Math.sin(2*l*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let m=new THREE.CatmullRomCurve3(g),n=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),o=new THREE.TubeGeometry(m,200,k,12);this.mesh=new THREE.Mesh(o,n),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh),this.nn=h,this.rB=j,this.rS=k,this.bar1=new TEACHER.ObjCylinder(k,100,e||16711935,!1,"y"),this.bar2=new TEACHER.ObjCylinder(k,100,e||16711935,!1,"x"),this.bar3=new TEACHER.ObjCylinder(k,100,e||16711935,!1,"x"),this.bar4=new TEACHER.ObjCylinder(k,100,e||16711935,!1,"y"),this.rotX.add(this.bar1).add(this.bar2).add(this.bar3).add(this.bar4)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}setSpringNew(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);if(0<d){this.rotX.visible=!0;let a=e,b=[],c=this.nn,d=this.rB,g=this.rS;b.push(new THREE.Vector3(0,0,0)),b.push(new THREE.Vector3(0,.05*a,0));for(var f=0;f<=16*c;f++)b.push(new THREE.Vector3(d*Math.cos(2*f*Math.PI/16),a*(.05+.9*f/c/16),d*Math.sin(2*f*Math.PI/16)));b.push(new THREE.Vector3(0,.95*a,0)),b.push(new THREE.Vector3(0,a,0));let h=new THREE.CatmullRomCurve3(b),i=new THREE.TubeGeometry(h,500,g,12);this.mesh.geometry=i}else this.rotX.visible=!1;this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}setSpringNew222(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);if(0<d){this.rotX.visible=!0;let a=this.nn,b=this.rB,c=this.rS;const d=this.mesh.geometry.attributes.position.array;for(var f=0;201>f;f++)for(var g=2*(f/200*a)*Math.PI,h=b*Math.cos(g),k=.8*e*f/200+.1*e,l=b*Math.sin(g),m=0;13>m;m++){var n=-2*Math.PI/12*m+Math.PI,o=h+c*Math.cos(n)*Math.cos(g),p=k+c*Math.sin(n),q=l+c*Math.cos(n)*Math.sin(g);d[3*(13*f)+3*m]=o,d[3*(13*f)+3*m+1]=p,d[3*(13*f)+3*m+2]=q}this.bar1.scale.y=this.bar4.scale.y=.1*e/100,this.bar2.scale.x=this.bar3.scale.x=b/100,this.bar1.position.y=.1*e/2,this.bar4.position.y=e*(1-.1/2),this.bar2.position.y=.1*e,this.bar3.position.y=e*(1-.1),this.bar2.position.x=this.bar3.position.x=.5*b}else this.rotX.visible=!1;this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c),this.mesh.geometry.attributes.position.needsUpdate=!0,this.mesh.geometry.computeVertexNormals()}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");world3D.scene.add(ground);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}TEACHER.CCC=class{constructor(a){this.name=a}},init();