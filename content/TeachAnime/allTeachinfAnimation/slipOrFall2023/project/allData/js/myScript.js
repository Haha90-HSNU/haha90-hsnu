'use strict';var engine,render,runner,mGround,mGround2,mGround3,mSBox,thePlane,boxes,singleBox,canvasGround,fps=60,log=console.log,isSingle=!0,isRising=!1,isWireframe=!1,Engine=Matter.Engine,Render=Matter.Render,Runner=Matter.Runner,Bodies=Matter.Bodies,Body=Matter.Body,Constraint=Matter.Constraint,Composite=Matter.Composite,Composites=Matter.Composites,MouseConstraint=Matter.MouseConstraint,Mouse=Matter.Mouse,mBoxes=[],sbW=100,sbH=100,mus=.8,ttt=200,dt=.2;function init(){initMatter(),thePlane=new THREE.Object3D,canvasGround=new ObjCanvasPlane(60,100,"y"),canvasGround.position.y=1,canvasGround.rotation.x=-Math.PI/2,canvasGround.position.x=30,thePlane.add(canvasGround);var a=new TEACHER.ObjPlane(60,2,6710886,"z");a.position.x=30,a.position.z=50,thePlane.add(a),a=new TEACHER.ObjPlane(60,2,6710886,"z"),a.position.x=30,a.position.z=-50,a.rotation.y=Math.PI,thePlane.add(a),a=new TEACHER.ObjPlane(100,2,6710886,"x"),a.position.x=60,thePlane.add(a),a=new TEACHER.ObjPlane(60,100,6710886,"y"),a.position.x=30,a.position.y=-1,a.rotation.x=Math.PI,thePlane.add(a),scene.add(thePlane),a=new TEACHER.ObjPlane(60,2,6710886,"z"),a.position.x=-30,a.position.z=50,scene.add(a),a=new TEACHER.ObjPlane(60,2,6710886,"z"),a.position.x=-30,a.position.z=-50,a.rotation.y=Math.PI,scene.add(a),a=new TEACHER.ObjPlane(100,2,6710886,"x"),a.position.x=-60,a.rotation.y=Math.PI,scene.add(a),a=new TEACHER.ObjPlane(60,100,6710886,"y"),a.position.x=-30,a.position.y=-1,a.rotation.x=Math.PI,scene.add(a),a=new TEACHER.ObjPlane(60,100,6710886,"y"),a.position.x=-30,a.position.y=1,scene.add(a),a=new TEACHER.ObjBox(120,120,100,6710886),a.position.y=-61,scene.add(a),a=new TEACHER.ObjCylinder(1,100,6710886,!1,"z"),scene.add(a),boxes=[];let b=.6;for(var c=0;7>c;c++){let a=new THREE.Color;a.setHSL(c/7,1,.65);let e=new THREE.Object3D;e.position.x=60,e.position.y=3*(10-c)/2+1,e.position.z=100*(c+.5)/7-50,e.sBox=new TEACHER.ObjBox(.1*(30+30*c),.1*(210-30*c),10,a.getHex()),e.add(e.sBox),e.wires=[];for(var d=0;4>d;d++){let f=new TEACHER.ObjBox(.1*(30+30*c),b,b,a.getHex());f.position.y=(.1*.5*(210-30*c)-.5*b)*(2>d?1:-1),f.position.z=(5-.5*b)*(0==d%2?1:-1),e.add(f),e.wires.push(f),f=new TEACHER.ObjBox(b,.1*(210-30*c),b,a.getHex()),f.position.x=(.1*.5*(30+30*c)-.5*b)*(2>d?1:-1),f.position.z=(5-.5*b)*(0==d%2?1:-1),e.add(f),e.wires.push(f),f=new TEACHER.ObjBox(b,b,10,a.getHex()),f.position.x=(.1*.5*(30+30*c)-.5*b)*(2>d?1:-1),f.position.y=(.1*.5*(210-30*c)-.5*b)*(0==d%2?1:-1),e.add(f),e.wires.push(f)}e.arrow=new TEACHER.ObjArrow(.8,16777215),e.arrow.setArrow(0,-10,0),e.add(e.arrow),scene.add(e),boxes.push(e)}singleBox=new THREE.Object3D,singleBox.L0=20,singleBox.position.x=60+.5*singleBox.L0,singleBox.position.y=.5*singleBox.L0,singleBox.position.z=0,singleBox.sBox=new TEACHER.ObjBox(singleBox.L0,singleBox.L0,singleBox.L0,65535),singleBox.add(singleBox.sBox),singleBox.wires=[];for(var d=0;4>d;d++){let a=new TEACHER.ObjBox(singleBox.L0,b,b,65535);a.position.y=(.5*singleBox.L0-.5*b)*(2>d?1:-1),a.position.z=(.5*singleBox.L0-.5*b)*(0==d%2?1:-1),singleBox.add(a),singleBox.wires.push(a),a=new TEACHER.ObjBox(b,singleBox.L0,b,65535),a.position.x=(.5*singleBox.L0-.5*b)*(2>d?1:-1),a.position.z=(.5*singleBox.L0-.5*b)*(0==d%2?1:-1),singleBox.add(a),singleBox.wires.push(a),a=new TEACHER.ObjBox(b,b,singleBox.L0,65535),a.position.x=(.5*singleBox.L0-.5*b)*(2>d?1:-1),a.position.y=(.5*singleBox.L0-.5*b)*(0==d%2?1:-1),singleBox.add(a),singleBox.wires.push(a)}singleBox.arrow=new TEACHER.ObjArrow(.8,16776960),singleBox.arrow.setArrow(0,-10,0),singleBox.add(singleBox.arrow),scene.add(singleBox),world2D.btnRise.on("mousedown",btnRiseDown),world2D.btnReset.on("mousedown",clickReset),world2D.on("pressup",myUp),world2D.slHD.value=50,world2D.slMus.minimum=0,world2D.slMus.maximum=160,world2D.slMus.digitN=1,world2D.slMus.value=1<mus?10*(mus-1)+90:100*(mus-.1),world2D.rb01.on("click",clickRB),world2D.rb02.on("click",clickRB),world2D.rb01.checked=isSingle,world2D.rb02.checked=!isSingle,world2D.chCircle.checked=!0,world2D.slCameraRR.value=150,setInterval(tick,1e3/fps)}function tick(){ttt--,140<ttt||0<ttt&&(world2D.title.scaleX=world2D.title.scaleY=1.5*ttt/140+.4*(140-ttt)/140,world2D.title.x=800*ttt/140+200*(140-ttt)/140,world2D.title.y=450*ttt/140+60*(140-ttt)/140),isWireframe=world2D.chWireframe.checked,mGround.angle>-.1*Math.PI/180&&(mus=90>world2D.slMus.value?.1+world2D.slMus.value/100:1+(world2D.slMus.value-90)/10),updateMatter(),world2D.theCircle.visible=world2D.chCircle.checked,world2D.theCircle.cPointer.x=world2D.theCircle.cPointer.y=0,world2D.theCircle.cPointer.rotation=180*mGround.angle/Math.PI,world2D.theCircle.tagMus.x=160*Math.cos(Math.atan(mus)),world2D.theCircle.tagMus.y=-160*Math.sin(Math.atan(mus)),world2D.theCircle.tagMus.rotation=-180*Math.atan(mus)/Math.PI,world2D.theCircle.tagMus.visible=isWireframe;for(var a=0;7>a;a++){world2D.theCircle["tagHD"+(a+1)].gotoAndStop(a+1);let b=(30+30*a)/(210-30*a);world2D.theCircle["tagHD"+(a+1)].x=160*Math.cos(Math.atan(b)),world2D.theCircle["tagHD"+(a+1)].y=-160*Math.sin(Math.atan(b)),world2D.theCircle["tagHD"+(a+1)].rotation=-180*Math.atan(b)/Math.PI,world2D.theCircle["tagHD"+(a+1)].scaleX=world2D.theCircle["tagHD"+(a+1)].scaleY=.6,world2D.theCircle["tagHD"+(a+1)].visible=!isSingle&&isWireframe}world2D.theCircle.tagHD8.gotoAndStop(8),world2D.theCircle.tagHD8.x=160*Math.cos(Math.atan(sbW/sbH)),world2D.theCircle.tagHD8.y=-160*Math.sin(Math.atan(sbW/sbH)),world2D.theCircle.tagHD8.rotation=-180*Math.atan(sbW/sbH)/Math.PI,world2D.theCircle.tagHD8.visible=isSingle&&isWireframe,showAngle(),thePlane.rotation.z=-mGround.angle;for(var a=0;7>a;a++){let c=boxes[a],d=mBoxes[a];c.visible=!isSingle,c.position.x=.1*(d.position.x-800),c.position.y=-.1*(d.position.y-800),c.rotation.z=-d.angle,c.arrow.rotation.z=d.angle,c.sBox.visible=!isWireframe,c.arrow.visible=isWireframe;let e=c.wires.length;for(var b=0;b<e;b++)c.wires[b].visible=isWireframe}singleBox.visible=isSingle,singleBox.position.x=.1*(mSBox.position.x-800),singleBox.position.y=-.1*(mSBox.position.y-800),singleBox.rotation.z=-mSBox.angle,singleBox.arrow.rotation.z=mSBox.angle,singleBox.sBox.scale.x=.1*sbW/singleBox.L0,singleBox.sBox.scale.y=.1*sbH/singleBox.L0;let c=.6;for(var b=0;12>b;b++)0==b%3?(singleBox.wires[b].scale.x=.1*sbW/singleBox.L0,singleBox.wires[b].position.y=(.05*sbH-.5*c)*(1<Math.round(b/3)?1:-1)):1==b%3?(singleBox.wires[b].scale.y=.1*sbH/singleBox.L0,singleBox.wires[b].position.x=(.05*sbW-.5*c)*(1<Math.round((b-1)/3)?1:-1)):2==b%3&&(singleBox.wires[b].position.x=(.05*sbW-.5*c)*(0==Math.round((b-2)/3)%2?1:-1),singleBox.wires[b].position.y=(.05*sbH-.5*c)*(1<Math.round((b-2)/3)?1:-1));singleBox.sBox.visible=!isWireframe,singleBox.arrow.visible=isWireframe;let d=singleBox.wires.length;for(var b=0;b<d;b++)singleBox.wires[b].visible=isWireframe;canvasGround.updateCanvasGround(),!mGround.angle>-.1*Math.PI/180&&(world2D.slHD.value=(sbW-150)/2.5+50,world2D.slMus.value=1<mus?10*(mus-1)+90:100*(mus-.1)),world2D.slMus.valueText.text=1>mus?digit12(mus,2):digit12(mus,1),world2D.slHD.valueText.text=Math.round(sbW/5)+"/"+Math.round(sbH/5)+"",world3D.cameraTarget.x=20*Math.cos(mGround.angle),world3D.cameraTarget.y=-20*Math.sin(mGround.angle),world3D.render(),world2D.stage.update()}MyJS.myResize();function btnRiseDown(){isRising=!0}function myUp(){isRising=!1}function clickReset(){resetMatter()}function clickRB(a){var b=a.target.parent.name;isSingle=!("rb01"!==b),world2D.rb01.checked=isSingle,world2D.rb02.checked=!isSingle}function showAngle(){let a=Math.round(10*(180*-mGround.angle/Math.PI));world2D.theCircle.cNumber.nA.gotoAndStop(Math.floor(a/100)),world2D.theCircle.cNumber.nB.gotoAndStop(Math.floor(a/10)-10*Math.floor(a/100)),world2D.theCircle.cNumber.nC.gotoAndStop(a-10*Math.floor(a/10)),world2D.theCircle.cNumber.nA.visible=99<a,canvasGround.groundTexture.cNumber.nA.gotoAndStop(Math.floor(a/100)),canvasGround.groundTexture.cNumber.nB.gotoAndStop(Math.floor(a/10)-10*Math.floor(a/100)),canvasGround.groundTexture.cNumber.nC.gotoAndStop(a-10*Math.floor(a/10)),canvasGround.groundTexture.cNumber.nA.visible=99<a}function digit12(a,b){let c;return 1===b?(c=Math.round(10*mus)/10+"","."!==c.slice(-2).charAt(0)&&(c+=".0")):2==b&&(c=Math.round(100*mus)/100+"","."!==c.slice(-3).charAt(0)&&(c+="0")),c}function initMatter(){engine=Engine.create(),engine.constraintIterations=10,engine.positionIterations=20,engine.gravity.y=2,render=Render.create({engine:engine,options:{width:1600,height:900,pixelRatio:1,background:"transparent",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!1,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!0,showCollisions:!0,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}}),mGround=Bodies.rectangle(800,800,1200,20,{isStatic:!0,collisionFilter:{mask:510}}),mGround2=Bodies.rectangle(800,800,600,22,{isStatic:!0,collisionFilter:{mask:510}}),mGround3=Bodies.rectangle(800,800,1200,20,{isStatic:!0,collisionFilter:{mask:510}}),mGround.friction=mGround2.friction=mGround3.friction=0,Composite.add(engine.world,[mGround,mGround2,mGround3]);for(var a=0;7>a;a++){let b=Bodies.rectangle(1115+15*a,685+15*a,30+30*a,210-30*a,{collisionFilter:{category:Math.pow(2,a+1),mask:1}});b.friction=0,b.frictionAir=0,b.motionMD=0,b.disNow=300,mBoxes.push(b),Composite.add(engine.world,[b])}mSBox=Bodies.rectangle(1100+.5*sbW,790-.5*sbH,sbW,sbH,{collisionFilter:{category:256,mask:1}}),mSBox.motionMD=0,mSBox.friction=0,mSBox.frictionAir=0,mSBox.disNow=300,Composite.add(engine.world,[mSBox]),Render.run(render),runner=Runner.create();var b=Mouse.create(render.canvas),c=MouseConstraint.create(engine,{mouse:b,constraint:{stiffness:.2,render:{visible:!0}}});Composite.add(engine.world,c),render.mouse=b}function updateMatter(){if(mGround.angle>-70*Math.PI/180&&isRising)Matter.Body.rotate(mGround,-.05*Math.PI/180),Matter.Body.rotate(mGround2,-.05*Math.PI/180);else if(mGround.angle>-89*Math.PI/180&&isRising)Matter.Body.rotate(mGround,-.02*Math.PI/180),Matter.Body.rotate(mGround2,-.02*Math.PI/180);else if(mGround.angle>-.1*Math.PI/180&&!isRising){world2D.slHD.value=5*Math.round(world2D.slHD.value/5),sbW=150+2.5*(world2D.slHD.value-50),sbH=150-2.5*(world2D.slHD.value-50);for(var a=0;7>a;a++){let b=mBoxes[a];b.motionMD=0,Matter.Body.setPosition(b,{x:1115+15*a+.1,y:685+15*a}),Matter.Body.setVelocity(b,{x:0,y:0}),Matter.Body.setSpeed(b,0),Matter.Body.setAngle(b,0),Matter.Body.setAngularSpeed(b,0),Matter.Body.setAngularVelocity(b,0)}mSBox.motionMD=0;let b=mSBox.vertices[1].x-mSBox.vertices[0].x,c=mSBox.vertices[3].y-mSBox.vertices[0].y;Matter.Body.scale(mSBox,sbW/b,sbH/c),Matter.Body.setPosition(mSBox,{x:1100+.5*sbW,y:790-.5*sbH}),Matter.Body.setVelocity(mSBox,{x:0,y:0}),Matter.Body.setSpeed(mSBox,0),Matter.Body.setAngle(mSBox,0),Matter.Body.setAngularSpeed(mSBox,0),Matter.Body.setAngularVelocity(mSBox,0)}let b=mGround.angle;for(var a=0;7>a;a++){let b=mBoxes[a];b.disNow=Math.sqrt(Math.pow(b.vertices[3].x-800,2)+Math.pow(b.vertices[3].y-800,2))*(0<b.vertices[3].x-800?1:-1),b.angle-mGround.angle<-5*Math.PI/180&&0===b.motionMD?b.motionMD=1:298>b.disNow&&0===b.motionMD&&(b.motionMD=2)}mSBox.disNow=Math.sqrt(Math.pow(mSBox.vertices[3].x-800,2)+Math.pow(mSBox.vertices[3].y-800,2))*(0<mSBox.vertices[3].x-800?1:-1),mSBox.angle-mGround.angle<-5*Math.PI/180&&0===mSBox.motionMD?mSBox.motionMD=1:298>mSBox.disNow&&0===mSBox.motionMD&&(mSBox.motionMD=2),Math.tan(-b)>mus&&Matter.Body.setPosition(mGround2,{x:800,y:11800}),Runner.tick(runner,engine)}function resetMatter(){Matter.Body.setPosition(mGround,{x:800,y:800}),Matter.Body.setPosition(mGround2,{x:800,y:800}),Matter.Body.setPosition(mGround3,{x:800,y:800}),Matter.Body.setVelocity(mGround,{x:0,y:0}),Matter.Body.setVelocity(mGround2,{x:0,y:0}),Matter.Body.setVelocity(mGround3,{x:0,y:0}),Matter.Body.setAngle(mGround,0),Matter.Body.setAngle(mGround2,0),mGround.friction=mGround2.friction=mGround3.friction=0}var ObjCanvasPlane=class extends THREE.Object3D{constructor(a,b){super();let c=this,d=5;c.w=a||100,c.h=b||100,c.canvas=document.createElement("canvas"),c.canvas.width=c.w*d,c.canvas.height=c.h*d,c.stage=new createjs.Stage(c.canvas),c.groundTexture=new lib.groundTexture,c.groundTexture.scaleX=c.groundTexture.scaleY=d,c.stage.addChild(c.groundTexture),c.stage.update(),c.mapTexture=new THREE.Texture(c.canvas),c.mapTexture.needsUpdate=!0,c.mapMaterial=new THREE.MeshStandardMaterial({map:c.mapTexture,side:0,roughness:.6,transparent:!0}),c.mesh=new THREE.Mesh(new THREE.PlaneGeometry(c.w,c.h,1,1),c.mapMaterial),c.add(c.mesh)}updateCanvasGround(){let a=this;for(var b=0;8>b;b++){7>b?mBoxes[b]:mSBox;a.groundTexture["rTA"+(b+1)].visible=a.groundTexture["rTB"+(b+1)].visible=a.groundTexture["tL"+(b+1)].visible=!1}if(isSingle&&isWireframe)a.groundTexture.rTA8.visible=!0,a.groundTexture.rTB8.visible=2===mSBox.motionMD,a.groundTexture.tL8.visible=!0,a.groundTexture.rTA8.scaleY=2,a.groundTexture.rTA8.scaleX=2/10,a.groundTexture.rTB8.scaleY=2,a.groundTexture.rTB8.scaleX=Math.min(0<300-mSBox.disNow&&0<mSBox.disNow?300-mSBox.disNow:200,200)/100,a.groundTexture.rTA8.x=30,a.groundTexture.rTA8.y=50,a.groundTexture.rTB8.x=30-5*a.groundTexture.rTB8.scaleX,a.groundTexture.rTB8.y=50,a.groundTexture.tL8.rotation=90,a.groundTexture.tL8.x=20,a.groundTexture.tL8.y=50,a.groundTexture.tL8.gotoAndStop(mSBox.motionMD);else if(!isSingle&&isWireframe)for(var b=0;7>b;b++){let c=mBoxes[b];a.groundTexture["rTA"+(b+1)].visible=!0,a.groundTexture["rTB"+(b+1)].visible=2===c.motionMD,a.groundTexture["tL"+(b+1)].visible=!0,a.groundTexture["rTA"+(b+1)].scaleY=1,a.groundTexture["rTA"+(b+1)].scaleX=2/10,a.groundTexture["rTB"+(b+1)].scaleY=1,a.groundTexture["rTB"+(b+1)].scaleX=Math.min(0<300-c.disNow&&0<c.disNow?300-c.disNow:200,200)/100,a.groundTexture["rTA"+(b+1)].x=30,a.groundTexture["rTA"+(b+1)].y=100*(b+.5)/7,a.groundTexture["rTB"+(b+1)].x=30-5*a.groundTexture["rTB"+(b+1)].scaleX,a.groundTexture["rTB"+(b+1)].y=100*(b+.5)/7,a.groundTexture["tL"+(b+1)].rotation=90,a.groundTexture["tL"+(b+1)].x=20,a.groundTexture["tL"+(b+1)].y=100*(b+.5)/7,a.groundTexture["tL"+(b+1)].gotoAndStop(c.motionMD)}a.stage.update(),a.mapTexture.needsUpdate=!0}},TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y"),logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();