"use strict";var conRZ,arrowMg,arrowFc,arrowNA,arrowNB,arrowNC,arrowND,arrowFA,arrowFB,arrowFC,arrowFD,arrowMgFc,circleFs,theGroundPlane,fps=60,log=console.log,ttTitle=120,gameMD=0,bikeDriverMD=1,mCannonWorlds=[],theBikes=[],theDrivers=[],vv=0,vvOld=vv,curveture=0,curvetureTarget=0,gg=10,pressingDir="X",tt=0,dt=1/60,fallTime=0;function init(){conRZ=new THREE.Object3D,scene.add(conRZ);for(let e=0;e<=4;e++){let o=new CannonWorld,n=new OneBike(o.world,e),i=new OneRagDoll(new CANNON.Vec3(0,1.5,2),o.world,0,0,0,e,0===e||2===e,0===e);o.connectBikeAndDriver(e,n,i),mCannonWorlds.push(o),theBikes.push(n),theDrivers.push(i)}initArrows(),theGroundPlane=new GroundPlane,scene.add(theGroundPlane);let e=new TEACHER.ObjPicCylinder(80,16,pics.wallSide,!0,"y",1);e.position.y=8,scene.add(e),world2D.btnBike00.on("click",clickBikeBtn),world2D.btnBike01.on("click",clickBikeBtn),world2D.btnBike02.on("click",clickBikeBtn),world2D.btnBike03.on("click",clickBikeBtn),world2D.btnBike04.on("click",clickBikeBtn),world2D.btn01.on("click",clickBtn),world2D.btn01.setLabel("出!!"),world2D.btnReset.on("click",clickBtn),world2D.btnRight.on("mousedown",downDirBtn),world2D.btnLeft.on("mousedown",downDirBtn),world2D.btnUp.on("mousedown",downDirBtn),world2D.btnDown.on("mousedown",downDirBtn),world2D.on("pressup",myUp),world2D.slMus.minimum=.8,world2D.slMus.maximum=2,world2D.slMus.digitN=1,world2D.slMus.value=1.2,world2D.slCameraRR.value=50,resetGame(),setInterval(tick,1e3/fps)}function tick(){--ttTitle>0&&ttTitle<80&&(world2D.title.x=(800*ttTitle+220*(80-ttTitle))/80,world2D.title.y=(450*ttTitle+80*(80-ttTitle))/80,world2D.title.scaleX=world2D.title.scaleY=(1.8*ttTitle+.6*(80-ttTitle))/80),tt++;let e=mCannonWorlds[bikeDriverMD],o=theBikes[bikeDriverMD],n=theDrivers[bikeDriverMD];if(world2D.slMus.visible=bikeDriverMD<3,world2D.musInfinity.visible=bikeDriverMD>=3,0===gameMD)if("btnRight"===pressingDir?curvetureTarget+=5e-4*(bikeDriverMD<3?1:4):"btnLeft"===pressingDir&&(curvetureTarget-=5e-4*(bikeDriverMD<3?1:4)),curveture=.95*curveture+.05*curvetureTarget,"btnUp"===pressingDir?(vv+=.1)>60&&bikeDriverMD<3?vv=60:vv>30&&(vv=30):"btnDown"===pressingDir&&((vv-=.1)<10&&bikeDriverMD<3?vv=10:vv<5&&(vv=5)),bikeDriverMD<3){let e=vv*vv*curveture/gg;Math.abs(e)>world2D.slMus.value&&(bikeFall(),fallTime=0)}else{Math.abs(o.bikeBody.quaternion.toAxisAngle()[1])>.1&&(bikeFall(),fallTime=0)}else if(1===gameMD)if(vv>.1?(vv-=.1,curveture*=.995):vv=0,e.world.gravity.z*=.9,e.world.gravity.x*=.9,conRZ.rotation.z*=.9,fallTime++,0===bikeDriverMD){let n=4e3/(10+fallTime);o.bikeBody.applyForce(new CANNON.Vec3(n*e.world.gravity.x,0,n*e.world.gravity.z),new CANNON.Vec3(0,0,0))}else if(1===bikeDriverMD||2===bikeDriverMD){let n=6e3/(10+fallTime);o.bikeBody.applyForce(new CANNON.Vec3(n*e.world.gravity.x,0,n*e.world.gravity.z),new CANNON.Vec3(0,0,0))}theGroundPlane.wheelGo(),theGroundPlane.updatePlane();let i=Math.atan(vv*vv*curveture/gg)*(bikeDriverMD<3?1:0)*(1===bikeDriverMD?.8:1),t=.3*Math.atan(vv*vv*curveture/gg);0===gameMD&&(bikeDriverMD<3&&(o.bikeBody.position.x=0,o.bikeBody.position.y=o.mcPosition.y*Math.cos(i),o.bikeBody.position.z=o.mcPosition.y*Math.sin(i),o.bikeBody.velocity.x=0,o.bikeBody.velocity.y=0,o.bikeBody.velocity.z=0,o.bikeBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),i)),o.at=(vv-vvOld)/dt,0===bikeDriverMD&&(conRZ.rotation.z=.9*conRZ.rotation.z-.1*Math.atan2(o.at,gg)),vvOld=vv,e.world.gravity.z=-vv*vv*curveture,curveture>0?(e.connectBAG("R",0),e.connectBAG("L",1)):curveture<0&&(e.connectBAG("R",1),e.connectBAG("L",0))),e.rotateJoint(t),e.updateCannon(),o.updateBike(),n.updateDoll(),1===bikeDriverMD||2===bikeDriverMD?o.wheelFObj.rotation.y=-Math.atan((o.wheelDisBack+o.wheelDisFront)*curveture/Math.cos(i)):3===bikeDriverMD?o.wheelFObj.rotation.y=-Math.atan((o.wheelDisBack+o.wheelDisFront)*curveture):4===bikeDriverMD&&(o.wheelFRObj.rotation.y=-Math.atan((o.wheelDisBack+o.wheelDisFront)/(-o.wheelWidthFront/2+1/curveture)),o.wheelFLObj.rotation.y=-Math.atan((o.wheelDisBack+o.wheelDisFront)/(+o.wheelWidthFront/2+1/curveture))),setArrows(),0===gameMD&&(world3D.cameraTarget.y=.98*world3D.cameraTarget.y+.02*n.headObj.position.y/2),world2D.btnReset.visible=1===gameMD,world3D.render(),world2D.stage.update()}function clickBtn(e){"btnReset"===e.target.name&&resetGame()}function bikeFall(){let e=theBikes[bikeDriverMD],o=theDrivers[bikeDriverMD],n=mCannonWorlds[bikeDriverMD];gameMD=1,n.world.gravity.x=2*Math.abs(n.world.gravity.z);let i=o.objsArray.length;if(0===bikeDriverMD)for(var t=0;t<i;t++){o.objsArray[t].body}else if(1===bikeDriverMD||2===bikeDriverMD){e.bikeBody.angularVelocity.set(1*(curveture<0?-1:1),-2*(curveture<0?-1:1),0);for(t=0;t<i;t++){o.objsArray[t].body.angularVelocity.set(1*(curveture<0?-1:1),-2*(curveture<0?-1:1),0)}}i=n.connectionArray.length;for(t=0;t<i;t++){let e=n.connectionArray[t];e.isConnected&&(n.world.removeConstraint(e),e.isConnected=!1)}n.connectBAG("R",0),n.connectBAG("L",0)}function downDirBtn(e){let o=e.target.parent.name;pressingDir=o}function myUp(){pressingDir="X"}function resetGame(){let e=theBikes[bikeDriverMD],o=theDrivers[bikeDriverMD],n=mCannonWorlds[bikeDriverMD];for(let e=0;e<=4;e++)theBikes[e].setVisible(e===bikeDriverMD),theDrivers[e].setVisible(e===bikeDriverMD);let i=n.connectionArray.length;for(var t=0;t<i;t++){let e=n.connectionArray[t];e.isConnected||(n.world.addConstraint(e),e.isConnected=!0)}n.connectBAG("R",1),n.connectBAG("L",1),e.bikeBody.position.x=0,e.bikeBody.position.y=e.mcPosition.y,e.bikeBody.position.z=0,e.bikeBody.velocity.x=0,e.bikeBody.velocity.y=0,e.bikeBody.velocity.z=0,e.bikeBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1,0,0),0),conRZ.rotation.z=0,n.world.gravity.z=0,n.world.gravity.x=0,n.rotateJoint(0),n.updateCannon(),e.updateBike(),o.updateDoll(),4===bikeDriverMD?(e.wheelFRObj.rotation.y=0,e.wheelFLObj.rotation.y=0):bikeDriverMD>0&&(e.wheelFObj.rotation.y=0),vvOld=vv=bikeDriverMD<3?20:10,curveture=0,curvetureTarget=0,theGroundPlane.resetTraces(),gameMD=0}function clickBikeBtn(e){let o=e.target.name;bikeDriverMD=parseInt(o.charAt(8)),resetGame()}function initArrows(){let e=.06;arrowMg=new TEACHER.ObjArrow(e,16711680),arrowFc=new TEACHER.ObjArrow(e,16776960),arrowNA=new TEACHER.ObjArrow(e,16711680),arrowNB=new TEACHER.ObjArrow(e,16711680),arrowNC=new TEACHER.ObjArrow(e,16711680),arrowND=new TEACHER.ObjArrow(e,16711680),arrowFA=new TEACHER.ObjArrow(e,16776960),arrowFB=new TEACHER.ObjArrow(e,16776960),arrowFC=new TEACHER.ObjArrow(e,16776960),arrowFD=new TEACHER.ObjArrow(e,16776960),arrowMgFc=new TEACHER.ObjArrow(e,16750848),circleFs=new TEACHER.Line(16776960,3,65),scene.add(circleFs);for(var o=0;o<65;o++)circleFs.addPoint(10*Math.cos(o/64*2*Math.PI),0,10*Math.sin(o/64*2*Math.PI));scene.add(arrowMg).add(arrowFc).add(arrowNA).add(arrowNB).add(arrowNC).add(arrowND).add(arrowFA).add(arrowFB).add(arrowFC).add(arrowFD).add(arrowMgFc)}function setArrows(){let e,o,n=theBikes[bikeDriverMD],i=world2D.chArrows.checked&&0===gameMD;if(world2D.chCombine.visible=i,0===bikeDriverMD?(e=1.6,o=-.2):1===bikeDriverMD?(e=1.2,o=0):2===bikeDriverMD?(e=1.5,o=-.2):3===bikeDriverMD?(e=.8,o=0):4===bikeDriverMD&&(e=.6,o=.2),arrowMg.setArrow(0,.1*-gg,0),bikeDriverMD>0){let e=Math.atan(n.wheelDisBack*curveture);arrowFc.setArrow(-n.at*Math.cos(e)*.1+vv*vv*curveture*Math.sin(e)*.1,0,n.at*Math.sin(e)*.1-vv*vv*curveture*Math.cos(e)*.1),arrowMgFc.setArrow(-n.at*Math.cos(e)*.1+vv*vv*curveture*Math.sin(e)*.1,.1*-gg,n.at*Math.sin(e)*.1-vv*vv*curveture*Math.cos(e)*.1)}else arrowFc.setArrow(.1*-n.at,0,-vv*vv*curveture*.1),arrowMgFc.setArrow(.1*-n.at,.1*-gg,-vv*vv*curveture*.1);if(arrowMgFc.position.x=arrowMg.position.x=arrowFc.position.x=-e*Math.sin(conRZ.rotation.z)+o,arrowMgFc.position.y=arrowMg.position.y=arrowFc.position.y=e*Math.cos(conRZ.rotation.z)*Math.cos(n.allObjs.rotation.x*(1===bikeDriverMD?1.25:1)),arrowMgFc.position.z=arrowMg.position.z=arrowFc.position.z=e*Math.cos(conRZ.rotation.z)*Math.sin(n.allObjs.rotation.x*(1===bikeDriverMD?1.25:1)),arrowMgFc.visible=i&&world2D.chCombine.checked,arrowMg.visible=arrowFc.visible=i&&!world2D.chCombine.checked,bikeDriverMD<3){let e=gg*world2D.slMus.value*.1;for(var t=0;t<65;t++)circleFs.setPoint(t,e*Math.cos(t/64*2*Math.PI),0,e*Math.sin(t/64*2*Math.PI));circleFs.update(),circleFs.position.x=arrowMgFc.position.x,circleFs.position.y=arrowMgFc.position.y,circleFs.position.z=arrowMgFc.position.z}if(circleFs.visible=bikeDriverMD<3&&i,0===bikeDriverMD)arrowFA.position.x=arrowFA.position.z=0,arrowNA.position.x=arrowNA.position.z=0,arrowFA.setArrow(.1*n.at,0,vv*vv*curveture*.1),arrowNA.setArrow(0,.1*gg,0),arrowNA.visible=arrowFA.visible=i,arrowNB.visible=arrowFB.visible=!1,arrowNC.visible=arrowFC.visible=!1,arrowND.visible=arrowFD.visible=!1;else if(bikeDriverMD<3){arrowNA.position.x=arrowFA.position.x=-n.wheelDisBack,arrowNA.position.z=arrowFA.position.z=0,arrowNB.position.x=arrowFB.position.x=+n.wheelDisFront,arrowNB.position.z=arrowFB.position.z=0;let o=Math.atan((n.wheelDisBack+n.wheelDisFront)*curveture);arrowFA.setArrow(.5*n.at*.1,0,vv*vv*curveture*.1*.5),arrowNA.setArrow(0,.1*(gg/2+.4*n.at*e/(n.wheelDisFront+n.wheelDisBack)),0),arrowFB.setArrow(.5*n.at*.1-vv*vv*curveture*Math.sin(o)*.1,0,vv*vv*curveture*Math.cos(o)*.1*.5),arrowNB.setArrow(0,.1*(gg/2-.4*n.at*e/(n.wheelDisFront+n.wheelDisBack)),0),arrowNA.visible=arrowFA.visible=i,arrowNB.visible=arrowFB.visible=i,arrowNC.visible=arrowFC.visible=!1,arrowND.visible=arrowFD.visible=!1}else if(3===bikeDriverMD){arrowNA.position.x=arrowFA.position.x=-n.wheelDisBack-n.mcPosition.x,arrowNA.position.z=arrowFA.position.z=+n.wheelWidthBack/2+.05,arrowNB.position.x=arrowFB.position.x=-n.wheelDisBack-n.mcPosition.x,arrowNB.position.z=arrowFB.position.z=-n.wheelWidthBack/2-.05,arrowNC.position.x=arrowFC.position.x=n.wheelDisFront-n.mcPosition.x,arrowNC.position.z=arrowFC.position.z=0;let o=Math.atan((n.wheelDisBack+n.wheelDisFront)*curveture);arrowFA.setArrow(.35*n.at*.1,0,(.35-.4*e/n.wheelWidthBack*(curveture<0?-1:1))*vv*vv*curveture*.1),arrowNA.setArrow(0,.1*(.35*gg+.16*n.at*e/n.wheelDisBack-.25*vv*vv*curveture*e/n.wheelWidthBack),0),arrowFB.setArrow(.35*n.at*.1,0,(.35+.4*e/n.wheelWidthBack*(curveture<0?-1:1))*vv*vv*curveture*.1),arrowNB.setArrow(0,.1*(.35*gg+.16*n.at*e/n.wheelDisBack+.25*vv*vv*curveture*e/n.wheelWidthBack),0),arrowFC.setArrow(.1*(.3*n.at*Math.cos(o)-.3*vv*vv*curveture*Math.sin(o)),0,.1*(.3*vv*vv*curveture*Math.cos(o)+.3*n.at*Math.sin(o))),arrowNC.setArrow(0,.1*(.3*gg-.15*n.at*e/n.wheelDisBack),0),arrowNA.visible=arrowFA.visible=i,arrowNB.visible=arrowFB.visible=i,arrowNC.visible=arrowFC.visible=i,arrowND.visible=arrowFD.visible=!1}else if(4===bikeDriverMD){arrowNA.position.x=arrowFA.position.x=-n.wheelDisBack-n.mcPosition.x,arrowNA.position.z=arrowFA.position.z=+n.wheelWidthBack/2+.05,arrowNB.position.x=arrowFB.position.x=-n.wheelDisBack-n.mcPosition.x,arrowNB.position.z=arrowFB.position.z=-n.wheelWidthBack/2-.05,arrowNC.position.x=arrowFC.position.x=+n.wheelDisFront-n.mcPosition.x,arrowNC.position.z=arrowFC.position.z=+n.wheelWidthFront/2+.05,arrowND.position.x=arrowFD.position.x=+n.wheelDisFront-n.mcPosition.x,arrowND.position.z=arrowFD.position.z=-n.wheelWidthFront/2-.05;let o=Math.atan((n.wheelDisBack+n.wheelDisFront)*curveture/(1-n.wheelWidthFront/2*curveture)),t=Math.atan((n.wheelDisBack+n.wheelDisFront)*curveture/(1+n.wheelWidthFront/2*curveture)),r=(.25-.45*e/n.wheelWidthBack*(curveture<0?-1:1))*vv*vv*curveture,s=(.25+.45*e/n.wheelWidthBack*(curveture<0?-1:1))*vv*vv*curveture;arrowFA.setArrow(.25*n.at*.1,0,.1*r),arrowNA.setArrow(0,.1*(.25*gg+.1*n.at*e/n.wheelDisBack-.1*vv*vv*curveture*e/n.wheelWidthBack),0),arrowFB.setArrow(.25*n.at*.1,0,.1*s),arrowNB.setArrow(0,.1*(.25*gg+.1*n.at*e/n.wheelDisBack+.1*vv*vv*curveture*e/n.wheelWidthBack),0),arrowFC.setArrow(.1*(.25*n.at*Math.cos(o)-r*Math.sin(o)),0,.1*(.25*n.at*Math.sin(o)+r*Math.cos(o))),arrowNC.setArrow(0,.1*(.25*gg-.1*n.at*e/n.wheelDisFront-.1*vv*vv*curveture*e/n.wheelWidthFront),0),arrowFD.setArrow(.1*(.25*n.at*Math.cos(t)-s*Math.sin(t)),0,.1*(.25*n.at*Math.sin(t)+s*Math.cos(t))),arrowND.setArrow(0,.1*(.25*gg-.1*n.at*e/n.wheelDisFront+.1*vv*vv*curveture*e/n.wheelWidthFront),0),arrowNA.visible=arrowFA.visible=i,arrowNB.visible=arrowFB.visible=i,arrowNC.visible=arrowFC.visible=i,arrowND.visible=arrowFD.visible=i}}MyJS.myResize();var GroundPlane=class extends THREE.Object3D{constructor(){super();let e=this;e.grid=new THREE.Object3D,e.gridRY=new THREE.Object3D,this.add(e.gridRY),e.gridRY.add(e.grid),e.gridRY.position.y=-.1,e.ddd=10;let o=new THREE.PlaneGeometry(e.ddd/2,e.ddd/2),n=new THREE.MeshBasicMaterial({color:6710886}),i=new THREE.MeshBasicMaterial({color:10066329});for(var t=-200;t<200;t+=e.ddd)for(var r=-200;r<200;r+=e.ddd){let s=new THREE.Mesh(o,n);s.rotation.x=-Math.PI/2;let a=new THREE.Mesh(o,i);a.rotation.x=-Math.PI/2;let c=new THREE.Mesh(o,i);c.rotation.x=-Math.PI/2;let h=new THREE.Mesh(o,n);h.rotation.x=-Math.PI/2,s.position.x=t,s.position.z=r,a.position.x=t+e.ddd/2,a.position.z=r,c.position.x=t,c.position.z=r+e.ddd/2,h.position.x=t+e.ddd/2,h.position.z=r+e.ddd/2,e.grid.add(s).add(a).add(c).add(h)}e.positionWheelA,e.positionWheelB,e.positionWheelC,e.positionWheelD,e.bikeDir=[1,0],e.traceNN=100,e.traceA=new TEACHER.Line(16711680,5,800),e.traceB=new TEACHER.Line(255,5,800),e.traceC=new TEACHER.Line(65280,5,800),e.traceD=new TEACHER.Line(16711935,5,800),scene.add(e.traceA).add(e.traceB).add(e.traceC).add(e.traceD),e.resetTraces()}resetTraces(){let e=this;e.bikeDir=[1,0];let o=theBikes[bikeDriverMD];0===bikeDriverMD?(e.positionWheelA=[0,0],e.positionWheelB=[],e.positionWheelC=[],e.positionWheelD=[]):1===bikeDriverMD?(e.positionWheelA=[o.wheelDisFront-o.mcPosition.x,0],e.positionWheelB=[-o.wheelDisBack-o.mcPosition.x,0],e.positionWheelC=[],e.positionWheelD=[]):2===bikeDriverMD?(e.positionWheelA=[o.wheelDisFront-o.mcPosition.x,0],e.positionWheelB=[-o.wheelDisBack-o.mcPosition.x,0],e.positionWheelC=[],e.positionWheelD=[]):3===bikeDriverMD?(e.positionWheelA=[-o.wheelDisBack-o.mcPosition.x,.5*o.wheelWidthBack],e.positionWheelB=[-o.wheelDisBack-o.mcPosition.x,-.5*o.wheelWidthBack],e.positionWheelC=[o.wheelDisFront-o.mcPosition.x,0],e.positionWheelD=[]):4===bikeDriverMD&&(e.positionWheelA=[-o.wheelDisBack-o.mcPosition.x,.5*o.wheelWidthBack],e.positionWheelB=[-o.wheelDisBack-o.mcPosition.x,-.5*o.wheelWidthBack],e.positionWheelC=[o.wheelDisFront-o.mcPosition.x,.5*o.wheelWidthFront],e.positionWheelD=[o.wheelDisFront-o.mcPosition.x,-.5*o.wheelWidthFront]),e.traceA.clear(),e.traceB.clear(),e.traceC.clear(),e.traceD.clear(),e.grid.position.x=0,e.grid.position.z=0,e.gridRY.rotation.y=0}wheelGo(){let e=this,o=vv*dt,n=o*curveture;0!=curveture&&(o=2*Math.sin(o/2*curveture)/curveture);let i=[o*Math.cos(n/2)*e.bikeDir[0],o*Math.cos(n/2)*e.bikeDir[1]],t=[o*Math.sin(n/2)*e.bikeDir[1],-o*Math.sin(n/2)*e.bikeDir[0]],r=Math.atan2(e.bikeDir[1],e.bikeDir[0]);e.bikeDir[0]=Math.cos(r+n),e.bikeDir[1]=Math.sin(r+n);let s=theBikes[bikeDriverMD];if(0===bikeDriverMD)e.positionWheelA[0]+=i[0]+t[0],e.positionWheelA[1]+=i[1]+t[1];else if(1===bikeDriverMD||2===bikeDriverMD)e.positionWheelB[0]+=i[0]+t[0],e.positionWheelB[1]+=i[1]+t[1],e.positionWheelA[0]=e.positionWheelB[0]+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[0],e.positionWheelA[1]=e.positionWheelB[1]+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[1];else if(3===bikeDriverMD){let o=.5*(e.positionWheelA[0]+e.positionWheelB[0]),n=.5*(e.positionWheelA[1]+e.positionWheelB[1]);o+=i[0]+t[0],n+=i[1]+t[1],e.positionWheelA[0]=o-.5*s.wheelWidthBack*e.bikeDir[1],e.positionWheelA[1]=n+.5*s.wheelWidthBack*e.bikeDir[0],e.positionWheelB[0]=o+.5*s.wheelWidthBack*e.bikeDir[1],e.positionWheelB[1]=n-.5*s.wheelWidthBack*e.bikeDir[0],e.positionWheelC[0]=o+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[0],e.positionWheelC[1]=n+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[1]}else if(4===bikeDriverMD){let o=.5*(e.positionWheelA[0]+e.positionWheelB[0]),n=.5*(e.positionWheelA[1]+e.positionWheelB[1]);o+=i[0]+t[0],n+=i[1]+t[1],e.positionWheelA[0]=o-.5*s.wheelWidthBack*e.bikeDir[1],e.positionWheelA[1]=n+.5*s.wheelWidthBack*e.bikeDir[0],e.positionWheelB[0]=o+.5*s.wheelWidthBack*e.bikeDir[1],e.positionWheelB[1]=n-.5*s.wheelWidthBack*e.bikeDir[0],e.positionWheelC[0]=o+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[0]-.5*s.wheelWidthFront*e.bikeDir[1],e.positionWheelC[1]=n+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[1]+.5*s.wheelWidthFront*e.bikeDir[0],e.positionWheelD[0]=o+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[0]+.5*s.wheelWidthFront*e.bikeDir[1],e.positionWheelD[1]=n+(s.wheelDisFront+s.wheelDisBack)*e.bikeDir[1]-.5*s.wheelWidthFront*e.bikeDir[0]}}updatePlane(){let e=this,o=theBikes[bikeDriverMD],n=0,i=0;if(0===bikeDriverMD)n=e.positionWheelA[0],i=e.positionWheelA[1];else if(1===bikeDriverMD||2===bikeDriverMD)n=.5*(e.positionWheelA[0]+e.positionWheelB[0])+o.mcPosition.x*this.bikeDir[0],i=.5*(e.positionWheelA[1]+e.positionWheelB[1])+o.mcPosition.x*this.bikeDir[1];else if(3===bikeDriverMD){let t=.5*(e.positionWheelA[0]+e.positionWheelB[0]),r=.5*(e.positionWheelA[1]+e.positionWheelB[1]);n=(o.wheelDisFront*t+o.wheelDisBack*e.positionWheelC[0])/(o.wheelDisFront+o.wheelDisBack)+o.mcPosition.x*this.bikeDir[0],i=(o.wheelDisFront*r+o.wheelDisBack*e.positionWheelC[1])/(o.wheelDisFront+o.wheelDisBack)+o.mcPosition.x*this.bikeDir[1]}else if(4===bikeDriverMD){let t=.5*(e.positionWheelA[0]+e.positionWheelB[0]),r=.5*(e.positionWheelA[1]+e.positionWheelB[1]),s=.5*(e.positionWheelC[0]+e.positionWheelD[0]),a=.5*(e.positionWheelC[1]+e.positionWheelD[1]);n=(o.wheelDisFront*t+o.wheelDisBack*s)/(o.wheelDisFront+o.wheelDisBack)+o.mcPosition.x*this.bikeDir[0],i=(o.wheelDisFront*r+o.wheelDisBack*a)/(o.wheelDisFront+o.wheelDisBack)+o.mcPosition.x*this.bikeDir[1]}e.grid.position.x=-n%e.ddd,e.grid.position.z=-i%e.ddd,e.gridRY.rotation.y=Math.atan2(e.bikeDir[1],e.bikeDir[0]),0===gameMD&&(0===bikeDriverMD?(e.traceA.addPoint(e.positionWheelA[0],0,e.positionWheelA[1]),e.traceA.update()):1===bikeDriverMD||2===bikeDriverMD?(e.traceA.addPoint(e.positionWheelA[0],0,e.positionWheelA[1]),e.traceB.addPoint(e.positionWheelB[0],0,e.positionWheelB[1]),e.traceA.update(),e.traceB.update()):3===bikeDriverMD?(e.traceA.addPoint(e.positionWheelA[0],0,e.positionWheelA[1]),e.traceB.addPoint(e.positionWheelB[0],0,e.positionWheelB[1]),e.traceC.addPoint(e.positionWheelC[0],0,e.positionWheelC[1]),e.traceA.update(),e.traceB.update(),e.traceC.update()):4===bikeDriverMD&&(e.traceA.addPoint(e.positionWheelA[0],0,e.positionWheelA[1]),e.traceB.addPoint(e.positionWheelB[0],0,e.positionWheelB[1]),e.traceC.addPoint(e.positionWheelC[0],0,e.positionWheelC[1]),e.traceD.addPoint(e.positionWheelD[0],0,e.positionWheelD[1]),e.traceA.update(),e.traceB.update(),e.traceC.update(),e.traceD.update())),e.traceA.position.x=e.traceB.position.x=e.traceC.position.x=e.traceD.position.x=-n*e.bikeDir[0]-i*e.bikeDir[1],e.traceA.position.z=e.traceB.position.z=e.traceC.position.z=e.traceD.position.z=-i*e.bikeDir[0]+n*e.bikeDir[1],e.traceA.rotation.y=e.traceB.rotation.y=e.traceC.rotation.y=e.traceD.rotation.y=Math.atan2(e.bikeDir[1],e.bikeDir[0]),e.traceA.visible=e.traceB.visible=e.traceC.visible=e.traceD.visible=world2D.chTrace.checked}};class CannonWorld{constructor(){let e=this;e.timeStep=1/60,e.world=new CANNON.World,e.world.gravity.set(0,-10,0),e.world.defaultContactMaterial.friction=.005;var o=new CANNON.Box(new CANNON.Vec3(500,50,500));e.groundBody=new CANNON.Body({mass:0,position:new CANNON.Vec3(0,-50,0),material:e.groundMaterial}),e.groundBody.addShape(o),e.world.addBody(e.groundBody)}updateCannon(){this.world.step(this.timeStep)}connectBikeAndDriver(e,o,n){let i=this;i.forceMax=1e6,i.forceMid=1e3,i.forceMin=10,i.monkeyY=.5-o.mcPosition.y,i.monkeyArray=[],i.connectionArray=[],i.connectionBAGArrayR=[],i.connectionBAGArrayL=[],0===e?(i.connectBAD0(o,n),i.connectBAG0(o)):1===e?(i.connectBAD1(o,n),i.connectBAG2(o)):2===e?(i.connectBAD2(o,n),i.connectBAG2(o)):3===e?(i.connectBAD3(o,n),i.connectBAG3(o)):4===e&&(i.connectBAD3(o,n),i.connectBAG4(o));let t=i.monkeyArray.length;for(var r=0;r<t;r++){let e=i.monkeyArray[r];e.rr=Math.sqrt(Math.pow(e.pivotB.y-i.monkeyY,2)+Math.pow(e.pivotB.z,2)),e.theta0=Math.atan2(e.pivotB.z,e.pivotB.y-i.monkeyY)}}connectBAD0(e,o){let n=this,i=e,t=o;n.connectHead=new CANNON.PointToPointConstraint(t.head,new CANNON.Vec3(0,0,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength+t.headRadius+t.neckLength-i.mcPosition.y,0),n.forceMax),n.connectionArray.push(n.connectHead),n.connectShoulderR=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(-.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectShoulderL=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectShoulderR),n.connectionArray.push(n.connectShoulderL),n.connectShoulder2R=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(-.5*t.shouldersDistance,-.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectShoulder2L=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(.5*t.shouldersDistance,-.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectShoulder2R),n.connectionArray.push(n.connectShoulder2L),n.connectElbowR=new CANNON.PointToPointConstraint(t.upperRightArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-t.upperArmLength-i.mcPosition.y,.5*+i.fBarW),n.forceMin),n.connectElbowL=new CANNON.PointToPointConstraint(t.upperLeftArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-t.upperArmLength-i.mcPosition.y,.5*-i.fBarW),n.forceMin),n.connectionArray.push(n.connectElbowR),n.connectionArray.push(n.connectElbowL),n.connectHandR=new CANNON.PointToPointConstraint(t.lowerRightArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(t.lowerArmLength*Math.sin(30*Math.PI/180),i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-t.upperArmLength-t.lowerArmLength*Math.cos(30*Math.PI/180)-i.mcPosition.y,.5*+i.fBarW),n.forceMax),n.connectHandL=new CANNON.PointToPointConstraint(t.lowerLeftArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(t.lowerArmLength*Math.sin(30*Math.PI/180),i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-t.upperArmLength-t.lowerArmLength*Math.cos(30*Math.PI/180)-i.mcPosition.y,.5*-i.fBarW),n.forceMax),n.connectionArray.push(n.connectHandR),n.connectionArray.push(n.connectHandL),n.connectHipR=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(-.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectHipL=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectHipR),n.connectionArray.push(n.connectHipL),n.connectSpline=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(0,.5*t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength-i.mcPosition.y,0),n.forceMax),n.connectionArray.push(n.connectSpline),n.connectKneeR=new CANNON.PointToPointConstraint(t.upperRightLeg,new CANNON.Vec3(0,.5*-t.upperLegLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectKneeL=new CANNON.PointToPointConstraint(t.upperLeftLeg,new CANNON.Vec3(0,.5*-t.upperLegLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectKneeR),n.connectionArray.push(n.connectKneeL),n.connectKnee2R=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectKnee2L=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(0,i.fBarY+t.lowerLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectKnee2R),n.connectionArray.push(n.connectKnee2L),n.connectFeetR=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,.5*t.lowerLegSize),i.bikeBody,new CANNON.Vec3(.5*t.lowerLegSize,i.fBarY-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectFeetL=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,.5*t.lowerLegSize),i.bikeBody,new CANNON.Vec3(.5*t.lowerLegSize,i.fBarY-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectFeetR),n.connectionArray.push(n.connectFeetL),n.connectFeet2R=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,.5*-t.lowerLegSize),i.bikeBody,new CANNON.Vec3(.5*-t.lowerLegSize,i.fBarY-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectFeet2L=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,.5*-t.lowerLegSize),i.bikeBody,new CANNON.Vec3(.5*-t.lowerLegSize,i.fBarY-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectFeet2R),n.connectionArray.push(n.connectFeet2L)}connectBAD1(e,o){let n=this,i=e,t=o;n.connectHead=new CANNON.PointToPointConstraint(t.head,new CANNON.Vec3(0,0,0),i.bikeBody,new CANNON.Vec3(.2+t.headRadius+t.neckLength-i.mcPosition.x,i.hBarY+.4-i.mcPosition.y,0),n.forceMax),n.monkeyArray.push(n.connectHead),n.connectHead.monkeySide="Both",n.connectionArray.push(n.connectHead),n.connectShoulderR=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(-.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(.2-i.mcPosition.x,i.hBarY+.4-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectShoulderL=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(.2-i.mcPosition.x,i.hBarY+.4-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.monkeyArray.push(n.connectShoulderR),n.monkeyArray.push(n.connectShoulderL),n.connectShoulderR.monkeySide="Both",n.connectShoulderL.monkeySide="Both",n.connectionArray.push(n.connectShoulderR),n.connectionArray.push(n.connectShoulderL),n.connectElbowR=new CANNON.PointToPointConstraint(t.upperRightArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(.2-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*+i.hBarW),n.forceMin),n.connectElbowL=new CANNON.PointToPointConstraint(t.upperLeftArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(.2-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*-i.hBarW),n.forceMin),n.monkeyArray.push(n.connectElbowR),n.monkeyArray.push(n.connectElbowL),n.connectElbowR.monkeySide="R",n.connectElbowL.monkeySide="L",n.connectionArray.push(n.connectElbowR),n.connectionArray.push(n.connectElbowL),n.connectElbowR2=new CANNON.PointToPointConstraint(t.lowerRightArm,new CANNON.Vec3(0,0,-.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(.2-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*+i.hBarW),n.forceMin),n.connectElbowL2=new CANNON.PointToPointConstraint(t.lowerLeftArm,new CANNON.Vec3(0,0,-.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(.2-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*-i.hBarW),n.forceMin),n.monkeyArray.push(n.connectElbowR2),n.monkeyArray.push(n.connectElbowL2),n.connectElbowR2.monkeySide="R",n.connectElbowL2.monkeySide="L",n.connectionArray.push(n.connectElbowR2),n.connectionArray.push(n.connectElbowL2),n.connectHandR=new CANNON.PointToPointConstraint(t.lowerRightArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*+i.hBarW),n.forceMax),n.connectHandL=new CANNON.PointToPointConstraint(t.lowerLeftArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*-i.hBarW),n.forceMax),n.connectionArray.push(n.connectHandR),n.connectionArray.push(n.connectHandL),n.connectHipR=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(-.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-.3-i.mcPosition.x,.8+.4-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectHipL=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-.3-i.mcPosition.x,.8+.4-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.monkeyArray.push(n.connectHipR),n.monkeyArray.push(n.connectHipL),n.connectHipR.monkeySide="Both",n.connectHipL.monkeySide="Both",n.connectionArray.push(n.connectHipR),n.connectionArray.push(n.connectHipL),n.connectSpline=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(0,.5*t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(t.pelvisLength*Math.cos(.6)-.3-i.mcPosition.x,.8+.4+t.pelvisLength*Math.sin(.6)-i.mcPosition.y,0),n.forceMax),n.monkeyArray.push(n.connectSpline),n.connectSpline.monkeySide="Both",n.connectionArray.push(n.connectSpline),n.connectKneeR=new CANNON.PointToPointConstraint(t.upperRightLeg,new CANNON.Vec3(0,0,.5*+t.upperLegLength),i.bikeBody,new CANNON.Vec3(.5*Math.SQRT1_2-.3-i.mcPosition.x,.2+.4+.5*Math.SQRT1_2-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectKneeL=new CANNON.PointToPointConstraint(t.upperLeftLeg,new CANNON.Vec3(0,0,.5*+t.upperLegLength),i.bikeBody,new CANNON.Vec3(.5*Math.SQRT1_2-.3-i.mcPosition.x,.2+.4+.5*Math.SQRT1_2-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.monkeyArray.push(n.connectKneeR),n.monkeyArray.push(n.connectKneeL),n.connectKneeR.monkeySide="R",n.connectKneeL.monkeySide="L",n.connectionArray.push(n.connectKneeR),n.connectionArray.push(n.connectKneeL),n.connectFeetR=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(-.3-i.mcPosition.x,.2+.4-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectFeetL=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(-.3-i.mcPosition.x,.2+.4-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectFeetR),n.connectionArray.push(n.connectFeetL)}connectBAD2(e,o){let n=this,i=e,t=o;n.connectHead=new CANNON.PointToPointConstraint(t.head,new CANNON.Vec3(0,0,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength+t.headRadius+t.neckLength-i.mcPosition.y,0),n.forceMax),n.connectionArray.push(n.connectHead),n.connectShoulderR=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(-.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectShoulderL=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength+t.upperBodyLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectShoulderR),n.connectionArray.push(n.connectShoulderL),n.connectElbowR=new CANNON.PointToPointConstraint(t.upperRightArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-t.lowerArmLength-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectElbowL=new CANNON.PointToPointConstraint(t.upperLeftArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-t.lowerArmLength-i.mcPosition.x,i.hBarY-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectElbowR),n.connectionArray.push(n.connectElbowL),n.connectHandR=new CANNON.PointToPointConstraint(t.lowerRightArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectHandL=new CANNON.PointToPointConstraint(t.lowerLeftArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-i.mcPosition.x,i.hBarY-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectHandR),n.connectionArray.push(n.connectHandL),n.connectHipR=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(-.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.upperLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectHipL=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.upperLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectHipR),n.connectionArray.push(n.connectHipL),n.connectSpline=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(0,.5*t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.upperLegLength+t.pelvisLength-i.mcPosition.y,0),n.forceMax),n.connectionArray.push(n.connectSpline),n.connectKneeR=new CANNON.PointToPointConstraint(t.upperRightLeg,new CANNON.Vec3(0,.5*-t.upperLegLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectKneeL=new CANNON.PointToPointConstraint(t.upperLeftLeg,new CANNON.Vec3(0,.5*-t.upperLegLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectKneeR),n.connectionArray.push(n.connectKneeL),n.connectKnee2R=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectKnee2L=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectKnee2R),n.connectionArray.push(n.connectKnee2L),n.connectFeetR=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectFeetL=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectFeetR),n.connectionArray.push(n.connectFeetL)}connectBAD3(e,o){let n=this,i=e,t=o;n.connectHead=new CANNON.PointToPointConstraint(t.head,new CANNON.Vec3(0,0,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.pelvisLength+t.upperBodyLength+t.headRadius+t.neckLength-i.mcPosition.y,0),n.forceMax),n.connectionArray.push(n.connectHead),n.connectShoulderR=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(-.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.pelvisLength+t.upperBodyLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectShoulderL=new CANNON.PointToPointConstraint(t.upperBody,new CANNON.Vec3(.5*t.shouldersDistance,.5*t.upperBodyLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.pelvisLength+t.upperBodyLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectShoulderR),n.connectionArray.push(n.connectShoulderL),n.connectElbowR=new CANNON.PointToPointConstraint(t.upperRightArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-t.lowerArmLength-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*i.hBarW),n.forceMax),n.connectElbowL=new CANNON.PointToPointConstraint(t.upperLeftArm,new CANNON.Vec3(0,0,.5*t.upperArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-t.lowerArmLength-i.mcPosition.x,i.hBarY-i.mcPosition.y,-.5*i.hBarW),n.forceMax),n.connectionArray.push(n.connectElbowR),n.connectionArray.push(n.connectElbowL),n.connectHandR=new CANNON.PointToPointConstraint(t.lowerRightArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-i.mcPosition.x,i.hBarY-i.mcPosition.y,.5*i.hBarW),n.forceMax),n.connectHandL=new CANNON.PointToPointConstraint(t.lowerLeftArm,new CANNON.Vec3(0,0,.5*t.lowerArmLength),i.bikeBody,new CANNON.Vec3(i.hBarDis-i.mcPosition.x,i.hBarY-i.mcPosition.y,-.5*i.hBarW),n.forceMax),n.connectionArray.push(n.connectHandR),n.connectionArray.push(n.connectHandL),n.connectHipR=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(-.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectHipL=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(.5*t.shouldersDistance,.5*-t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectHipR),n.connectionArray.push(n.connectHipL),n.connectSpline=new CANNON.PointToPointConstraint(t.pelvis,new CANNON.Vec3(0,.5*t.pelvisLength,0),i.bikeBody,new CANNON.Vec3(-i.mcPosition.x,i.fBarY+t.lowerLegLength+t.pelvisLength-i.mcPosition.y,0),n.forceMax),n.connectionArray.push(n.connectSpline),n.connectKneeR=new CANNON.PointToPointConstraint(t.upperRightLeg,new CANNON.Vec3(0,0,.5*t.upperLegLength),i.bikeBody,new CANNON.Vec3(t.upperLegLength-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectKneeL=new CANNON.PointToPointConstraint(t.upperLeftLeg,new CANNON.Vec3(0,0,.5*t.upperLegLength),i.bikeBody,new CANNON.Vec3(t.upperLegLength-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectKneeR),n.connectionArray.push(n.connectKneeL),n.connectKnee2R=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(t.upperLegLength-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectKnee2L=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(t.upperLegLength-i.mcPosition.x,i.fBarY+t.lowerLegLength-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectKnee2R),n.connectionArray.push(n.connectKnee2L),n.connectFeetR=new CANNON.PointToPointConstraint(t.lowerRightLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(t.upperLegLength-i.mcPosition.x,i.fBarY-i.mcPosition.y,.5*t.shouldersDistance),n.forceMax),n.connectFeetL=new CANNON.PointToPointConstraint(t.lowerLeftLeg,new CANNON.Vec3(0,.5*-t.lowerLegLength,0),i.bikeBody,new CANNON.Vec3(t.upperLegLength-i.mcPosition.x,i.fBarY-i.mcPosition.y,-.5*t.shouldersDistance),n.forceMax),n.connectionArray.push(n.connectFeetR),n.connectionArray.push(n.connectFeetL)}connectBAG0(e){let o=this,n=e;o.connectBR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelW-n.mcPosition.x,-n.mcPosition.y,.5*n.wheelW),o.groundBody,new CANNON.Vec3(-n.wheelW-n.mcPosition.x,50,.5*n.wheelW),o.forceMax),o.connectionBAGArrayR.push(o.connectBR),o.connectBL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelW-n.mcPosition.x,-n.mcPosition.y,-.5*n.wheelW),o.groundBody,new CANNON.Vec3(-n.wheelW-n.mcPosition.x,50,-.5*n.wheelW),o.forceMax),o.connectionBAGArrayL.push(o.connectBL),o.connectFR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelW-n.mcPosition.x,-n.mcPosition.y,.5*n.wheelW),o.groundBody,new CANNON.Vec3(n.wheelW-n.mcPosition.x,50,.5*n.wheelW),o.forceMax),o.connectionBAGArrayR.push(o.connectFR),o.connectFL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelW-n.mcPosition.x,-n.mcPosition.y,-.5*n.wheelW),o.groundBody,new CANNON.Vec3(n.wheelW-n.mcPosition.x,50,-.5*n.wheelW),o.forceMax),o.connectionBAGArrayL.push(o.connectFL)}connectBAG2(e){let o=this,n=e;o.connectBR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,-n.mcPosition.y,.5*n.wheelW),o.groundBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,50,.5*n.wheelW),o.forceMax),o.connectionBAGArrayR.push(o.connectBR),o.connectBL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,-n.mcPosition.y,-.5*n.wheelW),o.groundBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,50,-.5*n.wheelW),o.forceMax),o.connectionBAGArrayL.push(o.connectBL),o.connectFR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,-n.mcPosition.y,.5*n.wheelW),o.groundBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,50,.5*n.wheelW),o.forceMax),o.connectionBAGArrayR.push(o.connectFR),o.connectFL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,-n.mcPosition.y,-.5*n.wheelW),o.groundBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,50,-.5*n.wheelW),o.forceMax),o.connectionBAGArrayL.push(o.connectFL)}connectBAG3(e){let o=this,n=e;o.connectBR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,-n.mcPosition.y,.5*(n.wheelWidthBack+n.wheelW)),o.groundBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,50,.5*(n.wheelWidthBack+n.wheelW)),o.forceMax),o.connectionBAGArrayR.push(o.connectBR),o.connectBL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,-n.mcPosition.y,-.5*(n.wheelWidthBack+n.wheelW)),o.groundBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,50,-.5*(n.wheelWidthBack+n.wheelW)),o.forceMax),o.connectionBAGArrayL.push(o.connectBL),o.connectFR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,-n.mcPosition.y,.5*n.wheelW),o.groundBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,50,.5*n.wheelW),o.forceMax),o.connectionBAGArrayR.push(o.connectFR),o.connectFL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,-n.mcPosition.y,-.5*n.wheelW),o.groundBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,50,-.5*n.wheelW),o.forceMax),o.connectionBAGArrayL.push(o.connectFL)}connectBAG4(e){let o=this,n=e;o.connectBR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,-n.mcPosition.y,.5*(n.wheelWidthBack+n.wheelW)),o.groundBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,50,.5*(n.wheelWidthBack+n.wheelW)),o.forceMax),o.connectionBAGArrayR.push(o.connectBR),o.connectBL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,-n.mcPosition.y,-.5*(n.wheelWidthBack+n.wheelW)),o.groundBody,new CANNON.Vec3(-n.wheelDisBack-n.mcPosition.x,50,-.5*(n.wheelWidthBack+n.wheelW)),o.forceMax),o.connectionBAGArrayL.push(o.connectBL),o.connectFR=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,-n.mcPosition.y,.5*(n.wheelWidthFront+n.wheelW)),o.groundBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,50,.5*(n.wheelWidthFront+n.wheelW)),o.forceMax),o.connectionBAGArrayR.push(o.connectFR),o.connectFL=new CANNON.PointToPointConstraint(n.bikeBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,-n.mcPosition.y,-.5*(n.wheelWidthFront+n.wheelW)),o.groundBody,new CANNON.Vec3(n.wheelDisFront-n.mcPosition.x,50,-.5*(n.wheelWidthFront+n.wheelW)),o.forceMax),o.connectionBAGArrayL.push(o.connectFL)}connectBAG(e,o){let n=this;"R"!==e||1!==o||n.isConnectBAGR?"L"!==e||1!==o||n.isConnectBAGL?"R"===e&&0===o&&n.isConnectBAGR?(n.world.removeConstraint(n.connectionBAGArrayR[0]),n.world.removeConstraint(n.connectionBAGArrayR[1]),n.isConnectBAGR=!1):"L"===e&&0===o&&n.isConnectBAGL&&(n.world.removeConstraint(n.connectionBAGArrayL[0]),n.world.removeConstraint(n.connectionBAGArrayL[1]),n.isConnectBAGL=!1):(n.world.addConstraint(n.connectionBAGArrayL[0]),n.world.addConstraint(n.connectionBAGArrayL[1]),n.isConnectBAGL=!0):(n.world.addConstraint(n.connectionBAGArrayR[0]),n.world.addConstraint(n.connectionBAGArrayR[1]),n.isConnectBAGR=!0)}rotateJoint(e){let o=this,n=o.monkeyArray.length;for(var i=0;i<n;i++){let n=o.monkeyArray[i],t=n.theta0;"R"===n.monkeySide?t+=e*(e>0?1.5:-.5):"L"===n.monkeySide?t+=e*(e<0?1.5:-.5):t+=e,n.pivotB.y=o.monkeyY+n.rr*Math.cos(t),n.pivotB.z=n.rr*Math.sin(t)}}}class OneRagDoll{constructor(e,o,n,i,t,r,s,a){let c=this;c.isStandUp=s;var h=o.bodies.length;c.shouldersDistance=.4,c.upperArmLength=.4,c.lowerArmLength=.4,c.upperArmSize=.1,c.lowerArmSize=.1,c.neckLength=.04,c.headRadius=.18,c.upperBodyLength=.4,c.upperBodyThickness=.2,c.pelvisLength=.2,c.upperLegLength=.5,c.upperLegSize=.15,c.lowerLegSize=.15,c.lowerLegLength=.5,c.headShape=new CANNON.Sphere(c.headRadius),c.upperArmShape=new CANNON.Box(new CANNON.Vec3(.5*c.upperArmSize,.5*c.upperArmSize,.5*c.upperArmLength)),c.lowerArmShape=new CANNON.Box(new CANNON.Vec3(.5*c.lowerArmSize,.5*c.lowerArmSize,.5*c.lowerArmLength)),c.upperBodyShape=new CANNON.Box(new CANNON.Vec3(.5*c.shouldersDistance,.5*c.upperBodyLength,.5*c.upperBodyThickness)),c.pelvisShape=new CANNON.Box(new CANNON.Vec3(.5*c.shouldersDistance,.5*c.pelvisLength,.5*c.upperBodyThickness)),c.upperLegShape=s?new CANNON.Box(new CANNON.Vec3(.5*c.upperLegSize,.5*c.upperLegLength,.5*c.upperLegSize)):new CANNON.Box(new CANNON.Vec3(.5*c.upperLegSize,.5*c.upperLegSize,.5*c.upperLegLength)),c.lowerLegShape=new CANNON.Box(new CANNON.Vec3(.5*c.lowerLegSize,.5*c.lowerLegLength,.5*c.lowerLegSize));let l=65535;c.headObj=new TEACHER.ObjSphere(c.headRadius,l),c.upperArmRObj=new TEACHER.ObjBox(c.upperArmSize,c.upperArmSize,c.upperArmLength,l),c.upperArmLObj=new TEACHER.ObjBox(c.upperArmSize,c.upperArmSize,c.upperArmLength,l),c.lowerArmRObj=new TEACHER.ObjBox(c.lowerArmSize,c.lowerArmSize,c.lowerArmLength,l),c.lowerArmLObj=new TEACHER.ObjBox(c.lowerArmSize,c.lowerArmSize,c.lowerArmLength,l),c.upperBodyObj=new TEACHER.ObjBox(c.shouldersDistance,c.upperBodyLength,c.upperBodyThickness,l),c.pelvisObj=new TEACHER.ObjBox(c.shouldersDistance,c.pelvisLength,c.upperBodyThickness,l),s?(c.upperLegRObj=new TEACHER.ObjBox(c.upperLegSize,c.upperLegLength,c.upperLegSize,l),c.upperLegLObj=new TEACHER.ObjBox(c.upperLegSize,c.upperLegLength,c.upperLegSize,l)):(c.upperLegRObj=new TEACHER.ObjBox(c.upperLegSize,c.upperLegSize,c.upperLegLength,l),c.upperLegLObj=new TEACHER.ObjBox(c.upperLegSize,c.upperLegSize,c.upperLegLength,l)),c.lowerLegRObj=new TEACHER.ObjBox(c.lowerLegSize,c.lowerLegLength,c.lowerLegSize,l),c.lowerLegLObj=new TEACHER.ObjBox(c.lowerLegSize,c.lowerLegLength,c.lowerLegSize,l),c.allObjs=new THREE.Object3D,c.allObjs.add(c.headObj).add(c.upperArmRObj).add(c.upperArmLObj).add(c.lowerArmRObj).add(c.lowerArmLObj).add(c.upperBodyObj).add(c.pelvisObj).add(c.upperLegRObj).add(c.upperLegLObj).add(c.lowerLegRObj).add(c.lowerLegLObj),c.objsArray=[c.headObj,c.upperArmRObj,c.upperArmLObj,c.lowerArmRObj,c.lowerArmLObj,c.upperBodyObj,c.pelvisObj,c.upperLegRObj,c.upperLegLObj,c.lowerLegRObj,c.lowerLegLObj],conRZ.add(c.allObjs),c.lowerLeftLeg=new CANNON.Body({mass:1,position:new CANNON.Vec3(+c.shouldersDistance/2,c.lowerLegLength/2,0),material:o.driverMaterial}),c.lowerRightLeg=new CANNON.Body({mass:1,position:new CANNON.Vec3(-c.shouldersDistance/2,c.lowerLegLength/2,0),material:o.driverMaterial}),c.lowerLeftLeg.addShape(c.lowerLegShape),c.lowerRightLeg.addShape(c.lowerLegShape),o.addBody(c.lowerLeftLeg),o.addBody(c.lowerRightLeg),c.lowerLegLObj.body=c.lowerLeftLeg,c.lowerLegRObj.body=c.lowerRightLeg;let w=s?new CANNON.Vec3(+c.shouldersDistance/2,c.lowerLeftLeg.position.y+c.lowerLegLength/2+c.upperLegLength/2,0):new CANNON.Vec3(+c.shouldersDistance/2,c.lowerLeftLeg.position.y+c.lowerLegLength/2,-c.upperLegLength/2);c.upperLeftLeg=new CANNON.Body({mass:1,position:w,material:o.driverMaterial}),c.upperRightLeg=new CANNON.Body({mass:1,position:w,material:o.driverMaterial}),c.upperLeftLeg.addShape(c.upperLegShape),c.upperRightLeg.addShape(c.upperLegShape),o.addBody(c.upperLeftLeg),o.addBody(c.upperRightLeg),c.upperLegLObj.body=c.upperLeftLeg,c.upperLegRObj.body=c.upperRightLeg;let N=s?new CANNON.Vec3(0,c.upperLeftLeg.position.y+c.upperLegLength/2+c.pelvisLength/2,0):new CANNON.Vec3(0,c.upperLeftLeg.position.y+c.pelvisLength/2,-c.upperLegLength);c.pelvis=new CANNON.Body({mass:1,position:N,material:o.driverMaterial}),c.pelvis.addShape(c.pelvisShape),o.addBody(c.pelvis),c.pelvisObj.body=c.pelvis,c.upperBody=new CANNON.Body({mass:2,position:new CANNON.Vec3(0,c.pelvis.position.y+c.pelvisLength/2+c.upperBodyLength/2,c.pelvis.position.z),material:o.driverMaterial}),c.upperBody.addShape(c.upperBodyShape),o.addBody(c.upperBody),c.upperBodyObj.body=c.upperBody,c.head=new CANNON.Body({mass:1,position:new CANNON.Vec3(0,c.upperBody.position.y+c.upperBodyLength/2+c.headRadius+c.neckLength,c.upperBody.position.z),material:o.driverMaterial}),c.head.addShape(c.headShape),o.addBody(c.head),c.headObj.body=c.head,c.upperLeftArm=new CANNON.Body({mass:.5,position:new CANNON.Vec3(+c.shouldersDistance/2+c.upperArmSize/2,c.upperBody.position.y+c.upperBodyLength/2-c.upperArmSize/2,c.upperBody.position.z+c.upperArmLength/2),material:o.driverMaterial}),c.upperRightArm=new CANNON.Body({mass:.5,position:new CANNON.Vec3(-c.shouldersDistance/2-c.upperArmSize/2,c.upperBody.position.y+c.upperBodyLength/2-c.upperArmSize/2,c.upperBody.position.z+c.upperArmLength/2),material:o.driverMaterial}),c.upperLeftArm.addShape(c.upperArmShape),c.upperRightArm.addShape(c.upperArmShape),o.addBody(c.upperLeftArm),o.addBody(c.upperRightArm),c.upperArmLObj.body=c.upperLeftArm,c.upperArmRObj.body=c.upperRightArm,c.lowerLeftArm=new CANNON.Body({mass:.5,position:new CANNON.Vec3(+c.upperLeftArm.position.x,c.upperLeftArm.position.y,c.upperBody.position.z+c.lowerArmLength/2+c.upperArmLength/2),material:o.driverMaterial}),c.lowerRightArm=new CANNON.Body({mass:.5,position:new CANNON.Vec3(-c.upperRightArm.position.x,c.upperRightArm.position.y,c.upperBody.position.z+c.lowerArmLength/2+c.upperArmLength/2),material:o.driverMaterial}),c.lowerLeftArm.addShape(c.lowerArmShape),c.lowerRightArm.addShape(c.lowerArmShape),o.addBody(c.lowerLeftArm),o.addBody(c.lowerRightArm),c.lowerArmLObj.body=c.lowerLeftArm,c.lowerArmRObj.body=c.lowerRightArm,c.neckJoint=new CANNON.ConeTwistConstraint(c.head,c.upperBody,{pivotA:new CANNON.Vec3(0,-c.headRadius-c.neckLength/2,0),pivotB:new CANNON.Vec3(0,c.upperBodyLength/2,0),axisA:CANNON.Vec3.UNIT_Y,axisB:CANNON.Vec3.UNIT_Y,angle:0,twistAngle:0}),o.addConstraint(c.neckJoint),c.leftKneeJoint=new CANNON.ConeTwistConstraint(c.lowerLeftLeg,c.upperLeftLeg,{pivotA:new CANNON.Vec3(0,c.lowerLegLength/2,0),pivotB:s?new CANNON.Vec3(0,-c.upperLegLength/2,0):new CANNON.Vec3(0,0,c.upperLegLength/2),axisA:CANNON.Vec3.UNIT_Y,axisB:CANNON.Vec3.UNIT_Y,angle:0,twistAngle:0}),c.rightKneeJoint=new CANNON.ConeTwistConstraint(c.lowerRightLeg,c.upperRightLeg,{pivotA:new CANNON.Vec3(0,c.lowerLegLength/2,0),pivotB:s?new CANNON.Vec3(0,-c.upperLegLength/2,0):new CANNON.Vec3(0,0,c.upperLegLength/2),axisA:CANNON.Vec3.UNIT_Y,axisB:CANNON.Vec3.UNIT_Y,angle:0,twistAngle:0}),o.addConstraint(c.leftKneeJoint),o.addConstraint(c.rightKneeJoint),c.leftHipJoint=new CANNON.ConeTwistConstraint(c.upperLeftLeg,c.pelvis,{pivotA:s?new CANNON.Vec3(0,c.upperLegLength/2,0):new CANNON.Vec3(0,0,-c.upperLegLength/2),pivotB:new CANNON.Vec3(+c.shouldersDistance/2,-c.pelvisLength/2,0),axisA:CANNON.Vec3.UNIT_Y,axisB:CANNON.Vec3.UNIT_Y,angle:n,twistAngle:t}),c.rightHipJoint=new CANNON.ConeTwistConstraint(c.upperRightLeg,c.pelvis,{pivotA:s?new CANNON.Vec3(0,c.upperLegLength/2,0):new CANNON.Vec3(0,0,-c.upperLegLength/2),pivotB:new CANNON.Vec3(-c.shouldersDistance/2,-c.pelvisLength/2,0),axisA:CANNON.Vec3.UNIT_Y,axisB:CANNON.Vec3.UNIT_Y,angle:n,twistAngle:t}),o.addConstraint(c.leftHipJoint),o.addConstraint(c.rightHipJoint),c.spineJoint=new CANNON.ConeTwistConstraint(c.pelvis,c.upperBody,{pivotA:new CANNON.Vec3(0,c.pelvisLength/2,0),pivotB:new CANNON.Vec3(0,-c.upperBodyLength/2,0),axisA:CANNON.Vec3.UNIT_Y,axisB:CANNON.Vec3.UNIT_Y,angle:0,twistAngle:0}),o.addConstraint(c.spineJoint),c.leftShoulder=new CANNON.ConeTwistConstraint(c.upperBody,c.upperLeftArm,{pivotA:new CANNON.Vec3(+c.shouldersDistance/2+c.upperArmSize/2,c.upperBodyLength/2-c.upperArmSize/2,0),pivotB:new CANNON.Vec3(0,0,-c.upperArmLength/2),axisA:new CANNON.Vec3(1,0,0),axisB:new CANNON.Vec3(1,0,0),angle:a?Math.PI:0,twistAngle:a?Math.PI:0}),c.rightShoulder=new CANNON.ConeTwistConstraint(c.upperBody,c.upperRightArm,{pivotA:new CANNON.Vec3(-c.shouldersDistance/2-c.upperArmSize/2,c.upperBodyLength/2-c.upperArmSize/2,0),pivotB:new CANNON.Vec3(0,0,-c.upperArmLength/2),axisA:new CANNON.Vec3(1,0,0),axisB:new CANNON.Vec3(1,0,0),angle:a?Math.PI:0,twistAngle:a?Math.PI:0}),o.addConstraint(c.leftShoulder),o.addConstraint(c.rightShoulder),c.leftElbowJoint=new CANNON.ConeTwistConstraint(c.lowerLeftArm,c.upperLeftArm,{pivotA:new CANNON.Vec3(0,0,-c.lowerArmLength/2),pivotB:new CANNON.Vec3(0,0,c.lowerArmLength/2),axisA:CANNON.Vec3.UNIT_Z,axisB:CANNON.Vec3.UNIT_Z,angle:n,twistAngle:t}),c.rightElbowJoint=new CANNON.ConeTwistConstraint(c.lowerRightArm,c.upperRightArm,{pivotA:new CANNON.Vec3(0,0,-c.lowerArmLength/2),pivotB:new CANNON.Vec3(0,0,c.lowerArmLength/2),axisA:CANNON.Vec3.UNIT_Z,axisB:CANNON.Vec3.UNIT_Z,angle:n,twistAngle:t}),o.addConstraint(c.leftElbowJoint),o.addConstraint(c.rightElbowJoint);for(var p=h;p<o.bodies.length;p++){var d=o.bodies[p];d.position.vadd(e,d.position)}}updateDoll(){let e=this,o=e.objsArray.length;for(let n=0;n<o;n++){let o=e.objsArray[n],i=o.body;o.position.x=i.position.x,o.position.y=i.position.y,o.position.z=i.position.z,o.quaternion.x=i.quaternion.x,o.quaternion.y=i.quaternion.y,o.quaternion.z=i.quaternion.z,o.quaternion.w=i.quaternion.w}}setVisible(e){let o=this,n=o.objsArray.length;for(let i=0;i<n;i++){o.objsArray[i].visible=e}}}class OneBike{constructor(e,o){let n=this;n.objsArray=[],n.mcPosition=new CANNON.Vec3(0,1,0),0===o?n.constructor0(e):1===o?n.constructor1(e):2===o?n.constructor2(e):3===o?n.constructor3(e):4===o&&n.constructor4(e)}constructor0(e){let o=this;o.wheelR=.4,o.wheelW=.05,o.fBarW=.5,o.fBarD=.08,o.fBarY=0+o.wheelR,o.mcPosition.y=o.wheelR,o.wheelShape=new CANNON.Cylinder(o.wheelR,o.wheelR,o.wheelW,64),o.fBarShape=new CANNON.Box(new CANNON.Vec3(.5*o.fBarD,.5*o.fBarD,.5*o.fBarW));o.wheelObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,13421772,13421772,!1,"z"),o.fBarObj=new TEACHER.ObjBox(o.fBarD,o.fBarD,o.fBarW,13421772),o.wheelObj.position.x=0,o.wheelObj.position.y=o.wheelR-this.mcPosition.y,o.fBarObj.position.y=o.fBarY-this.mcPosition.y,o.allObjs=new THREE.Object3D,o.allObjs.position.y=o.mcPosition.y,o.allObjs.add(o.wheelObj).add(o.fBarObj),o.objsArray=[o.wheelObj,o.fBarObj],conRZ.add(o.allObjs),o.bikeBody=new CANNON.Body({mass:100,material:e.bikeMaterial}),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(0,o.wheelR-o.mcPosition.y,0)),o.bikeBody.addShape(o.fBarShape,new CANNON.Vec3(0,o.fBarY-o.mcPosition.y,0)),e.addBody(o.bikeBody),o.bikeBody.position.y=o.mcPosition.y}constructor1(e){let o=this;o.wheelR=.4,o.wheelW=.05,o.wheelDisFront=.9,o.wheelDisBack=.9,o.chassisW=.1,o.chassisH=.6,o.chassisL=.7,o.chassisY=o.chassisH/2+o.wheelR,o.hBarW=.5,o.hBarD=.08,o.hBarY=.7+o.wheelR,o.hBarDis=.6,o.mcPosition.y=.4,o.mcPosition.x=0,o.wheelShape=new CANNON.Cylinder(o.wheelR,o.wheelR,o.wheelW,64),o.chassisShape=new CANNON.Box(new CANNON.Vec3(.5*o.chassisL,.5*o.chassisH,.5*o.chassisW)),o.hBarShape=new CANNON.Box(new CANNON.Vec3(.5*o.hBarD,.5*o.hBarD,.5*o.hBarW));let n=13421772;o.wheelFObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,13421772,!1,"z"),o.wheelBObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,13421772,!1,"z"),o.chassisObj=new TEACHER.ObjBox(o.chassisL,o.chassisH,o.chassisW,n),o.hBarObj=new TEACHER.ObjBox(o.hBarD,o.hBarD,o.hBarW,n),o.wheelFObj.position.x=o.wheelDisFront-o.mcPosition.x,o.wheelFObj.position.y=o.wheelR-o.mcPosition.y,o.wheelBObj.position.x=-o.wheelDisBack-o.mcPosition.x,o.wheelBObj.position.y=o.wheelR-o.mcPosition.y,o.chassisObj.position.y=o.chassisY-o.mcPosition.y,o.chassisObj.position.x=-o.mcPosition.x,o.hBarObj.position.y=o.hBarY-o.mcPosition.y,o.hBarObj.position.x=o.hBarDis-o.mcPosition.x,o.allObjs=new THREE.Object3D,o.allObjs.position.x=0,o.allObjs.position.y=o.mcPosition.y,o.allObjs.add(o.wheelBObj).add(o.wheelFObj).add(o.chassisObj).add(o.hBarObj),o.objsArray=[o.wheelFObj,o.wheelBObj,o.chassisObj,o.hBarObj],conRZ.add(o.allObjs),o.bikeBody=new CANNON.Body({mass:100,material:e.bikeMaterial}),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(o.wheelDisFront-o.mcPosition.x,o.wheelR-o.mcPosition.y,0)),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(-o.wheelDisBack-o.mcPosition.x,o.wheelR-o.mcPosition.y,0)),o.bikeBody.addShape(o.chassisShape,new CANNON.Vec3(-o.mcPosition.x,o.chassisY-o.mcPosition.y,0)),o.bikeBody.addShape(o.hBarShape,new CANNON.Vec3(o.hBarDis-o.mcPosition.x,o.hBarY-o.mcPosition.y,0)),e.addBody(o.bikeBody),o.bikeBody.position.y=o.mcPosition.y,o.bikeBody.position.x=0}constructor2(e){let o=this;o.wheelR=.1,o.wheelW=.05,o.wheelDisFront=.9,o.wheelDisBack=.9,o.chassisW=.2,o.chassisH=.1,o.chassisL=1.2,o.chassisY=o.chassisH/2+o.wheelR,o.hBarW=.5,o.hBarD=.08,o.hBarY=1.5+o.wheelR,o.hBarDis=.8,o.fBarY=.1+o.wheelR,o.mcPosition.y=.4,o.mcPosition.x=0,o.wheelShape=new CANNON.Cylinder(o.wheelR,o.wheelR,o.wheelW,64),o.chassisShape=new CANNON.Box(new CANNON.Vec3(.5*o.chassisL,.5*o.chassisH,.5*o.chassisW)),o.hBarShape=new CANNON.Box(new CANNON.Vec3(.5*o.hBarD,.5*o.hBarD,.5*o.hBarW)),o.hBarShapeV=new CANNON.Box(new CANNON.Vec3(.5*o.hBarD,.5*(o.hBarY-2*o.wheelR-.1),.5*o.hBarD));let n=13421772;o.wheelFObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,13421772,!1,"z"),o.wheelBObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,13421772,!1,"z"),o.chassisObj=new TEACHER.ObjBox(o.chassisL,o.chassisH,o.chassisW,n),o.hBarObj=new TEACHER.ObjBox(o.hBarD,o.hBarD,o.hBarW,n),o.hBarVObj=new TEACHER.ObjBox(o.hBarD,o.hBarY-2*o.wheelR-.1,o.hBarD,n),o.wheelFObj.position.x=o.wheelDisFront-o.mcPosition.x,o.wheelFObj.position.y=o.wheelR-o.mcPosition.y,o.wheelBObj.position.x=-o.wheelDisBack-o.mcPosition.x,o.wheelBObj.position.y=o.wheelR-o.mcPosition.y,o.chassisObj.position.x=-o.mcPosition.x,o.chassisObj.position.y=o.chassisY-o.mcPosition.y,o.hBarObj.position.y=o.hBarY-o.mcPosition.y,o.hBarObj.position.x=o.hBarDis-o.mcPosition.x,o.hBarVObj.position.y=o.hBarY-.5*(o.hBarY-2*o.wheelR-.1)-o.mcPosition.y,o.hBarVObj.position.x=o.hBarDis-o.mcPosition.x,o.allObjs=new THREE.Object3D,o.allObjs.position.x=o.mcPosition.x,o.allObjs.position.y=o.mcPosition.y,o.allObjs.add(o.wheelBObj).add(o.wheelFObj).add(o.chassisObj).add(o.hBarObj).add(o.hBarVObj),o.objsArray=[o.wheelFObj,o.wheelBObj,o.chassisObj,o.hBarObj,o.hBarVObj],conRZ.add(o.allObjs),o.bikeBody=new CANNON.Body({mass:100,material:e.bikeMaterial}),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(o.wheelDisFront-o.mcPosition.x,o.wheelR-o.mcPosition.y,0)),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(-o.wheelDisBack-o.mcPosition.x,o.wheelR-o.mcPosition.y,0)),o.bikeBody.addShape(o.chassisShape,new CANNON.Vec3(-o.mcPosition.x,o.chassisY-o.mcPosition.y,0)),o.bikeBody.addShape(o.hBarShape,new CANNON.Vec3(o.hBarDis-o.mcPosition.x,o.hBarY-o.mcPosition.y,0)),e.addBody(o.bikeBody),o.bikeBody.position.y=o.mcPosition.y,o.bikeBody.position.x=0}constructor3(e){let o=this;o.wheelR=.4,o.wheelW=.05,o.wheelDisFront=1,o.wheelDisBack=.5,o.wheelWidthBack=1.5,o.chassisW=.6,o.chassisH=.1,o.chassisL=.4,o.chassisY=o.chassisH/2+o.wheelR,o.hBarW=.5,o.hBarD=.08,o.hBarY=1.1-.5+o.wheelR,o.hBarDis=.7,o.fBarY=-.3+o.wheelR,o.mcPosition.y=.8,o.mcPosition.x=-.2,o.wheelShape=new CANNON.Cylinder(o.wheelR,o.wheelR,o.wheelW,64),o.chassisShape=new CANNON.Box(new CANNON.Vec3(.5*o.chassisL,.5*o.chassisH,.5*o.chassisW)),o.hBarShape=new CANNON.Box(new CANNON.Vec3(.5*o.hBarD,.5*o.hBarD,.5*o.hBarW));let n=13421772,i=13421772;o.wheelFObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,i,!1,"z"),o.wheelBRObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,i,!1,"z"),o.wheelBLObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,i,!1,"z"),o.chassisObj=new TEACHER.ObjBox(o.chassisL,o.chassisH,o.chassisW,n),o.hBarObj=new TEACHER.ObjBox(o.hBarD,o.hBarD,o.hBarW,n),o.wheelFObj.position.x=o.wheelDisFront-o.mcPosition.x,o.wheelFObj.position.y=o.wheelR-o.mcPosition.y,o.wheelBRObj.position.x=-o.wheelDisBack-o.mcPosition.x,o.wheelBRObj.position.z=.5*o.wheelWidthBack,o.wheelBRObj.position.y=o.wheelR-o.mcPosition.y,o.wheelBLObj.position.x=-o.wheelDisBack-o.mcPosition.x,o.wheelBLObj.position.z=-.5*o.wheelWidthBack,o.wheelBLObj.position.y=o.wheelR-o.mcPosition.y,o.chassisObj.position.y=o.chassisY-o.mcPosition.y,o.chassisObj.position.x=-o.mcPosition.x,o.hBarObj.position.y=o.hBarY-o.mcPosition.y,o.hBarObj.position.x=o.hBarDis-o.mcPosition.x,o.allObjs=new THREE.Object3D,o.allObjs.position.x=0,o.allObjs.position.y=o.mcPosition.y,o.allObjs.add(o.wheelBRObj).add(o.wheelBLObj).add(o.wheelFObj).add(o.chassisObj).add(o.hBarObj),o.objsArray=[o.wheelFObj,o.wheelBRObj,o.wheelBLObj,o.chassisObj,o.hBarObj],conRZ.add(o.allObjs),o.bikeBody=new CANNON.Body({mass:100,material:e.bikeMaterial}),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(-o.wheelDisBack-o.mcPosition.x,o.wheelR-o.mcPosition.y,.5*o.wheelWidthBack)),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(-o.wheelDisBack-o.mcPosition.x,o.wheelR-o.mcPosition.y,-.5*o.wheelWidthBack)),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(o.wheelDisFront-o.mcPosition.x,o.wheelR-o.mcPosition.y,0)),o.bikeBody.addShape(o.chassisShape,new CANNON.Vec3(-o.mcPosition.x,o.chassisY-o.mcPosition.y,0)),o.bikeBody.addShape(o.hBarShape,new CANNON.Vec3(o.hBarDis-o.mcPosition.x,o.hBarY-o.mcPosition.y,0)),e.addBody(o.bikeBody),o.bikeBody.position.y=o.mcPosition.y,o.bikeBody.position.x=0}constructor4(e){let o=this;o.wheelR=.4,o.wheelW=.05,o.wheelDisFront=1,o.wheelDisBack=.5,o.wheelWidthBack=1.5,o.wheelWidthFront=1.5,o.chassisW=.6,o.chassisH=.1,o.chassisL=.4,o.chassisY=o.chassisH/2+o.wheelR,o.hBarW=.5,o.hBarD=.08,o.hBarY=1.1-.5+o.wheelR,o.hBarDis=.7,o.fBarY=-.3+o.wheelR,o.mcPosition.y=.6,o.mcPosition.x=0,o.wheelShape=new CANNON.Cylinder(o.wheelR,o.wheelR,o.wheelW,64),o.chassisShape=new CANNON.Box(new CANNON.Vec3(.5*o.chassisL,.5*o.chassisH,.5*o.chassisW)),o.hBarShape=new CANNON.Box(new CANNON.Vec3(.5*o.hBarD,.5*o.hBarD,.5*o.hBarW));let n=13421772,i=13421772;o.wheelFRObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,i,!1,"z"),o.wheelFLObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,i,!1,"z"),o.wheelBRObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,i,!1,"z"),o.wheelBLObj=new TEACHER.ObjWheelCylinder(o.wheelR,o.wheelW,n,i,!1,"z"),o.chassisObj=new TEACHER.ObjBox(o.chassisL,o.chassisH,o.chassisW,n),o.hBarObj=new TEACHER.ObjBox(o.hBarD,o.hBarD,o.hBarW,n),o.wheelFRObj.position.x=o.wheelDisFront-o.mcPosition.x,o.wheelFRObj.position.y=o.wheelR-o.mcPosition.y,o.wheelFRObj.position.z=.5*o.wheelWidthFront,o.wheelFLObj.position.x=o.wheelDisFront-o.mcPosition.x,o.wheelFLObj.position.y=o.wheelR-o.mcPosition.y,o.wheelFLObj.position.z=-.5*o.wheelWidthFront,o.wheelBRObj.position.x=-o.wheelDisBack-o.mcPosition.x,o.wheelBRObj.position.z=.5*o.wheelWidthBack,o.wheelBRObj.position.y=o.wheelR-o.mcPosition.y,o.wheelBLObj.position.x=-o.wheelDisBack-o.mcPosition.x,o.wheelBLObj.position.z=-.5*o.wheelWidthBack,o.wheelBLObj.position.y=o.wheelR-o.mcPosition.y,o.chassisObj.position.y=o.chassisY-o.mcPosition.y,o.chassisObj.position.x=-o.mcPosition.x,o.hBarObj.position.y=o.hBarY-o.mcPosition.y,o.hBarObj.position.x=o.hBarDis-o.mcPosition.x,o.allObjs=new THREE.Object3D,o.allObjs.position.x=0,o.allObjs.position.y=o.mcPosition.y,o.allObjs.add(o.wheelBRObj).add(o.wheelBLObj).add(o.wheelFRObj).add(o.wheelFLObj).add(o.chassisObj).add(o.hBarObj),o.objsArray=[o.wheelFRObj,o.wheelFLObj,o.wheelBRObj,o.wheelBLObj,o.chassisObj,o.hBarObj],conRZ.add(o.allObjs),o.bikeBody=new CANNON.Body({mass:100,material:e.bikeMaterial}),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(-o.wheelDisBack-o.mcPosition.x,o.wheelR-o.mcPosition.y,.5*o.wheelWidthBack)),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(-o.wheelDisBack-o.mcPosition.x,o.wheelR-o.mcPosition.y,-.5*o.wheelWidthBack)),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(o.wheelDisFront-o.mcPosition.x,o.wheelR-o.mcPosition.y,.5*o.wheelWidthFront)),o.bikeBody.addShape(o.wheelShape,new CANNON.Vec3(o.wheelDisFront-o.mcPosition.x,o.wheelR-o.mcPosition.y,-.5*o.wheelWidthFront)),o.bikeBody.addShape(o.chassisShape,new CANNON.Vec3(-o.mcPosition.x,o.chassisY-o.mcPosition.y,0)),o.bikeBody.addShape(o.hBarShape,new CANNON.Vec3(o.hBarDis-o.mcPosition.x,o.hBarY-o.mcPosition.y,0)),e.addBody(o.bikeBody),o.bikeBody.position.y=o.mcPosition.y,o.bikeBody.position.x=0}updateBike(){let e=this;e.allObjs.position.x=e.bikeBody.position.x,e.allObjs.position.y=e.bikeBody.position.y,e.allObjs.position.z=e.bikeBody.position.z,e.allObjs.quaternion.x=e.bikeBody.quaternion.x,e.allObjs.quaternion.y=e.bikeBody.quaternion.y,e.allObjs.quaternion.z=e.bikeBody.quaternion.z,e.allObjs.quaternion.w=e.bikeBody.quaternion.w}setVisible(e){let o=this,n=o.objsArray.length;for(let i=0;i<n;i++){o.objsArray[i].visible=e}}}var TEACHER={ObjWheelCylinder:class extends THREE.Object3D{constructor(e,o,n,i,t,r,s){super();let a=this;a.mat=new TEACHER.MSMat(n,s),a.geo=new THREE.CylinderGeometry(e||10,e||10,o||10,32,2,t),a.mesh=new THREE.Mesh(a.geo,a.mat),"x"===r?a.mesh.rotation.z=-.5*Math.PI:"z"===r&&(a.mesh.rotation.x=.5*Math.PI),a.add(a.mesh)}},ObjPlane:class extends THREE.Object3D{constructor(e,o,n,i,t){super();let r=this;r.mat=new TEACHER.MSMat(n,t),r.geo=new THREE.PlaneGeometry(e||10,o||10,1,1),r.mesh=new THREE.Mesh(r.geo,r.mat),"x"===i?r.mesh.rotation.y=.5*Math.PI:"y"===i&&(r.mesh.rotation.x=-.5*Math.PI),r.add(r.mesh)}},ObjCylinder:class extends THREE.Object3D{constructor(e,o,n,i,t,r){super();let s=this;s.mat=new TEACHER.MSMat(n,r),s.geo=new THREE.CylinderGeometry(e||10,e||10,o||10,32,2,i),s.mesh=new THREE.Mesh(s.geo,s.mat),"x"===t?s.mesh.rotation.z=-.5*Math.PI:"z"===t&&(s.mesh.rotation.x=.5*Math.PI),s.add(s.mesh)}},ObjSphere:class extends THREE.Object3D{constructor(e,o,n){super();let i=this;i.mat=new TEACHER.MSMat(o,n),i.geo=new THREE.SphereGeometry(e||10,32,16),i.mesh=new THREE.Mesh(i.geo,i.mat),i.add(i.mesh)}},ObjBox:class extends THREE.Object3D{constructor(e,o,n,i,t){super();let r=this;r.mat=new TEACHER.MSMat(i,t),r.geo=new THREE.BoxGeometry(e||10,o||10,n||10),r.mesh=new THREE.Mesh(r.geo,r.mat),r.add(r.mesh)}},MSMat:class extends THREE.MeshStandardMaterial{constructor(e,o){super({color:e||16711935,roughness:.4,side:o||0})}},ObjPicPlane:class extends THREE.Object3D{constructor(e,o,n,i,t){super();let r=this,s=(new THREE.TextureLoader).load(n);r.mat=new THREE.MeshBasicMaterial({map:s,transparent:!0,side:t||0}),r.geo=new THREE.PlaneGeometry(e,o,1,1),r.mesh=new THREE.Mesh(r.geo,r.mat),"x"===i?r.mesh.rotation.y=.5*Math.PI:"y"===i&&(r.mesh.rotation.x=-.5*Math.PI),r.add(r.mesh)}},ObjPicCylinder:class extends THREE.Object3D{constructor(e,o,n,i,t,r){super();let s=this,a=(new THREE.TextureLoader).load(n);s.mat=new THREE.MeshBasicMaterial({map:a,side:r||0}),s.geo=new THREE.CylinderGeometry(e||10,e||10,o||10,32,4,i),s.mesh=new THREE.Mesh(s.geo,s.mat),"x"===t?s.mesh.rotation.z=-.5*Math.PI:"z"===t?(s.mesh.rotation.y=.5*Math.PI,s.mesh.rotation.x=.5*Math.PI):"y"===t&&(s.mesh.rotation.y=.5*Math.PI),s.add(s.mesh)}},ObjPicSphere:class extends THREE.Object3D{constructor(e,o,n){super();let i=this,t=(new THREE.TextureLoader).load(o);i.mat=new THREE.MeshBasicMaterial({map:t,side:n||0}),i.geo=new THREE.SphereGeometry(e||10,32,16),i.mesh=new THREE.Mesh(i.geo,i.mat),i.add(i.mesh)}},ObjArrow:class extends THREE.Object3D{constructor(e,o){super();let n=new THREE.MeshStandardMaterial({color:o||16711935,roughness:.4}),i=new THREE.ConeGeometry(e||10,40,32);this.ArrowHead=new THREE.Mesh(i,n),this.ArrowHead.position.y=80,i=new THREE.CylinderGeometry(.5*(e||10),.5*(e||10),60,32,2),this.ArrowBody=new THREE.Mesh(i,n),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead),this.xx=0,this.yy=0,this.zz=0}setArrow(e,o,n){this.xx=.9*this.xx+.1*e,this.yy=.9*this.yy+.1*o,this.zz=.9*this.zz+.1*n;let i=this.xx**2+this.yy**2+this.zz**2,t=Math.sqrt(i);i>.001?(this.rotX.visible=!0,this.rotX.scale.y=t/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(this.yy/t),this.rotY.rotation.y=Math.atan2(this.xx,this.zz)}},ObjSpring:class extends THREE.Object3D{constructor(e,o,n,i,t){super();let r=e||20;this.L0=r;let s=[],a=i||5,c=o||5,h=n||.5;s.push(new THREE.Vector3(0,0,0)),s.push(new THREE.Vector3(0,.05*r,0));for(var l=0;l<=16*a;l++)s.push(new THREE.Vector3(c*Math.cos(2*l*Math.PI/16),r*(.05+.9*l/a/16),c*Math.sin(2*l*Math.PI/16)));s.push(new THREE.Vector3(0,.95*r,0)),s.push(new THREE.Vector3(0,r,0));let w=new THREE.CatmullRomCurve3(s),N=new THREE.MeshStandardMaterial({color:t||16711935,roughness:.4}),p=new THREE.TubeGeometry(w,500,h,12);this.mesh=new THREE.Mesh(p,N),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(e,o,n){let i=e*e+o*o+n*n,t=Math.sqrt(i);i>0?(this.rotX.visible=!0,this.rotX.scale.y=t/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(o/t),this.rotY.rotation.y=Math.atan2(e,n)}},Points:class extends THREE.Points{constructor(e,o,n){let i=o||1,t=e||16711935,r=new THREE.Color(t),s=n||1e4,a=new THREE.BufferGeometry,c=[];a.setAttribute("position",new THREE.Float32BufferAttribute(c,3)),a.computeBoundingSphere(),super(a,new THREE.PointsMaterial({size:i,map:TEACHER.Points.createCanvasMaterial("#"+r.getHexString(),64),transparent:!0,depthWrite:!1}));this.nnMax=s,this.nnNow=0,this.geometry=a,this.positions=c}static createCanvasMaterial(e,o){var n=document.createElement("canvas");n.width=n.height=o;var i=n.getContext("2d");i.imageSmoothingEnabled=!1;var t=new THREE.Texture(n),r=o/2;return i.beginPath(),i.arc(r,r,o/2-3,0,2*Math.PI,!1),i.closePath(),i.fillStyle=e,i.fill(),t.needsUpdate=!0,t}addPoint(e,o,n){let i=this;i.nnNow<i.nnMax?i.nnNow++:(log("TEACHER.Points 到達最大點數"),i.positions.shift(),i.positions.shift(),i.positions.shift()),i.positions.push(e,o,n)}clear(){this.positions=[],this.nnNow=0,this.update()}setPoint(e,o,n,i){let t=this;e>t.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):e>t.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(t.positions[3*e]=o,t.positions[3*e+1]=n,t.positions[3*e+2]=i)}getPoint(e){let o=this,n=new THREE.Vector3;return e>o.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):e>o.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(n.x=o.positions[3*e],n.y=o.positions[3*e+1],n.z=o.positions[3*e+2]),n}update(){this.geometry.setAttribute("position",new THREE.Float32BufferAttribute(this.positions,3)),this.geometry.computeBoundingSphere(),this.geometry.attributes.position.needsUpdate=!0}},Line:class extends THREE.Line2{constructor(e,o,n){let i=n||1e4,t=o||1;var r=new THREE.LineMaterial({color:e||16711935,linewidth:o||1});r.resolution.set(window.innerWidth,window.innerHeight);let s=new THREE.LineGeometry,a=new Float32Array(3*i);s.setPositions(a),super(s,r);let c=this;c.nnMax=i,c.lineWidth=t,c.nnNow=0,c.geometry=s,c.positions=a}addPoint(e,o,n){let i=this;if(i.nnNow<i.nnMax)i.nnNow++;else for(var t=0;t<i.nnMax-1;t++)i.positions[3*t]=i.positions[3*t+3],i.positions[3*t+1]=i.positions[3*t+4],i.positions[3*t+2]=i.positions[3*t+5];for(t=i.nnNow;t<=i.nnMax;t++)i.positions[3*(t-1)]=e,i.positions[3*(t-1)+1]=o,i.positions[3*(t-1)+2]=n}clear(){let e=this;for(var o=0;o<=e.nnMax;o++)e.positions[3*o]=0,e.positions[3*o+1]=0,e.positions[3*o+2]=0;e.nnNow=0,e.geometry.setPositions(e.positions)}setPoint(e,o,n,i){let t=this;e>t.nnMax||e>t.nnNow||(t.positions[3*e]=o,t.positions[3*e+1]=n,t.positions[3*e+2]=i)}getPoint(e){let o=this,n=new THREE.Vector3;return e>o.nnMax||e>o.nnNow||(n.x=o.positions[3*e],n.y=o.positions[3*e+1],n.z=o.positions[3*e+2]),n}update(){let e=this,o=e.getPoint(e.nnNow-1);for(var n=e.nnNow;n<=e.nnMax;n++)e.positions[3*n]=o.x,e.positions[3*n+1]=o.y,e.positions[3*n+2]=o.z;e.geometry.setPositions(e.positions)}},ObjTextPlane:class extends THREE.Object3D{constructor(e,o,n,i,t,r){super();let s=this,a=Math.round(Math.log2(e/o)),c=$("<canvas>").attr("width",String(128*Math.pow(2,a))).attr("height","128");s.stage=new createjs.Stage(c[0]);let h=new createjs.Container;if(r){let e=new createjs.Shape,o=new THREE.Color(r);e.graphics.c().f("#"+o.getHexString()).dr(0,0,128*Math.pow(2,a),128),h.addChild(e)}s.ctext=new createjs.Text;let l=new THREE.Color(t||16777215);s.ctext.color="#"+l.getHexString(),s.ctext.font="96px Arial",s.ctext.text=n||"",s.ctext.textAlign="center",s.ctext.textBaseline="middle",s.ctext.x=128*Math.pow(2,a)/2,s.ctext.y=64,h.addChild(s.ctext),s.stage.addChild(h),s.stage.update(),s.texture=new THREE.Texture(c[0]);var w=new THREE.MeshBasicMaterial({map:s.texture,transparent:!0}),N=new THREE.PlaneGeometry(e||10,o||10,1,1);s.texture.needsUpdate=!0,s.plane1=new THREE.Mesh(N,w),s.plane2=new THREE.Mesh(N,w),s.plane2.rotation.y=Math.PI;let p=new THREE.Object3D;p.add(s.plane1).add(s.plane2),"x"===i?p.rotation.y=.5*Math.PI:"y"===i&&(p.rotation.x=-.5*Math.PI),s.add(p)}setText(e){let o=this;o.ctext.text=e,o.stage.update(),o.texture.needsUpdate=!0}},ObjGraph:class extends THREE.Object3D{constructor(e,o,n,i,t,r,s){super();let a=this;a.objCon=new THREE.Object3D,a._xMin=e||0,a._xMax=o||10,a._yMin=n||0,a._yMax=i||10,a.divXN=5,a.divYN=4,a.frameMat=new THREE.LineBasicMaterial({color:t||16777215});for(var c=[],h=0;h<=a.divXN;h++)c.push(new THREE.Vector3(20*h-50,0,0)),c.push(new THREE.Vector3(20*h-50,50,0));for(var l=0;l<=a.divYN;l++)c.push(new THREE.Vector3(-50,12.5*l,0)),c.push(new THREE.Vector3(50,12.5*l,0));let w=(new THREE.BufferGeometry).setFromPoints(c);a.frame=new THREE.LineSegments(w,a.frameMat),a.objCon.add(a.frame),a.labelXMin=new TEACHER.ObjTextPlane(20,5,String(a._xMin),"z",t||16777215),a.labelXMin.position.x=-50,a.labelXMin.position.y=-3,a.objCon.add(a.labelXMin),a.labelXMax=new TEACHER.ObjTextPlane(20,5,String(a._xMax),"z",t||16777215),a.labelXMax.position.x=50,a.labelXMax.position.y=-3,a.objCon.add(a.labelXMax),a.labelYMin=new TEACHER.ObjTextPlane(20,5,String(a._yMin),"z",t||16777215),a.labelYMin.position.x=-53,a.labelYMin.position.y=0,a.objCon.add(a.labelYMin),a.labelYMax=new TEACHER.ObjTextPlane(20,5,String(a._yMax),"z",t||16777215),a.labelYMax.position.x=-53,a.labelYMax.position.y=50,a.objCon.add(a.labelYMax),a.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",t||16777215),a.labelX.position.x=60,a.labelX.position.y=4,a.labelX.position.z=1,a.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",t||16777215),a.labelY.position.x=-60,a.labelY.position.y=25,a.labelY.position.z=1,a.labelY.rotation.z=Math.PI/2,a.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",t||16777215),a.labelTitle.position.y=53,a.labelTitle.position.z=1,a.objCon.add(a.labelX).add(a.labelY).add(a.labelTitle),a._lineColor=r,a._nnMax=s,a.line=new TEACHER.Line(a._lineColor||16776960,2,a._nnMax),a.objCon.add(a.line),a.changeScale(),a.add(a.objCon)}addPoint(e,o){this.line.addPoint(e,o,0),this.line.update()}clear(){this.line.clear()}changeScale(){let e=this;e.line.scale.x=100/(e._xMax-e._xMin),e.line.scale.y=50/(e._yMax-e._yMin),e.line.position.x=-50-e._xMin*e.line.scale.x,e.line.position.y=-e._yMin*e.line.scale.y,e.labelXMin.setText(e._xMin),e.labelXMax.setText(e._xMax),e.labelYMin.setText(e._yMin),e.labelYMax.setText(e._yMax)}setLabel(e,o,n){this.labelTitle.setText(e||"y-x"),this.labelY.setText(o||"y"),this.labelX.setText(n||"x")}get xMin(){return this._xMin}set xMin(e){this._xMin=e,this.changeScale()}get xMax(){return this._xMax}set xMax(e){this._xMax=e,this.changeScale()}get yMin(){return this._yMin}set yMin(e){this._yMin=e,this.changeScale()}get yMax(){return this._yMax}set yMax(e){this._yMax=e,this.changeScale()}}},skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var logo=new TEACHER.ObjPicPlane(400,50,pics.logo,"z",2);function getMouse3D(e,o){let n,i=e||"y",t=new THREE.Vector3;"x"===i?n=new THREE.Vector3(1,0,0):"y"===i?n=new THREE.Vector3(0,1,0):"z"===i?n=new THREE.Vector3(0,0,1):log("錯誤!!");let r=new THREE.Vector2;return r.x=world2D.stage.mouseX/1600*2-1,r.y=-world2D.stage.mouseY/900*2+1,world3D.raycaster.setFromCamera(r,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(n),t),t}logo.position.z=-500,logo.position.y=125,world3D.scene.add(logo),init();