'use strict';var engine,render,runner,boxs,isDangerTotal,canvasGround,canvasWall,box3Ds,pointerBox,fps=60,log=console.log,dTheta=1,Engine=Matter.Engine,Render=Matter.Render,Runner=Matter.Runner,Bodies=Matter.Bodies,Constraint=Matter.Constraint,Composite=Matter.Composite,MouseConstraint=Matter.MouseConstraint,Mouse=Matter.Mouse,movingWait=200,L0=360,H0=50,D0=150,blockNNow=10,firstTime=!0,isDragingPointer=!1,nBPointer=0,phyMD=1,dangerBarTT=0,tt=160;function init(){engine=Engine.create(),engine.gravity.y=.8,engine.positionIterations=12,engine.constraintIterations=10,engine.velocityIterations=8,render=Render.create({canvas:canvasMatter[0],engine:engine,options:{width:1600,height:900,pixelRatio:1,background:"transparent",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!1,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}}),boxs=[];for(var a,c=0;10>c;c++)a=Bodies.rectangle(800+0*c,500,L0,50,{isStatic:!1,friction:.4,frictionAir:0,frictionStatic:.5,restitution:.7}),boxs.push(a);let d=Bodies.rectangle(500,800,600,20,{isStatic:!0,friction:.1,frictionAir:0,frictionStatic:.5}),e=Bodies.rectangle(790,1090,20,600,{isStatic:!0,friction:.1,frictionAir:0,frictionStatic:.5});Composite.add(engine.world,[d,e]),Composite.add(engine.world,boxs),Render.run(render),runner=Runner.create(),canvasGround=new ObjCanvasPlane(1e3,300,"y","textureGround",2),canvasGround.position.x=100,canvasGround.position.z=75,scene.add(canvasGround);let f=new TEACHER.ObjPlane(3e3,3e3,6710886,"x");f.position.y=-1500,scene.add(f),f=new TEACHER.ObjPlane(2600,3e3,6710886,"y"),f.position.x=-1700,scene.add(f),f=new TEACHER.ObjPlane(400,1425,6710886,"y"),f.position.x=-200,f.position.z=-825+75/2,scene.add(f),f=new TEACHER.ObjPlane(400,1275,6710886,"y"),f.position.x=-200,f.position.z=825+75/2,scene.add(f),canvasWall=new ObjCanvasPlane(1e3,600,"z","textureWall",2),canvasWall.position.x=100,canvasWall.position.y=300,canvasWall.position.z=-D0/2,scene.add(canvasWall),box3Ds=[];for(var c=0;10>c;c++){let a=new One3DBlock(c);scene.add(a),box3Ds.push(a)}pointerBox=new PointerBox,scene.add(pointerBox),world2D.btnFall.on("click",clickFall),world2D.btnRestore.on("click",clickResetore),world2D.btnPlus.on("click",clickBlockNowPN),world2D.btnMinus.on("click",clickBlockNowPN),world2D.btnReset.on("click",resetGame),resetGame();for(var c=0;10>c;c++)world2D.theBlocks["b"+(c+101+"").substring(1,3)].btnRight.on("mousedown",downBlockMove),world2D.theBlocks["b"+(c+101+"").substring(1,3)].btnLeft.on("mousedown",downBlockMove),world2D.theBlocks["b"+(c+101+"").substring(1,3)].nn.gotoAndStop(9-c);world2D.theBlocks.bPointer.btn.on("mousedown",downBPoint),world2D.on("pressup",myUp),world2D.chLengthMark.checked=!0,setInterval(tick,1e3/fps)}function tick(){if(tt--,100<tt?(world2D.logo.x=800,world2D.logo.y=450):0<tt&&(world2D.logo.x=800*tt/100+120*(100-tt)/100,world2D.logo.y=450*tt/100+60*(100-tt)/100,world2D.logo.scaleX=world2D.logo.scaleY=1*tt/100+.2*(100-tt)/100),1===phyMD){70>movingWait&&(movingWait--,1>movingWait&&(movingWait=1));let d=1e-4>Math.abs(Math.round(Math.sqrt(movingWait))-Math.sqrt(movingWait));for(var a,b=0;10>b;b++){a=boxs[b],a.upXc=0,a.upXmax=-1e3,a.upXmin=1e3;for(var c=b;10>c;c++){let e=boxs[c];e.xNow+=a.dx*(d?1:0),c>=b&&c<blockNNow&&(a.upXc+=e.xNow/(blockNNow-b),a.upXmax=Math.max(a.upXmax,e.xNow+.5*L0),a.upXmin=Math.min(a.upXmin,e.xNow-.5*L0))}Matter.Body.setPosition(a,{x:a.xNow+800-L0,y:800-50*(b+1)+15}),Matter.Body.setVelocity(a,{x:0,y:0}),Matter.Body.setAngle(a,0),Matter.Body.setAngularSpeed(a,0),Matter.Body.setAngularVelocity(a,0)}isDangerTotal=!1;for(var b=0;10>b;b++){let a=boxs[b];a.edge=0==b?L0:boxs[b-1].xNow+.5*L0,a.isDanger=1e-4<a.upXc-a.edge&&b<blockNNow,isDangerTotal=isDangerTotal||a.isDanger}}else if(2===phyMD);isDangerTotal&&firstTime&&(phyMD=2,firstTime=!1),isDragingPointer&&(nBPointer=-Math.round((world2D.stage.mouseY-world2D.theBlocks.y)/world2D.theBlocks.scaleY/60)),0>nBPointer?nBPointer=0:nBPointer>blockNNow-1&&(nBPointer=blockNNow-1),world2D.theBlocks.bPointer.y=world2D.theBlocks["b"+(nBPointer+101+"").substring(1,3)].y+30,world2D.theBlocks.bPointer.visible=world2D.chCenterMass.checked&&world2D.chWireframe.checked,world2D.theBlocks.scaleX=world2D.theBlocks.scaleY=7>blockNNow?1:6/blockNNow,world2D.dangerBar.visible=isDangerTotal&&1===phyMD,world2D.btnFall.visible=1===phyMD,world2D.btnRestore.visible=2===phyMD,Runner.tick(runner,engine),canvasWall.updateCanvasWall(),canvasGround.updateCanvasGround(),dangerBarTT++,dangerBarTT%=60;for(var b=0;10>b;b++){let a=box3Ds[b],c=boxs[b];a.position.x=c.position.x-800,a.position.y=800-c.position.y-10,a.rotation.z=-c.angle,a.visible=b<blockNNow,a.solid.visible=!world2D.chWireframe.checked,a.wf.visible=world2D.chWireframe.checked,a.dangerBar.visible=c.isDanger&&40>dangerBarTT&&world2D.chWireframe.checked&&1===phyMD,a.dangerBar.position.y=-.5*H0,a.dangerBar.position.x=c.edge-c.xNow}pointerBox.updateBox(),pointerBox.visible=world2D.chCenterMass.checked&&world2D.chWireframe.checked&&1===phyMD,world2D.blockN.gotoAndStop(blockNNow-1),world2D.chCenterMass.visible=world2D.chWireframe.checked,world3D.cameraTarget.y=.92*world3D.cameraTarget.y+.08*blockNNow*H0/2,world3D.render(),world2D.stage.update()}MyJS.myResize();function clickBlockNowPN(a){let b=a.target.name;"btnPlus"===b?blockNNow++:"btnMinus"===b&&blockNNow--,1>blockNNow?blockNNow=1:10<blockNNow&&(blockNNow=10);for(var c=0;10>c;c++)world2D.theBlocks["b"+(c+101+"").substring(1,3)].nn.gotoAndStop(blockNNow-1-c);resetGame()}function resetGame(){for(var a,c=0;10>c;c++)a=boxs[c],a.xNow=.5*L0+1200*(c<blockNNow?0:1),a.dx=0,a.upXc=.5*L0,a.upXmax=L0,a.upXmin=0,Matter.Body.setPosition(a,{x:a.xNow+800-L0,y:800-50*(c+1)+15}),Matter.Body.setVelocity(a,{x:0,y:0}),Matter.Body.setAngle(a,0),Matter.Body.setAngularSpeed(a,0),Matter.Body.setAngularVelocity(a,0),world2D.theBlocks["b"+(c+101+"").substring(1,3)].visible=c<blockNNow;phyMD=1,firstTime=!0}function downBlockMove(a){let b=a.target.parent.name,c=a.target.name;boxs[parseInt(b.substring(1,3))-1].dx="btnRight"===c?1:-1,firstTime=!0,movingWait=65}function downBPoint(){isDragingPointer=!0}function myUp(){isDragingPointer=!1;for(var a=0;10>a;a++)boxs[a].dx=0;movingWait=200}function clickFall(){isDangerTotal&&(phyMD=2)}function clickResetore(){for(var a,c=0;10>c;c++)a=boxs[c],Matter.Body.setPosition(a,{x:a.xNow+800-L0,y:800-50*(c+1)+15}),Matter.Body.setVelocity(a,{x:0,y:0}),Matter.Body.setAngle(a,0),Matter.Body.setAngularSpeed(a,0),Matter.Body.setAngularVelocity(a,0);phyMD=1}var One3DBlock=class extends THREE.Object3D{constructor(a){super();let b=this;b.index=a,b.color=new THREE.Color,b.color.setHSL(b.index/10,1,.65);let c=5;b.solid=new THREE.Object3D,b.add(b.solid);for(var d=0;2>d;d++){let a=new THREE.TextureLoader().load("allData/pics/FloorsCheckerboard_S_Normal.jpg");a.wrapS=a.wrapT=THREE.RepeatWrapping,a.repeat.set(1,1/3);let c=new TEACHER.ObjPlane(D0,H0,b.color.getHex(),"x");c.mat.normalMap=a,c.mat.normalScale.set(.6,.4),c.position.x=.5*L0*(1>d?-1:1),c.rotation.y=1>d?Math.PI:0,b.solid.add(c),a=new THREE.TextureLoader().load("allData/pics/FloorsCheckerboard_S_Normal.jpg"),a.wrapS=a.wrapT=THREE.RepeatWrapping,a.repeat.set(2,1),c=new TEACHER.ObjPlane(L0,D0,b.color.getHex(),"y"),c.mat.normalMap=a,c.mat.normalScale.set(.6,.4),c.position.y=.5*H0*(1>d?-1:1),c.rotation.x=1>d?Math.PI:0,b.solid.add(c),a=new THREE.TextureLoader().load("allData/pics/FloorsCheckerboard_S_Normal.jpg"),a.wrapS=a.wrapT=THREE.RepeatWrapping,a.repeat.set(2,1/3),c=new TEACHER.ObjPlane(L0,H0,b.color.getHex(),"z"),c.mat.normalMap=a,c.mat.normalScale.set(.6,.4),c.position.z=.5*D0*(1>d?-1:1),c.rotation.y=1>d?Math.PI:0,b.solid.add(c)}b.wf=new THREE.Object3D,b.add(b.wf);for(var d=0;4>d;d++){let a=new TEACHER.ObjBox(L0,c,c,b.color.getHex());a.position.y=.5*(H0-c)*(2>d?-1:1),a.position.z=.5*(D0-c)*(0==d%2?-1:1),b.wf.add(a),a=new TEACHER.ObjBox(c,H0,c,b.color.getHex()),a.position.x=.5*(L0-c)*(2>d?-1:1),a.position.z=.5*(D0-c)*(0==d%2?-1:1),b.wf.add(a),a=new TEACHER.ObjBox(c,c,D0,b.color.getHex()),a.position.x=.5*(L0-c)*(2>d?-1:1),a.position.y=.5*(H0-c)*(0==d%2?-1:1),b.wf.add(a)}b.dangerBar=new TEACHER.ObjBox(10,10,D0,16711680),b.dangerBar.position.x=L0/2-5/2,b.dangerBar.position.y=H0/2-5/2,b.add(b.dangerBar)}},PointerBox=class extends THREE.Object3D{constructor(){super();let a=this;a.barX=[],a.barY=[],a.barZ=[],a.dd=5;let b=16777215;for(var c=0;4>c;c++){let c=new TEACHER.ObjBox(100,a.dd,a.dd,b);a.add(c),a.barX.push(c),c=new TEACHER.ObjBox(a.dd,100,a.dd,b),a.add(c),a.barY.push(c),c=new TEACHER.ObjBox(a.dd,a.dd,100,b),a.add(c),a.barZ.push(c)}a.center=new TEACHER.ObjSphere(12,16777215),a.add(a.center),a.arrow=new TEACHER.ObjArrow(5,16777215),a.center.add(a.arrow)}updateBox(){let a=this,b=boxs[nBPointer].upXmax-boxs[nBPointer].upXmin+5,c=(boxs[nBPointer].upXmax+boxs[nBPointer].upXmin)/2,d=(blockNNow-nBPointer)*H0+5,e=(blockNNow+nBPointer)/2*H0;a.position.x=c-L0,a.position.y=e,a.center.position.x=boxs[nBPointer].upXc-c,a.arrow.setArrow(0,-d/2,0);for(var f=0;4>f;f++){let c=a.barX[f];c.scale.x=(a.dd+b)/100,c.position.y=d/2*(2>f?1:-1),c.position.z=(D0+5)/2*(0==f%2?1:-1),c=a.barY[f],c.scale.y=(a.dd+d)/100,c.position.x=b/2*(2>f?1:-1),c.position.z=(D0+5)/2*(0==f%2?1:-1),c=a.barZ[f],c.scale.z=(a.dd+D0+5)/100,c.position.y=d/2*(2>f?1:-1),c.position.x=b/2*(0==f%2?1:-1)}}},ObjCanvasPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=e;f.w=a||100,f.h=b||100,f.canvas=document.createElement("canvas"),f.canvas.width=f.w*g,f.canvas.height=f.h*g,f.stage=new createjs.Stage(f.canvas),f.groundTexture=new lib[d],f.groundTexture.scaleX=f.groundTexture.scaleY=g,f.stage.addChild(f.groundTexture),f.stage.update(),f.mapTexture=new THREE.Texture(f.canvas),f.mapTexture.needsUpdate=!0,f.mapMaterial=new THREE.MeshStandardMaterial({map:f.mapTexture,side:0,roughness:.6,transparent:!0}),f.mesh=new THREE.Mesh(new THREE.PlaneGeometry(f.w,f.h,1,1),f.mapMaterial),"y"===c?f.mesh.rotation.x=-Math.PI/2:"x"==c&&(f.mesh.rotation.y=Math.PI/2),f.add(f.mesh)}updateCanvasWall(){let a=this;for(var b=0;10>b;b++){let c=a.groundTexture["lm"+(b+101+"").substring(1,3)],d=boxs[b].xNow-.5*L0,e=0==b?0:boxs[b-1].xNow-.5*L0;c.visible=b<blockNNow&&world2D.chLengthMark.checked,c.x=.5*(e+d)+400-L0,c.y=600-H0*b-.5*H0,c.endR.x=.5*(d-e),c.endL.x=-c.endR.x,c.endR.scaleX=(15<Math.abs(d-e)?1:Math.abs(d-e)/15)*(0<d-e?1:-1),c.endL.scaleX=-c.endR.scaleX,c.barR.x=c.endR.x,c.barL.x=c.endL.x,c.barR.scaleX=Math.max(0,Math.abs(d-e)-80)/200,c.barL.scaleX=-c.barR.scaleX,c.tt360.textU.tt.text=Math.abs(Math.round(d-e))+"",c.tt360.scaleX=60<Math.abs(d-e)?1:Math.abs(d-e)/60}a.stage.update(),a.mapTexture.needsUpdate=!0}updateCanvasGround(){let a=this,b=0,c=L0;for(var d=0;d<blockNNow;d++)b=Math.max(b,boxs[d].xNow+.5*L0);let e=a.groundTexture.lm;e.visible=b>c&&world2D.chLengthMark.checked,e.x=.5*(c+b)+400-L0,e.y=150,e.endR.x=.5*(b-c),e.endL.x=-e.endR.x,e.endR.scaleX=(15<Math.abs(b-c)?1:Math.abs(b-c)/15)*(0<b-c?1:-1),e.endL.scaleX=-e.endR.scaleX,e.barR.x=e.endR.x,e.barL.x=e.endL.x,e.barR.scaleX=Math.max(0,Math.abs(b-c)-80)/200,e.barL.scaleX=-e.barR.scaleX,e.tt360.textU.tt.text=Math.abs(Math.round(b-c))+"",e.tt360.scaleX=60<Math.abs(b-c)?1:Math.abs(b-c)/60,a.stage.update(),a.mapTexture.needsUpdate=!0}},TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y"),logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2;function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}TEACHER.CCC=class{constructor(a){this.name=a}},init();