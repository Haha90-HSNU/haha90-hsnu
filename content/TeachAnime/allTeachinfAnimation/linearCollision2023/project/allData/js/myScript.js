'use strict';var mC,ballA,ballB,spring,mc,fps=60,log=console.log,gameMD=0,mA=10,mB=10,kk=20,ee=1,dt=.05,tt=0,L0=20,x01=0,x02=30,x1=0,x2=30,v01=10,v02=0,v1=10,v2=0,vc=0;let time01,time02,period,rr1,rr2,AA,A1,A2,xc;var graphics,isPlay=!1,isStep=!1,cameraFolloX=0,cameraFolloXNow=0;function init(){ballA=new TEACHER.ObjCylinder(5,5,65535,!1,"y"),ballB=new TEACHER.ObjCylinder(5,5,52224,!1,"y"),spring=new TEACHER.ObjSpring(L0,2,.3,8,16776960),scene.add(ballA).add(ballB).add(spring),ballA.arV=new TEACHER.ObjArrow(1,16776960),ballB.arV=new TEACHER.ObjArrow(1,16776960),generateMC(),logo.position.x=40,ground.position.x=50,world2D.slM2.minimum=0,world2D.slM2.maximum=10,world2D.slM2.value=5,world2D.slV2.minimum=-.5,world2D.slV2.maximum=.5,world2D.slV2.value=0,world2D.slV2.digitN=1,world2D.slEE.minimum=0,world2D.slEE.maximum=1,world2D.slEE.value=1,world2D.slEE.digitN=1,world2D.btnGo.on("click",clickBtn),world2D.btnPlayStop.on("click",clickBtn),world2D.btnReset.on("click",clickBtn),world2D.screen.chart.stop(),world2D.rbChartNone.on("click",clickRBChart),world2D.rbChartVT.on("click",clickRBChart),world2D.rbChartET.on("click",clickRBChart),world2D.rbChartFT.on("click",clickRBChart),world2D.rbChartVT.checked=!0,setRBChart("rbChartVT"),world2D.rbLookA.on("click",clickRBLook),world2D.rbLookB.on("click",clickRBLook),world2D.rbLookC.on("click",clickRBLook),world2D.rbLookG.on("click",clickRBLook),world2D.rbLookG.checked=!0,setRBLook("rbLookG"),world2D.chGround.checked=!0,graphics=new createjs.Graphics;var a=new createjs.Shape(graphics);world2D.screen.chart.addChild(a),setInterval(tick,1e3/fps)}function tick(){if(0===gameMD){tt=0,x1=x01,x2=x02,v1=v01,v02=v2=world2D.slV2.value*v01,mA=10,world2D.slM2.value=Math.round(world2D.slM2.value);let a;a=1>world2D.slM2.value?mA/10:5>world2D.slM2.value?mA/(5-world2D.slM2.value):10>world2D.slM2.value?mA*(world2D.slM2.value-4):10*mA,mB=.9*mB+.1*a,world2D.slM2.valueText.text=Math.round(10*(mB/mA))/10+"",vc=(mA*v1+mB*v2)/(mA+mB),ee=world2D.slEE.value,time01=(x02-x01-L0)/(v01-v02),period=2*Math.PI*Math.sqrt(mA*mB/(mA+mB)/kk),time02=Math.acos(-ee)*period/2/Math.PI+time01,rr1=L0*mB/(mA+mB),rr2=L0*mA/(mA+mB),AA=(v01-v02)*period/2/Math.PI,A1=AA*mB/(mA+mB),A2=AA*mA/(mA+mB),xc=(mA*x1+mB*x2)/(mA+mB),spring.setSpring(-L0,0,0)}else if(1===gameMD){if(tt+=dt*(isPlay?1:0)*(world2D.chSlow.checked?.2:1),tt<time01)x1=x01+v1*tt,x2=x02+v2*tt,xc=(mA*x1+mB*x2)/(mA+mB),spring.setSpring(-L0,0,0);else if(tt<time02)xc=x02+v02*time01-rr2+vc*(tt-time01),x1=xc-rr1+A1*Math.sin(2*Math.PI/period*(tt-time01)),x2=xc+rr2-A2*Math.sin(2*Math.PI/period*(tt-time01)),v1=vc+(v01-vc)*Math.cos(2*Math.PI/period*(tt-time01)),v2=vc+(v02-vc)*Math.cos(2*Math.PI/period*(tt-time01)),spring.setSpring(x1-x2,0,0);else if(tt<1.5*(time01+time02)){v1=(1+ee)*vc-ee*v01,v2=(1+ee)*vc-ee*v02;let a=x02+v02*time01-rr2+vc*(time02-time01);x1=a-rr1+A1*Math.sin(2*Math.PI/period*(time02-time01))+v1*(tt-time02),x2=a+rr2-A2*Math.sin(2*Math.PI/period*(time02-time01))+v2*(tt-time02),xc=(mA*x1+mB*x2)/(mA+mB),spring.setSpring(-rr1+A1*Math.sin(2*Math.PI/period*(time02-time01))-(rr2-A2*Math.sin(2*Math.PI/period*(time02-time01))),0,0)}else gameMD=2;}else if(2===gameMD);0!=gameMD&&(log(11),world2D.slEE.value=ee,world2D.slV2.value=v02/v01,world2D.slM2.value=mB/mA<1/9?0:1>mB/mA?5-mA/mB:9>mB/mA?mB/mA+4:10,world2D.slM2.valueText.text=Math.round(10*(mB/mA))/10+""),world2D.btnGo.visible=0===gameMD,world2D.btnReset.visible=2===gameMD,world2D.btnPlayStop.visible=1===gameMD,drawChart(),ballA.position.y=ballB.position.y=2.5,ballA.scale.x=ballA.scale.z=Math.sqrt(mA/10),ballB.scale.x=ballB.scale.z=Math.sqrt(mB/10),ballA.position.x=x1-5*ballA.scale.x,ballB.position.x=x2+5*ballB.scale.x,spring.position.x=x2,spring.position.y=2.5,mC.position.x=xc+5*(mB*ballB.scale.x-mA*ballA.scale.x)/(mA+mB),mC.visible=world2D.chMC.checked,ground.visible=world2D.chGround.checked,ballA.arV.setArrow(v1,0,0),ballB.arV.setArrow(v2,0,0),ballA.arV.position.x=ballA.position.x,ballB.arV.position.x=ballB.position.x,ballA.arV.position.y=ballB.arV.position.y=6,world2D.rbLookA.checked?cameraFolloX=ballA.position.x:world2D.rbLookB.checked?cameraFolloX=ballB.position.x:world2D.rbLookC.checked?cameraFolloX=mC.position.x:world2D.rbLookG.checked&&(cameraFolloX=40),cameraFolloXNow=1===gameMD?cameraFolloX:.9*cameraFolloXNow+.1*cameraFolloX;var a=18*world2D.slCameraRR.value/80;world3D.cameraTarget.y=-a*Math.sin(world3D.cameraTheta),world3D.cameraTarget.x=a*Math.cos(world3D.cameraTheta)*Math.sin(world3D.cameraPhi)+cameraFolloXNow,world3D.cameraTarget.z=a*Math.cos(world3D.cameraTheta)*Math.cos(world3D.cameraPhi),world3D.render(),world2D.stage.update()}MyJS.myResize();function clickBtn(a){var b=a.target.name;"btnGo"===b?(gameMD=1,isPlay=!0):"btnReset"===b?(gameMD=0,isPlay=!0):"btnPlayStop"===b&&(isPlay=!isPlay)}function drawChart(){let a=[],b=[],c=[],d=[],e=[];a.push([0,v01]),a.push([time01,v01]),b.push([0,v02]),b.push([time01,v02]),c.push([0,.5*(mA*v01*v01+mB*v02*v02)]),c.push([time01,.5*(mA*v01*v01+mB*v02*v02)]),d.push([0,0]),d.push([time01,0]),e.push([0,0]),e.push([time01,0]);for(var f=time01;f<=time02;f+=(time02-time01)/32){let g=vc+(v01-vc)*Math.cos(2*Math.PI/period*(f-time01)),h=vc+(v02-vc)*Math.cos(2*Math.PI/period*(f-time01)),i=x02-rr2+vc*(f-time01),j=i-rr1+A1*Math.sin(2*Math.PI/period*(f-time01)),k=i+rr2-A2*Math.sin(2*Math.PI/period*(f-time01));a.push([f,g]),b.push([f,h]),c.push([f,.5*(mA*g*g+mB*h*h)]),d.push([f,.5*(mA*v01*v01+mB*v02*v02)-.5*(mA*g*g+mB*h*h)]),e.push([f,kk*(L0+(j-k))])}let g=(1+ee)*vc-ee*v01,h=(1+ee)*vc-ee*v02;a.push([time02,g]),b.push([time02,h]),c.push([time02,.5*(mA*g*g+mB*h*h)]),d.push([time02,.5*(mA*v01*v01+mB*v02*v02)-.5*(mA*g*g+mB*h*h)]),e.push([time02,0]),a.push([1.5*(time01+time02),g]),b.push([1.5*(time01+time02),h]),c.push([1.5*(time01+time02),.5*(mA*g*g+mB*h*h)]),d.push([1.5*(time01+time02),.5*(mA*v01*v01+mB*v02*v02)-.5*(mA*g*g+mB*h*h)]),e.push([1.5*(time01+time02),0]);let j=a.length,k=120;if(graphics.clear(),world2D.rbChartVT.checked){world2D.screen.chart.gotoAndStop(0),graphics.setStrokeStyle(6,"round").beginStroke("#000000").mt(0,-10*a[0][1]+200);for(var l=0;l<j;l++)graphics.lt(a[l][0]*k,-10*a[l][1]+200);graphics.setStrokeStyle(3,"round").beginStroke("#00ffff").mt(0,-10*a[0][1]+200);for(var l=0;l<j;l++)graphics.lt(a[l][0]*k,-10*a[l][1]+200);graphics.setStrokeStyle(6,"round").beginStroke("#000000").mt(0,-10*b[0][1]+200);for(var l=0;l<j;l++)graphics.lt(b[l][0]*k,-10*b[l][1]+200);graphics.setStrokeStyle(3,"round").beginStroke("#00cc00").mt(0,-10*b[0][1]+200);for(var l=0;l<j;l++)graphics.lt(b[l][0]*k,-10*b[l][1]+200)}else if(world2D.rbChartET.checked){world2D.screen.chart.gotoAndStop(1);let a=200*(1/(.5*mA*v01*v01));graphics.setStrokeStyle(6,"round").beginStroke("#000000").mt(0,-a*c[0][1]+250);for(var l=0;l<j;l++)graphics.lt(c[l][0]*k,-a*c[l][1]+250);graphics.setStrokeStyle(3,"round").beginStroke("#ff6666").mt(0,-a*c[0][1]+250);for(var l=0;l<j;l++)graphics.lt(c[l][0]*k,-a*c[l][1]+250);graphics.setStrokeStyle(6,"round").beginStroke("#000000").mt(0,-a*d[0][1]+250);for(var l=0;l<j;l++)graphics.lt(d[l][0]*k,-a*d[l][1]+250);graphics.setStrokeStyle(3,"round").beginStroke("#ffff00").mt(0,-a*d[0][1]+250);for(var l=0;l<j;l++)graphics.lt(d[l][0]*k,-a*d[l][1]+250)}else if(world2D.rbChartFT.checked){world2D.screen.chart.gotoAndStop(2);let a=1.2;graphics.setStrokeStyle(6,"round").beginStroke("#000000").mt(0,a*e[0][1]+150);for(var l=0;l<j;l++)graphics.lt(e[l][0]*k,a*e[l][1]+150);graphics.setStrokeStyle(3,"round").beginStroke("#00ffff").mt(0,a*e[0][1]+150);for(var l=0;l<j;l++)graphics.lt(e[l][0]*k,a*e[l][1]+150);graphics.setStrokeStyle(6,"round").beginStroke("#000000").mt(0,-a*e[0][1]+150);for(var l=0;l<j;l++)graphics.lt(e[l][0]*k,-a*e[l][1]+150);graphics.setStrokeStyle(3,"round").beginStroke("#00cc00").mt(0,-a*e[0][1]+150);for(var l=0;l<j;l++)graphics.lt(e[l][0]*k,-a*e[l][1]+150)}world2D.screen.chart.visible=!world2D.rbChartNone.checked,world2D.screen.chart.timeBar.x=tt*k}function generateMC(){mC=new TEACHER.ObjCylinder(1.5,1,16724787,!1,"y"),mC.position.y=5.5;let a=new TEACHER.ObjBox(10,.6,.6,16724787);mC.add(a),a=new TEACHER.ObjBox(.6,.6,10,16724787),mC.add(a),scene.add(mC)}function clickRBChart(a){var b=a.target.parent.name;setRBChart(b)}function setRBChart(a){world2D.rbChartNone.checked="rbChartNone"===a,world2D.rbChartVT.checked="rbChartVT"===a,world2D.rbChartET.checked="rbChartET"===a,world2D.rbChartFT.checked="rbChartFT"===a}function clickRBLook(a){var b=a.target.parent.name;setRBLook(b)}function setRBLook(a){world2D.rbLookA.checked="rbLookA"===a,world2D.rbLookB.checked="rbLookB"===a,world2D.rbLookC.checked="rbLookC"===a,world2D.rbLookG.checked="rbLookG"===a}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}setArrowRTP(a,b,c){this.setArrow(a*Math.sin(b)*Math.sin(c),a*Math.cos(b),a*Math.sin(b)*Math.cos(c))}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}},TEACHER.ObjCreatejsPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=document.createElement("canvas");g.width=c,g.height=d,f.stage=new createjs.Stage(g),f.sprite=e,f.stage.addChild(f.sprite),f.stage.update(),f.mapTexture=new THREE.Texture(g),f.mapTexture.needsUpdate=!0;let h=new THREE.MeshBasicMaterial({map:f.mapTexture,side:2,transparent:!0});f.plane=new THREE.Mesh(new THREE.PlaneGeometry(a,b,1,1),h),f.add(f.plane)}update(){this.stage.update(),this.mapTexture.needsUpdate=!0}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(200,50,"allData/pics/ground.png","y");world3D.scene.add(ground);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();