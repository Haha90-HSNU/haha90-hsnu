"use strict";$("#mainAnimation").css("position","absolute").css("top","0px").css("left","0px").css("width","1600px").css("height","900px");var MyJS=MyJS||{};!function(){var a={};function e(){var e=1600,t=900,a=window.innerWidth,o=window.innerHeight,i=Math.min(a/e,o/t);$("#mainAnimation").css("width",i*e).css("height",i*t);var n=0,r=0;a/e<o/t?n=.5*(o-t*i):r=.5*(a-e*i),$("#mainAnimation").offset({top:n,left:r});for(var l=$("#mainAnimation").children(),s=l.length,c=0;c<s;c++){var p=l[c],d=i;"canvas"===$(p).attr("id")&&(d/=resolutionScale),$(p).css({"-webkit-transform":"scale("+d+")","-moz-transform":"scale("+d+")","-ms-transform":"scale("+d+")","-o-transform":"scale("+d+")",transform:"scale("+d+");"}).offset({top:n,left:r})}}!function(){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(a.isMobile=!0),a.isOpera=!!window.opr&&!!opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),a.isFirefox="undefined"!=typeof InstallTrigger,a.isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),a.isIE=!!document.documentMode,a.isEdge=!a.isIE&&!!window.StyleMedia,a.isChrome=!!window.chrome&&!!window.chrome.webstore,a.isBlink=(a.isChrome||a.isOpera)&&!!window.CSS;var e=window.navigator.userAgent,t=window.navigator.platform;-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?a.isMacOS=!0:-1!==["iPhone","iPad","iPod"].indexOf(t)?a.isIOS=!0:-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?a.isWondows=!0:/Android/.test(e)?a.isAndroid=!0:!os&&/Linux/.test(t)&&(a.isLinux=!0)}(),(MyJS.myResize=e)(),$("#mainAnimation").on("dragstart",function(e){e.preventDefault()}).css("margin","0px auto").css("overflow","hidden"),$(window).resize(e),$("body").prop("scroll","no").css("overflow","hidden"),MyJS.myFullScreen=function(){t=theWorld;var e=$("#mainAnimation").get(0);t.isFullscreened?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),t.isFullscreened=!1):(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),t.isFullscreened=!0)}}();var comp=AdobeAn.getComposition("98EA1A955B63F6489D0F00F6BFD1C4DE"),lib=comp.getLibrary(),world2D=new lib.myAnimate,canvas2D=$("<canvas>").attr("width","1600px").attr("height","900px"),canvas3D=$("<canvas>").attr("width","1600px").attr("height","900px");$("#mainAnimation").append(canvas3D).append(canvas2D);var stage2D=new createjs.Stage(canvas2D[0]);stage2D.enableMouseOver(1e3/30),stage2D.addChild(world2D),createjs.Touch.enable(stage2D),stage2D.update();var Stats=function(){function e(e){return o.appendChild(e.dom),e}function t(e){for(var t=0;t<o.children.length;t++)o.children[t].style.display=t===e?"block":"none";a=e}var a=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(e){e.preventDefault(),t(++a%o.children.length)},!1);var i,n=(performance||Date).now(),r=n,l=0,s=e(new Stats.Panel("FPS","#0ff","#002")),c=e(new Stats.Panel("MS","#0f0","#020"));return self.performance&&self.performance.memory&&(i=e(new Stats.Panel("MB","#f08","#201"))),t(0),{REVISION:16,dom:o,addPanel:e,showPanel:t,begin:function(){n=(performance||Date).now()},end:function(){l++;var e,t=(performance||Date).now();return c.update(t-n,200),r+1e3<t&&(s.update(1e3*l/(t-r),100),r=t,l=0,i)&&(e=performance.memory,i.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)),t},update:function(){n=this.end()},domElement:o,setMode:t}};Stats.Panel=function(a,o,i){var n=1/0,r=0,l=Math.round,s=l(window.devicePixelRatio||1),c=80*s,e=48*s,p=3*s,d=2*s,w=3*s,E=15*s,m=74*s,h=30*s,b=document.createElement("canvas");b.width=c,b.height=e,b.style.cssText="width:80px;height:48px";var R=b.getContext("2d");return R.font="bold "+9*s+"px Helvetica,Arial,sans-serif",R.textBaseline="top",R.fillStyle=i,R.fillRect(0,0,c,e),R.fillStyle=o,R.fillText(a,p,d),R.fillRect(w,E,m,h),R.fillStyle=i,R.globalAlpha=.9,R.fillRect(w,E,m,h),{dom:b,update:function(e,t){n=Math.min(n,e),r=Math.max(r,e),R.fillStyle=i,R.globalAlpha=1,R.fillRect(0,0,c,E),R.fillStyle=o,R.fillText(l(e)+" "+a+" ("+l(n)+"-"+l(r)+")",p,d),R.drawImage(b,w+s,E,m-s,h,w,E,m-s,h),R.fillRect(w+m-s,E,s,h),R.fillStyle=i,R.globalAlpha=.9,R.fillRect(w+m-s,E,s,l((1-e/t)*h))}}},"object"==typeof module&&(module.exports=Stats);var world3D={cameraRR:20};world3D.cameraTheta=90*Math.PI/180,world3D.cameraPhi=0*Math.PI/180,world3D.scene=new THREE.Scene;var scene=world3D.scene;world3D.camera=new THREE.PerspectiveCamera(60,1600/900,.01,1e5),world3D.cameraTarget=new THREE.Vector3(0,0,0),world3D.cameraDragAndRotate=!0,world3D.renderer=new THREE.WebGLRenderer({canvas:canvas3D[0],antialias:!0}),world3D.renderer.setSize(1600,900),world3D.raycaster=new THREE.Raycaster;var stats=new Stats;$("#mainAnimation").append(stats.dom),stats.dom.style.visibility="visible",Object.defineProperty(stats,"visible",{get:function(){return"visible"===stats.dom.style.visibility},set:function(e){stats.dom.style.visibility=e?"visible":"hidden"}}),stats.visible=!1;var directionalLight=new THREE.DirectionalLight(16777215,1);directionalLight.position.set(5,10,7.5),world3D.scene.add(directionalLight);var ambientLight=new THREE.AmbientLight(6710886);world3D.scene.add(ambientLight);var cpIU,cpIR,cpID,cpIL,cpWU,cpWR,cpWD,cpWL,gpImage,gpWireframe,gpObject,playersObject,playersImage,playersWireframe,eyeBallObj,eyeBallImg,mirror,viewLine,smallScreen,logo,fps=60,log=console.log,cos=Math.cos,sin=Math.sin,isEyeDragging=!1,isViewTweening=!1,viewTweenMD=0,viewTweenDir=1,topViewRR=200;function init(){ground.visible=!1,skyBox.visible=!1,cpIU=new THREE.Plane(new THREE.Vector3(0,1,0),0),cpID=new THREE.Plane(new THREE.Vector3(0,1,0),0),cpIR=new THREE.Plane(new THREE.Vector3(0,1,0),0),cpIL=new THREE.Plane(new THREE.Vector3(0,1,0),0),cpWU=new THREE.Plane(new THREE.Vector3(0,1,0),0),cpWD=new THREE.Plane(new THREE.Vector3(0,1,0),0),cpWR=new THREE.Plane(new THREE.Vector3(0,1,0),0),cpWL=new THREE.Plane(new THREE.Vector3(0,1,0),0),world3D.renderer.localClippingEnabled=!0,gpObject=new THREE.Group,gpImage=new THREE.Group,gpWireframe=new THREE.Group,scene.add(gpWireframe).add(gpImage).add(gpObject),playersImage=[],playersObject=[],playersWireframe=[],generatePlayers(),eyeBallObj=generateOneEyeBall("o"),gpObject.add(eyeBallObj),eyeBallImg=generateOneEyeBall("i"),gpImage.add(eyeBallImg),eyeBallImg.mat.clippingPlanes=[cpIU,cpID,cpIR,cpIL],mirror=generateMirror(),scene.add(mirror),(viewLine=new TEACHER.Line(6750054,3)).addPoint(-10,10,-100),viewLine.addPoint(0,10,100),viewLine.addPoint(10,10,-100),gpObject.add(viewLine),world2D.sl01.minimum=20,world2D.sl01.maximum=60,world2D.sl01.value=40,world2D.sl01.setLabel("鏡寬"),world2D.sl02.minimum=-20,world2D.sl02.maximum=20,world2D.sl02.setLabel("鏡轉"),world2D.ch01.setLabel("鏡外假像"),world2D.ch02.setLabel("上空俯視"),world2D.ch03.setLabel("觀察視野"),world2D.sl03.visible=!1,world2D.btn01.visible=!1,world2D.btn02.visible=!1,world2D.btnUp.visible=!1,world2D.btnRight.visible=!1,world2D.btnLeft.visible=!1,world2D.btnDown.visible=!1,(smallScreen=new createjs.Shape).graphics.ss(5).s("#ffffff").dr(800,450,797.5,447.5),world2D.addChild(smallScreen),world2D.slCameraRR.value=80,world3D.cameraTarget.y=15,world3D.camera2=world3D.camera.clone(),world3D.cameraTarget2=world3D.cameraTarget.clone(),(logo=new createjs.Bitmap("allData/pics/logo.png")).x=200,logo.y=200,logo.tt=200,world2D.addChild(logo),setInterval(tick,1e3/fps)}function tick(){if(0<logo.tt&&(logo.tt--,logo.tt<60&&(logo.scaleX=.2+logo.tt/60*.8,logo.scaleY=.2+logo.tt/60*.8,logo.x=20+logo.tt/60*80,logo.y=20+logo.tt/60*80)),0!==viewTweenMD||isViewTweening){var e,t;1!==viewTweenMD||isViewTweening?isViewTweening&&(world3D.cameraTarget.x=30*viewTweenMD,a=(1-viewTweenMD)*world3D.cameraTheta,e=(1-viewTweenMD)*world3D.cameraPhi,world3D.cameraRR=world2D.slCameraRR.value,t=(1-viewTweenMD)*world3D.cameraRR+viewTweenMD*topViewRR,world3D.camera.position.x=t*Math.sin(a)*Math.sin(e)+world3D.cameraTarget.x,world3D.camera.position.z=t*Math.sin(a)*Math.cos(e)+world3D.cameraTarget.z,world3D.camera.position.y=t*Math.cos(a)+world3D.cameraTarget.y,1<(viewTweenMD+=viewTweenDir/60)?(isViewTweening=!1,viewTweenMD=1,world3D.cameraPhi=0,world3D.cameraRR=40,world3D.cameraTheta=Math.PI/2,eyeBallObj.position.x=world3D.cameraRR*Math.sin(world3D.cameraTheta)*Math.sin(world3D.cameraPhi),eyeBallObj.position.y=world3D.cameraTarget.y,eyeBallObj.position.z=world3D.cameraRR*Math.sin(world3D.cameraTheta)*Math.cos(world3D.cameraPhi)):viewTweenMD<0&&(isViewTweening=!1,viewTweenMD=0,eyeBallObj.position.x=world3D.camera.position.x,eyeBallObj.position.y=world3D.camera.position.y,eyeBallObj.position.z=world3D.camera.position.z)):(isEyeDragging&&(o=getMouse3D("y",world3D.cameraTarget.y),world3D.cameraPhi=Math.atan2(o.x,o.z),Math.abs(world3D.cameraPhi)>65*Math.PI/180&&(world3D.cameraPhi=65*Math.PI/180*(0<world3D.cameraPhi?1:-1)),world3D.cameraRR=Math.sqrt(Math.pow(o.x,2)+Math.pow(o.z,2)),world3D.cameraRR<world2D.slCameraRR.minimum?world3D.cameraRR=world2D.slCameraRR.minimum:world3D.cameraRR>world2D.slCameraRR.maximum&&(world3D.cameraRR=world2D.slCameraRR.maximum),world3D.cameraTheta=Math.PI/2,world2D.slCameraRR.value=world3D.cameraRR),eyeBallObj.position.x=world3D.cameraRR*Math.sin(world3D.cameraTheta)*Math.sin(world3D.cameraPhi),eyeBallObj.position.y=world3D.cameraTarget.y,eyeBallObj.position.z=world3D.cameraRR*Math.sin(world3D.cameraTheta)*Math.cos(world3D.cameraPhi),world3D.camera.position.x=world3D.cameraTarget.x,world3D.camera.position.z=world3D.cameraTarget.z+.1,world3D.camera.position.y=topViewRR+world3D.cameraTarget.y,world3D.camera2.position.x=eyeBallObj.position.x,world3D.camera2.position.y=eyeBallObj.position.y,world3D.camera2.position.z=eyeBallObj.position.z)}else{if(world3D.camera.isDraging){var a=stage2D.mouseX,o=stage2D.mouseY;for(world3D.cameraPhi-=.005*(a-world3D.camera.oldMouseX);world3D.cameraPhi>Math.PI;)world3D.cameraPhi-=2*Math.PI;for(;world3D.cameraPhi<-Math.PI;)world3D.cameraPhi+=2*Math.PI;world3D.cameraTheta-=.005*(o-world3D.camera.oldMouseY),world3D.cameraTheta>.9999*Math.PI&&(world3D.cameraTheta=.9999*Math.PI),world3D.cameraTheta<1e-4*Math.PI&&(world3D.cameraTheta=1e-4*Math.PI),world3D.camera.oldMouseX=a,world3D.camera.oldMouseY=o}world3D.cameraRR=world2D.slCameraRR.value,world3D.camera.position.x=world3D.cameraRR*Math.sin(world3D.cameraTheta)*Math.sin(world3D.cameraPhi)+world3D.cameraTarget.x,world3D.camera.position.z=world3D.cameraRR*Math.sin(world3D.cameraTheta)*Math.cos(world3D.cameraPhi)+world3D.cameraTarget.z,world3D.camera.position.y=world3D.cameraRR*Math.cos(world3D.cameraTheta)+world3D.cameraTarget.y,eyeBallObj.position.x=world3D.camera.position.x,eyeBallObj.position.y=world3D.camera.position.y,eyeBallObj.position.z=world3D.camera.position.z}world3D.camera.fov=60*(1-viewTweenMD)+30*viewTweenMD,world2D.slCameraRR.visible=0===viewTweenMD,world3D.camera.lookAt(world3D.cameraTarget),eyeBallObj.visible=1===viewTweenMD,eyeBallObj.rotation.x=.5*Math.PI*viewTweenMD,eyeBallImg.rotation.x=-.5*Math.PI*viewTweenMD,eyeBallImg.position.x=eyeBallObj.position.x,eyeBallImg.position.y=eyeBallObj.position.y,eyeBallImg.position.z=-eyeBallObj.position.z,eyeBallImg.visible=(1===viewTweenMD||0===viewTweenMD)&&1<eyeBallObj.position.z,mirror.width=world2D.sl01.value,Math.abs(world2D.sl02.value)<3&&(world2D.sl02.value=0),mirror.theta=world2D.sl02.value*Math.PI/180,mirror.resetM(),gpWireframe.rotation.y=gpImage.rotation.y=2*mirror.rotation.y,gpWireframe.visible=world2D.ch01.checked,cpIU.setFromCoplanarPoints(eyeBallObj.position,mirror.vUL,mirror.vUR),cpID.setFromCoplanarPoints(eyeBallObj.position,mirror.vDR,mirror.vDL),cpIR.setFromCoplanarPoints(eyeBallObj.position,mirror.vUR,mirror.vDR),cpIL.setFromCoplanarPoints(eyeBallObj.position,mirror.vDL,mirror.vUL),cpWU.setFromCoplanarPoints(eyeBallObj.position,mirror.vUR,mirror.vUL),cpWD.setFromCoplanarPoints(eyeBallObj.position,mirror.vDL,mirror.vDR),cpWR.setFromCoplanarPoints(eyeBallObj.position,mirror.vDR,mirror.vUR),cpWL.setFromCoplanarPoints(eyeBallObj.position,mirror.vUL,mirror.vDL);viewLine.setPoint(0,eyeBallObj.position.x+10*(mirror.vUL.x-eyeBallObj.position.x),eyeBallObj.position.y+2,eyeBallObj.position.z+10*(mirror.vUL.z-eyeBallObj.position.z)),viewLine.setPoint(1,eyeBallObj.position.x,eyeBallObj.position.y+2,eyeBallObj.position.z),viewLine.setPoint(2,eyeBallObj.position.x+10*(mirror.vUR.x-eyeBallObj.position.x),eyeBallObj.position.y+2,eyeBallObj.position.z+10*(mirror.vUR.z-eyeBallObj.position.z)),viewLine.visible=1===viewTweenMD&&world2D.ch01.checked,viewLine.update(),world2D.ch02.checked&&viewTweenMD<1&&!isViewTweening?(isViewTweening=!0,viewTweenDir=1):!world2D.ch02.checked&&0<viewTweenMD&&!isViewTweening&&(isViewTweening=!0,viewTweenDir=-1),world2D.ch02.btnS.visible=!isViewTweening,gpImage.scale.y=gpObject.scale.y=gpWireframe.scale.y=mirror.scale.y=.1*viewTweenMD+(1-viewTweenMD),renderScreenBig(),world2D.ch03.visible=1===viewTweenMD,smallScreen.visible=1===viewTweenMD&&world2D.ch03.checked,1===viewTweenMD&&world2D.ch03.checked&&(viewLine.visible=!1,eyeBallObj.visible=!1,eyeBallImg.rotation.x=0,gpImage.scale.y=gpObject.scale.y=gpWireframe.scale.y=mirror.scale.y=1,world3D.camera2.lookAt(world3D.cameraTarget2),renderScreenSmall()),world2D.stage.update(),stats.update()}function renderScreenBig(){world3D.renderer.setViewport(0,0,1600,900),world3D.renderer.setScissor(0,0,1600,900),world3D.renderer.setScissorTest(!0),world3D.camera.aspect=1600/900,world3D.camera.updateProjectionMatrix(),world3D.renderer.render(scene,world3D.camera)}function renderScreenSmall(){world3D.renderer.setViewport(800,0,800,450),world3D.renderer.setScissor(800,0,800,450),world3D.renderer.setScissorTest(!0),world3D.renderer.render(scene,world3D.camera2)}function generatePlayers(){for(var e=0;e<5;e++){var t=generateOneMan("o");t.position.z=20+15*(e<3?0:1),t.position.x=15*(e<3?e-1:e-3.5),playersObject.push(t),gpObject.add(t);var a=generateOneMan("i");a.position.z=15*(e<3?0:-1)-20,a.position.x=15*(e<3?e-1:e-3.5),playersImage.push(a),gpImage.add(a);var o=generateOneMan("w","u"),i=generateOneMan("w","d"),t=generateOneMan("w","r"),a=generateOneMan("w","l");o.position.z=i.position.z=t.position.z=a.position.z=15*(e<3?0:-1)-20,o.position.x=i.position.x=t.position.x=a.position.x=15*(e<3?e-1:e-3.5),playersWireframe.push(o),playersWireframe.push(i),playersWireframe.push(t),playersWireframe.push(a),gpWireframe.add(o),gpWireframe.add(i),gpWireframe.add(t),gpWireframe.add(a)}var n=new TEACHER.ObjPicPlane(60,120,pics.groundO,"y"),r=new TEACHER.ObjPicPlane(60,120,pics.groundO,"y"),l=new TEACHER.ObjPicPlane(60,120,pics.groundO,"y"),s=new TEACHER.ObjPicPlane(60,120,pics.groundO,"y"),c=new TEACHER.ObjPicPlane(60,120,pics.groundI,"y");c.mat.clippingPlanes=[cpIU,cpID,cpIR,cpIL],gpObject.add(n).add(r).add(l).add(s),gpImage.add(c),n.mat.clippingPlanes=[cpWU],r.mat.clippingPlanes=[cpWD],l.mat.clippingPlanes=[cpWR],s.mat.clippingPlanes=[cpWL]}function generateOneMan(e,t){var a,o=new THREE.Object3D;return"o"===e?a=new TEACHER.ObjPicSphere(5,"allData/pics/man01.png"):"i"===e?(a=new TEACHER.ObjPicSphere(5,"allData/pics/man02.png")).mat.clippingPlanes=[cpIU,cpID,cpIR,cpIL]:"w"===e&&(a=new TEACHER.ObjPicSphere(5,"allData/pics/man03.png"),"u"===t?a.mat.clippingPlanes=[cpWU]:"d"===t?a.mat.clippingPlanes=[cpWD]:"r"===t?a.mat.clippingPlanes=[cpWR]:"l"===t&&(a.mat.clippingPlanes=[cpWL])),a.position.y=5,o.add(a),o}function generateMirror(){var e=new THREE.Object3D;e.width=40,e.height=20,e.theta=0,e.vUR=new THREE.Vector3,e.vUL=new THREE.Vector3,e.vDR=new THREE.Vector3,e.vDL=new THREE.Vector3;var t=16777011;return e.barU=new TEACHER.ObjBox(.8,.8,.8,t),e.barD=new TEACHER.ObjBox(.8,.8,.8,t),e.barR=new TEACHER.ObjBox(.8,.8,.8,t),e.barL=new TEACHER.ObjBox(.8,.8,.8,t),e.add(e.barU).add(e.barD).add(e.barR).add(e.barL),e.backM=new TEACHER.ObjPicPlane(e.height,e.height,"allData/pics/mirrorBack.png"),e.backR=new TEACHER.ObjPicPlane(e.height,e.height,"allData/pics/mirrorBack2.png"),e.backL=new TEACHER.ObjPicPlane(e.height,e.height,"allData/pics/mirrorBack2.png"),e.backR.position.y=e.backL.position.y=e.backM.position.y=.5*e.height,e.backR.rotation.y=e.backL.rotation.y=e.backM.rotation.y=Math.PI,e.add(e.backM).add(e.backL).add(e.backR),e.resetM=function(){e.barR.scale.y=e.barL.scale.y=(e.height-.8)/.8,e.barU.scale.x=e.barD.scale.x=(e.width+.8)/.8,e.barR.position.x=.5*e.width,e.barL.position.x=-.5*e.width,e.barR.position.y=e.barL.position.y=.5*e.height,e.barU.position.y=e.height,e.barD.position.y=0,e.rotation.y=e.theta,e.vUR.set(.5*e.width*cos(e.theta),e.height,-.5*e.width*sin(e.theta)),e.vUL.set(-.5*e.width*cos(e.theta),e.height,.5*e.width*sin(e.theta)),e.vDR.set(.5*e.width*cos(e.theta),0,-.5*e.width*sin(e.theta)),e.vDL.set(-.5*e.width*cos(e.theta),0,.5*e.width*sin(e.theta)),e.backR.scale.x=e.backL.scale.x=.5*(e.width-20)/20,e.backR.position.x=.5*(e.width-20)/2+10,e.backL.position.x=-.5*(e.width-20)/2-10},e.resetM(),e}function myMouseDown(e){var t;world3D.camera.oldMouseX=stage2D.mouseX,world3D.camera.oldMouseY=stage2D.mouseY,1===viewTweenMD?(t=getMouse3D("y",world3D.cameraTarget.y),Math.abs(t.x-eyeBallObj.position.x)<5&&Math.abs(t.z-eyeBallObj.position.z)<4&&(isEyeDragging=!0)):0===viewTweenMD&&(world3D.camera.isDraging=!0)}function myMouseMove(e){}function myMouseUp(e){world3D.camera.isDraging=!1,isEyeDragging=!1}function generateOneEyeBall(e){return new TEACHER.ObjPicPlane(10.24,8.64,"allData/pics/eye.png","z","i"===e?0:1)}MyJS.myResize(),world2D.btn3D.on("mousedown",myMouseDown),world2D.btn3D.on("pressmove",myMouseMove),world2D.btn3D.on("pressup",myMouseUp),world3D.camera.isDraging=!1,world3D.camera.oldMouseX=0,world3D.camera.oldMouseY=0,world2D.slCameraRR.minimum=10,world2D.slCameraRR.maximum=200,world2D.slCameraRR.value=80,world2D.slCameraRR.setLabel("遠近");var TEACHER={ObjPlane:function(e,t,a,o,i){var n=this;n.mat=new TEACHER.MSMat(a,i),n.geo=new THREE.PlaneGeometry(e||10,t||10,1,1),n.mesh=new THREE.Mesh(n.geo,n.mat),"x"===o?n.mesh.rotation.y=.5*Math.PI:"y"===o&&(n.mesh.rotation.x=-.5*Math.PI),THREE.Object3D.call(this,n.geo,n.mat),n.add(n.mesh)}};TEACHER.ObjPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPlane.prototype.constructor=TEACHER.ObjPlane,TEACHER.ObjCylinder=function(e,t,a,o,i,n){var r=this;r.mat=new TEACHER.MSMat(a,n),r.geo=new THREE.CylinderGeometry(e||10,e||10,t||10,32,2,o),r.mesh=new THREE.Mesh(r.geo,r.mat),"x"===i?r.mesh.rotation.z=-.5*Math.PI:"z"===i&&(r.mesh.rotation.x=.5*Math.PI),THREE.Object3D.call(this,r.geo,r.mat),r.add(r.mesh)},TEACHER.ObjCylinder.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjCylinder.prototype.constructor=TEACHER.ObjCylinder,TEACHER.ObjSphere=function(e,t,a){var o=this;o.mat=new TEACHER.MSMat(t,a),o.geo=new THREE.SphereGeometry(e||10,32,16),o.mesh=new THREE.Mesh(o.geo,o.mat),THREE.Object3D.call(this,o.geo,o.mat),o.add(o.mesh)},TEACHER.ObjSphere.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjSphere.prototype.constructor=TEACHER.ObjSphere,TEACHER.ObjBox=function(e,t,a,o,i){var n=this;n.mat=new TEACHER.MSMat(o,i),n.geo=new THREE.BoxGeometry(e||10,t||10,a||10),n.mesh=new THREE.Mesh(n.geo,n.mat),THREE.Object3D.call(this,n.geo,n.mat),n.add(n.mesh)},TEACHER.ObjBox.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjBox.prototype.constructor=TEACHER.ObjBox,TEACHER.MSMat=function(e,t){THREE.MeshStandardMaterial.call(this,{color:e||16711935,roughness:.4,side:t||0})},TEACHER.MSMat.prototype=Object.create(THREE.MeshStandardMaterial.prototype),TEACHER.MSMat.prototype.constructor=TEACHER.MSMat,TEACHER.ObjPicPlane=function(e,t,a,o,i){var n=this,a=(new THREE.TextureLoader).load(a);n.mat=new THREE.MeshBasicMaterial({map:a,transparent:!0,side:i||0}),n.geo=new THREE.PlaneGeometry(e,t,1,1),n.mesh=new THREE.Mesh(n.geo,n.mat),"x"===o?n.mesh.rotation.y=.5*Math.PI:"y"===o&&(n.mesh.rotation.x=-.5*Math.PI),THREE.Object3D.call(this),n.add(n.mesh)},TEACHER.ObjPicPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicPlane.prototype.constructor=TEACHER.ObjPicPlane,TEACHER.ObjPicCylinder=function(e,t,a,o,i,n){var r=this,a=(new THREE.TextureLoader).load(a);r.mat=new THREE.MeshBasicMaterial({map:a,side:n||0}),r.geo=new THREE.CylinderGeometry(e||10,e||10,t||10,32,4,o),r.mesh=new THREE.Mesh(r.geo,r.mat),"x"===i?r.mesh.rotation.z=-.5*Math.PI:"z"===i?(r.mesh.rotation.y=.5*Math.PI,r.mesh.rotation.x=.5*Math.PI):"y"===i&&(r.mesh.rotation.y=.5*Math.PI),THREE.Object3D.call(this,r.geo,r.mat),r.add(r.mesh)},TEACHER.ObjPicCylinder.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicCylinder.prototype.constructor=TEACHER.ObjPicCylinder,TEACHER.ObjPicSphere=function(e,t,a){var o=this,t=(new THREE.TextureLoader).load(t);o.mat=new THREE.MeshBasicMaterial({map:t,side:a||0}),o.geo=new THREE.SphereGeometry(e||10,32,16),o.mesh=new THREE.Mesh(o.geo,o.mat),THREE.Object3D.call(this,o.geo,o.mat),o.add(o.mesh)},TEACHER.ObjPicSphere.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicSphere.prototype.constructor=TEACHER.ObjPicSphere,TEACHER.ObjArrow=function(e,t){var a=new THREE.MeshStandardMaterial({color:t||16711935,roughness:.4}),t=new THREE.ConeGeometry(e||10,40,32);this.ArrowHead=new THREE.Mesh(t,a),this.ArrowHead.position.y=80,t=new THREE.CylinderGeometry(.5*(e||10),.5*(e||10),60,32,2),this.ArrowBody=new THREE.Mesh(t,a),this.ArrowBody.position.y=30,THREE.Object3D.call(this),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)},TEACHER.ObjArrow.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjArrow.prototype.constructor=TEACHER.ObjArrow,TEACHER.ObjArrow.prototype.setArrow=function(e,t,a){var o=e*e+t*t+a*a,i=Math.sqrt(o);0<o?(this.rotX.visible=!0,this.rotX.scale.y=i/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(t/i),this.rotY.rotation.y=Math.atan2(e,a)},TEACHER.ObjSpring=function(e,t,a,o,i){var n=e||20;this.L0=n;let r=[];var l=o||5,s=t||5,t=a||.5;r.push(new THREE.Vector3(0,0,0)),r.push(new THREE.Vector3(0,.05*n,0));for(var c=0;c<=16*l;c++)r.push(new THREE.Vector3(s*Math.cos(2*c*Math.PI/16),n*(.05+.9*c/l/16),s*Math.sin(2*c*Math.PI/16)));r.push(new THREE.Vector3(0,.95*n,0)),r.push(new THREE.Vector3(0,n,0));a=new THREE.CatmullRomCurve3(r),i=new THREE.MeshStandardMaterial({color:i||16711935,roughness:.4}),t=new THREE.TubeGeometry(a,500,t,12);this.mesh=new THREE.Mesh(t,i),THREE.Object3D.call(this),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)},TEACHER.ObjSpring.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjSpring.prototype.constructor=TEACHER.ObjSpring,TEACHER.ObjSpring.prototype.setSpring=function(e,t,a){var o=e*e+t*t+a*a,i=Math.sqrt(o);0<o?(this.rotX.visible=!0,this.rotX.scale.y=i/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(t/i),this.rotY.rotation.y=Math.atan2(e,a)},TEACHER.Points=function(e,t,a){var o=this,t=t||1,e=e||16711935;let i=new THREE.Color(e);o.nnMax=a||1e4,o.nnNow=0,o.geometry=new THREE.BufferGeometry,o.positions=[],o.geometry.setAttribute("position",new THREE.Float32BufferAttribute(o.positions,3)),o.geometry.computeBoundingSphere();t=new THREE.PointsMaterial({size:t,map:o.createCanvasMaterial("#"+i.getHexString(),64),transparent:!0,depthWrite:!1});THREE.Points.call(this,o.geometry,t)},TEACHER.Points.prototype=Object.create(THREE.Points.prototype),TEACHER.Points.prototype.constructor=TEACHER.Points,TEACHER.Points.prototype.createCanvasMaterial=function(e,t){var a=document.createElement("canvas");a.width=a.height=t;var o=a.getContext("2d");o.imageSmoothingEnabled=!1;var i=new THREE.Texture(a),a=t/2;return o.beginPath(),o.arc(a,a,t/2-3,0,2*Math.PI,!1),o.closePath(),o.fillStyle=e,o.fill(),i.needsUpdate=!0,i},TEACHER.Points.prototype.addPoint=function(e,t,a){var o=this;o.nnNow<o.nnMax?o.nnNow++:(log("TEACHER.Points 到達最大點數"),o.positions.shift(),o.positions.shift(),o.positions.shift()),o.positions.push(e,t,a)},TEACHER.Points.prototype.clear=function(){this.positions=[],this.nnNow=0,this.update()},TEACHER.Points.prototype.setPoint=function(e,t,a,o){var i=this;e>i.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):e>i.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(i.positions[3*e]=t,i.positions[3*e+1]=a,i.positions[3*e+2]=o)},TEACHER.Points.prototype.getPoint=function(e){var t=this;let a=new THREE.Vector3;return e>t.nnMax?log("輸入的n值大於TEACHER.Points 最大點數 nnMax"):e>t.nnNow?log("輸入的n值大於TEACHER.Points 現在點數 nnNow"):(a.x=t.positions[3*e],a.y=t.positions[3*e+1],a.z=t.positions[3*e+2]),a},TEACHER.Points.prototype.update=function(){this.geometry.setAttribute("position",new THREE.Float32BufferAttribute(this.positions,3)),this.geometry.computeBoundingSphere(),this.geometry.attributes.position.needsUpdate=!0},TEACHER.Line=function(e,t,a){var o=this;o.nnMax=a||1e4,o.lineWidth=t||1,o.nnNow=0;t=new THREE.LineMaterial({color:e||16711935,linewidth:t||1});t.resolution.set(window.innerWidth,window.innerHeight),o.geometry=new THREE.LineGeometry,o.positions=new Float32Array(3*o.nnMax),o.geometry.setPositions(o.positions),THREE.Line2.call(this,o.geometry,t)},TEACHER.Line.prototype=Object.create(THREE.Line2.prototype),TEACHER.Line.prototype.constructor=TEACHER.Line,TEACHER.Line.prototype.addPoint=function(e,t,a){var o=this;if(o.nnNow<o.nnMax)o.nnNow++;else{log("TEACHER.Line 到達最大點數");for(var i=0;i<o.nnMax-1;i++)o.positions[3*i]=o.positions[3*i+3],o.positions[3*i+1]=o.positions[3*i+4],o.positions[3*i+2]=o.positions[3*i+5]}for(i=o.nnNow;i<=o.nnMax;i++)o.positions[3*(i-1)]=e,o.positions[3*(i-1)+1]=t,o.positions[3*(i-1)+2]=a},TEACHER.Line.prototype.clear=function(){this.positions=new Float32Array(3*this.nnMax),this.nnNow=0,this.update()},TEACHER.Line.prototype.setPoint=function(e,t,a,o){var i=this;e>i.nnMax?log("輸入的n值大於TEACHER.Line 最大點數 nnMax"):e>i.nnNow?log("輸入的n值大於TEACHER.Line 現在點數 nnNow"):(i.positions[3*e]=t,i.positions[3*e+1]=a,i.positions[3*e+2]=o)},TEACHER.Line.prototype.getPoint=function(e){var t=this;let a=new THREE.Vector3;return e>t.nnMax?log("輸入的n值大於TEACHER.Line 最大點數 nnMax"):e>t.nnNow?log("輸入的n值大於TEACHER.Line 現在點數 nnNow"):(a.x=t.positions[3*e],a.y=t.positions[3*e+1],a.z=t.positions[3*e+2]),a},TEACHER.Line.prototype.update=function(){for(var e=this,t=e.getPoint(e.nnNow-1),a=e.nnNow;a<=e.nnMax;a++)e.positions[3*a]=t.x,e.positions[3*a+1]=t.y,e.positions[3*a+2]=t.z;e.geometry.setPositions(e.positions)},TEACHER.ObjTextPlane=function(e,t,a,o,i,n){var r=this,l=Math.round(Math.log2(e/t)),s=$("<canvas>").attr("width",String(128*Math.pow(2,l))).attr("height","128");r.stage=new createjs.Stage(s[0]);let c=new createjs.Container;if(n){let e=new createjs.Shape,t=new THREE.Color(n);e.graphics.c().f("#"+t.getHexString()).dr(0,0,128*Math.pow(2,l),128),c.addChild(e)}r.ctext=new createjs.Text;let p=new THREE.Color(i||16777215);r.ctext.color="#"+p.getHexString(),r.ctext.font="96px Arial",r.ctext.text=a||"",r.ctext.textAlign="center",r.ctext.textBaseline="middle",r.ctext.x=128*Math.pow(2,l)/2,r.ctext.y=64,c.addChild(r.ctext),r.stage.addChild(c),r.stage.update(),r.texture=new THREE.Texture(s[0]);s=new THREE.MeshBasicMaterial({map:r.texture,transparent:!0}),t=new THREE.PlaneGeometry(e||10,t||10,1,1);r.texture.needsUpdate=!0,r.plane1=new THREE.Mesh(t,s),r.plane2=new THREE.Mesh(t,s),r.plane2.rotation.y=Math.PI;let d=new THREE.Object3D;d.add(r.plane1).add(r.plane2),"x"===o?d.rotation.y=.5*Math.PI:"y"===o&&(d.rotation.x=-.5*Math.PI),THREE.Object3D.call(this),r.add(d)},TEACHER.ObjTextPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjTextPlane.prototype.constructor=TEACHER.ObjTextPlane,TEACHER.ObjTextPlane.prototype.setText=function(e){this.ctext.text=e,this.stage.update(),this.texture.needsUpdate=!0},TEACHER.ObjGraph=function(e,t,a,o,i,n,r){var l=this;l.objCon=new THREE.Object3D,l._xMin=e||0,l._xMax=t||10,l._yMin=a||0,l._yMax=o||10,l.divXN=5,l.divYN=4,l.frameMat=new THREE.LineBasicMaterial({color:i||16777215});for(var s=[],c=0;c<=l.divXN;c++)s.push(new THREE.Vector3(20*c-50,0,0)),s.push(new THREE.Vector3(20*c-50,50,0));for(var p=0;p<=l.divYN;p++)s.push(new THREE.Vector3(-50,12.5*p,0)),s.push(new THREE.Vector3(50,12.5*p,0));o=(new THREE.BufferGeometry).setFromPoints(s);l.frame=new THREE.LineSegments(o,l.frameMat),l.objCon.add(l.frame),l.labelXMin=new TEACHER.ObjTextPlane(20,5,String(l._xMin),"z",i||16777215),l.labelXMin.position.x=-50,l.labelXMin.position.y=-3,l.objCon.add(l.labelXMin),l.labelXMax=new TEACHER.ObjTextPlane(20,5,String(l._xMax),"z",i||16777215),l.labelXMax.position.x=50,l.labelXMax.position.y=-3,l.objCon.add(l.labelXMax),l.labelYMin=new TEACHER.ObjTextPlane(20,5,String(l._yMin),"z",i||16777215),l.labelYMin.position.x=-53,l.labelYMin.position.y=0,l.objCon.add(l.labelYMin),l.labelYMax=new TEACHER.ObjTextPlane(20,5,String(l._yMax),"z",i||16777215),l.labelYMax.position.x=-53,l.labelYMax.position.y=50,l.objCon.add(l.labelYMax),l.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",i||16777215),l.labelX.position.x=60,l.labelX.position.y=4,l.labelX.position.z=1,l.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",i||16777215),l.labelY.position.x=-60,l.labelY.position.y=25,l.labelY.position.z=1,l.labelY.rotation.z=Math.PI/2,l.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",i||16777215),l.labelTitle.position.y=53,l.labelTitle.position.z=1,l.objCon.add(l.labelX).add(l.labelY).add(l.labelTitle),l._lineColor=n,l._nnMax=r,l.line=new TEACHER.Line(l._lineColor||16776960,2,l._nnMax),l.objCon.add(l.line),l.changeScale(),THREE.Object3D.call(this),l.add(l.objCon)},TEACHER.ObjGraph.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjGraph.prototype.constructor=TEACHER.ObjGraph,Object.defineProperty(TEACHER.ObjGraph.prototype,"xMin",{get:function(){return this._xMin},set:function(e){this._xMin=e,this.changeScale()}}),Object.defineProperty(TEACHER.ObjGraph.prototype,"xMax",{get:function(){return this._xMax},set:function(e){this._xMax=e,this.changeScale()}}),Object.defineProperty(TEACHER.ObjGraph.prototype,"yMin",{get:function(){return this._yMin},set:function(e){this._yMin=e,this.changeScale()}}),Object.defineProperty(TEACHER.ObjGraph.prototype,"yMax",{get:function(){return this._yMax},set:function(e){this._yMax=e,this.changeScale()}}),TEACHER.ObjGraph.prototype.addPoint=function(e,t){this.line.addPoint(e,t,0),this.line.update()},TEACHER.ObjGraph.prototype.clear=function(){this.line.clear()},TEACHER.ObjGraph.prototype.changeScale=function(){var e=this;e.line.scale.x=100/(e._xMax-e._xMin),e.line.scale.y=50/(e._yMax-e._yMin),e.line.position.x=-50-e._xMin*e.line.scale.x,e.line.position.y=-e._yMin*e.line.scale.y,e.labelXMin.setText(e._xMin),e.labelXMax.setText(e._xMax),e.labelYMin.setText(e._yMin),e.labelYMax.setText(e._yMax)},TEACHER.ObjGraph.prototype.setLabel=function(e,t,a){this.labelTitle.setText(e||"y-x"),this.labelY.setText(t||"y"),this.labelX.setText(a||"x")};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");function getMouse3D(e,t){var a=e||"y";let o;e=new THREE.Vector3;"x"===a?o=new THREE.Vector3(1,0,0):"y"===a?o=new THREE.Vector3(0,1,0):"z"===a?o=new THREE.Vector3(0,0,1):log("錯誤!!");let i=new THREE.Vector2;return i.x=world2D.stage.mouseX/1600*2-1,i.y=-world2D.stage.mouseY/900*2+1,world3D.raycaster.setFromCamera(i,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(o,-t||0),e),e}world3D.scene.add(ground),init();