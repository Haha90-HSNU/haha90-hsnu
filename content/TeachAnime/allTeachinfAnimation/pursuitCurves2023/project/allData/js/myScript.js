'use strict';var app,ctx,ballA,ballBs,fps=60,log=console.log,gameType="B",isActive=!1,gameAMD=1,nnBmax=20,nnBnow=8,vA=2,vB=1,isPlay=!1,tt=0,dt=1;const dd=50;function init(){ctx=canvasCanvas[0].getContext("2d"),ballA=new lib.ballA,ballA.x=800,ballA.y=450,world2D.balls.addChild(ballA),ballBs=[];for(var a=0;a<nnBmax;a++){let b=new lib.ballB;b.x=500+30*a,b.y=400+30*a,world2D.balls.addChild(b),ballBs.push(b)}world2D.balls.ball00A.visible=world2D.balls.ball00B.visible=!1,world2D.btnPlayStop.on("click",clickPlayStop),world2D.btnReset.on("click",clickReset),world2D.controlMain.btnTypeA.on("click",clickMBtn),world2D.controlMain.btnTypeB.on("click",clickMBtn),world2D.controlA.rbLine.on("click",clickRB),world2D.controlA.rbCircle.on("click",clickRB),world2D.controlA.rbFree.on("click",clickRB),world2D.controlA.rbCircle.checked=!0,setGameAMD(2),world2D.controlA.vADirector.on("mousedown",function(){world2D.controlA.vADirector.isDragging=!0}),world2D.on("pressup",function(){world2D.controlA.vADirector.isDragging=!1}),world2D.controlB.slNNB.minimum=1,world2D.controlB.slNNB.maximum=20,world2D.controlB.slNNB.value=16,world2D.controlB.slVBVA.minimum=5,world2D.controlB.slVBVA.maximum=100,world2D.controlB.slVBVA.value=40,clickReset(),setInterval(tick,1e3/fps)}function tick(){isActive&&(world2D.controlMain.title.x=.98*world2D.controlMain.title.x+180*.02,world2D.controlMain.title.y=.98*world2D.controlMain.title.y+70*.02,world2D.controlMain.title.scaleX=world2D.controlMain.title.scaleY=.98*world2D.controlMain.title.scaleX+.8*.02,world2D.controlMain.btnTypeA.x=.98*world2D.controlMain.btnTypeA.x+110*.02,world2D.controlMain.btnTypeA.y=.98*world2D.controlMain.btnTypeA.y+165*.02,world2D.controlMain.btnTypeA.scaleX=world2D.controlMain.btnTypeA.scaleY=.98*world2D.controlMain.btnTypeA.scaleX+.02,world2D.controlMain.btnTypeB.x=.98*world2D.controlMain.btnTypeB.x+110*.02,world2D.controlMain.btnTypeB.y=.98*world2D.controlMain.btnTypeB.y+5,world2D.controlMain.btnTypeB.scaleX=world2D.controlMain.btnTypeB.scaleY=.98*world2D.controlMain.btnTypeB.scaleX+.02,world2D.controlMain.pointer.x=.98*world2D.controlMain.pointer.x+25*.02,world2D.controlMain.pointer.y=.98*world2D.controlMain.pointer.y+.02*("A"===gameType?165:250),world2D.controlMain.bg.scaleX=.98*world2D.controlMain.bg.scaleX),tt+=isPlay?dt:0;let a=isPlay?dt:0;if("A"===gameType){if(0===tt)if(world2D.controlB.slNNB.value=nnBnow=Math.round(world2D.controlB.slNNB.value),1===gameAMD){ballA.x0=ballA.x=200,ballA.y0=ballA.y=500;for(var b=0;b<nnBmax;b++){let a=ballBs[b];a.x0=a.x=200+2*b*dd,a.y0=a.y=200}}else if(2===gameAMD){ballA.x0=ballA.x=1100,ballA.y0=ballA.y=450;for(var b=0;b<nnBmax;b++){let a=ballBs[b];a.x0=a.x=800+500*Math.cos(2*b*Math.PI/nnBnow),a.y0=a.y=450+500*Math.sin(2*b*Math.PI/nnBnow)}}else if(3===gameAMD){ballA.x0=ballA.x=800,ballA.y0=ballA.y=450;for(var b=0;b<nnBmax;b++){let a=ballBs[b];a.x0=a.x=800+500*Math.cos(2*b*Math.PI/nnBnow),a.y0=a.y=450+500*Math.sin(2*b*Math.PI/nnBnow)}}vB=vA*(1+Math.round(world2D.controlB.slVBVA.value-50)/50),world2D.controlB.slVBVA.valueText.text=Math.round(10*(vB/vA))/10;let c=ballA.x,d=ballA.y;if(1===gameAMD)ballA.x+=vA*a,ballA.arrow.rotation=0;else if(2===gameAMD){let b=Math.atan2(ballA.y-450,ballA.x-800),c=Math.sqrt(Math.pow(ballA.y-450,2)+Math.pow(ballA.x-800,2)),d=vA/c;ballA.x=800+c*Math.cos(b+d*a),ballA.y=450+c*Math.sin(b+d*a),ballA.arrow.rotation=180*b/Math.PI+90}else if(3===gameAMD){world2D.controlA.vADirector.isDragging?(world2D.controlA.vADirector.btnC.x=.8*world2D.controlA.vADirector.btnC.x+.2*(stage2D.mouseX-world2D.controlA.vADirector.x),world2D.controlA.vADirector.btnC.y=.8*world2D.controlA.vADirector.btnC.y+.2*(stage2D.mouseY-world2D.controlA.vADirector.y)):(world2D.controlA.vADirector.btnC.x=.8*world2D.controlA.vADirector.btnC.x,world2D.controlA.vADirector.btnC.y=.8*world2D.controlA.vADirector.btnC.y);let b=Math.sqrt(Math.pow(world2D.controlA.vADirector.btnC.x,2)+Math.pow(world2D.controlA.vADirector.btnC.y,2)),c=Math.atan2(world2D.controlA.vADirector.btnC.y,world2D.controlA.vADirector.btnC.x);30<b&&(world2D.controlA.vADirector.btnC.x=30*Math.cos(c),world2D.controlA.vADirector.btnC.y=30*Math.sin(c)),ballA.x+=b/30*vA*Math.cos(c)*a,ballA.y+=b/30*vA*Math.sin(c)*a,ballA.arrow.rotation=180*c/Math.PI}world2D.controlA.vADirector.visible=3===gameAMD;for(var b=0;b<nnBmax;b++){let c=ballBs[b],d=c.x,e=c.y,f=Math.atan2(ballA.y-c.y,ballA.x-c.x);c.x+=vB*Math.cos(f)*a,c.y+=vB*Math.sin(f)*a,c.arrow.rotation=180*f/Math.PI,c.visible=b<nnBnow,c.textB.gotoAndStop(1===nnBnow?0:b+1),b<nnBnow&&0<tt&&(drawLine(ctx,d,e,c.x,c.y,"rgb(0,255,255)",5),world2D.controlB.chConnect.checked&&1==tt%60&&drawLine(ctx,ballA.x,ballA.y,c.x,c.y,"rgb(255,128,255)",3))}0<tt&&drawLine(ctx,c,d,ballA.x,ballA.y,"yellow",5)}else if("B"===gameType){if(0===tt){world2D.controlB.slNNB.value=nnBnow=Math.round(Math.max(world2D.controlB.slNNB.value,3));for(var b=0;b<nnBmax;b++){let a=ballBs[b];a.x0=a.x=800+400*Math.cos(2*(b+.5)*Math.PI/nnBnow),a.y0=a.y=450+400*Math.sin(2*(b+.5)*Math.PI/nnBnow)}}for(var b=0;b<nnBmax;b++){let a=ballBs[b],c=ballBs[b+1<nnBnow?b+1:0];a.xOld=a.x,a.yOld=a.y,c.xOld=c.x,c.yOld=c.y;let d=Math.atan2(c.y-a.y,c.x-a.x);a.vx=vA*Math.cos(d),a.vy=vA*Math.sin(d),a.arrow.rotation=180*d/Math.PI,a.visible=b<nnBnow,a.textB.gotoAndStop(b+1),world2D.controlB.chConnect.checked&&1==tt%60&&b<nnBnow&&drawLine(ctx,a.x,a.y,c.x,c.y,"rgb(255,128,255)",3)}for(var b=0;b<nnBnow;b++){let c=ballBs[b];c.x+=c.vx*a,c.y+=c.vy*a,0<tt&&drawLine(ctx,c.xOld,c.yOld,c.x,c.y,"rgb(0,255,255)",5)}}ballA.visible=world2D.controlA.visible="A"===gameType,world2D.controlB.slVBVA.visible="A"===gameType,isActive||(isPlay=!0,world2D.controlA.visible=world2D.controlB.visible=world2D.btnPlayStop.visible=world2D.btnReset.visible=!1),world2D.fpsText.y=-500,world2D.stage.update()}MyJS.myResize();function clickMBtn(a){let b=a.target.name,c=b.charAt(7);gameType==c&&isActive||(setToGameType(c),world2D.controlB.visible=world2D.btnPlayStop.visible=world2D.btnReset.visible=!0),isActive=!0}function setToGameType(a){gameType=a,clickReset()}function clickPlayStop(){isPlay=!isPlay}function clickReset(){if(tt=0,isPlay=!1,resetCTX(),world2D.controlB.slNNB.value=nnBnow,"A"===gameType){ballA.x=ballA.x0,ballA.y=ballA.y0;for(var a=0;a<nnBmax;a++){let b=ballBs[a];b.x=b.x0,b.y=b.y0}}}function resetCTX(){let a=ctx.createLinearGradient(0,0,0,900);a.addColorStop(0,"rgb(0,128,0)"),a.addColorStop(1,"rgb(0,64,0)"),ctx.fillStyle=a,ctx.fillRect(0,0,1600,900),ctx.strokeStyle="rgb(0,200,0)",ctx.lineWidth=1,ctx.beginPath();for(var b=0;1600>=b;b+=dd)ctx.moveTo(b,0),ctx.lineTo(b,900);for(var c=0;900>=c;c+=dd)ctx.moveTo(0,c),ctx.lineTo(1600,c);ctx.stroke()}function clickRB(a){let b,c=a.target.parent.name;"rbLine"===c?b=1:"rbCircle"===c?b=2:"rbFree"===c&&(b=3),world2D.controlA.rbLine.checked=1===b,world2D.controlA.rbCircle.checked=2===b,world2D.controlA.rbFree.checked=3===b,b!=gameAMD&&setGameAMD(b)}function setGameAMD(a){gameAMD=a,resetCTX(),tt=0,isPlay=!1}function drawLine(a,b,c,d,e,f="black",g=3){a.beginPath(),a.lineCap="round",a.moveTo(b,c),a.lineTo(d,e),a.strokeStyle=f,a.lineWidth=g,a.stroke()}init();