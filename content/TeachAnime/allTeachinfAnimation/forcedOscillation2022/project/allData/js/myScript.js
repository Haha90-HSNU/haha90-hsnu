'use strict';var wall,pointer,fps=60,log=console.log,nn=10,balls=[],springs=[],omegas=[],kings=[],ballR=5,wallR=2,L0=40,kk=2,beta=.12,AA=3,tt=0,theta=0,dt=.1,dtnn=10;function init(){wall=new TEACHER.ObjBox(20*ballR,2*ballR,2*wallR,39321),wall.position.z=L0+wallR,scene.add(wall);for(var a,b=0;b<nn;b++){a=new TEACHER.ObjSphere(ballR,65535),a.position.x=-50+10*(b+.5),scene.add(a),balls.push(a),a.vz=0,a.vzOld=0,a.mm=1;var c=new TEACHER.ObjSpring(L0,(.2+.055*b)*ballR,.1+.08*b,8,16776960);c.position.x=a.position.x,scene.add(c),springs.push(c),c.kk=1+.6*b;var d=.4,e=new THREE.Object3D;kings.push(e),e.position.x=c.position.x,e.position.y=7,scene.add(e),e.barSU=new TEACHER.ObjBox(5,d,d,16711935),e.barSD=new TEACHER.ObjBox(5,d,d,16711935),e.barSM=new TEACHER.ObjBox(5,d,d,16711935),e.barSV=new TEACHER.ObjBox(d,d,2*AA,16711935),e.barArrowS=new TEACHER.ObjArrow(.6,16711935),e.barArrowS.setArrow(0,5,0),e.barArrowS.position.y=-5,e.barOU=new TEACHER.ObjBox(5,d,d,16711935),e.barOD=new TEACHER.ObjBox(5,d,d,16711935),e.barOM=new TEACHER.ObjBox(5,d,d,16711935),e.barOV=new TEACHER.ObjBox(d,d,100,16711935),e.barArrowO=new TEACHER.ObjArrow(.6,16711935),e.barArrowO.setArrow(0,5,0),e.barArrowO.position.y=-5,e.add(e.barSU).add(e.barSD).add(e.barSM).add(e.barSV).add(e.barArrowS),e.add(e.barOU).add(e.barOD).add(e.barOM).add(e.barOV).add(e.barArrowO),e.zU=e.zD=0,e.zUTarget=e.zDTarget=0,e.barSU.position.z=L0+AA,e.barSD.position.z=L0-AA,e.barSM.position.z=L0,e.barSV.position.z=L0}pointer=new TEACHER.ObjArrow(2,16711935),pointer.setArrow(0,0,-10),pointer.position.z=55,pointer.position.y=5,scene.add(pointer),ground.position.y=-ballR,world2D.sl01.minimum=.6,world2D.sl01.maximum=2.8,world2D.sl01.value=1.8,world2D.sl01.setLabel("\u983B\u7387"),world2D.sl01.valueText.visible=!1,world2D.sl02.visible=world2D.sl03.visible=!1,world2D.ch01.setLabel("\u6162\u52D5\u4F5C"),world2D.ch02.setLabel("SHM"),world2D.btn01.visible=world2D.btn02.visible=world2D.btnRight.visible=world2D.btnLeft.visible=world2D.btnUp.visible=world2D.btnDown.visible=!1,world2D.slCameraRR.value=130,setInterval(tick,1e3/fps)}function tick(){var a=world2D.ch01.checked;tt+=dt*(a?.2:1);var b=world2D.sl01.value;theta+=b*dt*(a?.2:1),theta%=2*Math.PI,pointer.position.x=10*((b*b-1)/.6)-45,wall.position.z=L0+3*Math.sin(theta)+wallR;for(var c=0;c<nn;c++){var d=balls[c],e=springs[c],f=d.position.z-(wall.position.z-wallR)+L0,g=-e.kk*f-beta*d.vz;g/=d.mm,d.vz+=g*dt*(a?.2:1),d.position.z+=d.vz*dt*(a?.2:1),e.position.z=wall.position.z-wallR,e.setSpring(0,0,-L0+f+ballR);var h=kings[c];h.visible=world2D.ch02.checked,0>=d.vz*d.vzOld&&(0<d.position.z?h.zUTarget=d.position.z:h.zDTarget=d.position.z),h.zU=.9*h.zU+.1*h.zUTarget,h.zD=.9*h.zD+.1*h.zDTarget,d.vzOld=d.vz,h.barOU.position.z=h.zU,h.barOD.position.z=h.zD,h.barOM.position.z=.5*(h.zU+h.zD),h.barOV.position.z=.5*(h.zU+h.zD),h.barOV.scale.z=(h.zU-h.zD)/100,h.barArrowO.position.z=d.position.z,h.barArrowS.position.z=wall.position.z-wallR}world3D.render(),world2D.stage.update()}MyJS.myResize();var TEACHER={};TEACHER.ObjPlane=function(a,b,c,d,e){let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),THREE.Object3D.call(this,f.geo,f.mat),f.add(f.mesh)},TEACHER.ObjPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPlane.prototype.constructor=TEACHER.ObjPlane,TEACHER.ObjCylinder=function(a,b,c,d,e,f){let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),THREE.Object3D.call(this,g.geo,g.mat),g.add(g.mesh)},TEACHER.ObjCylinder.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjCylinder.prototype.constructor=TEACHER.ObjCylinder,TEACHER.ObjSphere=function(a,b,c){let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),THREE.Object3D.call(this,d.geo,d.mat),d.add(d.mesh)},TEACHER.ObjSphere.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjSphere.prototype.constructor=TEACHER.ObjSphere,TEACHER.ObjBox=function(a,b,c,d,e){let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),THREE.Object3D.call(this,f.geo,f.mat),f.add(f.mesh)},TEACHER.ObjBox.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjBox.prototype.constructor=TEACHER.ObjBox,TEACHER.MSMat=function(a,b){THREE.MeshStandardMaterial.call(this,{color:a||16711935,roughness:.4,side:b||0})},TEACHER.MSMat.prototype=Object.create(THREE.MeshStandardMaterial.prototype),TEACHER.MSMat.prototype.constructor=TEACHER.MSMat,TEACHER.ObjPicPlane=function(a,b,c,d,e){let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),THREE.Object3D.call(this),f.add(f.mesh)},TEACHER.ObjPicPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicPlane.prototype.constructor=TEACHER.ObjPicPlane,TEACHER.ObjPicCylinder=function(a,b,c,d,e,f){let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.z=-.5*Math.PI):"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),THREE.Object3D.call(this,g.geo,g.mat),g.add(g.mesh)},TEACHER.ObjPicCylinder.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicCylinder.prototype.constructor=TEACHER.ObjPicCylinder,TEACHER.ObjPicSphere=function(a,b,c){let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),THREE.Object3D.call(this,d.geo,d.mat),d.add(d.mesh)},TEACHER.ObjPicSphere.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjPicSphere.prototype.constructor=TEACHER.ObjPicSphere,TEACHER.ObjArrow=function(a,b){let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,THREE.Object3D.call(this),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)},TEACHER.ObjArrow.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjArrow.prototype.constructor=TEACHER.ObjArrow,TEACHER.ObjArrow.prototype.setArrow=function(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)},TEACHER.ObjSpring=function(a,b,c,d,e){let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),THREE.Object3D.call(this),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)},TEACHER.ObjSpring.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjSpring.prototype.constructor=TEACHER.ObjSpring,TEACHER.ObjSpring.prototype.setSpring=function(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)},TEACHER.Points=function(a,b,c){let d=this,e=new THREE.Color(a||16711935);d.nnMax=c||1e4,d.nnNow=0,d.geometry=new THREE.BufferGeometry,d.positions=[],d.geometry.setAttribute("position",new THREE.Float32BufferAttribute(d.positions,3)),d.geometry.computeBoundingSphere();let f=new THREE.PointsMaterial({size:b||1,map:d.createCanvasMaterial("#"+e.getHexString(),64),transparent:!0,depthWrite:!1});THREE.Points.call(this,d.geometry,f)},TEACHER.Points.prototype=Object.create(THREE.Points.prototype),TEACHER.Points.prototype.constructor=TEACHER.Points,TEACHER.Points.prototype.createCanvasMaterial=function(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e},TEACHER.Points.prototype.addPoint=function(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c),d.geometry.setAttribute("position",new THREE.Float32BufferAttribute(d.positions,3)),d.geometry.computeBoundingSphere(),d.geometry.attributes.position.needsUpdate=!0},TEACHER.Points.prototype.clear=function(){let a=this;a.positions=[],a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0,a.nnNow=0},TEACHER.Line=function(a,b){let c=this;c.nnMax=b||1e4,c.nnNow=0;let d=new THREE.MeshBasicMaterial({color:a||16711935});c.geometry=new THREE.BufferGeometry,c.positions=[],c.geometry.setAttribute("position",new THREE.Float32BufferAttribute(c.positions,3)),c.geometry.computeBoundingSphere(),c.geometry.dynamic=!0,THREE.Line.call(this,c.geometry,d)},TEACHER.Line.prototype=Object.create(THREE.Line.prototype),TEACHER.Line.prototype.constructor=TEACHER.Line,TEACHER.Line.prototype.addPoint=function(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c),d.geometry.setAttribute("position",new THREE.Float32BufferAttribute(d.positions,3)),d.geometry.computeBoundingSphere(),d.geometry.attributes.position.needsUpdate=!0},TEACHER.Line.prototype.clear=function(){let a=this;a.positions=[],a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0,a.nnNow=0},TEACHER.ObjTextPlane=function(a,b,c,d,e,f){let g=this,h=Math.round(Math.log2(a/b));log(h);let i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),THREE.Object3D.call(this),g.add(n)},TEACHER.ObjTextPlane.prototype=Object.create(THREE.Object3D.prototype),TEACHER.ObjTextPlane.prototype.constructor=TEACHER.ObjTextPlane,TEACHER.ObjTextPlane.prototype.setText=function(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,pics.ground,"y");world3D.scene.add(ground);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.z=-50,logo.position.y=100/8/2,world3D.scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();