'use strict';var fps=60,log=console.log,sin=Math.sin,cos=Math.cos,tan=Math.tan,titleTime=120,courseMD=2,gameMD=0,isPlay=!0,tt=0,dt=.1;const gg=10;var theRotator,downDesk01,downDesk02,downDesk03,energy0,rrMin,rrMax,L0,dJ=0,omega0=1,omega=omega0,r0=30,rr=r0,y0=40,yy=y0,vr=0;const massB=r0*omega0*omega0/10;var massC,ballTrace,traceTime=0;function init(){theRotator=new THREE.Object3D,downDesk01=new THREE.Object3D,downDesk02=new THREE.Object3D,downDesk03=new THREE.Object3D,buildRotator(),buildDownDesk(),scene.add(theRotator).add(downDesk01).add(downDesk02).add(downDesk03),ballTrace=new FireSmoke(100),scene.add(ballTrace),world3D.cameraTarget.y=-30,world2D.btnCourse01.on("click",clickBtnCourese),world2D.btnCourse02.on("click",clickBtnCourese),world2D.btnCourse03.on("click",clickBtnCourese),world2D.control01.slHandY.value=40,world2D.control02.btnJ1.on("mousedown",downJBtn),world2D.control02.btnJ1.on("pressup",upJBtn),world2D.control02.btnJ2.on("mousedown",downJBtn),world2D.control02.btnJ2.on("pressup",upJBtn),world2D.control02.btnReset.on("click",clickBtn),world2D.control03.btnMassC.on("click",clickBtn),world2D.control03.btnReset.on("click",clickBtn),setInterval(tick,1e3/fps)}function tick(){if(titleTime--,60<titleTime?(world2D.title.x=800,world2D.title.y=450,world2D.title.scaleX=world2D.title.scaleY=2.8):0<titleTime&&(world2D.title.x=(800*titleTime+240*(60-titleTime))/60,world2D.title.y=(450*titleTime+70*(60-titleTime))/60,world2D.title.scaleX=world2D.title.scaleY=(2.8*titleTime+.9*(60-titleTime))/60),world2D.chSlow.checked?(dt-=.002,.01>dt&&(dt=.01),traceTime+=.5):(dt+=.002,.1<dt&&(dt=.1),traceTime+=1),1===courseMD)rr=r0-(world2D.control01.slHandY.value-40)/2.5,theRotator.setRR(rr),omega=omega0*r0*r0/rr/rr,theRotator.rotation.y+=omega*dt,yy=y0+(r0-rr),downDesk01.mB.position.y=-yy,downDesk01.wire.scale.y=yy/y0,downDesk01.wire.position.y=-.5*yy;else if(2===courseMD){if(0===gameMD)rr=r0,theRotator.setRR(r0),theRotator.rotation.y+=omega0*dt,downDesk02.mB.position.y=-y0,downDesk02.wire.scale.y=1,downDesk02.wire.position.y=-.5*y0,vr+=(4>Math.abs(vr)?.1:.2)*dJ,30<vr&&(vr=30),-30>vr&&(vr=-30),world2D.control02.theJBar.jBar.scaleX=Math.abs(vr)/30;else if(1===gameMD){let a=-10*massB+L0*L0/rr**3;rr+=vr*dt+.5*a*dt*dt,vr+=a*dt;let b=energy0-L0*L0/2/rr/rr-massB*gg*(rr-r0);0<b?vr=Math.sqrt(2*b)*(0<vr?1:-1):(vr=0,rr=Math.abs(rr-rrMin)>Math.abs(rr-rrMax)?rrMax:rrMin),omega=L0/rr**2,theRotator.setRR(rr),theRotator.rotation.y+=omega*dt,yy=y0+(r0-rr),downDesk02.mB.position.y=-yy,downDesk02.wire.scale.y=yy/y0,downDesk02.wire.position.y=-.5*yy}downDesk02.arJ.setArrow(0,vr,0),downDesk02.arJ.position.y=downDesk02.mB.position.y,downDesk02.arJ.visible=0===gameMD,world2D.control02.btnJ1.visible=world2D.control02.btnJ2.visible=0===gameMD,world2D.control02.btnReset.visible=1===gameMD}else if(3===courseMD){if(world2D.control03.slMassC.value=10*Math.round(world2D.control03.slMassC.value/10),50>world2D.control03.slMassC.value?(massC=10*(massB/(60-world2D.control03.slMassC.value)),world2D.control03.slMassC.l1.gotoAndStop(1),world2D.control03.slMassC.l2.gotoAndStop(Math.round(massB/massC))):50<world2D.control03.slMassC.value?(massC=massB*(world2D.control03.slMassC.value-40)/10,world2D.control03.slMassC.l1.gotoAndStop(Math.round(massC/massB)),world2D.control03.slMassC.l2.gotoAndStop(1)):(massC=massB,world2D.control03.slMassC.l1.gotoAndStop(1),world2D.control03.slMassC.l2.gotoAndStop(1)),downDesk03.mC.scale.x=downDesk03.mC.scale.z=Math.sqrt(massC/massB),0===gameMD)rr=r0,theRotator.setRR(r0),theRotator.rotation.y+=omega0*dt,downDesk03.mB.position.y=-y0+20,downDesk03.mC.position.y=-y0+20-18,downDesk03.wire.scale.y=1,downDesk03.wire.position.y=-.5*y0+10;else if(1===gameMD){let a=-10*(massB+massC)+L0*L0/rr**3;rr+=vr*dt+.5*a*dt*dt,vr+=a*dt;let b=energy0-L0*L0/2/rr/rr-(massB+massC)*gg*(rr-r0);0<b?vr=Math.sqrt(2*b)*(0<vr?1:-1):(vr=0,rr=Math.abs(rr-rrMin)>Math.abs(rr-rrMax)?rrMax:rrMin),omega=L0/rr**2,theRotator.setRR(rr),theRotator.rotation.y+=omega*dt,yy=y0+(r0-rr),downDesk03.mB.position.y=-yy+20,downDesk03.wire.scale.y=(yy-20)/(y0-20),downDesk03.wire.position.y=-.5*(yy-20),downDesk03.mC.position.y=-yy+20-18,downDesk03.wire2.position.y=-yy+20-9}downDesk03.wire2.visible=1===gameMD,world2D.control03.btnMassC.visible=0===gameMD,world2D.control03.btnReset.visible=1===gameMD}if(ballTrace.visible=world2D.chTrace.checked,!ballTrace.visible)ballTrace.zero();else if(.9995<traceTime){let a=rr*cos(theRotator.rotation.y),b=-rr*sin(theRotator.rotation.y);ballTrace.addOne(a,3,b,1,0,0,8),ballTrace.update(),traceTime=0}world2D.control01.visible=downDesk01.visible=1===courseMD,world2D.control02.visible=downDesk02.visible=2===courseMD,world2D.control03.visible=downDesk03.visible=3===courseMD,world3D.render(),world2D.stage.update()}MyJS.myResize();function clickBtnCourese(a){let b=a.target.name,c=parseInt(b.charAt(10));courseMD!=c&&(courseMD=c,gameMD=0,world2D.control01.slHandY.value=40,dJ=0,vr=0)}function downJBtn(a){let b=a.target.name;"btnJ1"===b?dJ=1:"btnJ2"===b&&(dJ=-1)}function upJBtn(){L0=r0*r0*omega0,energy0=.5*vr*vr+.5*(omega0*r0)**2,rrMax=findRootRR(100*r0),rrMin=findRootRR(r0/1e3),gameMD=1}function clickBtn(a){let b=a.target.name;"btnReset"===b?(ballTrace.zero(),rr=r0,gameMD=0,dJ=0,vr=0):"btnMassC"===b&&(gameMD=1,L0=r0*r0*omega0,energy0=.5*vr*vr+.5*(omega0*r0)**2,rrMax=r0,rrMin=findRootRR03(r0/1e3))}function buildRotator(){var a=new THREE.Object3D;scene.add(a),ground.position.y=-100;let b=new THREE.BoxGeometry(2,2,2),c=new TEACHER.MSMat(6710886);for(var d=0;5>d;d++){let e=new THREE.Mesh(b,c);e.scale.x=51,e.position.z=-50+25*d,e.position.y=-1,a.add(e),e=new THREE.Mesh(b,c),e.scale.z=51,e.position.x=-50+25*d,e.position.y=-1,a.add(e)}for(var d=0;4>d;d++){let b=new TEACHER.ObjBox(2,100,2,6710886);b.position.x=45*(0==d%2?1:-1),b.position.z=45*(2>d?-1:1),b.position.y=-50,a.add(b)}let e=new TEACHER.ObjCylinder(3.5,4,16750848);e.position.y=-1,theRotator.add(e),b=new THREE.TorusGeometry(2,1.5,32,32),c=new TEACHER.MSMat(16750848),e=new THREE.Mesh(b,c),e.rotation.x=Math.PI/2,e.position.y=1,theRotator.add(e),theRotator.ball=new TEACHER.ObjSphere(3,16711680),theRotator.ball.position.x=r0+3,theRotator.ball.position.y=3,theRotator.add(theRotator.ball),theRotator.wire=new TEACHER.ObjCylinder(.5,r0,16776960,!0,"x"),theRotator.wire.position.x=r0/2+2,theRotator.wire.position.y=3,theRotator.add(theRotator.wire),b=new THREE.TorusGeometry(2,.5,16,12,Math.PI/2),c=new TEACHER.MSMat(16776960),e=new THREE.Mesh(b,c),e.rotation.z=Math.PI/2,e.position.x=2,e.position.y=1,theRotator.add(e),theRotator.setRR=function(a){theRotator.ball.position.x=a,theRotator.wire.position.x=a/2+2,theRotator.wire.scale.x=a/30}}function buildDownDesk(){downDesk01.wire=new TEACHER.ObjCylinder(.5,y0,16776960),downDesk01.wire.position.y=-.5*y0,downDesk01.mB=new TEACHER.ObjCylinder(4,8,16711680),downDesk01.mB.position.y=-y0,downDesk01.add(downDesk01.mB).add(downDesk01.wire),downDesk01.hand=new OneRightHand,downDesk01.hand.rotateHand(1,.001,.001,0,1,0),downDesk01.hand.bendHand(Math.PI/5),downDesk01.hand.position.x=7,downDesk01.hand.position.z=-4,downDesk01.hand.position.y=-1,downDesk01.mB.add(downDesk01.hand),downDesk02.wire=new TEACHER.ObjCylinder(.5,y0,16776960),downDesk02.wire.position.y=-.5*y0,downDesk02.mB=new TEACHER.ObjCylinder(4,8,16711680),downDesk02.mB.position.y=-y0,downDesk02.add(downDesk02.mB).add(downDesk02.wire),downDesk02.arJ=new TEACHER.ObjArrow(2,16776960),downDesk02.arJ.position.x=-6,downDesk02.add(downDesk02.arJ),downDesk03.wire=new TEACHER.ObjCylinder(.5,y0-20,16776960),downDesk03.wire.position.y=-.5*y0+10,downDesk03.mB=new TEACHER.ObjCylinder(4,8,16711680),downDesk03.mB.position.y=-y0+20,downDesk03.add(downDesk03.mB).add(downDesk03.wire),downDesk03.wire2=new TEACHER.ObjCylinder(.5,10,16776960),downDesk03.wire2.position.y=-y0-4-5+20,downDesk03.mC=new TEACHER.ObjCylinder(4,8,16711680),downDesk03.mC.position.y=-y0-4-10-4+20,downDesk03.add(downDesk03.mC).add(downDesk03.wire2)}function findRootRR(a){let b=r0,c=a,d=.5*(b+c),e=L0*L0/2/b/b-massB*gg*(r0-b)-energy0,f=L0*L0/2/c/c-massB*gg*(r0-c)-energy0,g=L0*L0/2/d/d-massB*gg*(r0-d)-energy0,h=0;for(;.001<Math.abs(b-c)&&1e3>h;)0>e*g?(c=d,f=g):(b=d,e=g),d=.5*(b+c),g=L0*L0/2/d/d-massB*gg*(r0-d)-energy0,h++;return d}function findRootRR03(a){let b=.99*r0,c=a,d=.5*(b+c),e=L0*L0/2/b/b-(massB+massC)*gg*(r0-b)-energy0,f=L0*L0/2/c/c-(massB+massC)*gg*(r0-c)-energy0,g=L0*L0/2/d/d-(massB+massC)*gg*(r0-d)-energy0,h=0;for(;.001<Math.abs(b-c)&&1e3>h;)0>e*g?(c=d,f=g):(b=d,e=g),d=.5*(b+c),g=L0*L0/2/d/d-(massB+massC)*gg*(r0-d)-energy0,h++;return d}class FireSmoke extends THREE.Object3D{constructor(a){super();let b=this;b.nn=a,b.iNow=0,b.xxiNow=0,b.velocities,b.velocities=new Float32Array(3*b.nn),b.positions=new Float32Array(3*b.nn),b.colors=new Float32Array(3*b.nn),b.sizes=new Float32Array(b.nn),b.ages=new Float32Array(b.nn);const c=new THREE.Vector3,d=new THREE.Color(16777215);for(let e=0;e<b.nn;e++)c.x=0,c.y=0,c.z=0,c.toArray(b.positions,3*e),d.setHSL(.5+.1*(e/b.nn),.7,.5),d.toArray(b.colors,3*e),b.sizes[e]=2,b.ages[e]=-1;const e=new THREE.BufferGeometry;e.setAttribute("position",new THREE.BufferAttribute(b.positions,3)),e.setAttribute("customColor",new THREE.BufferAttribute(b.colors,3)),e.setAttribute("size",new THREE.BufferAttribute(b.sizes,1));const f=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(16777215)},pointTexture:{value:new THREE.TextureLoader().load("allData/pics/ball.png")}},vertexShader:document.getElementById("vertexshader").textContent,fragmentShader:document.getElementById("fragmentshader").textContent,blending:THREE.AdditiveBlending,depthTest:!1,transparent:!0});b.points=new THREE.Points(e,f),b.add(b.points)}zero(){let a=this;a.iNow=0,a.xxiNow=0;const b=a.points.geometry,c=b.attributes;for(var d=0;d<a.nn;d++)c.position.array[3*d+0]=0,c.position.array[3*d+1]=0,c.position.array[3*d+2]=0,c.size.array[d]=1e-5,c.customColor.array[3*d+0]=1,c.customColor.array[3*d+1]=1,c.customColor.array[3*d+2]=1,a.ages[d]=-1;c.size.needsUpdate=!0,c.position.needsUpdate=!0,c.customColor.needsUpdate=!0}addOne(a,b,c,d,e,f,g){let h=this;const i=h.points.geometry,j=i.attributes;h.ages[h.iNow]=0,h.finalR=d,h.finalG=e,h.finalB=f,h.finalSize=g,j.position.array[3*h.iNow+0]=a,j.position.array[3*h.iNow+1]=b,j.position.array[3*h.iNow+2]=c,j.customColor.array[3*h.iNow+0]=1,j.customColor.array[3*h.iNow+1]=1,j.customColor.array[3*h.iNow+2]=1,h.iNow+=1,h.xxiNow+=1,h.iNow>=h.nn&&(h.iNow=0)}update(){let a=this;const b=a.points.geometry,c=b.attributes;for(let b=0;b<a.nn;b++){let d=c.position.array[3*b+0],e=c.position.array[3*b+1],f=c.position.array[3*b+2];a.ages[b]+=0<=a.ages[b]?1:0,c.size.array[b]=0<=a.ages[b]?a.finalSize+(20-a.finalSize)*Math.exp(-a.ages[b]/100):1e-5,c.position.array[3*b+0]=d,c.position.array[3*b+1]=e,c.position.array[3*b+2]=f,c.customColor.array[3*b+0]=a.finalR+(1-a.finalR)*Math.exp(-a.ages[b]/10),c.customColor.array[3*b+1]=a.finalG+(1-a.finalG)*Math.exp(-a.ages[b]/10),c.customColor.array[3*b+2]=a.finalB+(1-a.finalB)*Math.exp(-a.ages[b]/10)}c.size.needsUpdate=!0,c.position.needsUpdate=!0,c.customColor.needsUpdate=!0}}class OneRightHand extends THREE.Object3D{constructor(){super();let a=this;a.rotYIn=new THREE.Object3D,a.rotZMid=new THREE.Object3D,a.add(a.rotZMid),a.rotZMid.add(a.rotYIn);a.theta=0;var b=new TEACHER.ObjCylinder(4.5,9,16750899,!1,"z");b.position.z=-4.5,b.scale.x=.4,a.rotYIn.add(b);var b=new TEACHER.ObjCylinder(2,5,16750899,!1,"y");b.position.y=3,b.position.z=-3,b.position.x=-1,b.rotation.z=20*Math.PI/180,b.rotation.x=-20*Math.PI/180,a.rotYIn.add(b);var b=new TEACHER.ObjCylinder(1.5,3,16750899,!1,"y");b.position.y=6.2,b.position.z=-4,b.position.x=-1.8,b.rotation.x=-10*Math.PI/180,b.scale.z=.9,a.rotYIn.add(b);var b=new TEACHER.ObjCylinder(1,2,16750899,!1,"y");b.position.y=8.5,b.position.z=-4.2,b.position.x=-1.8,b.scale.z=.9,a.rotYIn.add(b);var c=new TEACHER.ObjSphere(1,16750899);c.position.y=8.5+1,c.position.z=-4.2,c.position.x=-1.8,c.scale.z=.9,c.scale.y=.6,a.rotYIn.add(c),a.lowerFingers=new THREE.Object3D,a.lowerFingers.position.z=-9,a.rotYIn.add(a.lowerFingers);var b=new TEACHER.ObjCylinder(1,3,16750899,!1,"z");b.position.z=-1.5,b.position.y=3.5,a.lowerFingers.add(b);var b=new TEACHER.ObjCylinder(1.2,3.4,16750899,!1,"z");b.position.z=-1.7,b.position.y=1.2,a.lowerFingers.add(b);var b=new TEACHER.ObjCylinder(1,3,16750899,!1,"z");b.position.z=-1.5,b.position.y=-1.2,a.lowerFingers.add(b);var b=new TEACHER.ObjCylinder(.9,2.9,16750899,!1,"z");b.position.z=-1.45,b.position.y=-3.2,a.lowerFingers.add(b),a.middleFingers=new THREE.Object3D,a.middleFingers.position.z=-3,a.lowerFingers.add(a.middleFingers);var b=new TEACHER.ObjCylinder(.85,2.2,16750899,!1,"z");b.position.z=-1.1,b.position.y=3.5,a.middleFingers.add(b);var b=new TEACHER.ObjCylinder(.9,2.6,16750899,!1,"z");b.position.z=-1.3,b.position.y=1.2,a.middleFingers.add(b);var b=new TEACHER.ObjCylinder(.85,2.2,16750899,!1,"z");b.position.z=-1.1,b.position.y=-1.2,a.middleFingers.add(b);var b=new TEACHER.ObjCylinder(.75,2,16750899,!1,"z");b.position.z=-1,b.position.y=-3.2,a.middleFingers.add(b),a.upperFingers=new THREE.Object3D,a.upperFingers.position.z=-2.2,a.middleFingers.add(a.upperFingers);var b=new TEACHER.ObjCylinder(.75,2,16750899,!1,"z");b.position.z=-1,b.position.y=3.5,a.upperFingers.add(b);var b=new TEACHER.ObjCylinder(.8,2.4,16750899,!1,"z");b.position.z=-1.2,b.position.y=1.2,a.upperFingers.add(b);var b=new TEACHER.ObjCylinder(.75,2,16750899,!1,"z");b.position.z=-1,b.position.y=-1.2,a.upperFingers.add(b);var b=new TEACHER.ObjCylinder(.65,1.8,16750899,!1,"z");b.position.z=-.9,b.position.y=-3.2,a.upperFingers.add(b)}bendHand(a){let b=this;b.theta=a,b.lowerFingers.rotation.y=a,b.middleFingers.rotation.y=a,b.upperFingers.rotation.y=a}rotateHand(a,b,c,d,e,f){let g=this,h=d**2+e**2+f**2,i=a**2+b**2+c**2;h=Math.sqrt(h),i=Math.sqrt(i);let j=d/h,k=e/h,l=f/h,m=a/i,n=b/i,o=c/i,p=Math.acos(k),q=Math.atan2(l,-j),r=Math.atan2(-n/Math.sin(p),-m*Math.sin(q)-o*Math.cos(q));g.rotYIn.rotation.y=r,g.rotZMid.rotation.z=p,g.rotation.y=q}}var TEACHER={};TEACHER.ObjPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(c,e),f.geo=new THREE.PlaneGeometry(a||10,b||10,1,1),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this;g.mat=new TEACHER.MSMat(c,f),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,2,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"==e&&(g.mesh.rotation.x=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this;d.mat=new TEACHER.MSMat(b,c),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjBox=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this;f.mat=new TEACHER.MSMat(d,e),f.geo=new THREE.BoxGeometry(a||10,b||10,c||10),f.mesh=new THREE.Mesh(f.geo,f.mat),f.add(f.mesh)}},TEACHER.MSMat=class extends THREE.MeshStandardMaterial{constructor(a,b){super({color:a||16711935,roughness:.4,side:b||0})}},TEACHER.ObjPicPlane=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=this,g=new THREE.TextureLoader().load(c);f.mat=new THREE.MeshBasicMaterial({map:g,transparent:!0,side:e||0}),f.geo=new THREE.PlaneGeometry(a,b,10,10),f.mesh=new THREE.Mesh(f.geo,f.mat),"x"===d?f.mesh.rotation.y=.5*Math.PI:"y"==d&&(f.mesh.rotation.x=-.5*Math.PI),f.add(f.mesh)}},TEACHER.ObjPicCylinder=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=new THREE.TextureLoader().load(c);g.mat=new THREE.MeshBasicMaterial({map:h,side:f||0}),g.geo=new THREE.CylinderGeometry(a||10,a||10,b||10,32,4,d),g.mesh=new THREE.Mesh(g.geo,g.mat),"x"===e?g.mesh.rotation.z=-.5*Math.PI:"z"===e?(g.mesh.rotation.y=.5*Math.PI,g.mesh.rotation.x=.5*Math.PI):"y"==e&&(g.mesh.rotation.y=.5*Math.PI),g.add(g.mesh)}},TEACHER.ObjPicSphere=class extends THREE.Object3D{constructor(a,b,c){super();let d=this,e=new THREE.TextureLoader().load(b);d.mat=new THREE.MeshBasicMaterial({map:e,side:c||0}),d.geo=new THREE.SphereGeometry(a||10,32,16),d.mesh=new THREE.Mesh(d.geo,d.mat),d.add(d.mesh)}},TEACHER.ObjArrow=class extends THREE.Object3D{constructor(a,b){super();let c=.5,d=new THREE.MeshStandardMaterial({color:b||16711935,roughness:.4}),e=new THREE.ConeGeometry(a||10,40,32);this.ArrowHead=new THREE.Mesh(e,d),this.ArrowHead.position.y=80,e=new THREE.CylinderGeometry((a||10)*c,(a||10)*c,60,32,2),this.ArrowBody=new THREE.Mesh(e,d),this.ArrowBody.position.y=30,this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.ArrowBody),this.rotX.add(this.ArrowHead)}setArrow(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/100):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.ObjSpring=class extends THREE.Object3D{constructor(a,b,c,d,e){super();let f=a||20;this.L0=f;let g=[],h=d||5,j=b||5;g.push(new THREE.Vector3(0,0,0)),g.push(new THREE.Vector3(0,.05*f,0));for(var k=0;k<=16*h;k++)g.push(new THREE.Vector3(j*Math.cos(2*k*Math.PI/16),f*(.05+.9*k/h/16),j*Math.sin(2*k*Math.PI/16)));g.push(new THREE.Vector3(0,.95*f,0)),g.push(new THREE.Vector3(0,f,0));let l=new THREE.CatmullRomCurve3(g),m=new THREE.MeshStandardMaterial({color:e||16711935,roughness:.4}),n=new THREE.TubeGeometry(l,500,c||.5,12);this.mesh=new THREE.Mesh(n,m),this.rotX=new THREE.Object3D,this.rotY=new THREE.Object3D,this.add(this.rotY),this.rotY.add(this.rotX),this.rotX.add(this.mesh)}setSpring(a,b,c){let d=a*a+b*b+c*c,e=Math.sqrt(d);0<d?(this.rotX.visible=!0,this.rotX.scale.y=e/this.L0):this.rotX.visible=!1,this.rotX.rotation.x=Math.acos(b/e),this.rotY.rotation.y=Math.atan2(a,c)}},TEACHER.Points=class extends THREE.Points{constructor(a,b,c){let d=new THREE.Color(a||16711935),e=new THREE.BufferGeometry,f=[];e.setAttribute("position",new THREE.Float32BufferAttribute(f,3)),e.computeBoundingSphere();let g=new THREE.PointsMaterial({size:b||1,map:TEACHER.Points.createCanvasMaterial("#"+d.getHexString(),64),transparent:!0,depthWrite:!1});super(e,g);let h=this;h.nnMax=c||1e4,h.nnNow=0,h.geometry=e,h.positions=f}static createCanvasMaterial(a,b){var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d");d.imageSmoothingEnabled=!1;var e=new THREE.Texture(c),f=b/2;return d.beginPath(),d.arc(f,f,b/2-3,0,2*Math.PI,!1),d.closePath(),d.fillStyle=a,d.fill(),e.needsUpdate=!0,e}addPoint(a,b,c){let d=this;d.nnNow<d.nnMax?d.nnNow++:(log("TEACHER.Points \u5230\u9054\u6700\u5927\u9EDE\u6578"),d.positions.shift(),d.positions.shift(),d.positions.shift()),d.positions.push(a,b,c)}clear(){let a=this;a.positions=[],a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Points \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this;a.geometry.setAttribute("position",new THREE.Float32BufferAttribute(a.positions,3)),a.geometry.computeBoundingSphere(),a.geometry.attributes.position.needsUpdate=!0}},TEACHER.Line=class extends THREE.Line2{constructor(a,b,c){let d=c||1e4;var e=new THREE.LineMaterial({color:a||16711935,linewidth:b||1});e.resolution.set(window.innerWidth,window.innerHeight);let f=new THREE.LineGeometry,g=new Float32Array(3*d);f.setPositions(g),super(f,e);let h=this;h.nnMax=d,h.lineWidth=b||1,h.nnNow=0,h.geometry=f,h.positions=g}addPoint(a,b,c){let d=this;if(d.nnNow<d.nnMax)d.nnNow++;else{log("TEACHER.Line \u5230\u9054\u6700\u5927\u9EDE\u6578");for(var e=0;e<d.nnMax-1;e++)d.positions[3*e]=d.positions[3*e+3],d.positions[3*e+1]=d.positions[3*e+4],d.positions[3*e+2]=d.positions[3*e+5]}for(var e=d.nnNow;e<=d.nnMax;e++)d.positions[3*(e-1)]=a,d.positions[3*(e-1)+1]=b,d.positions[3*(e-1)+2]=c}clear(){let a=this;a.positions=new Float32Array(3*a.nnMax);a.nnNow=0,a.update()}setPoint(a,b,c,d){let e=this;a>e.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>e.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(e.positions[3*a]=b,e.positions[3*a+1]=c,e.positions[3*a+2]=d)}getPoint(a){let b=this,c=new THREE.Vector3;return a>b.nnMax?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u6700\u5927\u9EDE\u6578 nnMax"):a>b.nnNow?log("\u8F38\u5165\u7684n\u503C\u5927\u65BCTEACHER.Line \u73FE\u5728\u9EDE\u6578 nnNow"):(c.x=b.positions[3*a],c.y=b.positions[3*a+1],c.z=b.positions[3*a+2]),c}update(){let a=this,b=a.getPoint(a.nnNow-1);for(var c=a.nnNow;c<=a.nnMax;c++)a.positions[3*c]=b.x,a.positions[3*c+1]=b.y,a.positions[3*c+2]=b.z;a.geometry.setPositions(a.positions)}},TEACHER.ObjTextPlane=class extends THREE.Object3D{constructor(a,b,c,d,e,f){super();let g=this,h=Math.round(Math.log2(a/b)),i=$("<canvas>").attr("width",128*Math.pow(2,h)+"").attr("height","128");g.stage=new createjs.Stage(i[0]);let j=new createjs.Container;if(f){let a=new createjs.Shape,b=new THREE.Color(f);a.graphics.c().f("#"+b.getHexString()).dr(0,0,128*Math.pow(2,h),128),j.addChild(a)}g.ctext=new createjs.Text;let k=new THREE.Color(e||16777215);g.ctext.color="#"+k.getHexString(),g.ctext.font="96px Arial",g.ctext.text=c||"",g.ctext.textAlign="center",g.ctext.textBaseline="middle",g.ctext.x=128*Math.pow(2,h)/2,g.ctext.y=64,j.addChild(g.ctext),g.stage.addChild(j),g.stage.update(),g.texture=new THREE.Texture(i[0]);var l=new THREE.MeshBasicMaterial({map:g.texture,transparent:!0}),m=new THREE.PlaneGeometry(a||10,b||10,1,1);g.texture.needsUpdate=!0,g.plane1=new THREE.Mesh(m,l),g.plane2=new THREE.Mesh(m,l),g.plane2.rotation.y=Math.PI;let n=new THREE.Object3D;n.add(g.plane1).add(g.plane2),"x"===d?n.rotation.y=.5*Math.PI:"y"==d&&(n.rotation.x=-.5*Math.PI),g.add(n)}setText(a){let b=this;b.ctext.text=a,b.stage.update(),b.texture.needsUpdate=!0}},TEACHER.ObjGraph=class extends THREE.Object3D{constructor(a,b,c,d,e,f,g){super();let h=this;h.objCon=new THREE.Object3D,h._xMin=a||0,h._xMax=b||10,h._yMin=c||0,h._yMax=d||10,h.divXN=5,h.divYN=4,h.frameMat=new THREE.LineBasicMaterial({color:e||16777215});for(var i=[],j=0;j<=h.divXN;j++)i.push(new THREE.Vector3(-50+20*j,0,0)),i.push(new THREE.Vector3(-50+20*j,50,0));for(var k=0;k<=h.divYN;k++)i.push(new THREE.Vector3(-50,12.5*k,0)),i.push(new THREE.Vector3(50,12.5*k,0));let l=new THREE.BufferGeometry().setFromPoints(i);h.frame=new THREE.LineSegments(l,h.frameMat),h.objCon.add(h.frame),h.labelXMin=new TEACHER.ObjTextPlane(20,5,h._xMin+"","z",e||16777215),h.labelXMin.position.x=-50,h.labelXMin.position.y=-3,h.objCon.add(h.labelXMin),h.labelXMax=new TEACHER.ObjTextPlane(20,5,h._xMax+"","z",e||16777215),h.labelXMax.position.x=50,h.labelXMax.position.y=-3,h.objCon.add(h.labelXMax),h.labelYMin=new TEACHER.ObjTextPlane(20,5,h._yMin+"","z",e||16777215),h.labelYMin.position.x=-53,h.labelYMin.position.y=0,h.objCon.add(h.labelYMin),h.labelYMax=new TEACHER.ObjTextPlane(20,5,h._yMax+"","z",e||16777215),h.labelYMax.position.x=-53,h.labelYMax.position.y=50,h.objCon.add(h.labelYMax),h.labelX=new TEACHER.ObjTextPlane(24,7,"x","z",e||16777215),h.labelX.position.x=60,h.labelX.position.y=4,h.labelX.position.z=1,h.labelY=new TEACHER.ObjTextPlane(24,7,"y","z",e||16777215),h.labelY.position.x=-60,h.labelY.position.y=25,h.labelY.position.z=1,h.labelY.rotation.z=Math.PI/2,h.labelTitle=new TEACHER.ObjTextPlane(40,10,"y-x","z",e||16777215),h.labelTitle.position.y=53,h.labelTitle.position.z=1,h.objCon.add(h.labelX).add(h.labelY).add(h.labelTitle),h._lineColor=f,h._nnMax=g,h.line=new TEACHER.Line(h._lineColor||16776960,2,h._nnMax),h.objCon.add(h.line),h.changeScale(),h.add(h.objCon)}addPoint(a,b){let c=this;c.line.addPoint(a,b,0),c.line.update()}clear(){let a=this;a.line.clear()}changeScale(){let a=this;a.line.scale.x=100/(a._xMax-a._xMin),a.line.scale.y=50/(a._yMax-a._yMin),a.line.position.x=-50-a._xMin*a.line.scale.x,a.line.position.y=-a._yMin*a.line.scale.y,a.labelXMin.setText(a._xMin),a.labelXMax.setText(a._xMax),a.labelYMin.setText(a._yMin),a.labelYMax.setText(a._yMax)}setLabel(a,b,c){let d=this;d.labelTitle.setText(a||"y-x"),d.labelY.setText(b||"y"),d.labelX.setText(c||"x")}get xMin(){return this._xMin}set xMin(a){this._xMin=a,this.changeScale()}get xMax(){return this._xMax}set xMax(a){this._xMax=a,this.changeScale()}get yMin(){return this._yMin}set yMin(a){this._yMin=a,this.changeScale()}get yMax(){return this._yMax}set yMax(a){this._yMax=a,this.changeScale()}};var skyBox=new THREE.Object3D;skyBox.wallU=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallU,"y",1),skyBox.wallD=new TEACHER.ObjPicPlane(1e4,1e4,pics.wallD,"y",0),skyBox.wallS=new TEACHER.ObjPicCylinder(5e3,1e4,pics.wallSide,!0,"y",1),skyBox.wallU.position.y=5e3,skyBox.wallD.position.y=-5e3,skyBox.add(skyBox.wallU).add(skyBox.wallD).add(skyBox.wallS),world3D.scene.add(skyBox);var ground=new TEACHER.ObjPicPlane(100,100,"allData/pics/ground.png","y");ground.position.x=0,scene.add(ground);var logo=new TEACHER.ObjPicPlane(100,100/8,pics.logo,"z",2);logo.position.x=0,logo.position.z=-50,logo.position.y=100/8/2,scene.add(logo);function getMouse3D(a){let b,c=a||"y",d=new THREE.Vector3;"x"===c?b=new THREE.Vector3(1,0,0):"y"===c?b=new THREE.Vector3(0,1,0):"z"===c?b=new THREE.Vector3(0,0,1):log("\u932F\u8AA4!!");let e=new THREE.Vector2;return e.x=2*(world2D.stage.mouseX/1600)-1,e.y=2*-(world2D.stage.mouseY/900)+1,world3D.raycaster.setFromCamera(e,world3D.camera),world3D.raycaster.ray.intersectPlane(new THREE.Plane(b),d),d}init();